
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xitrum Scala Web Framework Guide 3.30.0 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="#">Xitrum Scala Web Framework Guide 3.30.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Xitrum Scala Web Framework Guide 3.30.0 documentation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="xitrum">
<h1>Xitrum 가이드<a class="headerlink" href="#xitrum" title="Permalink to this headline">¶</a></h1>

<p>
  <a href="../../xitrum-ko.pdf" title="PDF" style="float:left"><img src="../../../pdf-ko.png"/></a>
  <a href="../../xitrum-ko.pdf" title="PDF">다운로드 PDF</a></p>
</p>
<div style="clear:both"></div>


<p>
  <a href="../../xitrum-ko.pdf" title="PDF" style="float:left"><img src="../../../pdf-ko.png"/></a>
  <a href="../../xitrum-ko.pdf" title="PDF">다운로드 PDF</a></p>
</p>
<div style="clear:both"></div>

<p><a class="reference external" href="http://xitrum-framework.github.io/guide.html">Xitrum 가이드는 영어, 일본어, 러시아어, 베트남어 버전으로 제공됩니다.</a></p>
<div class="toctree-wrapper compound">
<span id="document-intro"></span><div class="section" id="id1">
<h2>소개<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+</span>
<span class="o">|</span>      <span class="n">Clients</span>       <span class="o">|</span>
<span class="o">+--------------------+</span>
          <span class="o">|</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>       <span class="n">Netty</span>        <span class="o">|</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>       <span class="n">Xitrum</span>       <span class="o">|</span>
<span class="o">|</span> <span class="o">+----------------+</span> <span class="o">|</span>
<span class="o">|</span> <span class="o">|</span> <span class="n">HTTP</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="n">Server</span> <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span> <span class="o">|----------------|</span> <span class="o">|</span>
<span class="o">|</span> <span class="o">|</span> <span class="n">Web</span> <span class="n">framework</span>  <span class="o">|</span> <span class="o">|</span>  <span class="o">&lt;-</span> <span class="n">Akka</span><span class="p">,</span> <span class="n">Hazelcast</span> <span class="o">-&gt;</span> <span class="n">Other</span> <span class="n">instances</span>
<span class="o">|</span> <span class="o">+----------------+</span> <span class="o">|</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>      <span class="n">Your</span> <span class="n">app</span>      <span class="o">|</span>
<span class="o">+--------------------+</span>
</pre></div>
</div>
<p>Xitrum은 <a class="reference external" href="http://netty.io/">Netty</a> 와 <a class="reference external" href="http://akka.io/">Akka</a> 를 기반으로 구축된 비동기적으로 확장 가능한 HTTP(S) Web 프레임웍입니다.</p>
<p>Xitrum <a class="reference external" href="https://groups.google.com/group/xitrum-framework/msg/d6de4865a8576d39">사용자</a> 로 부터:</p>
<blockquote>
<div><p>이것은 정말 인상적인 작품으로 아마도 Lift를 제외하고 가장 완벽한(그리고 아주 쉬운) Scala 프레임웍 입니다.</p>
<p><a class="reference external" href="http://xitrum-framework.github.io/">Xitrum</a> 은 Web 프레임웍의 기본 기능을 모두 충족하는 풀 스택의 Web 프레임웍입니다.
정말 다행스러운건 ETags, 정적 파일 캐쉬, 자동 gzip 압축, 내장된 JSON 변환기, 인터셉터, 리퀘스트, 세션, 쿠키, 플래시 스코프, 서버와 클라이언트의 통합 검증, 내장된 캐쉬 (<a class="reference external" href="http://www.hazelcast.org/">Hazelcast</a>) 그리고 Netty가 내장된 기능을 바로 사용할 수 있습니다. 와우</p>
</div></blockquote>
<div class="section" id="id3">
<h3>기능<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Scala 사상에 기초한 Type-Safe. 모든 API는 Type-Safe하도록 디자인되어 있습니다.</p></li>
<li><p>Netty 사상에 기초한 비동기처리. 요청의 처리결과에 대한 액션을 곧바로 반환할 필요가 없습니다.
Long polling, chunked response (스트리밍), WebSocket, SockJS을 지원합니다.</p></li>
<li><p><a class="reference external" href="http://netty.io/">Netty</a> 에 내장된 고속 HTTP(S) 서버.
(HTTPS는Java엔진과 OpenSSL을 선택할 수 있습니다)
Xitrum의 정적파일 전송속도는 <a class="reference external" href="https://gist.github.com/3293596">Nginx</a> 와 비슷합니다.</p></li>
<li><p>빠른 응답을 위한 광범위한 서버와 클라이언트 캐쉬. 웹 서버 측 에서는 작은 파일은 메모리에 캐쉬되고 큰 파일은 NIO의 zero copy를 사용하여 전송됩니다.
웹 프레임웍 측에서는 Rails스타일 처럼 page, action, object cache를 사용합니다.
<a class="reference external" href="http://code.google.com/speed/page-speed/docs/rules_intro.html">All Google’s best practices</a> 에 있는것 처럼,
조건적으로 GET 에대해 클라이언트측 Cache가 적용됩니다.
물론 브라우저에 강제로 요청 및 재전송을 할 수 있습니다.</p></li>
<li><p>정적 파일에 대한 <a class="reference external" href="http://en.wikipedia.org/wiki/Byte_serving">Range requests</a> 지원.
이 기능으로 모바일에 동영상 전송이나 모든 클라이언트에게 파일 전송을 중지하거나 다시 시작할 수 있습니다.</p></li>
<li><p><a class="reference external" href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> 지원.</p></li>
<li><p>JAX-RS 와 Rails엔진의 사상에 기초한 자동 라우트 수집. 모든 경로에 대해서 하나의 파일에 선언할 필요가 없습니다.
이 기능은 분산 라우팅을 위해 고려되었습니다. 이 기능으로 인해 어플리케이션을 다른 어플리케이션에 통합이 가능합니다.
만약 당신이 블로그엔진을 만든다면 그것을 JAR처럼 다른 어플리케이션으로 통합하는 즉시 블로그 기능을 사용할 수 있게 합니다.
라우팅에는 두 가지 특징이 있습니다.
Type-Safe한 방법으로 URL을 재생성하거나(리버스 라우팅)
<a class="reference external" href="http://swagger.wordnik.com/">Swagger Doc</a> 을 이용하여 문서화 할 수 있습니다.</p></li>
<li><p>Develop Mode에서는 클래스 파일과 라우트 정보는 자동으로 갱신됩니다.</p></li>
<li><p>View는 독립적인 <a class="reference external" href="http://scalate.fusesource.org/">Scalate</a> 템플릿이나
Scala의 인라인 XML로 작성되고 모두 Type-Safe합니다.</p></li>
<li><p>Cookie에 의한(더 확장가능한) <a class="reference external" href="http://www.hazelcast.org/">Hazelcast</a> 클러스터를 이용한(보다 안전한) 세션 관리.
Hazelcast는, 매우 빠르고 쉬운, 프로세스간 분산 Cache도 제공합니다.
굳이 다른 캐시 서버를 준비 할 필요는 없습니다. 이것은 Akka의 pubsub 기능도 마찬가지입니다.</p></li>
<li><p><a class="reference external" href="http://jqueryvalidation.org/">jQuery Validation</a> 를 이용한 브라우저와 서버의 양쪽 검증.</p></li>
<li><p><a class="reference external" href="http://en.wikipedia.org/wiki/GNU_gettext">GNU gettext</a> 를 사용한 국제화.
텍스트의 추출과 번역이 자동으로 이루어져서 번잡한 속성 파일은 필요하지 않습니다.
번역과 통합작업에는 <a class="reference external" href="http://www.poedit.net/screenshots.php">Poedit</a> 와 같은 강력한 도구를 사용할 수 있습니다.
gettext는 대부분의 다른 솔루션과 달리 단수와 복수 두 형식을 모두 지원하고 있습니다.</p></li>
</ul>
<p>Xitrum은 <a class="reference external" href="https://github.com/scalatra/scalatra">Scalatra</a> ,
<a class="reference external" href="http://liftweb.net/">Lift</a> 두 가지 특징을 모두 사용하려고 합니다: Scalatra보다 강력하고 Lift보다 사용하기 쉬운 것이 특징입니다.
<a class="reference external" href="http://xitrum-framework.github.io/">Xitrum</a> 은 많은 개발자에게 친숙한 controller-first를 사용하기 위해 Scalatra의 controller-first를 Lift의 <a class="reference external" href="http://www.assembla.com/wiki/show/liftweb/View_First">view-first</a> 를 적용하지 않았습니다.</p>
<p><a class="reference internal" href="index.html#document-deps"><span class="doc">연관된 프로젝트</span></a> 샘플, 플러그인 등의 프로젝트 목록을 참고하세요.</p>
</div>
<div class="section" id="id7">
<h3>기여자들<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://xitrum-framework.github.io/">Xitrum</a> 은 <a class="reference external" href="https://github.com/xitrum-framework/xitrum">오픈소스</a> 프로젝트입니다.
<a class="reference external" href="http://groups.google.com/group/xitrum-framework">Google group</a>. 에 가입하세요.</p>
<p>기여자들은 <a class="reference external" href="https://github.com/xitrum-framework/xitrum/graphs/contributors">공헌한 날</a> 의 순서대로 되어있습니다:</p>
<p>(*): 현재 코어 개발자들ー</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ngocdaothanh">Ngoc Dao (*)</a></p></li>
<li><p><a class="reference external" href="https://github.com/alide">Linh Tran</a></p></li>
<li><p><a class="reference external" href="https://github.com/earldouglas">James Earl Douglas</a></p></li>
<li><p><a class="reference external" href="https://github.com/caiiiycuk">Aleksander Guryanov</a></p></li>
<li><p><a class="reference external" href="https://github.com/georgeOsdDev">Takeharu Oshida (*)</a></p></li>
<li><p><a class="reference external" href="https://github.com/kimkha">Nguyen Kim Kha</a></p></li>
<li><p><a class="reference external" href="https://github.com/murz">Michael Murray</a></p></li>
</ul>
</div>
</div>
<span id="document-tutorial"></span><div class="section" id="id1">
<h2>튜토리얼<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>이 장에서는 Xitrum 프로젝트를 만들고 실행하는 데까지를 간단하게 소개합니다.</p>
<p><strong>이 과정은 Java가 설치된 Linux 환경을 가정하고 있습니다.</strong></p>
<div class="section" id="xitrum">
<h3>Xitrum 프로젝트 만들기<a class="headerlink" href="#xitrum" title="Permalink to this headline">¶</a></h3>
<p>새 프로젝트를 만들려면
<a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/archive/master.zip">xitrum-new.zip</a> 를 다운로드 합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="o">-</span><span class="n">O</span> <span class="n">xitrum</span><span class="o">-</span><span class="n">new</span><span class="o">.</span><span class="n">zip</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">xitrum</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">xitrum</span><span class="o">-</span><span class="n">new</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">master</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
<p>또는:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="o">-</span><span class="n">o</span> <span class="n">xitrum</span><span class="o">-</span><span class="n">new</span><span class="o">.</span><span class="n">zip</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">xitrum</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">xitrum</span><span class="o">-</span><span class="n">new</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">master</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>시작하기<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Scala 빌드 도구로써 사실상의 표준인 <a class="reference external" href="https://github.com/harrah/xsbt/wiki/Setup">SBT</a> 를 사용합니다.
방금 다운로드한 프로젝트에는 이미 SBT 0.13 이 <code class="docutils literal notranslate"><span class="pre">sbt</span></code> 디렉토리에 포함되어 있습니다.
SBT를 직접설치 하려면 SBT의 <a class="reference external" href="https://github.com/harrah/xsbt/wiki/Setup">설치가이드</a> 를 참고하세요.</p>
<p>생성한 프로젝트의 루트 디렉토리에 <code class="docutils literal notranslate"><span class="pre">sbt/sbt</span> <span class="pre">fgRun</span></code> 을 실행하면 Xitrum이 시작됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unzip</span> <span class="n">xitrum</span><span class="o">-</span><span class="n">new</span><span class="o">.</span><span class="n">zip</span>
<span class="n">cd</span> <span class="n">xitrum</span><span class="o">-</span><span class="n">new</span>
<span class="n">sbt</span><span class="o">/</span><span class="n">sbt</span> <span class="n">fgRun</span>
</pre></div>
</div>
<p>이 명령은 의존 라이브러리( <a class="reference internal" href="index.html#document-deps"><span class="doc">dependencies</span></a> )의 다운로드 및 프로젝트 컴파일 후에
<code class="docutils literal notranslate"><span class="pre">quickstart.Boot</span></code> 클래스가 실행되고 WEB서버가 시작됩니다.
콘솔에는 다음과 같은 라우팅 정보가 표시됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Load</span> <span class="n">routes</span><span class="o">.</span><span class="n">cache</span> <span class="ow">or</span> <span class="n">recollect</span> <span class="n">routes</span><span class="o">...</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Normal</span> <span class="n">routes</span><span class="p">:</span>
<span class="n">GET</span>  <span class="o">/</span>  <span class="n">quickstart</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">SiteIndex</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">SockJS</span> <span class="n">routes</span><span class="p">:</span>
<span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span>  <span class="n">xitrum</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">XitrumMetricsChannel</span>  <span class="n">websocket</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="n">cookie_needed</span><span class="p">:</span> <span class="n">false</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Error</span> <span class="n">routes</span><span class="p">:</span>
<span class="mi">404</span>  <span class="n">quickstart</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">NotFoundError</span>
<span class="mi">500</span>  <span class="n">quickstart</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">ServerError</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Xitrum</span> <span class="n">routes</span><span class="p">:</span>
<span class="n">GET</span>        <span class="o">/</span><span class="n">webjars</span><span class="o">/</span><span class="n">swagger</span><span class="o">-</span><span class="n">ui</span><span class="o">/</span><span class="mf">2.0</span><span class="o">.</span><span class="mi">17</span><span class="o">/</span><span class="n">index</span>                            <span class="n">xitrum</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">SwaggerUiVersioned</span>
<span class="n">GET</span>        <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">xitrum</span><span class="o">.</span><span class="n">js</span>                                           <span class="n">xitrum</span><span class="o">.</span><span class="n">js</span>
<span class="n">GET</span>        <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span>                                     <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">Greeting</span>
<span class="n">GET</span>        <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">serverId</span><span class="o">/</span><span class="p">:</span><span class="n">sessionId</span><span class="o">/</span><span class="n">eventsource</span>    <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">EventSourceReceive</span>
<span class="n">GET</span>        <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">serverId</span><span class="o">/</span><span class="p">:</span><span class="n">sessionId</span><span class="o">/</span><span class="n">htmlfile</span>       <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">HtmlFileReceive</span>
<span class="n">GET</span>        <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">serverId</span><span class="o">/</span><span class="p">:</span><span class="n">sessionId</span><span class="o">/</span><span class="n">jsonp</span>          <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">JsonPPollingReceive</span>
<span class="n">POST</span>       <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">serverId</span><span class="o">/</span><span class="p">:</span><span class="n">sessionId</span><span class="o">/</span><span class="n">jsonp_send</span>     <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">JsonPPollingSend</span>
<span class="n">WEBSOCKET</span>  <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">serverId</span><span class="o">/</span><span class="p">:</span><span class="n">sessionId</span><span class="o">/</span><span class="n">websocket</span>      <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">WebSocket</span>
<span class="n">POST</span>       <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">serverId</span><span class="o">/</span><span class="p">:</span><span class="n">sessionId</span><span class="o">/</span><span class="n">xhr</span>            <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">XhrPollingReceive</span>
<span class="n">POST</span>       <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">serverId</span><span class="o">/</span><span class="p">:</span><span class="n">sessionId</span><span class="o">/</span><span class="n">xhr_send</span>       <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">XhrSend</span>
<span class="n">POST</span>       <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">serverId</span><span class="o">/</span><span class="p">:</span><span class="n">sessionId</span><span class="o">/</span><span class="n">xhr_streaming</span>  <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">XhrStreamingReceive</span>
<span class="n">GET</span>        <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="n">info</span>                                <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">InfoGET</span>
<span class="n">WEBSOCKET</span>  <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="n">websocket</span>                           <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">RawWebSocket</span>
<span class="n">GET</span>        <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">viewer</span>                                      <span class="n">xitrum</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">XitrumMetricsViewer</span>
<span class="n">GET</span>        <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">iframe</span>                             <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">Iframe</span>
<span class="n">GET</span>        <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">serverId</span><span class="o">/</span><span class="p">:</span><span class="n">sessionId</span><span class="o">/</span><span class="n">websocket</span>      <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">WebSocketGET</span>
<span class="n">POST</span>       <span class="o">/</span><span class="n">xitrum</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">channel</span><span class="o">/</span><span class="p">:</span><span class="n">serverId</span><span class="o">/</span><span class="p">:</span><span class="n">sessionId</span><span class="o">/</span><span class="n">websocket</span>      <span class="n">xitrum</span><span class="o">.</span><span class="n">sockjs</span><span class="o">.</span><span class="n">WebSocketPOST</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">HTTP</span> <span class="n">server</span> <span class="n">started</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">8000</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">HTTPS</span> <span class="n">server</span> <span class="n">started</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">4430</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Xitrum</span> <span class="n">started</span> <span class="ow">in</span> <span class="n">development</span> <span class="n">mode</span>
</pre></div>
</div>
<p>처음 실행시에는 모든 라우팅을 수집하여 로그에 기록합니다.
이 정보는 어플리케이션의 RESTful API에 대한 문서를 작성하는 경우에 이 정보는 매우 유용하게 사용될 수 있습니다.</p>
<p>브라우저에서 <a class="reference external" href="http://localhost:8000/">http://localhost:8000</a> 또는 <a class="reference external" href="http://localhost:4430/">https://localhost:4430</a> 에 접근하게 되면
다음과 같은 요청정보를 확인할 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">GET</span> <span class="n">quickstart</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">SiteIndex</span><span class="p">,</span> <span class="mi">1</span> <span class="p">[</span><span class="n">ms</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="eclipse">
<h3>Eclipse 프로젝트로 만들기<a class="headerlink" href="#eclipse" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://scala-ide.org/">Eclipse</a> 개발환경을 사용하는 경우</p>
<p>프로젝트 디렉토리에서 다음 명령을 실행합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sbt</span><span class="o">/</span><span class="n">sbt</span> <span class="n">eclipse</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">build.sbt</span></code> 에 기재된 프로젝트 설정에 따라 Eclipse용 <code class="docutils literal notranslate"><span class="pre">.project</span></code> 파일이 생성됩니다.
Eclipse를 열고 프로젝트를 임포트 합니다.</p>
</div>
<div class="section" id="intellij-idea">
<h3>IntelliJ IDEA 프로젝트 만들기<a class="headerlink" href="#intellij-idea" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a> 개발환경을 사용하는 경우엔,
그 스칼라 플러그인을 설치하여 SBT프로젝트를 그대로 임포트 해주세요.
이클립스의 경우와 같이 사용전에 프로젝트 화일을 생성하지 않아도 됩니다.</p>
</div>
<div class="section" id="id6">
<h3>자동 리로드<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>프로그램을 다시 시작하지 않고 .class 파일을 다시 로드（핫 스왑)할 수 있습니다.
그러나 프로그램의 성능과 안정성을 위하여 자동 리로드는 개발 시에만 사용하는 것을 권장합니다.</p>
<div class="section" id="ide">
<h4>IDE를 사용하는 경우<a class="headerlink" href="#ide" title="Permalink to this headline">¶</a></h4>
<p>최신의 Eclipse 나 IntelliJ와 같은 IDE를 사용해 개발하여 시작하는 경우에는
기본적으로 IDE가 소스코드의 변경을 감지하고 변경이 있을 경우에만 자동으로 컴파일해줍니다.</p>
</div>
<div class="section" id="id7">
<h4>SBT를 사용하는 경우<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>SBT를 사용하는 경우에는 두 가지의 콘솔 창을 준비하여야 합니다:</p>
<ul class="simple">
<li><p>하나는 <code class="docutils literal notranslate"><span class="pre">sbt/sbt</span> <span class="pre">fgRun</span></code> 을 실행합니다. 이 명령은 프로그램을 실행하여 .class 파일에 변경이 있을 경우에만 다시 로드합니다.</p></li>
<li><p>다른 하나는 <code class="docutils literal notranslate"><span class="pre">sbt/sbt</span> <span class="pre">~compile</span></code> 를 실행합니다. 이 명령은 소스 코드의 변경을 감지하여 변경이 있을 경우에만 .class 파일로 컴파일합니다.</p></li>
</ul>
<p>sbt 디렉토리 <a class="reference external" href="https://github.com/xitrum-framework/agent7">agent7.jar</a> 이 포함되어 있습니다.
이 라이브러리는 현재 디렉토리（및 하위 디렉토리)의 .class 파일 리로드를 담당합니다.
<code class="docutils literal notranslate"><span class="pre">sbt/sbt</span></code> 스크립트 중에 <code class="docutils literal notranslate"><span class="pre">-javaagent:agent7.jar</span></code> 로 사용되고 있습니다.</p>
</div>
<div class="section" id="dcevm">
<h4>DCEVM<a class="headerlink" href="#dcevm" title="Permalink to this headline">¶</a></h4>
<p>일반 JVM은 클래스 파일이 다시 로드되었을 때 메소드의 바디부분만 변경이 반영됩니다.
오픈소스인 <a class="reference external" href="https://github.com/dcevm/dcevm">DCEVM</a> 의 Java HotSpot VM를 사용하여
로드된 클래스의 재정의를 보다 유연하게 할 수 있습니다.</p>
<p>DCEVM은 다음의 두 가지 방법으로 설치 할 수 있습니다:</p>
<ul class="simple">
<li><p>이미 설치된 Java에  <a class="reference external" href="https://github.com/dcevm/dcevm/releases">Patch</a> 하는 방법</p></li>
<li><p><a class="reference external" href="http://dcevm.nentjes.com/">prebuilt</a> 버전 설치 (이 쪽이 간단합니다)</p></li>
</ul>
<p>패치를 사용하여 설치하는 경우:</p>
<ul class="simple">
<li><p>DCEVM를 항상 활성화 할 수 있습니다.</p></li>
<li><p>또는 DCEVM 를 “alternative” JVM으로 적용할 수 있습니다.
이 경우에는 <code class="docutils literal notranslate"><span class="pre">java</span></code> 명령에 <code class="docutils literal notranslate"><span class="pre">-XXaltjvm=dcevm</span></code> 옵션을 지정하여 DCEVM를 사용할 수 있습니다.
예를 들어, <code class="docutils literal notranslate"><span class="pre">sbt/sbt</span></code> 스크립트 파일에 <code class="docutils literal notranslate"><span class="pre">-XXaltjvm=dcevm</span></code> 를 추가해야 합니다.</p></li>
</ul>
<p>Eclipse나 IntelliJ와 같은 IDE를 사용하는 경우에는 DCEVM은 프로젝트의 실행 JVM를 지정해야 합니다.</p>
<p>SBT를 사용하는 경우에는 <code class="docutils literal notranslate"><span class="pre">java</span></code> 명령이 DCEVM를 사용할 수 있도록 <code class="docutils literal notranslate"><span class="pre">PATH</span></code> 환경변수를 지정해 줘야 합니다.
DCEVM는 자체 클래스의 변경을 지원하지만, 새로고침을 하지 않기 때문에, DCEVM를 사용하는 경우에도 <code class="docutils literal notranslate"><span class="pre">javaagent</span></code> 가 필요합니다.</p>
<p>자세한 내용은 <a class="reference external" href="http://javainformed.blogspot.jp/2014/01/jrebel-free-alternative.html">DCEVM - A JRebel free alternative</a> 를 참고하세요.</p>
</div>
</div>
<div class="section" id="id9">
<h3>무시되는 파일들<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="index.html#document-tutorial"><span class="doc">튜토리얼</span></a> 에 따라 프로젝트를 만든 경우에는 <a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/.gitignore">ignored</a> 를 참고하여 ignore 파일을 작성하세요.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.*</span>
<span class="n">log</span>
<span class="n">project</span><span class="o">/</span><span class="n">project</span>
<span class="n">project</span><span class="o">/</span><span class="n">target</span>
<span class="n">target</span>
<span class="n">tmp</span>
</pre></div>
</div>
</div>
</div>
<span id="document-action_view"></span><div class="section" id="action-view">
<h2>Action 과 view<a class="headerlink" href="#action-view" title="Permalink to this headline">¶</a></h2>
<p>유연함을 위해, Xitrum은 3가지 형태의 Action을 제공합니다.
보통 <code class="docutils literal notranslate"><span class="pre">Action</span></code>, <code class="docutils literal notranslate"><span class="pre">FutureAction</span></code>, <code class="docutils literal notranslate"><span class="pre">ActorAction</span></code> 입니다.</p>
<div class="section" id="normal-action">
<h3>Normal Action<a class="headerlink" href="#normal-action" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HelloAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">respondText</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>요청은 Netty의 IO스레드로 직접로 처리되므로 시간이 걸리는 처리(블록처리)를 포함하면 안됩니다.
Netty의 IO스레드를 오래 사용하게 되면 Netty는 새로운 연결을 할 수 없거나 응답을 회신할 수 없게 되기 때문입니다.</p>
</div>
<div class="section" id="futureaction">
<h3>FutureAction<a class="headerlink" href="#futureaction" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.FutureAction</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HelloAction</span> <span class="n">extends</span> <span class="n">FutureAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">respondText</span><span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>요청은 Netty의 스레드 풀과는 별개로 다음의 <code class="docutils literal notranslate"><span class="pre">ActorAction</span></code> 과 같은 스레드 풀에서 처리됩니다.</p>
</div>
<div class="section" id="actor-action">
<h3>Actor Action<a class="headerlink" href="#actor-action" title="Permalink to this headline">¶</a></h3>
<p>Action 을 Akka actor 처럼 정의하려면 <code class="docutils literal notranslate"><span class="pre">ActorAction</span></code> 을 상속하면 됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scala.concurrent.duration._</span>

<span class="kn">import</span> <span class="nn">xitrum.ActorAction</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HelloAction</span> <span class="n">extends</span> <span class="n">ActorAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">See</span> <span class="n">Akka</span> <span class="n">doc</span> <span class="n">about</span> <span class="n">scheduler</span>
    <span class="kn">import</span> <span class="nn">context.dispatcher</span>
    <span class="n">context</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">scheduleOnce</span><span class="p">(</span><span class="mi">3</span> <span class="n">seconds</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="p">())</span>

    <span class="o">//</span> <span class="n">See</span> <span class="n">Akka</span> <span class="n">doc</span> <span class="n">about</span> <span class="s2">&quot;become&quot;</span>
    <span class="n">context</span><span class="o">.</span><span class="n">become</span> <span class="p">{</span>
      <span class="n">case</span> <span class="n">pastTime</span> <span class="o">=&gt;</span>
        <span class="n">respondInlineView</span><span class="p">(</span><span class="n">s</span><span class="s2">&quot;It&#39;s $pastTime Unix ms 3s ago.&quot;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Actor 인스턴스는 요청이 발생할때 생성됩니다. 이 actor 인스턴스는 연결이 끊어지거나
<code class="docutils literal notranslate"><span class="pre">respondText</span></code>, <code class="docutils literal notranslate"><span class="pre">respondView</span></code> 등의 메소드를 통해 응답을 얻을때 중지됩니다.
청크응답의 경우 즉시 중지되지 않고 마지막 청크가 전송된 시점에서 중지됩니다.</p>
<p>요청은 “xitrum”이라고 불리는 Akka actor 시스템 스레드 풀에서 처리됩니다.</p>
</div>
<div class="section" id="id1">
<h3>클라이언트로의 전송<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Action으로 부터 클라이언트로 응답을 전송하려면 다음과 같은 방법을 사용합니다</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">respondView</span></code>: 레이아웃을 포함하거나 포함하지 않고 View 템플릿을 전송합니다</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondInlineView</span></code>: 레이아웃을 포함하거나 포함하지 않고 인라인으로 작성된 템플릿을 전송합니다</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondText(&quot;hello&quot;)</span></code>: 레이아웃 파일을 사용하지 않고 문자열을 보냅니다</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondHtml(&quot;&lt;html&gt;...&lt;/html&gt;&quot;)</span></code>: contentType을 “text/html” 형식으로 문자열을 보냅니다</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondJson(List(1,</span> <span class="pre">2,</span> <span class="pre">3))</span></code>: Scala 객체를 JSON으로 변환하여 contentType을 “application/json” 형식으로 보냅니다</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondJs(&quot;myFunction([1,</span> <span class="pre">2,</span> <span class="pre">3])&quot;)</span></code> contentType을 “application/javascript”으로 문자열을 보냅니다</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondJsonP(List(1,</span> <span class="pre">2,</span> <span class="pre">3),</span> <span class="pre">&quot;myFunction&quot;)</span></code>: 위 두 가지를 조합하여 JSONP로 보냅니다</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondJsonText(&quot;[1,</span> <span class="pre">2,</span> <span class="pre">3]&quot;)</span></code>: contentType을 “application/javascript”으로 문자열을 보냅니다</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondJsonPText(&quot;[1,</span> <span class="pre">2,</span> <span class="pre">3]&quot;,</span> <span class="pre">&quot;myFunction&quot;)</span></code>: <cite>respondJs</cite>, <a href="#id2"><span class="problematic" id="id3">`</span></a>respondJsonText`의 두 가지 조합을 JSONP로 보냅니다</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondBinary</span></code>: 바이트 배열로 보냅니다</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondFile</span></code>: 디스크에서 파일을 직접 보냅니다. <a class="reference external" href="http://www.ibm.com/developerworks/library/j-zerocopy/">zero-copy</a> 를 사용하기 때문에 매우 빠릅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondEventSource(&quot;data&quot;,</span> <span class="pre">&quot;event&quot;)</span></code>: 청크응답을 보냅니다</p></li>
</ul>
</div>
<div class="section" id="view">
<h3>템플릿 View 파일 응답<a class="headerlink" href="#view" title="Permalink to this headline">¶</a></h3>
<p>모든 Action은  <a class="reference external" href="http://scalate.fusesource.org/">Scalate</a> 의 템플릿 View 파일과 연관이 있습니다.
위의 응답방식을 사용하여 직접 응답을 보내는 대신 별도의 View파일을 사용하여 응답을 보낼 수 있습니다.</p>
<p>scr/main/scala/mypackage/MyAction.scala:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">mypackage</span>

<span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;myAction&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">respondView</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">what</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Hello </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>scr/main/scalate/mypackage/MyAction.jade:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- import mypackage.MyAction

!!! 5
html
  head
    != antiCsrfMeta
    != xitrumCss
    != jsDefaults
    title Welcome to Xitrum

  body
    a(href={url}) Path to the current action
    p= currentAction.asInstanceOf[MyAction].hello(&quot;World&quot;)

    != jsForView
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xitrumCss</span></code> Xitrum 의 기본 CSS파일입니다. 삭제해도 무방합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jsDefaults</span></code> jQuery, jQuery Validate plugin등을 포함하고 있습니다. &lt;head&gt;안에 명시해야 합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jsForView</span></code> <code class="docutils literal notranslate"><span class="pre">jsAddToView</span></code> 에 의해 추가된 javascript가 출력됩니다. 레이아웃의 끝에 명시해야 합니다.</p></li>
</ul>
<p>템플릿 파일에서 <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/Action.scala">xitrum.Action</a> 클래스의 모든 파일을 사용할 수 있습니다.
또한, <code class="docutils literal notranslate"><span class="pre">unescape</span></code> 같은 Scalate 유틸리티도 사용할 수 있습니다. Scalate의 유틸리티는 <a class="reference external" href="http://scalate.fusesource.org/documentation/index.html">Scalate doc</a>　를 참고하세요.</p>
<p>Scalate 템플릿의 기본 유형은 <a class="reference external" href="http://scalate.fusesource.org/documentation/jade.html">Jade</a> 를 사용하고 있습니다.
또한 <a class="reference external" href="http://scalate.fusesource.org/documentation/mustache.html">Mustache</a> ,
<a class="reference external" href="http://scalate.fusesource.org/documentation/scaml-reference.html">Scaml</a> ,
<a class="reference external" href="http://scalate.fusesource.org/documentation/ssp-reference.html">Ssp</a> 를 선택할 수 있습니다.
템플릿의 기본 유형을 어플리케이션의 config 디렉토리내의 <cite>xitrum.conf</cite> 에서 설정할 수 있습니다.</p>
<p><cite>respondView</cite> 메소드의 type 매개변수로 “jade”, “mustache”, “scaml”, “ssp” 중 하나를 지정하여 기본 템플릿 유형을 무시하고 사용할 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">options</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="s2">&quot;type&quot;</span> <span class="o">-&gt;</span><span class="s2">&quot;mustache&quot;</span><span class="p">)</span>
<span class="n">respondView</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="currentaction">
<h4>currentAction의 캐스팅<a class="headerlink" href="#currentaction" title="Permalink to this headline">¶</a></h4>
<p>지금의 Action의 인스턴스를 정확하게 지정하려면 <code class="docutils literal notranslate"><span class="pre">currentAction</span></code> 를 지정한 Action 캐스팅합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">=</span> <span class="n">currentAction</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="p">[</span><span class="n">MyAction</span><span class="p">]</span><span class="o">.</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>여러 줄로 사용하는 경우에 캐스트 처리를 한 번만 호출합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">val</span> <span class="n">myAction</span> <span class="o">=</span> <span class="n">currentAction</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="p">[</span><span class="n">MyAction</span><span class="p">];</span> <span class="kn">import</span> <span class="nn">myAction._</span>

<span class="n">p</span><span class="o">=</span> <span class="n">hello</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">=</span> <span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Scala&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">=</span> <span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Xitrum&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>Mustache<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Mustache에 대한 참고자료:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://mustache.github.com/mustache.5.html">Mustache syntax</a></p></li>
<li><p><a class="reference external" href="http://scalate.fusesource.org/documentation/mustache.html">Scalate implementation</a></p></li>
</ul>
<p>Mustach는 구문위반에 강력해서 Jade 에서 할 수 있는 작업중 일부는 사용할 수 없습니다.</p>
<p>Action 에서 뭔가 값을 전달할 경우에는 <code class="docutils literal notranslate"><span class="pre">at</span></code> 메소드를 사용합니다.</p>
<p>Action:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">at</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Jack&quot;</span>
<span class="n">at</span><span class="p">(</span><span class="s2">&quot;xitrumCss&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">xitrumCss</span>
</pre></div>
</div>
<p>Mustache template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">My</span> <span class="n">name</span> <span class="ow">is</span> <span class="p">{{</span><span class="n">name</span><span class="p">}}</span>
<span class="p">{{</span><span class="n">xitrumCss</span><span class="p">}}</span>
</pre></div>
</div>
<p>주의:다음키는 예약어 이므로 <code class="docutils literal notranslate"><span class="pre">at</span></code> 메소드를 통해 Scalate 템플릿에 전달할 수 없습니다.</p>
<ul class="simple">
<li><p>“context”: <code class="docutils literal notranslate"><span class="pre">unescape</span></code> 등의 메소드를 포함하여 Scalate 객체</p></li>
<li><p>“helper”: 현재 Action 객체</p></li>
</ul>
</div>
<div class="section" id="coffeescript">
<h4>CoffeeScript<a class="headerlink" href="#coffeescript" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://scalate.fusesource.org/documentation/jade-syntax.html#filters">:coffeescript filter</a> 를 사용하여
CoffeeScript 템플릿에 배포할 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span>
  <span class="p">:</span><span class="n">coffeescript</span>
    <span class="n">alert</span> <span class="s2">&quot;Hello, Coffee!&quot;</span>
</pre></div>
</div>
<p>출력결과:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;body&gt;
  &lt;script type=&#39;text/javascript&#39;&gt;
    //&lt;![CDATA[
      (function() {
        alert(&quot;Hello, Coffee!&quot;);
      }).call(this);
    //]]&gt;
  &lt;/script&gt;
&lt;/body&gt;
</pre></div>
</div>
<p>주의: 그러나 이 작업은 <a class="reference external" href="http://groups.google.com/group/xitrum-framework/browse_thread/thread/6667a7608f0dc9c7">slow</a> 문제가 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jade</span><span class="o">+</span><span class="n">javascript</span><span class="o">+</span><span class="mi">1</span><span class="n">thread</span><span class="p">:</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="n">ms</span> <span class="k">for</span> <span class="n">page</span>
<span class="n">jade</span><span class="o">+</span><span class="n">coffesscript</span><span class="o">+</span><span class="mi">1</span><span class="n">thread</span><span class="p">:</span> <span class="mi">40</span><span class="o">-</span><span class="mi">70</span><span class="n">ms</span> <span class="k">for</span> <span class="n">page</span>
<span class="n">jade</span><span class="o">+</span><span class="n">javascript</span><span class="o">+</span><span class="mi">100</span><span class="n">threads</span><span class="p">:</span> <span class="o">~</span><span class="mi">40</span><span class="n">ms</span> <span class="k">for</span> <span class="n">page</span>
<span class="n">jade</span><span class="o">+</span><span class="n">coffesscript</span><span class="o">+</span><span class="mi">100</span><span class="n">threads</span><span class="p">:</span> <span class="mi">400</span><span class="o">-</span><span class="mi">700</span><span class="n">ms</span> <span class="k">for</span> <span class="n">page</span>
</pre></div>
</div>
<p>빠른속도로 동작시키기 위해서는 미리 CoffeeScript에서 Javascript를 생성해야 합니다.</p>
</div>
</div>
<div class="section" id="id5">
<h3>레이아웃<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">respondView</span></code> 또 <code class="docutils literal notranslate"><span class="pre">respondInlineView</span></code> 를 사용하여 View를 보낸 경우
Xitrum은 결과 문자열을 <code class="docutils literal notranslate"><span class="pre">renderedView</span></code> 변수로 설정합니다.
그리고 현재 Action의 <code class="docutils literal notranslate"><span class="pre">layout</span></code> 메소드가 실행됩니다.
브라우저에 전송되는 데이터는 결국 이 메소드의 결과가 표시됩니다.</p>
<p>기본적으로 <code class="docutils literal notranslate"><span class="pre">layout</span></code> 메소드는 단지 <code class="docutils literal notranslate"><span class="pre">renderedView</span></code> 를 호출합니다.
만약 이 처리방법에 무언가를 추가하려면 재정의가 필요합니다. 만약 <code class="docutils literal notranslate"><span class="pre">renderedView</span></code> 메소드에 포함하려는 경우에는
이 View의 레이아웃의 일부로 포함됩니다.</p>
<p>포인트는 <code class="docutils literal notranslate"><span class="pre">layout</span></code> 현재의 Action View가 실행된 후라는 것입니다.
여기에서 반환되는 값이 브라우저에 전달이 되는것 입니다.</p>
<p>이 메커니즘은 매우 간단하고 마법이 없습니다. 간단하게 Xitrum 에는 레이아웃이 존재하지 않는다고 생각할 수 있습니다.
여기에는 단지 <code class="docutils literal notranslate"><span class="pre">layout</span></code> 메소드가 있을 뿐 모두 이 방법으로 표현할 수 있습니다.</p>
<p>전형적인 예로 일반적인 레이아웃을 부모 클래스로 사용하는 패턴을 보여줍니다.</p>
<p>src/main/scala/mypackage/AppAction.scala</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">mypackage</span>
<span class="kn">import</span> <span class="nn">xitrum.Action</span>

<span class="n">trait</span> <span class="n">AppAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">override</span> <span class="k">def</span> <span class="nf">layout</span> <span class="o">=</span> <span class="n">renderViewNoLayout</span><span class="p">[</span><span class="n">AppAction</span><span class="p">]()</span>
<span class="p">}</span>
</pre></div>
</div>
<p>src/main/scalate/mypackage/AppAction.jade</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!!! 5
html
  head
    != antiCsrfMeta
    != xitrumCss
    != jsDefaults
    title Welcome to Xitrum

  body
    != renderedView
    != jsForView
</pre></div>
</div>
<p>src/main/scala/mypackage/MyAction.scala</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">mypackage</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;myAction&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyAction</span> <span class="n">extends</span> <span class="n">AppAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">respondView</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">what</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;Hello </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>scr/main/scalate/mypackage/MyAction.jade:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="kn">import</span> <span class="nn">mypackage.MyAction</span>

<span class="n">a</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">})</span> <span class="n">Path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">current</span> <span class="n">action</span>
<span class="n">p</span><span class="o">=</span> <span class="n">currentAction</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="p">[</span><span class="n">MyAction</span><span class="p">]</span><span class="o">.</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id6">
<h4>독립적인 레이아웃 파일을 사용하지 않는 패턴<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>AppAction.scala</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.view.DocType</span>

<span class="n">trait</span> <span class="n">AppAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">override</span> <span class="k">def</span> <span class="nf">layout</span> <span class="o">=</span> <span class="n">DocType</span><span class="o">.</span><span class="n">html5</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">antiCsrfMeta</span><span class="p">}</span>
        <span class="p">{</span><span class="n">xitrumCss</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsDefaults</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Welcome</span> <span class="n">to</span> <span class="n">Xitrum</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">renderedView</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsForView</span><span class="p">}</span>
      <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="respondview">
<h4>respondView 레이아웃을 직접 패스<a class="headerlink" href="#respondview" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">specialLayout</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span>
  <span class="n">DocType</span><span class="o">.</span><span class="n">html5</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">antiCsrfMeta</span><span class="p">}</span>
        <span class="p">{</span><span class="n">xitrumCss</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsDefaults</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Welcome</span> <span class="n">to</span> <span class="n">Xitrum</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">renderedView</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsForView</span><span class="p">}</span>
      <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="p">)</span>

<span class="n">respondView</span><span class="p">(</span><span class="n">specialLayout</span> <span class="n">_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="inline-view">
<h3>Inline view<a class="headerlink" href="#inline-view" title="Permalink to this headline">¶</a></h3>
<p>일반적인 Scalate 파일에 포함되지만 직접Action에 표기할 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import xitrum.Action
import xitrum.annotation.GET

@GET(&quot;myAction&quot;)
class MyAction extends Action {
  def execute() {
    val s = &quot;World&quot;  // Will be automatically HTML-escaped
    respondInlineView(
      &lt;p&gt;Hello &lt;em&gt;{s}&lt;/em&gt;!&lt;/p&gt;
    )
  }
}
</pre></div>
</div>
</div>
<div class="section" id="render-fragment">
<h3>Render fragment<a class="headerlink" href="#render-fragment" title="Permalink to this headline">¶</a></h3>
<p>MyAction.jade가
<code class="docutils literal notranslate"><span class="pre">scr/main/scalate/mypackage/MyAction.jade</span></code>
에 있는 경우 :
같은 디렉토리에 있는 조각파일을 반환하는 경우:
<code class="docutils literal notranslate"><span class="pre">scr/main/scalate/mypackage/_MyFragment.jade</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">renderFragment</span><span class="p">[</span><span class="n">MyAction</span><span class="p">](</span><span class="s2">&quot;MyFragment&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>현재 Action이 <code class="docutils literal notranslate"><span class="pre">MyAction</span></code> 의 경우에는 다음과 같이 생략이 가능합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">renderFragment</span><span class="p">(</span><span class="s2">&quot;MyFragment&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>다른 Action의 View를 응답하는 경우<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>다음의 메소드를 사용합니다 <code class="docutils literal notranslate"><span class="pre">respondView[ClassName]()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">mypackage</span>

<span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.</span><span class="p">{</span><span class="n">GET</span><span class="p">,</span> <span class="n">POST</span><span class="p">}</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">LoginFormAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">Respond</span> <span class="n">scr</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">scalate</span><span class="o">/</span><span class="n">mypackage</span><span class="o">/</span><span class="n">LoginFormAction</span><span class="o">.</span><span class="n">jade</span>
    <span class="n">respondView</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nd">@POST</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DoLoginAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">val</span> <span class="n">authenticated</span> <span class="o">=</span> <span class="o">...</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">authenticated</span><span class="p">)</span>
      <span class="n">redirectTo</span><span class="p">[</span><span class="n">HomeAction</span><span class="p">]()</span>
    <span class="k">else</span>
      <span class="o">//</span> <span class="n">Reuse</span> <span class="n">the</span> <span class="n">view</span> <span class="n">of</span> <span class="n">LoginFormAction</span>
      <span class="n">respondView</span><span class="p">[</span><span class="n">LoginFormAction</span><span class="p">]()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="id8">
<h4>하나의 Action - 여러 View사용<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">mypackage</span>

<span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="o">//</span> <span class="n">These</span> <span class="n">are</span> <span class="n">non</span><span class="o">-</span><span class="n">routed</span> <span class="n">actions</span><span class="p">,</span> <span class="k">for</span> <span class="n">mapping</span> <span class="n">to</span> <span class="n">view</span> <span class="n">template</span> <span class="n">files</span><span class="p">:</span>
<span class="o">//</span> <span class="n">scr</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">scalate</span><span class="o">/</span><span class="n">mypackage</span><span class="o">/</span><span class="n">HomeAction_NormalUser</span><span class="o">.</span><span class="n">jade</span>
<span class="o">//</span> <span class="n">scr</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">scalate</span><span class="o">/</span><span class="n">mypackage</span><span class="o">/</span><span class="n">HomeAction_Moderator</span><span class="o">.</span><span class="n">jade</span>
<span class="o">//</span> <span class="n">scr</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">scalate</span><span class="o">/</span><span class="n">mypackage</span><span class="o">/</span><span class="n">HomeAction_Admin</span><span class="o">.</span><span class="n">jade</span>
<span class="n">trait</span> <span class="n">HomeAction_NormalUser</span> <span class="n">extends</span> <span class="n">Action</span>
<span class="n">trait</span> <span class="n">HomeAction_Moderator</span>  <span class="n">extends</span> <span class="n">Action</span>
<span class="n">trait</span> <span class="n">HomeAction_Admin</span>      <span class="n">extends</span> <span class="n">Action</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HomeAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">val</span> <span class="n">userType</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">userType</span> <span class="n">match</span> <span class="p">{</span>
      <span class="n">case</span> <span class="n">NormalUser</span> <span class="o">=&gt;</span> <span class="n">respondView</span><span class="p">[</span><span class="n">HomeAction_NormalUser</span><span class="p">]()</span>
      <span class="n">case</span> <span class="n">Moderator</span>  <span class="o">=&gt;</span> <span class="n">respondView</span><span class="p">[</span><span class="n">HomeAction_Moderator</span><span class="p">]()</span>
      <span class="n">case</span> <span class="n">Admin</span>      <span class="o">=&gt;</span> <span class="n">respondView</span><span class="p">[</span><span class="n">HomeAction_Admin</span><span class="p">]()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>위와 같이 라우팅과 상관없는 작업을 설명하는것이 어려워 보일수는 있지만
이 방법은 프로그램이 형식에 대해 안정성을 유지할 수 있습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">String</span></code> 값을 이용하여 템블릿 위치를 지정할 수도 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">respondView</span><span class="p">(</span><span class="s2">&quot;mypackage/HomeAction_NormalUser&quot;</span><span class="p">)</span>
<span class="n">respondView</span><span class="p">(</span><span class="s2">&quot;mypackage/HomeAction_Moderator&quot;</span><span class="p">)</span>
<span class="n">respondView</span><span class="p">(</span><span class="s2">&quot;mypackage/HomeAction_Admin&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="component">
<h3>Component<a class="headerlink" href="#component" title="Permalink to this headline">¶</a></h3>
<p>여러 View에 통합 할 수 있는 재사용이 가능한 구성요소를 생성 수 있습니다.
구성 요소의 개념은 액션과 매우 비슷합니다.
다음과 같은 특징이 있습니다.</p>
<ul class="simple">
<li><p>구성요소는 루트가 없습니다. 즉 <code class="docutils literal notranslate"><span class="pre">execute</span></code> 메소드는 필요가 없습니다.</p></li>
<li><p>구성요소는 전체 응답을 반환하지 않습니다. 단편적인 view를 “render” 하기만 합니다.
따라서, 구성요소 내부에서 <code class="docutils literal notranslate"><span class="pre">respondXXX</span></code> 대신 <code class="docutils literal notranslate"><span class="pre">renderXXX</span></code> 호출해야 합니다.</p></li>
<li><p>Action처럼 구성요소는 단일 혹은 여러 View와 연관이 있거나 연관성 없이 사용할 수 있습니다.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>package mypackage

import xitrum.{FutureAction, Component}
import xitrum.annotation.GET

class CompoWithView extends Component {
  def render() = {
    // Render associated view template, e.g. CompoWithView.jade
    // Note that this is renderView, not respondView!
    renderView()
  }
}

class CompoWithoutView extends Component {
  def render() = {
    &quot;Hello World&quot;
  }
}

@GET(&quot;foo/bar&quot;)
class MyAction extends FutureAction {
  def execute() {
    respondView()
  }
}
</pre></div>
</div>
<p>MyAction.jade:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="kn">import</span> <span class="nn">mypackage._</span>

<span class="o">!=</span> <span class="n">newComponent</span><span class="p">[</span><span class="n">CompoWithView</span><span class="p">]()</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
<span class="o">!=</span> <span class="n">newComponent</span><span class="p">[</span><span class="n">CompoWithoutView</span><span class="p">]()</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<span id="document-restful"></span><div class="section" id="restful-apis">
<h2>RESTful APIs<a class="headerlink" href="#restful-apis" title="Permalink to this headline">¶</a></h2>
<p>Xitrum으로 iPhone, Android 등의 앱을 위한 RESTful APIs를 간단하게 만들 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesIndex</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles/:id&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesShow</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span><span class="n">다</span>
<span class="p">}</span>
</pre></div>
</div>
<p>POST, PUT, PATCH, DELETE, OPTIONS 뿐만 아니라
Xitrum은 HEAD의 GET 요청을 빈 바디응답으로 자동으로 처리합니다.</p>
<p>일반 브라우저처럼 PUT과 DELETE를 지원하지 않는 HTTP 클라이언트에서도
PUT과 DELETE를 구현하려면 응답 본문에 <code class="docutils literal notranslate"><span class="pre">_method=put</span></code> 나 <code class="docutils literal notranslate"><span class="pre">_method=delete</span></code> 를 포함하여
사용할 수 있습니다.</p>
<p>어플리케이션을 시작할때 Xitrum 어플리케이션을 스캔하여 라우팅 테이블을 만들고 출력합니다.
다음과 같은 로그에서 어플리케이션이 어떤 API를 지원하고 있는지 알 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Routes</span><span class="p">:</span>
<span class="n">GET</span> <span class="o">/</span><span class="n">articles</span>     <span class="n">quickstart</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">ArticlesIndex</span>
<span class="n">GET</span> <span class="o">/</span><span class="n">articles</span><span class="o">/</span><span class="p">:</span><span class="nb">id</span> <span class="n">quickstart</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">ArticlesShow</span>
</pre></div>
</div>
<p>라우팅은 JAX-RS과 Rails의 철학에 따라 자동으로 수집됩니다.
모든 경로를 한군데에 설정할 필요가 없습니다.
분산 라우팅처럼 이 기능 덕분에 어플리케이션을 다른 어플리케이션에 통합할 수 있습니다.
만약 블로그 엔진을 만든다면 패키징된 JAR파일을 다른 어플리케이션으로 가져와서 즉시 블로그 기능을 사용할 수 있습니다.
라우팅에는 두 가지 특징이 있습니다.
안전한 방법으로 루트를 재생성하거나(리버스 라우팅)
<a class="reference external" href="http://swagger.wordnik.com/">Swagger Doc</a> 이라고 하는 문서를 통해서 만들 수 있습니다.</p>
<div class="section" id="id1">
<h3>루트 캐싱<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>어플리케이션 시작시 속도 향상을 위해 루트는 <code class="docutils literal notranslate"><span class="pre">routes.cache</span></code> 파일에 캐쉬됩니다.
개발 시에는 <code class="docutils literal notranslate"><span class="pre">target</span></code> 파일에 있는 클래스 파일의 루트는 캐쉬되지 않습니다.
만약 루트를 포함하여 라이브러리가 업데이트 된 경우에는 <code class="docutils literal notranslate"><span class="pre">routes.cache</span></code> 파일을 삭제하세요.
또한, 이 파일은 소스 저장소에 커밋되지 않도록 주의해야 합니다.</p>
</div>
<div class="section" id="first-last">
<h3>루트의 우선순위(first, last)<a class="headerlink" href="#first-last" title="Permalink to this headline">¶</a></h3>
<p>다음과 같은 루트를 만든 경우</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">articles</span><span class="o">/</span><span class="p">:</span><span class="nb">id</span> <span class="o">--&gt;</span> <span class="n">ArticlesShow</span>
<span class="o">/</span><span class="n">articles</span><span class="o">/</span><span class="n">new</span> <span class="o">--&gt;</span> <span class="n">ArticlesNew</span>
</pre></div>
</div>
<p>두 번째 루트를 우선시 할 경우 <code class="docutils literal notranslate"><span class="pre">&#64;First</span></code> 주석을 추가시킵니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.annotation.</span><span class="p">{</span><span class="n">GET</span><span class="p">,</span> <span class="n">First</span><span class="p">}</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles/:id&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesShow</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@First</span>  <span class="o">//</span> <span class="n">This</span> <span class="n">route</span> <span class="n">has</span> <span class="n">higher</span> <span class="n">priority</span> <span class="n">than</span> <span class="s2">&quot;ArticlesShow&quot;</span> <span class="n">above</span>
<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles/new&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesNew</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Last</span></code> 도 똑같이 사용할 수 있습니다.</p>
</div>
<div class="section" id="action">
<h3>Action에 여러 경로를 연동<a class="headerlink" href="#action" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;image/:format&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Image</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">val</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">paramo</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
    <span class="o">//</span> <span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>점을 포함하는 루트<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles/:id&quot;</span><span class="p">,</span> <span class="s2">&quot;articles/:id.:format&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesShow</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">val</span> <span class="nb">id</span>     <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="n">Int</span><span class="p">](</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="nb">format</span> <span class="o">=</span> <span class="n">paramo</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s2">&quot;html&quot;</span><span class="p">)</span>
    <span class="o">//</span> <span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>정규 표현식을 이용한 라우팅<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>정규 표현식을 이용하여 라우팅할 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GET</span><span class="p">(</span><span class="s2">&quot;articles/:id&lt;[0-9]+&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>경로의 나머지 부분 이용<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">/</span></code> 문자는 특수문자라서 매개변수에 포함되지 않습니다. <code class="docutils literal notranslate"><span class="pre">/</span></code> 문자를 사용하려면 다음과 같이 씁니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GET</span><span class="p">(</span><span class="s2">&quot;service/:id/proxy/:*&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>다음의 경로를 가져오게 됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">service</span><span class="o">/</span><span class="mi">123</span><span class="o">/</span><span class="n">proxy</span><span class="o">/</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">foo</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">bar</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">:*</span></code> 를 가져오게 됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">url</span> <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>  <span class="o">//</span> <span class="s2">&quot;http://foo.com/bar&quot;</span> <span class="n">입니다</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>액션에 링크추가<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Xitrum은 typesafe하므로 URL을 직접 사용하면 안 됩니다. 다음처럼 사용하세요:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">ArticlesShow</span><span class="p">](</span><span class="s2">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="n">myArticle</span><span class="o">.</span><span class="n">id</span><span class="p">)}</span><span class="o">&gt;</span><span class="p">{</span><span class="n">myArticle</span><span class="o">.</span><span class="n">title</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>다른 액션으로 리디랙션<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>참고 <a class="reference external" href="http://en.wikipedia.org/wiki/URL_redirection">what redirection is</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.</span><span class="p">{</span><span class="n">GET</span><span class="p">,</span> <span class="n">POST</span><span class="p">}</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">LoginInput</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@POST</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DoLogin</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="o">//</span> <span class="n">After</span> <span class="n">login</span> <span class="n">success</span>
    <span class="n">redirectTo</span><span class="p">[</span><span class="n">AdminIndex</span><span class="p">]()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">GET</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AdminIndex</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="o">//</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">the</span> <span class="n">user</span> <span class="n">has</span> <span class="ow">not</span> <span class="n">logged</span> <span class="ow">in</span><span class="p">,</span> <span class="n">redirect</span> <span class="n">him</span> <span class="n">to</span> <span class="n">the</span> <span class="n">login</span> <span class="n">page</span>
    <span class="n">redirectTo</span><span class="p">[</span><span class="n">LoginInput</span><span class="p">]()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>현재 액션을 다음을 이용하여 변경할 수도 있습니다. <code class="docutils literal notranslate"><span class="pre">redirecToThis()</span></code>.</p>
</div>
<div class="section" id="id7">
<h3>다른 액션에 요청 전달<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">forwardTo[AnotherAction]()</span></code> 사용시에는  <code class="docutils literal notranslate"><span class="pre">redirectTo</span></code> 은 다른 요청을 만들어서 전달하지만</dt><dd><p><code class="docutils literal notranslate"><span class="pre">forwardTo</span></code> 는 요청이 유지됩니다.</p>
</dd>
</dl>
</div>
<div class="section" id="ajax">
<h3>Ajax 요청 여부 확인<a class="headerlink" href="#ajax" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">isAjax</span></code> 을 사용합니다.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">In</span> <span class="n">an</span> <span class="n">action</span>
<span class="n">val</span> <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;A message&quot;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">isAjax</span><span class="p">)</span>
  <span class="n">jsRender</span><span class="p">(</span><span class="s2">&quot;alert(&quot;</span> <span class="o">+</span> <span class="n">jsEscape</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
<span class="k">else</span>
  <span class="n">respondText</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="anti-csrf">
<h3>Anti-CSRF<a class="headerlink" href="#anti-csrf" title="Permalink to this headline">¶</a></h3>
<p>GET 이외의 요청에 Xitrum은 기본적으로 <a class="reference external" href="http://en.wikipedia.org/wiki/CSRF">Cross-site request forgery</a> 방식을 고수합니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">antiCsrfMeta</span></code> Tags의 레이아웃에 명시한 경우:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.view.DocType</span>

<span class="n">trait</span> <span class="n">AppAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">override</span> <span class="k">def</span> <span class="nf">layout</span> <span class="o">=</span> <span class="n">DocType</span><span class="o">.</span><span class="n">html5</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">antiCsrfMeta</span><span class="p">}</span>
        <span class="p">{</span><span class="n">xitrumCss</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsDefaults</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Welcome</span> <span class="n">to</span> <span class="n">Xitrum</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">renderedView</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsForView</span><span class="p">}</span>
      <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>출력되는 <code class="docutils literal notranslate"><span class="pre">&lt;head&gt;</span></code> 는 다음과 같습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    ...
    &lt;meta name=&quot;csrf-token&quot; content=&quot;5402330e-9916-40d8-a3f4-16b271d583be&quot; /&gt;
    ...
  &lt;/head&gt;
  ...
&lt;/html&gt;
</pre></div>
</div>
<dl class="simple">
<dt><a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/js.scala">xitrum.js</a> 이 템플릿 내에서 사용되는 경우,</dt><dd><p>토큰은 GET 요청을 제외한 모든 jQuery 의 Ajax 요청에 <code class="docutils literal notranslate"><span class="pre">X-CSRF-Token</span></code> 을 포함합니다.</p>
</dd>
</dl>
<p>xitrum.js은 <code class="docutils literal notranslate"><span class="pre">jsDefaults</span></code> 에 포함되어 있습니다.
만약 <code class="docutils literal notranslate"><span class="pre">jsDefaults</span></code> 를 사용하지 않고 xitrum.js를 사용하고 싶다면 다음과 같이 사용합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span> <span class="n">src</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">xitrum</span><span class="o">.</span><span class="n">js</span><span class="p">]}</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="anticsrfinput-anticsrftoken">
<h3>antiCsrfInput 과 antiCsrfToken<a class="headerlink" href="#anticsrfinput-anticsrftoken" title="Permalink to this headline">¶</a></h3>
<p>Xitrum은 CSRF토큰을 <code class="docutils literal notranslate"><span class="pre">X-CSRF-Token</span></code> 의 요청헤더에서 가져옵니다.
만약 요청헤더가 없다면 <code class="docutils literal notranslate"><span class="pre">csrf-token</span></code> 의 바디 파라미터에서 가져옵니다.
（URL의 파라미터가 아닙니다）</p>
<p>Form을 직접 작성할 때에 메타 태그와 xitrum.js을 사용하지 않는다면 <code class="docutils literal notranslate"><span class="pre">antiCsrfInput</span></code> 또는
<code class="docutils literal notranslate"><span class="pre">antiCsrfToken</span></code> 을 사용해야 합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">AdminAddGroup</span><span class="p">]})</span>
  <span class="o">!=</span> <span class="n">antiCsrfInput</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">AdminAddGroup</span><span class="p">]})</span>
  <span class="nb">input</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;csrf-token&quot;</span> <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="n">antiCsrfToken</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="csrf">
<h3>CSRF 체크 생략<a class="headerlink" href="#csrf" title="Permalink to this headline">¶</a></h3>
<p>스마트폰과 같은 기기를 위해서 API를 작성할 경우 CSRF체크를 생략할 수 있습니다.
<code class="docutils literal notranslate"><span class="pre">xitrum.SkipCsrfCheck</span></code> 를 Action에 추가하면 됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.</span><span class="p">{</span><span class="n">Action</span><span class="p">,</span> <span class="n">SkipCsrfCheck</span><span class="p">}</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.POST</span>

<span class="n">trait</span> <span class="n">Api</span> <span class="n">extends</span> <span class="n">Action</span> <span class="k">with</span> <span class="n">SkipCsrfCheck</span>

<span class="nd">@POST</span><span class="p">(</span><span class="s2">&quot;api/positions&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">LogPositionAPI</span> <span class="n">extends</span> <span class="n">Api</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@POST</span><span class="p">(</span><span class="s2">&quot;api/todos&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CreateTodoAPI</span> <span class="n">extends</span> <span class="n">Api</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>라우팅 조작<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Xitrum 은 시작 시에 자동으로 경로를 수집합니다.
경로를 수정하고 싶다면 다음을 이용하세요
<a class="reference external" href="http://xitrum-framework.github.io/api/3.17/index.html#xitrum.routing.RouteCollection">xitrum.Config.routes</a>.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.</span><span class="p">{</span><span class="n">Config</span><span class="p">,</span> <span class="n">Server</span><span class="p">}</span>

<span class="nb">object</span> <span class="n">Boot</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">String</span><span class="p">])</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">You</span> <span class="n">can</span> <span class="n">modify</span> <span class="n">routes</span> <span class="n">before</span> <span class="n">starting</span> <span class="n">the</span> <span class="n">server</span>
    <span class="n">val</span> <span class="n">routes</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">routes</span>

    <span class="o">//</span> <span class="n">Remove</span> <span class="n">routes</span> <span class="n">to</span> <span class="n">an</span> <span class="n">action</span> <span class="n">by</span> <span class="n">its</span> <span class="k">class</span>
    <span class="nc">routes</span><span class="o">.</span><span class="n">removeByClass</span><span class="p">[</span><span class="n">MyClass</span><span class="p">]()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">demoVersion</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">//</span> <span class="n">Remove</span> <span class="n">routes</span> <span class="n">to</span> <span class="n">actions</span> <span class="n">by</span> <span class="n">a</span> <span class="n">prefix</span>
      <span class="n">routes</span><span class="o">.</span><span class="n">removeByPrefix</span><span class="p">(</span><span class="s2">&quot;premium/features&quot;</span><span class="p">)</span>

      <span class="o">//</span> <span class="n">This</span> <span class="n">also</span> <span class="n">works</span>
      <span class="n">routes</span><span class="o">.</span><span class="n">removeByPrefix</span><span class="p">(</span><span class="s2">&quot;/premium/features&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="o">...</span>

    <span class="n">Server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3>요청 내용 가져오기<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>요청에 대한 타입이 <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> 이 아닐 경우에는
요청에 대한 내용을 가져오고 수동으로 파싱이 가능합니다.</p>
<p>문자열로 가져오기:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">body</span> <span class="o">=</span> <span class="n">requestContentString</span>
</pre></div>
</div>
<p>문자열로 가져와서 JSON형식으로 변경합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">myJValue</span> <span class="o">=</span> <span class="n">requestContentJValue</span>  <span class="o">//</span> <span class="o">=&gt;</span> <span class="n">JSON4S</span> <span class="p">(</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">json4s</span><span class="o">.</span><span class="n">org</span><span class="p">)</span> <span class="n">JValue</span>
<span class="n">val</span> <span class="n">myMap</span> <span class="o">=</span> <span class="n">xitrum</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">SeriDeseri</span><span class="o">.</span><span class="n">fromJValue</span><span class="p">[</span><span class="n">Map</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">Int</span><span class="p">]](</span><span class="n">myJValue</span><span class="p">)</span>
</pre></div>
</div>
<p>요청 전체를 컨트롤 하려면 <a class="reference external" href="http://netty.io/4.0/api/io/netty/handler/codec/http/FullHttpRequest.html">request.getContent</a> 을 사용하면 됩니다.
<a class="reference external" href="http://netty.io/4.0/api/io/netty/buffer/ByteBuf.html">ByteBuf</a> 타입으로 리턴합니다.</p>
</div>
<div class="section" id="swagger-api">
<h3>Swagger로 API 문서화 하기<a class="headerlink" href="#swagger-api" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://developers.helloreverb.com/swagger/">Swagger</a> 를 이용하여 API문서를 만들수 있습니다.
<code class="docutils literal notranslate"><span class="pre">&#64;Swagger</span></code> 태그를 문서화하고 싶은 API에 명시하면 됩니다.
Xitrum은 문서파일을 <a class="reference external" href="https://github.com/wordnik/swagger-core/wiki/API-Declaration">/xitrum/swagger.json</a> 에 생성합니다.
이 파일들은 <a class="reference external" href="https://github.com/wordnik/swagger-ui">Swagger UI</a> 를 이용하여 인터렉티브한 API문서를 생성합니다.
Xitrum은Swagger UI 를 내포하고 있으며 <code class="docutils literal notranslate"><span class="pre">/xitrum/swagger-ui</span></code> 에서 확인할 수 있습니다.
: <a class="reference external" href="http://localhost:8000/xitrum/swagger-ui">http://localhost:8000/xitrum/swagger-ui</a>.</p>
<img alt="_images/swagger.png" src="_images/swagger.png" />
<p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-placeholder">예제</a> 는 여기에 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.</span><span class="p">{</span><span class="n">Action</span><span class="p">,</span> <span class="n">SkipCsrfCheck</span><span class="p">}</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.</span><span class="p">{</span><span class="n">GET</span><span class="p">,</span> <span class="n">Swagger</span><span class="p">}</span>

<span class="nd">@Swagger</span><span class="p">(</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">Tags</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;APIs to create images&quot;</span><span class="p">),</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">Description</span><span class="p">(</span><span class="s2">&quot;Dimensions should not be bigger than 2000 x 2000&quot;</span><span class="p">),</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">OptStringQuery</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;Text to render on the image, default: Placeholder&quot;</span><span class="p">),</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">Produces</span><span class="p">(</span><span class="s2">&quot;image/png&quot;</span><span class="p">),</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;PNG image&quot;</span><span class="p">),</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;Width or height is invalid or too big&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">trait</span> <span class="n">ImageApi</span> <span class="n">extends</span> <span class="n">Action</span> <span class="k">with</span> <span class="n">SkipCsrfCheck</span> <span class="p">{</span>
  <span class="n">lazy</span> <span class="n">val</span> <span class="n">text</span> <span class="o">=</span> <span class="n">paramo</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s2">&quot;Placeholder&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;image/:width/:height&quot;</span><span class="p">)</span>
<span class="nd">@Swagger</span><span class="p">(</span>  <span class="o">//</span> <span class="o">&lt;--</span> <span class="n">Inherits</span> <span class="n">other</span> <span class="n">info</span> <span class="kn">from</span> <span class="nn">ImageApi</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">Summary</span><span class="p">(</span><span class="s2">&quot;Generate rectangle image&quot;</span><span class="p">),</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">IntPath</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">),</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">IntPath</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">RectImageApi</span> <span class="n">extends</span> <span class="n">Api</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span> <span class="p">{</span>
    <span class="n">val</span> <span class="n">width</span>  <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="n">Int</span><span class="p">](</span><span class="s2">&quot;width&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="n">height</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="n">Int</span><span class="p">](</span><span class="s2">&quot;height&quot;</span><span class="p">)</span>
    <span class="o">//</span> <span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;image/:width&quot;</span><span class="p">)</span>
<span class="nd">@Swagger</span><span class="p">(</span>  <span class="o">//</span> <span class="o">&lt;--</span> <span class="n">Inherits</span> <span class="n">other</span> <span class="n">info</span> <span class="kn">from</span> <span class="nn">ImageApi</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">Summary</span><span class="p">(</span><span class="s2">&quot;Generate square image&quot;</span><span class="p">),</span>
  <span class="n">Swagger</span><span class="o">.</span><span class="n">IntPath</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">class</span> <span class="nc">SquareImageApi</span> <span class="n">extends</span> <span class="n">Api</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span> <span class="p">{</span>
    <span class="n">val</span> <span class="n">width</span>  <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="n">Int</span><span class="p">](</span><span class="s2">&quot;width&quot;</span><span class="p">)</span>
    <span class="o">//</span> <span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">/xitrum/swagger</span></code> 에 접근할때
<a class="reference external" href="https://github.com/wordnik/swagger-spec/blob/master/versions/1.2.md">JSON For Swagger</a>
가 생성됩니다.</p>
<p>Swagger UI는 이 JSON 정보를 바탕으로 인터랙티브한 API 문서를 만듭니다.</p>
<p>여기에 있는 Swagger.IntPath, Swagger.OptStringQuery, 이외에도 BytePath, IntQuery, OptStringForm 등이
form에 명시되어 있습니다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;Value</span> <span class="pre">type&gt;&lt;Param</span> <span class="pre">type&gt;</span></code> (필수 값)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Opt&lt;Value</span> <span class="pre">type&gt;&lt;Param</span> <span class="pre">type&gt;</span></code> (옵션 값)</p></li>
</ul>
<p>Value type: Byte, Int, Int32, Int64, Long, Number, Float, Double, String, Boolean, Date, DateTime</p>
<p>Param type: Path, Query, Body, Header, Form</p>
<p>자세한 내용은 <a class="reference external" href="https://github.com/wordnik/swagger-core/wiki/Datatypes">value type</a> ,
<a class="reference external" href="https://github.com/wordnik/swagger-core/wiki/Parameters">param type</a> 를 참고하세요.</p>
</div>
</div>
<span id="document-template_engines"></span><div class="section" id="id1">
<h2>템플릿 엔진<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="index.html#document-action_view"><span class="doc">renderView 이나 renderFragment, respondView</span></a> 이 호출되면
설정된 템플릿 엔진이 호출됩니다.</p>
<div class="section" id="id2">
<h3>템플릿 엔진 설정<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/config/xitrum.conf">config/xitrum.conf</a> 에서 템플릿 엔진은 그 형식에 따라서 다음과 같이 두 종류로 설정이 가능합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="o">=</span> <span class="n">my</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">EngineClassName</span>
</pre></div>
</div>
<p>또는:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="p">{</span>
  <span class="s2">&quot;my.template.EngineClassName&quot;</span> <span class="p">{</span>
    <span class="n">option1</span> <span class="o">=</span> <span class="n">value1</span>
    <span class="n">option2</span> <span class="o">=</span> <span class="n">value2</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>기본 템플릿 엔진은 <a class="reference external" href="https://github.com/xitrum-framework/xitrum-scalate">xitrum-scalate</a> 입니다.</p>
</div>
<div class="section" id="id3">
<h3>템플릿 엔진 제거<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>단지 RESTful API만을 만들 경우에 renderView, renderFragment, respondView를 호출할 필요가 없습니다. 이 경우 템플릿 엔진을 프로젝트에서 삭제해서 프로젝트를 더 가볍게 만들 수 있습니다.
방법은 config/xitrum.conf 에서 <code class="docutils literal notranslate"><span class="pre">templateEngine</span></code> 을 지우거나 주석 처리하세요.</p>
</div>
<div class="section" id="id4">
<h3>템플릿 엔진 만들기<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>나민의 템플릿 엔진을 만들려면 <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/view/TemplateEngine.scala">xitrum.view.TemplateEngine</a> 을 상속받아 클래스를 만듭니다.
그리고 나서 config/xitrum.conf 에 명시하면 됩니다.</p>
<p>예제: <a class="reference external" href="https://github.com/xitrum-framework/xitrum-scalate">xitrum-scalate</a></p>
</div>
</div>
<span id="document-postback"></span><div class="section" id="id1">
<h2>포스트백<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Web 어플리케이션은 다음과 같은 두 가지 경우로 많이 사용됩니다.</p>
<ul class="simple">
<li><p>서버를 위해 사용하는 경우: 스마트폰을 위한 RESTful API를 만들거나, 다른 웹사이트를 위한 웹서비</p></li>
<li><p>사람을 위해 사용하는 경우: 인터랙티브한 웹 서비스</p></li>
</ul>
<p>Web 프레임워크를 기반으로 Xitrum은 이 두가지를 쉽게 사용할 수 있는것을 목표로 하고 있습니다.
1번째 케이스를 사용하기 위해서、<a class="reference internal" href="index.html#document-restful"><span class="doc">RESTful actions</span></a> 를 적용하여 대응하고、
2번째 케이스를 사용하기 위해、Ajax폼을 사용하고 있습니다.
아래 링크에서 postback에 대한 개념을 알 수 있습니다.</p>
<ul class="simple">
<li><p><a class="reference external" href="http://en.wikipedia.org/wiki/Postback">http://en.wikipedia.org/wiki/Postback</a></p></li>
<li><p><a class="reference external" href="http://nitrogenproject.com/doc/tutorial.html">http://nitrogenproject.com/doc/tutorial.html</a></p></li>
</ul>
<p>Xitrum은  <a class="reference external" href="http://nitrogenproject.com/">Nitrogen</a> 영향을 받아서 작성되었습니다.</p>
<div class="section" id="id2">
<h3>레이아웃<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>AppAction.scala</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.view.DocType</span>

<span class="n">trait</span> <span class="n">AppAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">override</span> <span class="k">def</span> <span class="nf">layout</span> <span class="o">=</span> <span class="n">DocType</span><span class="o">.</span><span class="n">html5</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">antiCsrfMeta</span><span class="p">}</span>
        <span class="p">{</span><span class="n">xitrumCss</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsDefaults</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Welcome</span> <span class="n">to</span> <span class="n">Xitrum</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">renderedView</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsForView</span><span class="p">}</span>
      <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>폼<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Articles.scala</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.annotation.</span><span class="p">{</span><span class="n">GET</span><span class="p">,</span> <span class="n">POST</span><span class="p">,</span> <span class="n">First</span><span class="p">}</span>
<span class="kn">import</span> <span class="nn">xitrum.validator._</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles/:id&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesShow</span> <span class="n">extends</span> <span class="n">AppAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">val</span> <span class="nb">id</span>      <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">respondInlineView</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="p">{</span><span class="n">article</span><span class="o">.</span><span class="n">title</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="p">{</span><span class="n">article</span><span class="o">.</span><span class="n">body</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nd">@First</span>  <span class="o">//</span> <span class="n">Force</span> <span class="n">this</span> <span class="n">route</span> <span class="n">to</span> <span class="n">be</span> <span class="n">matched</span> <span class="n">before</span> <span class="s2">&quot;show&quot;</span>
<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles/new&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesNew</span> <span class="n">extends</span> <span class="n">AppAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">respondInlineView</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="n">form</span> <span class="n">data</span><span class="o">-</span><span class="n">postback</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">ArticlesCreate</span><span class="p">]}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">Title</span><span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;title&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;required&quot;</span> <span class="o">/&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>

        <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span><span class="n">Body</span><span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">textarea</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;body&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;required&quot;</span><span class="o">&gt;&lt;/</span><span class="n">textarea</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>

        <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Save&quot;</span> <span class="o">/&gt;</span>
      <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nd">@POST</span><span class="p">(</span><span class="s2">&quot;articles&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesCreate</span> <span class="n">extends</span> <span class="n">AppAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">val</span> <span class="n">title</span>   <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="n">body</span>    <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>

    <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Article has been saved.&quot;</span><span class="p">)</span>
    <span class="n">jsRedirectTo</span><span class="p">(</span><span class="n">show</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="n">article</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">submit</span></code> 이벤트가 JavaScript 에서 실행될 때, 폼은 <code class="docutils literal notranslate"><span class="pre">ArticlesCreate</span></code> 으로 postback을 보냅니다.
<code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code> 의 <code class="docutils literal notranslate"><span class="pre">action</span></code> 속성은 암호화 되고 암호화된 URL은 CSRF토큰 대신 사용하게 됩니다.</p>
</div>
<div class="section" id="form">
<h3>form 이외의 사용<a class="headerlink" href="#form" title="Permalink to this headline">¶</a></h3>
<p>포스트백은 form이 아닌 HTML 요소에서 사용이 가능합니다.</p>
<p>링크를 사용하는 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span> <span class="n">data</span><span class="o">-</span><span class="n">postback</span><span class="o">=</span><span class="s2">&quot;click&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">LogoutAction</span><span class="p">]}</span><span class="o">&gt;</span><span class="n">Logout</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>링크를 클릭하게 되면 LogoutAction으로 포스트백 메세지를 보냅니다.</p>
</div>
<div class="section" id="id4">
<h3>확인 다이얼로그<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>확인 다이얼로그를 표시하고 싶은 경우:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span> <span class="n">data</span><span class="o">-</span><span class="n">postback</span><span class="o">=</span><span class="s2">&quot;click&quot;</span>
            <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">LogoutAction</span><span class="p">]}</span>
            <span class="n">data</span><span class="o">-</span><span class="n">confirm</span><span class="o">=</span><span class="s2">&quot;Do you want to logout?&quot;</span><span class="o">&gt;</span><span class="n">Logout</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>사용자가 취소를 클릭하게 되면 postback 메세지는 보내지 않습니다.</p>
</div>
<div class="section" id="id5">
<h3>매개 변수 추가<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>form의 요소중  <code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type=&quot;hidden&quot;...</span></code> 를 추가하여 추가 매개변수를 postback메세지로 보낼 수 있습니다.</p>
<p>form요소 이외의 경우에는 다음과 같이 사용하면 됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span>
   <span class="n">data</span><span class="o">-</span><span class="n">postback</span><span class="o">=</span><span class="s2">&quot;click&quot;</span>
   <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">ArticlesDestroy</span><span class="p">](</span><span class="s2">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">)}</span>
   <span class="n">data</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="s2">&quot;_method=delete&quot;</span>
   <span class="n">data</span><span class="o">-</span><span class="n">confirm</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Do you want to delete </span><span class="si">%s</span><span class="s2">?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)}</span><span class="o">&gt;</span><span class="n">Delete</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>또는 다음과 같이 다른 요소에 지정할 수 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;myform&quot;</span> <span class="n">data</span><span class="o">-</span><span class="n">postback</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">SiteSearch</span><span class="p">]}</span><span class="o">&gt;</span>
  <span class="n">Search</span><span class="p">:</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;keyword&quot;</span> <span class="o">/&gt;</span>

  <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;pagination&quot;</span>
     <span class="n">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span>
     <span class="n">data</span><span class="o">-</span><span class="n">postback</span><span class="o">=</span><span class="s2">&quot;click&quot;</span>
     <span class="n">data</span><span class="o">-</span><span class="n">form</span><span class="o">=</span><span class="s2">&quot;#myform&quot;</span>
     <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">SiteSearch</span><span class="p">](</span><span class="s2">&quot;page&quot;</span> <span class="o">-&gt;</span> <span class="n">page</span><span class="p">)}</span><span class="o">&gt;</span><span class="p">{</span><span class="n">page</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">#myform</span></code> 은 JQuery의 선택요소로 폼의 추가 파라미터를 선택하여 보내게 됩니다.</p>
</div>
<div class="section" id="ajax">
<h3>Ajax로딩중 이미지 로딩<a class="headerlink" href="#ajax" title="Permalink to this headline">¶</a></h3>
<p>아래의 로딩 이미지가 Ajax 통신중에 표시됩니다:</p>
<img alt="_images/ajax_loading.gif" src="_images/ajax_loading.gif" />
<p>커스터마이즈 시에 템플릿 내에 <code class="docutils literal notranslate"><span class="pre">jsDefaults</span></code> (이것은 <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/js.scala">xitrum.js</a>
를 포함하기 위한 함수입니다.)의 뒤에 다음 내용을 추가합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">target</span><span class="p">:</span> <span class="n">The</span> <span class="n">element</span> <span class="n">that</span> <span class="n">triggered</span> <span class="n">the</span> <span class="n">postback</span>
<span class="n">xitrum</span><span class="o">.</span><span class="n">ajaxLoading</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">Called</span> <span class="n">when</span> <span class="n">the</span> <span class="n">animation</span> <span class="n">should</span> <span class="n">be</span> <span class="n">displayed</span> <span class="n">when</span> <span class="n">the</span> <span class="n">Ajax</span> <span class="n">postback</span> <span class="ow">is</span> <span class="n">being</span> <span class="n">sent</span><span class="o">.</span>
  <span class="n">var</span> <span class="n">show</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
  <span class="p">};</span>

  <span class="o">//</span> <span class="n">Called</span> <span class="n">when</span> <span class="n">the</span> <span class="n">animation</span> <span class="n">should</span> <span class="n">be</span> <span class="n">stopped</span> <span class="n">after</span> <span class="n">the</span> <span class="n">Ajax</span> <span class="n">postback</span> <span class="n">completes</span><span class="o">.</span>
  <span class="n">var</span> <span class="n">hide</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">{</span><span class="n">show</span><span class="p">:</span> <span class="n">show</span><span class="p">,</span> <span class="n">hide</span><span class="p">:</span> <span class="n">hide</span><span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<span id="document-xml"></span><div class="section" id="xml">
<h2>XML<a class="headerlink" href="#xml" title="Permalink to this headline">¶</a></h2>
<p>Scala는 리터럴 문자를 표시할 수 있습니다. Xitrum에서는 이 기능을 템플릿 엔진으로 사용하고 있습니다.</p>
<ul class="simple">
<li><p>Scala는 XML 구문을 컴파일 때 체크합니다: View는 typesafe합니다.</p></li>
<li><p>Scala는 XML의 자동적으로 이스케이프하여 <a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_scripting">XSS</a>　공격을 방지합니다.</p></li>
</ul>
<p>일부 팁이 있습니다.</p>
<div class="section" id="id1">
<h3>XML의 이스케이프<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">scala.xml.Unparsed</span></code> 를 사용하는 경우:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scala.xml.Unparsed</span>

<span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
  <span class="p">{</span><span class="n">Unparsed</span><span class="p">(</span><span class="s2">&quot;if (1 &lt; 2) alert(&#39;Xitrum rocks&#39;);&quot;</span><span class="p">)}</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;xml:unparsed&gt;</span></code> 를 사용하는 경우:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">xml</span><span class="p">:</span><span class="n">unparsed</span><span class="o">&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="n">alert</span><span class="p">(</span><span class="s1">&#39;Xitrum rocks&#39;</span><span class="p">);</span>
  <span class="o">&lt;/</span><span class="n">xml</span><span class="p">:</span><span class="n">unparsed</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;xml:unparsed&gt;</span></code> 는 실제 출력에 포함되지 않습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
  <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="n">alert</span><span class="p">(</span><span class="s1">&#39;Xitrum rocks&#39;</span><span class="p">);</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>XML 요소의 그룹화<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="o">&gt;</span>
  <span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="n">loggedIn</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="n">xml</span><span class="p">:</span><span class="n">group</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="p">{</span><span class="n">username</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">LogoutAction</span><span class="p">]}</span><span class="o">&gt;</span><span class="n">Logout</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">xml</span><span class="p">:</span><span class="n">group</span><span class="o">&gt;</span>
  <span class="k">else</span>
    <span class="o">&lt;</span><span class="n">xml</span><span class="p">:</span><span class="n">group</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">LoginAction</span><span class="p">]}</span><span class="o">&gt;</span><span class="n">Login</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">RegisterAction</span><span class="p">]}</span><span class="o">&gt;</span><span class="n">Register</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">xml</span><span class="p">:</span><span class="n">group</span><span class="o">&gt;</span><span class="p">}</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;xml:group&gt;</span></code> 는 실제 출력에 포함되지 않습니다. 예를 들어 사용자가 로그인한 경우:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">My</span> <span class="n">username</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/login&quot;</span><span class="o">&gt;</span><span class="n">Logout</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="xhtml">
<h3>XHTML 렌더링<a class="headerlink" href="#xhtml" title="Permalink to this headline">¶</a></h3>
<p>Xitrum은 view 와 레이아웃을 자동으로 XHTML로 출력합니다.
이것을 직접 출력으로 표시할경우 드믈지만 다음 코드가 나타나는 것을 주의하세요.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scala.xml.Xhtml</span>

<span class="n">val</span> <span class="n">br</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<span class="n">br</span><span class="o">.</span><span class="n">toString</span>            <span class="o">//</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;&lt;/</span><span class="n">br</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">이</span> <span class="n">경우에</span> <span class="n">브라우저는</span> <span class="n">br태그가</span> <span class="n">두</span> <span class="n">개</span> <span class="n">있다고</span> <span class="n">판단합니다</span><span class="o">.</span>
<span class="n">Xhtml</span><span class="o">.</span><span class="n">toXhtml</span><span class="p">(</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="p">)</span>  <span class="o">//</span> <span class="o">=&gt;</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-js"></span><div class="section" id="javascript-json">
<h2>JavaScript 와 JSON<a class="headerlink" href="#javascript-json" title="Permalink to this headline">¶</a></h2>
<div class="section" id="javascript">
<h3>JavaScript<a class="headerlink" href="#javascript" title="Permalink to this headline">¶</a></h3>
<p>Xitrum은 jQuery를 내포하고 있습니다.</p>
<p>또한 일부 jsXXX 헬퍼도 제공하고 있습니다.</p>
<div class="section" id="javascript-view">
<h4>JavaScript 조각을 View에 추가하는 방법<a class="headerlink" href="#javascript-view" title="Permalink to this headline">¶</a></h4>
<p>액션 내에서 <code class="docutils literal notranslate"><span class="pre">jsAddToView</span></code> 를 호출합니다.（필요한 경우 여러 번 호출이 가능합니다）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyAction</span> <span class="n">extends</span> <span class="n">AppAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="n">jsAddToView</span><span class="p">(</span><span class="s2">&quot;alert(&#39;Hello&#39;)&quot;</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="n">jsAddToView</span><span class="p">(</span><span class="s2">&quot;alert(&#39;Hello again&#39;)&quot;</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="n">respondInlineView</span><span class="p">(</span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">My</span> <span class="n">view</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>레이아웃 내에서 <code class="docutils literal notranslate"><span class="pre">jsForView</span></code> 를 호출합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.view.DocType</span>

<span class="n">trait</span> <span class="n">AppAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">override</span> <span class="k">def</span> <span class="nf">layout</span> <span class="o">=</span> <span class="n">DocType</span><span class="o">.</span><span class="n">html5</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">antiCsrfMeta</span><span class="p">}</span>
        <span class="p">{</span><span class="n">xitrumCss</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsDefaults</span><span class="p">}</span>
      <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;flash&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="n">jsFlash</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">renderedView</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsForView</span><span class="p">}</span>
      <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4>JavaScript를 직접 호출하는 경우<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Javascript의 응답:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jsRespond</span><span class="p">(</span><span class="s2">&quot;$(&#39;#error&#39;).html(</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jsEscape</span><span class="p">(</span><span class="o">&lt;</span><span class="n">p</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="o">&gt;</span><span class="n">Could</span> <span class="ow">not</span> <span class="n">login</span><span class="o">.&lt;/</span><span class="n">p</span><span class="o">&gt;</span><span class="p">)))</span>
</pre></div>
</div>
<p>Javascript로 리다이렉션하는 경우:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jsRedirectTo</span><span class="p">(</span><span class="s2">&quot;http://cntt.tv/&quot;</span><span class="p">)</span>
<span class="n">jsRedirectTo</span><span class="p">[</span><span class="n">LoginAction</span><span class="p">]()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="json">
<h3>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h3>
<p>Xitrum은  <a class="reference external" href="https://github.com/json4s/json4s">JSON4S</a> 를 내포하고 있습니다.
JSON의 파싱과 생성은 JSON4S을 읽어보세요.</p>
<p>Scala의 case 객체를 JSON으로 변환하는 경우:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.util.SeriDeseri</span>

<span class="n">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">phone</span><span class="p">:</span> <span class="n">Option</span><span class="p">[</span><span class="n">String</span><span class="p">])</span>
<span class="n">val</span> <span class="n">person1</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;Jack&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">val</span> <span class="n">json</span>    <span class="o">=</span> <span class="n">SeriDeseri</span><span class="o">.</span><span class="n">toJson</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
<span class="n">val</span> <span class="n">person2</span> <span class="o">=</span> <span class="n">SeriDeseri</span><span class="o">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
</pre></div>
</div>
<p>JSON의 응답:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">scalaData</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="o">//</span> <span class="n">An</span> <span class="n">example</span>
<span class="n">respondJson</span><span class="p">(</span><span class="n">scalaData</span><span class="p">)</span>
</pre></div>
</div>
<p>JSON은 중첩된 구조로 되어 있는 문장을 만들기에 적합합니다.</p>
<p>참고 <a class="reference internal" href="index.html#document-howto"><span class="doc">설정 파일 읽어들이기</span></a></p>
</div>
<div class="section" id="knockout-js">
<h3>Knockout.js 플러그인<a class="headerlink" href="#knockout-js" title="Permalink to this headline">¶</a></h3>
<p>참고 <a class="reference external" href="https://github.com/xitrum-framework/xitrum-ko">xitrum-ko</a></p>
</div>
</div>
<span id="document-async"></span><div class="section" id="id1">
<h2>비동기 응답<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Action에서 클라이언트로 응답을 반환하려면 다음과 같은 방법을 사용합니다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">respondView</span></code>: 레이아웃 파일을 사용 또는 사용하지 않고 View의 템플릿 파일을 보냅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondInlineView</span></code>: 레이아웃 파일을 사용 또는 사용하지 않고 인라인 작성된 템플릿을 보냅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondText(&quot;hello&quot;)</span></code>: 레이아웃 파일을 사용하지 않고 텍스트를 보냅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondHtml(&quot;&lt;html&gt;...&lt;/html&gt;&quot;)</span></code>: 위와 같이 contentType을 “text/html”로 보냅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondJson(List(1,</span> <span class="pre">2,</span> <span class="pre">3))</span></code>: Scala 객체를 JSON 으로 변환하여 contentType을 “application/json”으로 보냅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondJs(&quot;myFunction([1,</span> <span class="pre">2,</span> <span class="pre">3])&quot;)</span></code> contentType을 “application/javascript”으로 보냅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondJsonP(List(1,</span> <span class="pre">2,</span> <span class="pre">3),</span> <span class="pre">&quot;myFunction&quot;)</span></code>: 위 두가지 조합을 JSONP 으로 보냅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondJsonText(&quot;[1,</span> <span class="pre">2,</span> <span class="pre">3]&quot;)</span></code>: contentType을 “application/javascript”으로 보냅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondJsonPText(&quot;[1,</span> <span class="pre">2,</span> <span class="pre">3]&quot;,</span> <span class="pre">&quot;myFunction&quot;)</span></code>: <cite>respondJs</cite>, <cite>respondJsonText</cite> 의 두 가지 조합을 JSONP로 보냅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondBinary</span></code>: 바이트 배열로 보냅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondFile</span></code>: 디스크에서 파일을 직접 보냅니다. <a class="reference external" href="http://www.ibm.com/developerworks/library/j-zerocopy/">zero-copy</a> 를 사용하기 때문에 빠릅니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondEventSource(&quot;data&quot;,</span> <span class="pre">&quot;event&quot;)</span></code>: 청크 응답을 보냅니다.</p></li>
</ul>
<p>Xitrum은 자동으로 어떤 특정한 응답을 하지 않습니다. 스스로 응답을 <code class="docutils literal notranslate"><span class="pre">respondXXX</span></code> 형식으로 명시해야 합니다.
<code class="docutils literal notranslate"><span class="pre">respondXXX</span></code> 을 호출하지 않을 경우 Xitrum은 HTTP 연결을 유지하기 때문에 나중에 <code class="docutils literal notranslate"><span class="pre">respondXXX</span></code> 형식의 호출문이 필요합니다.</p>
<p>연결이 open 상태로 되어 있는지 확인하려면 <code class="docutils literal notranslate"><span class="pre">channel.isOpen</span></code> 을 호출하면 됩니다. <code class="docutils literal notranslate"><span class="pre">addConnectionClosedListener</span></code>
를 사용해도 무방합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">addConnectionClosedListener</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">연결이</span> <span class="n">해제되었습니다</span><span class="o">.</span>
  <span class="o">//</span> <span class="n">이벤트로부터</span> <span class="n">자원을</span> <span class="n">해제합니다</span><span class="o">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>비동기 방식이므로 응답을 바로 전송하지 않습니다. <code class="docutils literal notranslate"><span class="pre">respondXXX</span></code> 의 반환값은
<a class="reference external" href="http://netty.io/4.0/api/io/netty/channel/ChannelFuture.html">ChannelFuture</a>
를 사용합니다. 이것을 통해 실제로 전송되는 콜백을 지정할 수 있습니다.</p>
<p>예를 들어, 응답의 전송 후에 연결을 해제하려면:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io.netty.channel.</span><span class="p">{</span><span class="n">ChannelFuture</span><span class="p">,</span> <span class="n">ChannelFutureListener</span><span class="p">}</span>

<span class="n">val</span> <span class="n">future</span> <span class="o">=</span> <span class="n">respondText</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="n">future</span><span class="o">.</span><span class="n">addListener</span><span class="p">(</span><span class="n">new</span> <span class="n">ChannelFutureListener</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">operationComplete</span><span class="p">(</span><span class="n">future</span><span class="p">:</span> <span class="n">ChannelFuture</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">future</span><span class="o">.</span><span class="n">getChannel</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<p>더 짧은 예:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">respondText</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">addListener</span><span class="p">(</span><span class="n">ChannelFutureListener</span><span class="o">.</span><span class="n">CLOSE</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="websocket">
<h3>WebSocket<a class="headerlink" href="#websocket" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scala.runtime.ScalaRunTime</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.WEBSOCKET</span>
<span class="kn">import</span> <span class="nn">xitrum.</span><span class="p">{</span><span class="n">WebSocketAction</span><span class="p">,</span> <span class="n">WebSocketBinary</span><span class="p">,</span> <span class="n">WebSocketText</span><span class="p">,</span> <span class="n">WebSocketPing</span><span class="p">,</span> <span class="n">WebSocketPong</span><span class="p">}</span>

<span class="nd">@WEBSOCKET</span><span class="p">(</span><span class="s2">&quot;echo&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EchoWebSocketActor</span> <span class="n">extends</span> <span class="n">WebSocketAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">여기에서</span> <span class="n">세션데이터</span><span class="p">,</span> <span class="n">요청해더</span> <span class="n">등을</span> <span class="n">추출할</span> <span class="n">수</span> <span class="n">있지만</span>
    <span class="o">//</span> <span class="n">respondText</span> <span class="n">나</span> <span class="n">respondView를</span> <span class="n">사용하면</span> <span class="n">안됩니다</span><span class="o">.</span>
    <span class="o">//</span> <span class="n">응답하려면</span> <span class="n">다음과</span> <span class="n">같이</span> <span class="n">respondWebSocketXXX를</span> <span class="n">사용하세요</span><span class="o">.</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;onOpen&quot;</span><span class="p">)</span>

    <span class="n">context</span><span class="o">.</span><span class="n">become</span> <span class="p">{</span>
      <span class="n">case</span> <span class="n">WebSocketText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;onTextMessage: &quot;</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">respondWebSocketText</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">toUpperCase</span><span class="p">)</span>

      <span class="n">case</span> <span class="n">WebSocketBinary</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;onBinaryMessage: &quot;</span> <span class="o">+</span> <span class="n">ScalaRunTime</span><span class="o">.</span><span class="n">stringOf</span><span class="p">(</span><span class="nb">bytes</span><span class="p">))</span>
        <span class="n">respondWebSocketBinary</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>

      <span class="n">case</span> <span class="n">WebSocketPing</span> <span class="o">=&gt;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;onPing&quot;</span><span class="p">)</span>

      <span class="n">case</span> <span class="n">WebSocketPong</span> <span class="o">=&gt;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;onPong&quot;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">override</span> <span class="k">def</span> <span class="nf">postStop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;onClose&quot;</span><span class="p">)</span>
    <span class="nb">super</span><span class="o">.</span><span class="n">postStop</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>요청이 올때 위의 액터가 생성됩니다. 그리고 다음의 경우 중단됩니다:</p>
<ul class="simple">
<li><p>연결이 끊긴경우</p></li>
<li><p>WebSocket의 close 프레임이 수신되거나 전송되었을 때</p></li>
</ul>
<p>WebSocket 프레임을 전송하는 경우:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">respondWebSocketText</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondWebSocketBinary</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondWebSocketPing</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondWebSocketClose</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">respondWebSocketPong</span></code> 은 없습니다. Xitrum이 ping 을 수신하게 되면 자동으로 pong 프레임을 전송하기 때문입니다.</p>
<p>위의 WebSocket 액션의 URL을 얻으려면:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Scalate</span> <span class="n">템플릿</span> <span class="n">파일을</span> <span class="n">사용하기</span> <span class="n">원한다면</span>
<span class="n">val</span> <span class="n">url</span> <span class="o">=</span> <span class="n">absWebSocketUrl</span><span class="p">[</span><span class="n">EchoWebSocketActor</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="sockjs">
<h3>SockJS<a class="headerlink" href="#sockjs" title="Permalink to this headline">¶</a></h3>
<dl>
<dt><a class="reference external" href="https://github.com/sockjs/sockjs-client">SockJS</a> 은 WebSocket을 지원하지 않는 브라우저를 위한</dt><dd><p>WebSocket 과 같은 API를 제공하는 JavaScript라이브러리 입니다. SockJS는 먼저 WebSocket를 시도해보고
실패할경우 다른 방법들을 통해 WebSocket과 같은 라이브러리들을 사용하게 됩니다.</p>
<p>만약 모든 브라우저에서 WebSocket API를 사용하고 싶다면 SockJS을 사용하되 WebSocket을 직접 사용하지 마세요.</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
  <span class="n">var</span> <span class="n">sock</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SockJS</span><span class="p">(</span><span class="s1">&#39;http://mydomain.com/path_prefix&#39;</span><span class="p">);</span>
  <span class="n">sock</span><span class="o">.</span><span class="n">onopen</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="n">sock</span><span class="o">.</span><span class="n">onmessage</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="n">sock</span><span class="o">.</span><span class="n">onclose</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
  <span class="p">};</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Xitrum은 SockJS의 JavsScript 파일을 내포하고 있습니다.
뷰 템플릿에서 다음과 같이 사용하면 됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">html</span>
  <span class="n">head</span>
    <span class="o">!=</span> <span class="n">jsDefaults</span>
<span class="o">...</span>
</pre></div>
</div>
<p>SockJS는 <a class="reference external" href="https://github.com/sockjs/sockjs-protocol">server counterpart</a> 가 필요하지 않습니다.
Xitrum이 자동으로 제공합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.</span><span class="p">{</span><span class="n">Action</span><span class="p">,</span> <span class="n">SockJsAction</span><span class="p">,</span> <span class="n">SockJsText</span><span class="p">}</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.SOCKJS</span>

<span class="nd">@SOCKJS</span><span class="p">(</span><span class="s2">&quot;echo&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EchoSockJsActor</span> <span class="n">extends</span> <span class="n">SockJsAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">응답을</span> <span class="n">위해</span> <span class="n">아래에</span> <span class="n">respondSockJSXXX를</span> <span class="n">사용합니다</span><span class="o">.</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;onOpen&quot;</span><span class="p">)</span>

    <span class="n">context</span><span class="o">.</span><span class="n">become</span> <span class="p">{</span>
      <span class="n">case</span> <span class="n">SockJsText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;onMessage: &quot;</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">respondSockJsText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">override</span> <span class="k">def</span> <span class="nf">postStop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;onClose&quot;</span><span class="p">)</span>
    <span class="nb">super</span><span class="o">.</span><span class="n">postStop</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>새로운 SockJS 세션이 생성될 때에 위의 액터 인스턴스가 생성됩니다.
세션이 정지될 때에는 액터가 정지됩니다.</p>
<p>SockJS 프레임으로 보내려면:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">respondSockJsText</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondSockJsClose</span></code></p></li>
</ul>
<p><a class="reference external" href="https://github.com/sockjs/sockjs-node#various-issues-and-design-considerations">SockJS 주의사항</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">기본적으로</span> <span class="n">쿠키는</span> <span class="n">SockJS</span> <span class="n">모델과</span> <span class="n">맞지가</span> <span class="n">않습니다</span><span class="o">.</span> <span class="n">세션</span> <span class="n">인증을</span> <span class="n">하려면</span> <span class="n">고유의</span> <span class="n">토큰을</span> <span class="n">SockJS를</span>
<span class="n">통해</span> <span class="n">서버</span> <span class="n">측에서</span> <span class="n">검증을</span> <span class="n">해야</span> <span class="n">합니다</span><span class="o">.</span> <span class="n">이것이</span> <span class="n">본질적으로</span> <span class="n">쿠키의</span> <span class="n">작동원리입니다</span>
</pre></div>
</div>
<p>SockJS 클러스터링을 구현하려면 <a class="reference internal" href="index.html#document-cluster"><span class="doc">Akka 클러스터링</span></a> 을 참고하세요.</p>
</div>
<div class="section" id="chunk">
<h3>Chunk응답<a class="headerlink" href="#chunk" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Chunked_transfer_encoding">Chunk응답</a> 을 보내려면:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">setChunked</span></code> 호출</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">respondXXX</span></code> 호출(필요한 만큼)</p></li>
<li><p>마지막으로 <code class="docutils literal notranslate"><span class="pre">respondLastChunk</span></code> 호출</p></li>
</ol>
<p>Chunk응답은 많은 유스케이스를 가지고 있습니다. 예를 들어 메모리에 맞지 않는 매우큰 CSV파일을 생성할때
Chunk별로 생성해서 보낼 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// &quot;Cache-Control&quot; 헤더가 자동으로 세팅됩니다:
// 「no-store, no-cache, must-revalidate, max-age=0」
//
// 덧붙여서 &quot;Pragma: no-cache&quot; 는 응답이 아닌 요청에 링크됩니다:
// http://palizine.plynt.com/issues/2008Jul/cache-control-attributes/
setChunked()

val generator = new MyCsvGenerator

generator.onFirstLine { line =&gt;
  val future = respondText(header, &quot;text/csv&quot;)
  future.addListener(new ChannelFutureListener {
    def operationComplete(future: ChannelFuture) {
      if (future.isSuccess) generator.next()
    }
  }
}

generator.onNextLine { line =&gt;
  val future = respondText(line)
  future.addListener(new ChannelFutureListener {
    def operationComplete(future: ChannelFuture) {
      if (future.isSuccess) generator.next()
    }
  })
}

generator.onLastLine { line =&gt;
  val future = respondText(line)
  future.addListener(new ChannelFutureListener {
    def operationComplete(future: ChannelFuture) {
      if (future.isSuccess) respondLastChunk()
    }
  })
}

generator.generate()
</pre></div>
</div>
<p>주의:</p>
<ul class="simple">
<li><p>헤더는 <code class="docutils literal notranslate"><span class="pre">respondXXX</span></code> 을 먼저 요청합니다.</p></li>
<li><p>마지막 헤더 옵션을 <code class="docutils literal notranslate"><span class="pre">respondLastChunk</span></code> 에 설정할 수 있습니다.</p></li>
<li><p><a class="reference internal" href="index.html#document-cache"><span class="doc">페이지와 액션 캐쉬</span></a> 는 chunk 응답으로 사용할 수 없습니다.</p></li>
</ul>
<p>Chunk응답을  <code class="docutils literal notranslate"><span class="pre">ActorAction</span></code> 과 함께 사용하려면
<a class="reference external" href="http://www.cubrid.org/blog/dev-platform/faster-web-page-loading-with-facebook-bigpipe/">Facebook BigPipe</a>
을 통해 쉽게 구현할 수 있습니다.</p>
<div class="section" id="iframe">
<h4>무한 iframe<a class="headerlink" href="#iframe" title="Permalink to this headline">¶</a></h4>
<p>청크 응답은 <a class="reference external" href="http://en.wikipedia.org/wiki/Comet_%28programming%29">Comet</a> 을 <a class="reference external" href="http://www.shanison.com/2010/05/10/stop-the-browser-%E2%80%9Cthrobber-of-doom%E2%80%9D-while-loading-comet-forever-iframe/">사용할 수 있습니다</a></p>
<p>iframe을 포함한 페이지:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
  <span class="n">var</span> <span class="n">functionForForeverIframeSnippetsToCall</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">...</span>
<span class="o">&lt;</span><span class="n">iframe</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;path/to/forever/iframe&quot;</span><span class="o">&gt;&lt;/</span><span class="n">iframe</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>무한 <code class="docutils literal notranslate"><span class="pre">&lt;script&gt;</span></code> 생성하는 페이지:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">준비</span>

<span class="n">setChunked</span><span class="p">()</span>

<span class="o">//</span> <span class="n">Firefox를</span> <span class="n">동작하기</span> <span class="n">위해</span> <span class="s2">&quot;123&quot;</span> <span class="n">등을</span> <span class="n">사용</span>
<span class="n">respondText</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;&lt;body&gt;123&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">curl을</span> <span class="n">포함한</span> <span class="n">대부분의</span> <span class="n">클라이언트는</span> <span class="n">script를</span> <span class="n">미리보기로</span> <span class="n">바로</span> <span class="n">사용할</span> <span class="n">수</span> <span class="n">없음</span><span class="o">.</span>
<span class="o">//</span> <span class="mi">2</span><span class="n">KB의</span> <span class="n">더미</span> <span class="n">데이터를</span> <span class="n">바로</span> <span class="n">보내볼</span> <span class="n">필요가</span> <span class="n">있음</span><span class="o">.</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">100</span><span class="p">)</span> <span class="n">respondText</span><span class="p">(</span><span class="s2">&quot;&lt;script&gt;&lt;/script&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>나중에 실제 데이터를 브라우저에 보내려면, 미리보기를 보내면 된다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (channel.isOpen)
  respondText(&quot;&lt;script&gt;parent.functionForForeverIframeSnippetsToCall()&lt;/script&gt;\n&quot;)
else
  // 연결이 종료되고, 이벤트가 해제됨
  // ``addConnectionClosedListener`` 을 사용할수 있음.
</pre></div>
</div>
</div>
<div class="section" id="event-source">
<h4>Event Source<a class="headerlink" href="#event-source" title="Permalink to this headline">¶</a></h4>
<p>참고: <a class="reference external" href="http://dev.w3.org/html5/eventsource/">http://dev.w3.org/html5/eventsource/</a></p>
<p>Event Source는 특별한 경우 chunk응답을 보냄.
데이터는 UTF-8 이어야 함.</p>
<p>Event Source를 응답하려면 <code class="docutils literal notranslate"><span class="pre">respondEventSource</span></code> 호출(필요한 만큼):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">respondEventSource</span><span class="p">(</span><span class="s2">&quot;data1&quot;</span><span class="p">,</span> <span class="s2">&quot;event1&quot;</span><span class="p">)</span>  <span class="o">//</span> <span class="n">event1의</span> <span class="n">이벤트</span> <span class="n">이름</span>
<span class="n">respondEventSource</span><span class="p">(</span><span class="s2">&quot;data2&quot;</span><span class="p">)</span>            <span class="o">//</span> <span class="n">message라는</span> <span class="n">이벤트</span> <span class="n">이름으로</span> <span class="n">기본설정됨</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-static"></span><div class="section" id="id1">
<h2>정적 파일<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>디스크의 정적 파일 전송<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>프로젝트 디렉토리의 레이아웃:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span>
<span class="n">public</span>
  <span class="n">favicon</span><span class="o">.</span><span class="n">ico</span>
  <span class="n">robots</span><span class="o">.</span><span class="n">txt</span>
  <span class="mf">404.</span><span class="n">html</span>
  <span class="mf">500.</span><span class="n">html</span>
  <span class="n">img</span>
    <span class="n">myimage</span><span class="o">.</span><span class="n">png</span>
  <span class="n">css</span>
    <span class="n">mystyle</span><span class="o">.</span><span class="n">css</span>
  <span class="n">js</span>
    <span class="n">myscript</span><span class="o">.</span><span class="n">js</span>
<span class="n">src</span>
<span class="n">build</span><span class="o">.</span><span class="n">sbt</span>
</pre></div>
</div>
<p>Xitrum은 <code class="docutils literal notranslate"><span class="pre">public</span></code> 디렉토리의 정적 파일들을 자동으로 제공합니다.
URLs는 다음과 같이 사용합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">img</span><span class="o">/</span><span class="n">myimage</span><span class="o">.</span><span class="n">png</span>
<span class="o">/</span><span class="n">css</span><span class="o">/</span><span class="n">mystyle</span><span class="o">.</span><span class="n">css</span>
<span class="o">/</span><span class="n">css</span><span class="o">/</span><span class="n">mystyle</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">css</span>
</pre></div>
</div>
<p>참조하려면:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="p">{</span><span class="n">publicUrl</span><span class="p">(</span><span class="s2">&quot;img/myimage.png&quot;</span><span class="p">)}</span> <span class="o">/&gt;</span>
</pre></div>
</div>
<p>일반 파일을 개발환경에서 사용하고 압축된 버전의 파일을 프로덕션 환경에서 사용하려면
(위의 mystyle.css와 mystyle.min.css):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="p">{</span><span class="n">publicUrl</span><span class="p">(</span><span class="s2">&quot;css&quot;</span><span class="p">,</span> <span class="s2">&quot;mystyle.css&quot;</span><span class="p">,</span> <span class="s2">&quot;mystyle.min.css&quot;</span><span class="p">)}</span> <span class="o">/&gt;</span>
</pre></div>
</div>
<p>디스크의 정적 파일을 액션을 통해 전송하려면 <code class="docutils literal notranslate"><span class="pre">respondFile</span></code> 을 사용합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">respondFile</span><span class="p">(</span><span class="s2">&quot;/absolute/path&quot;</span><span class="p">)</span>
<span class="n">respondFile</span><span class="p">(</span><span class="s2">&quot;path/relative/to/the/current/working/directory&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>정적 파일의 전송 속도를 최적화 하기 위해
정규식 필터를 통해, 불필요한 파일의 존재를 체크하여 미연에 방지할 수 있습니다.
만약 요청된 URL이 pathRegex와 맞지 않으면 Xitrum은 해당 요청에 404를 응답합니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">config/xitrum.conf</span></code> 의 <code class="docutils literal notranslate"><span class="pre">pathRegex</span></code> 를 참고하세요.</p>
</div>
<div class="section" id="index-html">
<h3>index.html 대체<a class="headerlink" href="#index-html" title="Permalink to this headline">¶</a></h3>
<p>만약 <code class="docutils literal notranslate"><span class="pre">/foo/bar</span></code> (또는 <code class="docutils literal notranslate"><span class="pre">/foo/bar/</span></code>) URL의 경로(액션)가 없을 경우
Xitrum은 <code class="docutils literal notranslate"><span class="pre">public/foo/bar/index.html</span></code> (“public” 디렉토리) 경로의 정적 파일을 탐색합니다.
파일이 존재하면 Xitrum은 해당파일을 클라이언트로 응답합니다.</p>
</div>
<div class="section" id="id3">
<h3>404 과 500<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>요청에 대해 적합한 경로가 없거나 에러가 발생한 경우에는 <code class="docutils literal notranslate"><span class="pre">public</span></code> 디렉토리에 있는 404.html과 500.html이 사용됩니다.
핸들러를 직접 등록하고 싶은 경우:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.</span><span class="p">{</span><span class="n">Error404</span><span class="p">,</span> <span class="n">Error500</span><span class="p">}</span>

<span class="nd">@Error404</span>
<span class="k">class</span> <span class="nc">My404ErrorHandlerAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isAjax</span><span class="p">)</span>
      <span class="n">jsRespond</span><span class="p">(</span><span class="s2">&quot;alert(&quot;</span> <span class="o">+</span> <span class="n">jsEscape</span><span class="p">(</span><span class="s2">&quot;Not Found&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">renderInlineView</span><span class="p">(</span><span class="s2">&quot;Not Found&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Error500</span>
<span class="k">class</span> <span class="nc">My500ErrorHandlerAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isAjax</span><span class="p">)</span>
      <span class="n">jsRespond</span><span class="p">(</span><span class="s2">&quot;alert(&quot;</span> <span class="o">+</span> <span class="n">jsEscape</span><span class="p">(</span><span class="s2">&quot;Internal Server Error&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">renderInlineView</span><span class="p">(</span><span class="s2">&quot;Internal Server Error&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>응답에 대한 요청은 액션이 수행되기 전에 404과 500이 세팅되므로 임의로 세팅할 필요가 없습니다.</p>
</div>
<div class="section" id="webjar">
<h3>WebJar에 의한 클래스 패스내의 리소스 파일 전송<a class="headerlink" href="#webjar" title="Permalink to this headline">¶</a></h3>
<div class="section" id="webjars">
<h4>WebJars<a class="headerlink" href="#webjars" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://www.webjars.org/">WebJars</a> 는 상당량의 웹 라이브러리를 제공하고 프로젝트 내에서
정의해 사용할 수 있습니다.</p>
<p>예를 들어 <a class="reference external" href="http://underscorejs.org/">Underscore.js</a> 를 사용하고자 하는 경우에는
프로젝트의 <code class="docutils literal notranslate"><span class="pre">build.sbt</span></code> 내에 정의하면 됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s2">&quot;org.webjars&quot;</span> <span class="o">%</span> <span class="s2">&quot;underscorejs&quot;</span> <span class="o">%</span> <span class="s2">&quot;1.6.0-3&quot;</span>
</pre></div>
</div>
<p>그리고 .jade 템플릿 파일에서 사용됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">script</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="p">{</span><span class="n">webJarsUrl</span><span class="p">(</span><span class="s2">&quot;underscorejs/1.6.0&quot;</span><span class="p">,</span> <span class="s2">&quot;underscore.js&quot;</span><span class="p">,</span> <span class="s2">&quot;underscore-min.js&quot;</span><span class="p">)})</span>
</pre></div>
</div>
<p>Xitrum은 자동으로 개발환경에서 <code class="docutils literal notranslate"><span class="pre">underscore.js</span></code> 를 사용하고　<code class="docutils literal notranslate"><span class="pre">underscore-min.js</span></code> 를
프로덕션 환경에서 사용합니다.</p>
<p>결과는 다음과 같습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/webjars/underscorejs/1.6.0/underscore.js?XOKgP8_KIpqz9yUqZ1aVzw
</pre></div>
</div>
<p>동일한 파일을 동일 환경에서 사용하려면:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">script</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="p">{</span><span class="n">webJarsUrl</span><span class="p">(</span><span class="s2">&quot;underscorejs/1.6.0/underscore.js&quot;</span><span class="p">)})</span>
</pre></div>
</div>
<p>종속된 파일들은 자동으로 다운로드 됩니다. 버전 충돌의 문제로 원하는 버전의 라이브러리가 선택되지 않았을 경우(<code class="docutils literal notranslate"><span class="pre">sbt</span> <span class="pre">xitrum-package</span></code> 명렁어를 통해 다음에 생성되는 디렉토리의 파일들을 보고 확인할 수 있습니다. <code class="docutils literal notranslate"><span class="pre">target/xitrum/lib</span></code>), <code class="docutils literal notranslate"><span class="pre">dependencyOverrides</span></code> 에서 강제로 원하는 버전의 라이브러리를 추가할 수 있습니다. 예를 들어, jQuery 2.x 이 선택되었지만 인터넷 익스플로러 6, 7, 8에서 강제로 jQuery 1.x 사용하기를 원할 경우엔 다음과 같이 사용하면 됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dependencyOverrides</span> <span class="o">+=</span> <span class="s2">&quot;org.webjars&quot;</span> <span class="o">%</span> <span class="s2">&quot;jquery&quot;</span> <span class="o">%</span> <span class="s2">&quot;1.11.3&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="webjars-jar">
<h4>WebJars 형식으로 리소스 파일을 .jar 내에 저장하기<a class="headerlink" href="#webjars-jar" title="Permalink to this headline">¶</a></h4>
<p>만약 라이브러리를 개발하여 라이브러리에 myimage.png를 추가하고 싶다면
<a class="reference external" href="http://www.webjars.org/">WebJars</a> 의 형식으로 .jar 파일의 클래스 패스에
myimage.png를 넣을 수 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">META</span><span class="o">-</span><span class="n">INF</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">webjars</span><span class="o">/</span><span class="n">mylib</span><span class="o">/</span><span class="mf">1.0</span><span class="o">/</span><span class="n">myimage</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<p>사용법:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="p">{</span><span class="n">webJarsUrl</span><span class="p">(</span><span class="s2">&quot;mylib/1.0/myimage.png&quot;</span><span class="p">)}</span> <span class="o">/&gt;</span>
</pre></div>
</div>
<p>개발환경과 프로덕션 환경 모두에서 URL은:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/webjars/mylib/1.0/myimage.png?xyz123
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>클래스 패스내의 파일 응답<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>클래스 패스내의 <a class="reference external" href="http://www.webjars.org/">WebJars</a> 형식으로 저장되지 않은 파일의 응답:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">respondResource</span><span class="p">(</span><span class="s2">&quot;path/relative/to/the/classpath/element&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>예:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">respondResource</span><span class="p">(</span><span class="s2">&quot;akka/actor/Actor.class&quot;</span><span class="p">)</span>
<span class="n">respondResource</span><span class="p">(</span><span class="s2">&quot;META-INF/resources/webjars/underscorejs/1.6.0/underscore.js&quot;</span><span class="p">)</span>
<span class="n">respondResource</span><span class="p">(</span><span class="s2">&quot;META-INF/resources/webjars/underscorejs/1.6.0/underscore-min.js&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="etag-max-age">
<h3>ETag 과 max-age의 클라이언트 캐쉬<a class="headerlink" href="#etag-max-age" title="Permalink to this headline">¶</a></h3>
<p>Xitrum은 자동으로 <a class="reference external" href="http://ja.wikipedia.org/wiki/HTTP_ETag">Etag</a> 을 디스크 내 클래스 패스의 정적파일을 사용하기 위해 추가합니다.</p>
<p>ETags는 작은 파일일 경우 MD5로 캐쉬되어 나중에 사용됩니다. 캐쉬 앤트리의 키는 <code class="docutils literal notranslate"><span class="pre">(파일경로,</span> <span class="pre">수정시간)</span></code> 입니다. 왜냐하면 파일의 변경시간은 각 서버별로 상이하기 때문에
클러스터의 각 서버는 각각 로컬 ETag 캐쉬를 가지게 됩니다.</p>
<p>큰 파일의 경우에는 수정된 시간만을 ETag에 사용됩니다. 완벽하지는 않지만 각기 서버는 다른 ETag 정보를 가질 것으로 예상되기 때문입니다.
물론 ETag를 사용하지 않는 경우보다는 약간 낫다고 보여집니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">publicUrl</span></code> 과 <code class="docutils literal notranslate"><span class="pre">resourceUrl</span></code> 은 자동으로 Etag가 추가되어 URLs이 생성됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>webJarsUrl(&quot;jquery/2.1.1/jquery.min.js&quot;)
=&gt; /webjars/jquery/2.1.1/jquery.min.js?0CHJg71ucpG0OlzB-y6-mQ
</pre></div>
</div>
<p>Xitrum은 헤더의 <code class="docutils literal notranslate"><span class="pre">max-age</span></code> 와 <code class="docutils literal notranslate"><span class="pre">Expires</span></code> 를 <a class="reference external" href="https://developers.google.com/speed/docs/best-practices/caching">1 년</a> 으로 설정합니다.
브라우저가 최신 파일을 참조하지 못할 것을 염려하지 않아도 됩니다.
왜냐하면 디스크의 파일이 변경될 때 <code class="docutils literal notranslate"><span class="pre">수정시간</span></code> 이 변하게 되고
<code class="docutils literal notranslate"><span class="pre">publicUrl</span></code> 과 <code class="docutils literal notranslate"><span class="pre">resourceUrl</span></code> 이 변하게 된 상태로 생성되기 때문입니다.
ETag 캐쉬 또한 업데이트 되기 때문에 키도 변하게 됩니다.</p>
</div>
<div class="section" id="gzip">
<h3>GZIP<a class="headerlink" href="#gzip" title="Permalink to this headline">¶</a></h3>
<p>Xitrum은 자동으로 텍스트 형식의 응답을 gzips을 적용합니다. <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> 헤더를 통해 형식이
<code class="docutils literal notranslate"><span class="pre">text/html</span></code>, <code class="docutils literal notranslate"><span class="pre">xml/application</span></code> 등과 같은 텍스트 형식인지를 체크해서 결정합니다.</p>
<p>Xitrum은 정적 파일에 대해서는 항상 gzips을 수행하지만 동적인 텍스트 응답에 대해서는 성능 최적화를 위해
1 KB 미만의 응답에 대해서는 gzips을 수행하지 않습니다.</p>
</div>
<div class="section" id="id9">
<h3>서버 캐쉬<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>디스크로부터 파일 로딩을 방지하기 위해 Xitrum은 작은 정적파일에 대해서(텍스트 뿐만 아니라)
메모리에 LRU (Least Recently Used) 알고리즘을 사용합니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">config/xitrum.conf</span></code> 내의 <code class="docutils literal notranslate"><span class="pre">small_static_file_size_in_kb</span></code> 와 <code class="docutils literal notranslate"><span class="pre">max_cached_small_static_files</span></code> 에서 확인할 수 있습니다.</p>
</div>
</div>
<span id="document-flash"></span><div class="section" id="flash-socket">
<h2>Flash Socket 정책 파일<a class="headerlink" href="#flash-socket" title="Permalink to this headline">¶</a></h2>
<p>Flash Socket 정책 파일:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.adobe.com/devnet/flashplayer/articles/socket_policy_files.html">http://www.adobe.com/devnet/flashplayer/articles/socket_policy_files.html</a></p></li>
<li><p><a class="reference external" href="http://www.lightsphere.com/dev/articles/flash_socket_policy.html">http://www.lightsphere.com/dev/articles/flash_socket_policy.html</a></p></li>
</ul>
<p>Flash Socket 정책 파일 프로토콜은 Http와 다릅니다.
제공하려면:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/config/flash_socket_policy.xml">config/flash_socket_policy.xml</a>
를 수정합니다</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/config/xitrum.conf">config/xitrum.conf</a>
위 파일을 수정하여 활성화합니다</p></li>
</ol>
</div>
<span id="document-scopes"></span><div class="section" id="id1">
<h2>스코프<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>요청<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id3">
<h4>매개변수<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>두 가지의 요청 매개변수:</p>
<ol class="arabic simple">
<li><p>텍스트</p></li>
<li><p>파일 업로드(바이너리)</p></li>
</ol>
<p>다음과 같은 타입의 <code class="docutils literal notranslate"><span class="pre">scala.collection.mutable.Map[String,</span> <span class="pre">Seq[String]]</span></code> 세 가지 매개변수:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">queryParams</span></code>: URL내의 ? 다음에 오는 매개변수  예: <code class="docutils literal notranslate"><span class="pre">http://example.com/blah?x=1&amp;y=2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bodyTextParams</span></code>: POST 요청의 body에 포함된 매개변수</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pathParams</span></code>: URL 내에 포함된 매개변수  예: <code class="docutils literal notranslate"><span class="pre">GET(&quot;articles/:id/:title&quot;)</span></code></p></li>
</ol>
<p>이 매개변수들은 위의 순서대로 <code class="docutils literal notranslate"><span class="pre">textParams</span></code> 에 병합됩니다.
（1번에서 3번의 순서대로 매개변수를 덮어씁니다）</p>
<p><code class="docutils literal notranslate"><span class="pre">bodyFileParams</span></code> 은 <code class="docutils literal notranslate"><span class="pre">scala.collection.mutable.Map[String,</span> <span class="pre">Seq[</span></code> <a class="reference external" href="http://netty.io/4.0/api/io/netty/handler/codec/http/multipart/FileUpload.html">FileUpload</a> <code class="docutils literal notranslate"><span class="pre">]]</span></code> 의 형태입니다.</p>
</div>
<div class="section" id="id4">
<h4>매개변수 접근<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>액션내에서 매개변수에 직접 접근하거나 접근자 함수를 사용할 수 있습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">textParams</span></code> 에 접근하는 경우:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">param(&quot;x&quot;)</span></code>: <code class="docutils literal notranslate"><span class="pre">String</span></code> 을 반환하며 x가 존재하지 않으면 예외를 던집니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">paramo(&quot;x&quot;)</span></code>: <code class="docutils literal notranslate"><span class="pre">Option[String]</span></code> 을 반환합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">params(&quot;x&quot;)</span></code>: <code class="docutils literal notranslate"><span class="pre">Seq[String]</span></code> 을 반환하며 x가 존재하지 않으면 Seq.empty를 반환합니다.</p></li>
</ul>
<p>파라미터를 다른 형태(Int, Long, Fload, Double)로 다음과 같이 <code class="docutils literal notranslate"><span class="pre">param[Int](&quot;x&quot;)</span></code> 이나 <code class="docutils literal notranslate"><span class="pre">params[Int](&quot;x&quot;)</span></code> 으로 자동으로 변환이 가능합니다.
이 밖에 다른 형태로 변환하고자 하면 <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala-2.11/xitrum/scope/request/ParamAccess.scala">convertTextParam</a> 를 재정의하여 사용하면 됩니다.</p>
<p>파일 업로드의 경우에는 <code class="docutils literal notranslate"><span class="pre">param[FileUpload](&quot;x&quot;)</span></code> 나 <code class="docutils literal notranslate"><span class="pre">params[FileUpload](&quot;x&quot;)</span></code> 를 사용하면 됩니다.
자세한 내용은 <a class="reference internal" href="index.html#document-upload"><span class="doc">Upload chapter</span></a> 를 참고하세요.</p>
</div>
<div class="section" id="at">
<h4>“at”<a class="headerlink" href="#at" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">at</span></code> 을 사용하여 요청을 전달하는 동안 매개변수를 전달할 수 있습니다(액션이나, 뷰, 또는 레이아웃에서）.
<code class="docutils literal notranslate"><span class="pre">at</span></code> 은 <code class="docutils literal notranslate"><span class="pre">scala.collection.mutable.HashMap[String,</span> <span class="pre">Any]</span></code> 타입입니다.
<code class="docutils literal notranslate"><span class="pre">at</span></code> 은 Rails에서 <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> 과 같은 역할을 수행합니다.</p>
<p>Articles.scala:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles/:id&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesShow</span> <span class="n">extends</span> <span class="n">AppAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">val</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span> <span class="o">=</span> <span class="o">...</span>  <span class="o">//</span> <span class="n">Get</span> <span class="kn">from</span> <span class="nn">DB</span>
    <span class="n">at</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">title</span>
    <span class="n">respondInlineView</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>AppAction.scala:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.view.DocType</span>

<span class="n">trait</span> <span class="n">AppAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">override</span> <span class="k">def</span> <span class="nf">layout</span> <span class="o">=</span> <span class="n">DocType</span><span class="o">.</span><span class="n">html5</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">antiCsrfMeta</span><span class="p">}</span>
        <span class="p">{</span><span class="n">xitrumCss</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsDefaults</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">isDefinedAt</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">))</span> <span class="s2">&quot;My Site - &quot;</span> <span class="o">+</span> <span class="n">at</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;My Site&quot;</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">renderedView</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsForView</span><span class="p">}</span>
      <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="atjson">
<h4>“atJson”<a class="headerlink" href="#atjson" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">atJson</span></code> 은 <code class="docutils literal notranslate"><span class="pre">at(&quot;key&quot;)</span></code> 을 자동으로 JSON으로 변환 시 사용되는 헬퍼입니다.
Scala에서 Javascript로 모델을 전달 시에 유용하게 사용됩니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">atJson(&quot;key&quot;)</span></code> 은 <code class="docutils literal notranslate"><span class="pre">xitrum.util.SeriDeseri.toJson(at(&quot;key&quot;))</span></code> 과 같습니다.</p>
<p>Action.scala:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">case</span> <span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">login</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>

<span class="o">...</span>

<span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">at</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;Admin&quot;</span><span class="p">)</span>
  <span class="n">respondView</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Action.ssp:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;script type=&quot;text/javascript&quot;&gt;
  var user = ${atJson(&quot;user&quot;)};
  alert(user.login);
  alert(user.name);
&lt;/script&gt;
</pre></div>
</div>
</div>
<div class="section" id="requestvar">
<h4>RequestVar<a class="headerlink" href="#requestvar" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">at</span></code> 은 어떠한 값도 map으로 저장이 가능해서 typesafe하지 않습니다.</p>
</div></blockquote>
<p>안전하게 사용하려면 <code class="docutils literal notranslate"><span class="pre">at</span></code> 의 래퍼인 <code class="docutils literal notranslate"><span class="pre">RequestVar</span></code> 을 사용하면 됩니다.</p>
<p>RVar.scala:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.RequestVar</span>

<span class="nb">object</span> <span class="n">RVar</span> <span class="p">{</span>
  <span class="nb">object</span> <span class="n">title</span> <span class="n">extends</span> <span class="n">RequestVar</span><span class="p">[</span><span class="n">String</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Articles.scala:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles/:id&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesShow</span> <span class="n">extends</span> <span class="n">AppAction</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">val</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span> <span class="o">=</span> <span class="o">...</span>  <span class="o">//</span> <span class="n">Get</span> <span class="kn">from</span> <span class="nn">DB</span>
    <span class="n">RVar</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">respondInlineView</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>AppAction.scala</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.view.DocType</span>

<span class="n">trait</span> <span class="n">AppAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">override</span> <span class="k">def</span> <span class="nf">layout</span> <span class="o">=</span> <span class="n">DocType</span><span class="o">.</span><span class="n">html5</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">antiCsrfMeta</span><span class="p">}</span>
        <span class="p">{</span><span class="n">xitrumCss</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsDefaults</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="n">RVar</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">isDefined</span><span class="p">)</span> <span class="s2">&quot;My Site - &quot;</span> <span class="o">+</span> <span class="n">RVar</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">get</span> <span class="k">else</span> <span class="s2">&quot;My Site&quot;</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="n">renderedView</span><span class="p">}</span>
        <span class="p">{</span><span class="n">jsForView</span><span class="p">}</span>
      <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h3>쿠키<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>위키피디아에 정의되어 있습니다. <a class="reference external" href="http://en.wikipedia.org/wiki/HTTP_cookie">cookies</a></p>
<p>액션 내에 <code class="docutils literal notranslate"><span class="pre">requestCookies</span></code> 를 사용하여 <code class="docutils literal notranslate"><span class="pre">Map[String,</span> <span class="pre">String]</span></code> 형식으로 브라우저에서 보낸 쿠키를 읽을 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">requestCookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;myCookie&quot;</span><span class="p">)</span> <span class="n">match</span> <span class="p">{</span>
  <span class="n">case</span> <span class="kc">None</span>         <span class="o">=&gt;</span> <span class="o">...</span>
  <span class="n">case</span> <span class="n">Some</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>브라우저에서 쿠키를 전송하려면 <a class="reference external" href="http://netty.io/4.0/api/io/netty/handler/codec/http/DefaultCookie.html">DefaultCookie</a> 인스턴스를 생성하고 <a class="reference external" href="http://netty.io/4.0/api/io/netty/handler/codec/http/Cookie.html">Cookie</a> 를 가지고 있는 <code class="docutils literal notranslate"><span class="pre">ArrayBuffer</span></code> 형식으로 <code class="docutils literal notranslate"><span class="pre">responseCookies</span></code> 에 추가합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">cookie</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DefaultCookie</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="n">cookie</span><span class="o">.</span><span class="n">setHttpOnly</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>  <span class="o">//</span> <span class="n">true</span><span class="p">:</span> <span class="n">JavaScript</span> <span class="n">cannot</span> <span class="n">access</span> <span class="n">this</span> <span class="n">cookie</span>
<span class="n">responseCookies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cookie.setPath(cookiePath)</span></code> 를 설정하지 않고 사용하면
루트 (<code class="docutils literal notranslate"><span class="pre">xitrum.Config.withBaseUrl(&quot;/&quot;)</span></code>)가 설정되고 원치 않는 중복을 막아줍니다.</p>
<p>브라우저에서 보낸 쿠키를 삭제하려면 같은 이름의 쿠키를 “max-age”를 0으로 설정하면 브라우저에서는 즉시 쿠키를 만료시킵니다.
브라우저가 종료될 때 쿠키를 삭제하려면 “max-age”를 <code class="docutils literal notranslate"><span class="pre">Long.MinValue</span></code> 으로 설정합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cookie</span><span class="o">.</span><span class="n">setMaxAge</span><span class="p">(</span><span class="n">Long</span><span class="o">.</span><span class="n">MinValue</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="http://mrcoles.com/blog/cookies-max-age-vs-expires/">Internet Explorer는 “max-age”를 지원하지 않습니다.</a> .
그러나, Netty는 “max-age”와 “expires”를 동시에 찾아내기 때문에 걱정하지 않아도 됩니다.</p>
<p>브라우저는 쿠키의 속성을 서버로 전송하지 않습니다.
브라우저는 <a class="reference external" href="http://en.wikipedia.org/wiki/HTTP_cookie#Cookie_attributes">name-value pairs</a> 만을 보냅니다.</p>
<p>서명된 쿠키를 사용하여 쿠키의 변조를 방지하려면
<code class="docutils literal notranslate"><span class="pre">xitrum.util.SeriDeseri.toSecureUrlSafeBase64</span></code> 와 <code class="docutils literal notranslate"><span class="pre">xitrum.util.SeriDeseri.fromSecureUrlSafeBase64</span></code> 을 사용하세요.
자세한 내용은 <a class="reference internal" href="index.html#document-howto"><span class="doc">How to encrypt data</span></a> 를 참고하세요</p>
<div class="section" id="id6">
<h4>쿠키가 가능한 문자들<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>쿠키는 <a class="reference external" href="http://stackoverflow.com/questions/1969232/allowed-characters-in-cookies">arbitrary characters in cookie</a> 를 사용할 수 없습니다.
UTF-8 문자는 UTF-8로 인코딩해야 합니다.
인코딩시 <code class="docutils literal notranslate"><span class="pre">xitrum.utill.UrlSafeBase64</span></code> 또는 <code class="docutils literal notranslate"><span class="pre">xitrum.util.SeriDeseri</span></code> 가 사용가능합니다.</p>
<p>쓰기 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io.netty.util.CharsetUtil</span>
<span class="kn">import</span> <span class="nn">xitrum.util.UrlSafeBase64</span>

<span class="n">val</span> <span class="n">value</span>   <span class="o">=</span> <span class="s2">&quot;&quot;&quot;{&quot;identity&quot;:&quot;example@gmail.com&quot;,&quot;first_name&quot;:&quot;Alexander&quot;}&quot;&quot;&quot;</span>
<span class="n">val</span> <span class="n">encoded</span> <span class="o">=</span> <span class="n">UrlSafeBase64</span><span class="o">.</span><span class="n">noPaddingEncode</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">getBytes</span><span class="p">(</span><span class="n">CharsetUtil</span><span class="o">.</span><span class="n">UTF_8</span><span class="p">))</span>
<span class="n">val</span> <span class="n">cookie</span>  <span class="o">=</span> <span class="n">new</span> <span class="n">DefaultCookie</span><span class="p">(</span><span class="s2">&quot;profile&quot;</span><span class="p">,</span> <span class="n">encoded</span><span class="p">)</span>
<span class="n">responseCookies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
</pre></div>
</div>
<p>읽기 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">requestCookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;profile&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">foreach</span> <span class="p">{</span> <span class="n">encoded</span> <span class="o">=&gt;</span>
  <span class="n">UrlSafeBase64</span><span class="o">.</span><span class="n">autoPaddingDecode</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span><span class="o">.</span><span class="n">foreach</span> <span class="p">{</span> <span class="nb">bytes</span> <span class="o">=&gt;</span>
    <span class="n">val</span> <span class="n">value</span> <span class="o">=</span> <span class="n">new</span> <span class="n">String</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">CharsetUtil</span><span class="o">.</span><span class="n">UTF_8</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;profile: &quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h3>세션<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>세션의 저장, 복원, 암호화 등은 Xitrum에 의해 자동화 되므로 신경쓰지 않아도 됩니다.</p>
<p>액션내에서 <code class="docutils literal notranslate"><span class="pre">session</span></code> 은 <code class="docutils literal notranslate"><span class="pre">scala.collection.mutable.Map[String,</span> <span class="pre">Any]</span></code> 의 인스턴스이고 <code class="docutils literal notranslate"><span class="pre">session</span></code> 은 반드시 직렬화 가능해야 합니다.</p>
<p>로그인 시에 사용자 이름을 세션에 저장하는 예:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="p">(</span><span class="s2">&quot;userId&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">userId</span>
</pre></div>
</div>
<p>사용자의 로그인 여부를 판단하려면 세션에 사용자 이름 항목이 있는지 확인하면 됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">isDefinedAt</span><span class="p">(</span><span class="s2">&quot;userId&quot;</span><span class="p">))</span> <span class="n">println</span><span class="p">(</span><span class="s2">&quot;This user has logged in&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>사용자의 ID를 저장하여 매번 접근할때마다 데이터베이스에서 사용자를 검색하는 것은 매우 바람직합니다.
사용자의 정보변경을 알 수 있기 때문입니다.(권한 및 인증을 포함하여)</p>
<div class="section" id="session-clear">
<h4>session.clear()<a class="headerlink" href="#session-clear" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://guides.rubyonrails.org/security.html#session-fixation">One line of code will protect you from session fixation</a>.</p>
<p>session fixation 은 위의 항목을 참고하세요. session fixation 공격을 방지하기 위해
사용자의 로그인 시 <code class="docutils literal notranslate"><span class="pre">session.clear()</span></code> 을 호출합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">LoginAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="n">session</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="o">//</span> <span class="n">Reset</span> <span class="n">first</span> <span class="n">before</span> <span class="n">doing</span> <span class="n">anything</span> <span class="k">else</span> <span class="k">with</span> <span class="n">the</span> <span class="n">session</span>
    <span class="n">session</span><span class="p">(</span><span class="s2">&quot;userId&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">userId</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>로그아웃 시에도 <code class="docutils literal notranslate"><span class="pre">session.clear()</span></code> 을 호출합니다.</p>
</div>
<div class="section" id="sessionvar">
<h4>SessionVar<a class="headerlink" href="#sessionvar" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">RequestVar</span></code> 와 마찬가지로 SessionVar는 조금 더 안전한 방법을 제공합니다.
예를 들어, 사용자 로그인 후 사용자 이름을 세션에 저장할 수 있습니다.</p>
<p>SessionVar의 선언:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.SessionVar</span>

<span class="nb">object</span> <span class="n">SVar</span> <span class="p">{</span>
  <span class="nb">object</span> <span class="n">username</span> <span class="n">extends</span> <span class="n">SessionVar</span><span class="p">[</span><span class="n">String</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>로그인 성공 후:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SVar</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
<p>사용자 이름 표시:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">SVar</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">isDefined</span><span class="p">)</span>
  <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="p">{</span><span class="n">SVar</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">get</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span>
<span class="k">else</span>
  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">LoginAction</span><span class="p">]}</span><span class="o">&gt;</span><span class="n">Login</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>SessionVar 삭제: <code class="docutils literal notranslate"><span class="pre">SVar.username.remove()</span></code></p></li>
<li><p>모든 세션 초기화: <code class="docutils literal notranslate"><span class="pre">session.clear()</span></code></p></li>
</ul>
</div>
<div class="section" id="id8">
<h4>세션 스토어<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>Xitrum은 세 가지의 세션 스토어를 제공합니다.
<a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/config/xitrum.conf">config/xitrum.conf</a>
원하는 방향대로 세션을 수정할 수 있습니다.</p>
<p>CookieSessionStore:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Store sessions on client side</span>
<span class="n">store</span> <span class="o">=</span> <span class="n">xitrum</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">CookieSessionStore</span>
</pre></div>
</div>
<p>LruSessionStore:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simple in-memory server side session store</span>
<span class="n">store</span> <span class="p">{</span>
  <span class="s2">&quot;xitrum.local.LruSessionStore&quot;</span> <span class="p">{</span>
    <span class="n">maxElems</span> <span class="o">=</span> <span class="mi">10000</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>클러스터 내에서 여러 서버를 사용하게 된다면 <a class="reference external" href="https://github.com/xitrum-framework/xitrum-hazelcast">Hazelcast</a> 를 클러스터 간 세션 공유 저장소로 사용할 수 있습니다.</p>
<p>CookieSessionStore이나 Hazelcast를 세션 저장용으로 사용한다면 세션에 사용되는 데이터는 직렬화가 가능해야 합니다.
만약 직렬화가 불가능한 데이터일 경우에는 LruSessionStore를 사용하세요.
LruSessionStore를 사용하여 여러 서버를 사용하게 된다면 “sticky sessions”이 가능한 로드 밸런서를 사용해야 합니다.</p>
<p>일반적으로 위에 언급된 기본 세션 저장소면 충분히 구현이 가능하지만 특별한 세션 저장소를 직접 구축하려면
<a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/scope/session/SessionStore.scala">SessionStore</a>
또는
<a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/scope/session/ServerSessionStore.scala">ServerSessionStore</a>
을 상속받아 구현하여야 합니다.</p>
<p>설정 방법은 다음의 두 가지 방식이 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="n">my</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">StoreClassName</span>
</pre></div>
</div>
<p>또는:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="p">{</span>
  <span class="s2">&quot;my.session.StoreClassName&quot;</span> <span class="p">{</span>
    <span class="n">option1</span> <span class="o">=</span> <span class="n">value1</span>
    <span class="n">option2</span> <span class="o">=</span> <span class="n">value2</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>세션은 클라이언트에 저장하는 것이 확장에 도움이 됩니다
(직렬화가 가능하고 <a class="reference external" href="http://stackoverflow.com/questions/640938/what-is-the-maximum-size-of-a-web-browsers-cookies-key">4KB 이하</a>).
서버 측(메모리 혹은 데이터베이스)에는 필요할 때에만 저장하세요.</p>
<p>참고:
<a class="reference external" href="http://www.technicalinfo.net/papers/WebBasedSessionManagement.html">Web Based Session Management - Best practices in managing HTTP-based client sessions</a>.</p>
</div>
<div class="section" id="id9">
<h4>클라이언트 세션 저장과 서버 세션 저장<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>두 가지 종류의 세션 저장이 가능:</p>
<ul class="simple">
<li><p>클라이언트에만 저장</p></li>
<li><p>클라이언트 + 서버 사용:</p></li>
</ul>
<p>클라이언트만 사용:</p>
<ul class="simple">
<li><p>세션 데이터는 암호화된 쿠키로 클라이언트에 저장됩니다.</p></li>
<li><p>서버는 어떠한 데이터도 저장할 필요가 없습니다.</p></li>
<li><p>요청이 발생하면 서버는 복호화해서 사용합니다.</p></li>
</ul>
<p>클라이언트 + 서버 사용:</p>
<ul class="simple">
<li><p>세션은 두 가지의 정보가 있습니다: 세션ID, 세션데이터.</p></li>
<li><p>서버는 lookup table에서 데이터를 찾는 것처럼 세션을 저장합니다.</p></li>
<li><p>ID는 암호화 되어 클라이언트에 저장됩니다.</p></li>
<li><p>요청이 발생하면 서버는 아이디를 복호화하여 데이터를 찾게됩니다.</p></li>
<li><p>신용카드처럼 ID만 저장되고 금액은 저장되지 않는 것과 같습니다.</p></li>
</ul>
<p>위 두 가지 경우에 있어서 클라이언트는 반드시 쿠키를 저장하고 있어야만 합니다
(암호화된 데이터 vs 암호화된 ID). “Store sessions at server side” 가 의미하는 것은 서버 측에서 데이터가 저장되는 것만을 의미합니다.</p>
</div>
</div>
<div class="section" id="object-vs-val">
<h3>object vs. val<a class="headerlink" href="#object-vs-val" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">val</span></code> 대신에 <code class="docutils literal notranslate"><span class="pre">object</span></code> 를 사용하세요.</p>
<p><strong>아래와 같이 사용하지 마세요</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">object</span> <span class="n">RVar</span> <span class="p">{</span>
  <span class="n">val</span> <span class="n">title</span>    <span class="o">=</span> <span class="n">new</span> <span class="n">RequestVar</span><span class="p">[</span><span class="n">String</span><span class="p">]</span>
  <span class="n">val</span> <span class="n">category</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RequestVar</span><span class="p">[</span><span class="n">String</span><span class="p">]</span>
<span class="p">}</span>

<span class="nb">object</span> <span class="n">SVar</span> <span class="p">{</span>
  <span class="n">val</span> <span class="n">username</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SessionVar</span><span class="p">[</span><span class="n">String</span><span class="p">]</span>
  <span class="n">val</span> <span class="n">isAdmin</span>  <span class="o">=</span> <span class="n">new</span> <span class="n">SessionVar</span><span class="p">[</span><span class="n">Boolean</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>위의 코드는 컴파일은 되지만 실행되지 않습니다. 왜냐하면 “Vars”는 내부적으로 조회 시에 클래스 이름이 사용됩니다.
<code class="docutils literal notranslate"><span class="pre">title</span></code>, <code class="docutils literal notranslate"><span class="pre">category</span></code>, <code class="docutils literal notranslate"><span class="pre">val</span></code> 을 사용하는 경우 “xitrum.RequestVar” 라는 클래스 이름으로 사용됩니다.
<code class="docutils literal notranslate"><span class="pre">username</span></code> 과 <code class="docutils literal notranslate"><span class="pre">isAdmin</span></code> 도 마찬가지 입니다.</p>
</div>
</div>
<span id="document-validation"></span><div class="section" id="id1">
<h2>검증<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Xitrum은 클라이언트 검증을 위해 <a class="reference external" href="http://bassistance.de/jquery-plugins/jquery-plugin-validation/">jQuery Validation plugin</a>
내포하고 있고 서버 검증을 위해 핼퍼를 제공합니다.</p>
<div class="section" id="id2">
<h3>기본 검증<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">xitrum.validator</span></code> 패키지에 검증기를 제공합니다.
다음과 같은 메소드를 가지고 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">check</span><span class="p">(</span><span class="n">value</span><span class="p">):</span> <span class="n">Boolean</span>
<span class="n">message</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="n">Option</span><span class="p">[</span><span class="n">String</span><span class="p">]</span>
<span class="n">exception</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>검증을 통과 하지 못하면, <code class="docutils literal notranslate"><span class="pre">message</span></code> 는 <code class="docutils literal notranslate"><span class="pre">Some(error</span> <span class="pre">message)</span></code> 를 반환하고
<code class="docutils literal notranslate"><span class="pre">exception</span></code> 은 <code class="docutils literal notranslate"><span class="pre">xitrum.exception.InvalidInput(error</span> <span class="pre">message)</span></code> 를 호출합니다.</p>
<p>어디서든지 검증기를 사용할 수 있습니다.</p>
<p>Action 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.validator.Required</span>

<span class="nd">@POST</span><span class="p">(</span><span class="s2">&quot;articles&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CreateArticle</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">val</span> <span class="n">title</span> <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="s2">&quot;tite&quot;</span><span class="p">)</span>
    <span class="n">val</span> <span class="n">body</span>  <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
    <span class="n">Required</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
    <span class="n">Required</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Body&quot;</span><span class="p">,</span>  <span class="n">body</span><span class="p">)</span>

    <span class="o">//</span> <span class="n">Do</span> <span class="k">with</span> <span class="n">the</span> <span class="n">valid</span> <span class="n">title</span> <span class="ow">and</span> <span class="n">body</span><span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">try</span></code> 、 <code class="docutils literal notranslate"><span class="pre">catch</span></code> 를 사용하지 않은 구문에서 검증을 통과하지 못하면
xitrum은 자동으로 예외를 탐지해서 클라이언트로 에러메세지를 전송합니다.
이것은 클라이언트에서 검증을 사용하거나 웹 APIs를 작성할 때 도움이 됩니다.</p>
<p>Model 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.validator.Required</span>

<span class="n">case</span> <span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="n">String</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">String</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">isValid</span>           <span class="o">=</span> <span class="n">Required</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>   <span class="o">&amp;&amp;</span>     <span class="n">Required</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">validationMessage</span> <span class="o">=</span> <span class="n">Required</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="n">orElse</span> <span class="n">Required</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/xitrum-framework/xitrum/tree/master/src/main/scala/xitrum/validator">xitrum.validator 패키지에는</a>
모든 종류의 기본 검증기 리스트가 있습니다.</p>
</div>
<div class="section" id="id3">
<h3>검증기 수정하기<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/validator/Validator.scala">xitrum.validator.Validator</a> 를 확장할때
<code class="docutils literal notranslate"><span class="pre">check</span></code> 나 <code class="docutils literal notranslate"><span class="pre">message</span></code> 메소드만 확장하면 됩니다.</p>
<p>또한, <a class="reference external" href="http://commons.apache.org/proper/commons-validator/">Commons Validator</a> 를 사용해도 됩니다.</p>
</div>
</div>
<span id="document-upload"></span><div class="section" id="id1">
<h2>파일 업로드<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="index.html#document-scopes"><span class="doc">스코프</span></a> 를 참고하세요.</p>
<p>업로드 폼에서 <code class="docutils literal notranslate"><span class="pre">enctype</span></code> 를 <code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code> 으로 설정합니다.</p>
<p>MyUpload.scalate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="p">{</span><span class="n">url</span><span class="p">[</span><span class="n">MyUpload</span><span class="p">]}</span> <span class="n">enctype</span><span class="o">=</span><span class="s2">&quot;multipart/form-data&quot;</span><span class="p">)</span>
  <span class="o">!=</span> <span class="n">antiCsrfInput</span>

  <span class="n">label</span> <span class="n">Please</span> <span class="n">select</span> <span class="n">a</span> <span class="n">file</span><span class="p">:</span>
  <span class="nb">input</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;file&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myFile&quot;</span><span class="p">)</span>

  <span class="n">button</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="p">)</span> <span class="n">Upload</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">MyUpload</span></code> 액션:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io.netty.handler.codec.http.multipart.FileUpload</span>

<span class="n">val</span> <span class="n">myFile</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="n">FileUpload</span><span class="p">](</span><span class="s2">&quot;myFile&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">myFile</span></code>  <a class="reference external" href="http://netty.io/4.0/api/io/netty/handler/codec/http/multipart/FileUpload.html">FileUpload</a>
의 인스턴스 입니다. 이 메소드를 이용하여 파일 이름을 가져오거나 파일의 이동 등을 할 수 있습니다.</p>
<p>작은 파일(16KB 이하)은 메모리에 저장됩니다. 대용량 파일은 시스템의 임시 폴더에 저장됩니다(혹은 xitrum.conf에 정의된 <code class="docutils literal notranslate"><span class="pre">xitrum.request.tmpUploadDir</span></code>).
그리고 나서 커넥션이 닫히거나 응답이 전송되면 자동으로 삭제됩니다.</p>
<div class="section" id="ajax">
<h3>Ajax 스타일 업로드<a class="headerlink" href="#ajax" title="Permalink to this headline">¶</a></h3>
<p>많은 자바스크립트 라이브러리는 Ajax 스타일의 업로드를 지원합니다. 숨겨진 iframe이나 플래시등으로 <code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code> 를 서버로 전송합니다.
폼의 요청 파라미터가 전송될 때, 어떤 라이브러리를 사용했는지는 Xitrum 억세스 로그를 확인하면 알 수 있습니다.</p>
</div>
</div>
<span id="document-filter"></span><div class="section" id="id1">
<h2>액션 필터<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="before">
<h3>Before 필터<a class="headerlink" href="#before" title="Permalink to this headline">¶</a></h3>
<p>Before 필터는 액션이 수행되기 전에 수행됩니다.
만약 Before가 무언가를 응답한다면 필터 이후의 어떠한 액션도 수행되지 않습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;before_filter&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">beforeFilter</span> <span class="p">{</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;I run therefore I am&quot;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="o">//</span> <span class="n">This</span> <span class="n">method</span> <span class="ow">is</span> <span class="n">run</span> <span class="n">after</span> <span class="n">the</span> <span class="n">above</span> <span class="n">filters</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">respondInlineView</span><span class="p">(</span><span class="s2">&quot;Before filters should have been run, please check the log&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="after">
<h3>After 필터<a class="headerlink" href="#after" title="Permalink to this headline">¶</a></h3>
<p>After 필터는 액션이 수행되고 난 후에 수행됩니다.
함수들은 입력값이 없으면 리턴값은 무시됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;after_filter&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">afterFilter</span> <span class="p">{</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Run at &quot;</span> <span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="p">())</span>
  <span class="p">}</span>

  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">respondText</span><span class="p">(</span><span class="s2">&quot;After filter should have been run, please check the log&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="around">
<h3>Around 필터<a class="headerlink" href="#around" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;around_filter&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">aroundFilter</span> <span class="p">{</span> <span class="n">action</span> <span class="o">=&gt;</span>
    <span class="n">val</span> <span class="n">begin</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="p">()</span>
    <span class="n">action</span><span class="p">()</span>
    <span class="n">val</span> <span class="n">end</span>   <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="p">()</span>
    <span class="n">val</span> <span class="n">dt</span>    <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">begin</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">s</span><span class="s2">&quot;アクション実行時間: $dt [ms]&quot;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">respondText</span><span class="p">(</span><span class="s2">&quot;Around filter should have been run, please check the log&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Around 필터가 여러 개 있을 때, 외부와 내부 구성에 중첩됩니다</p>
</div>
<div class="section" id="id2">
<h3>필터의 수행 순서<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Before 필터 -&gt; around 필터 -&gt; after 필터.</p></li>
<li><p>몇몇 before 필터가 false를 반환하면 나머지 필터가 실행되지 않습니다.</p></li>
<li><p>Around 필터가 실행되면 모든 after 필터가 실행됩니다.</p></li>
<li><p>외부 around filter 필터가 <code class="docutils literal notranslate"><span class="pre">action</span></code> 인수를 호출하지 않으면 내부의 around 필터가 실행되지 않습니다.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">before1</span> <span class="o">-</span><span class="n">true</span><span class="o">-&gt;</span> <span class="n">before2</span> <span class="o">-</span><span class="n">true</span><span class="o">-&gt;</span> <span class="o">+--------------------+</span> <span class="o">--&gt;</span> <span class="n">after1</span> <span class="o">--&gt;</span> <span class="n">after2</span>
                                <span class="o">|</span> <span class="n">around1</span> <span class="p">(</span><span class="mi">1</span> <span class="n">of</span> <span class="mi">2</span><span class="p">)</span>   <span class="o">|</span>
                                <span class="o">|</span>   <span class="n">around2</span> <span class="p">(</span><span class="mi">1</span> <span class="n">of</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span>
                                <span class="o">|</span>     <span class="n">action</span>         <span class="o">|</span>
                                <span class="o">|</span>   <span class="n">around2</span> <span class="p">(</span><span class="mi">2</span> <span class="n">of</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span>
                                <span class="o">|</span> <span class="n">around1</span> <span class="p">(</span><span class="mi">2</span> <span class="n">of</span> <span class="mi">2</span><span class="p">)</span>   <span class="o">|</span>
                                <span class="o">+--------------------+</span>
</pre></div>
</div>
</div>
</div>
<span id="document-cache"></span><div class="section" id="id1">
<h2>서버측 캐시<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="index.html#document-cluster"><span class="doc">클러스터링</span></a> 챕터를 참고하세요</p>
<p>Xitrum은 빠른 응답을 위해 클라이언트 측과 서버 측의 광범위한 캐싱 기능을 제공합니다.
웹 서버 레이어는 작은 파일은 메모리에 캐시된 큰 파일은 NIO의 제로 복사를 사용하여 전송됩니다.
Xitrum 정적 파일 전송 속도는 <a class="reference external" href="https://gist.github.com/3293596">Nginx와 동등</a> 합니다
Web 프레임워크 레이어는 Rails 스타일로 페이지나 액션 객체를 캐시 할 수 있습니다.
<a class="reference external" href="http://code.google.com/speed/page-speed/docs/rules_intro.html">All Google’s best practices (영문)</a>
에서와 같이 조건부 GET 요청은 클라이언트 사이드에서 캐시됩니다.</p>
<p>동적 콘텐츠에 대해서는 만약 파일이 생성 된 이후 변경되지 않는 경우(static file과 같이) 클라이언트에 적극적으로 캐시하도록
헤더를 설정해야합니다.
이 경우에는 <code class="docutils literal notranslate"><span class="pre">setClientCacheAggressively</span> <span class="pre">()</span></code> 를 액션에서 호출하여 얻을 수 있습니다.</p>
<p>클라이언트에 캐시시키고 싶지 않은 경우에는 <code class="docutils literal notranslate"><span class="pre">setNoClientCache</span> <span class="pre">()</span></code> 를 액션에서 호출하여 얻을 수 있습니다.</p>
<p>서버 측 캐시에 대해서는 다음 예제에 자세히 설명합니다.</p>
<div class="section" id="id2">
<h3>캐시페이지 혹은 액션<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.</span><span class="p">{</span><span class="n">GET</span><span class="p">,</span> <span class="n">CacheActionMinute</span><span class="p">,</span> <span class="n">CachePageMinute</span><span class="p">}</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles&quot;</span><span class="p">)</span>
<span class="nd">@CachePageMinute</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesIndex</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;articles/:id&quot;</span><span class="p">)</span>
<span class="nd">@CacheActionMinute</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ArticlesShow</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>“page cache”와 “acation cache” 개념은 <a class="reference external" href="http://guides.rubyonrails.org/caching_with_rails.html">Ruby on Rails</a> 를 참고하고 있습니다.</p>
<p>요청 처리 프로세스의 순서는 다음과 같습니다.</p>
<ol class="arabic simple">
<li><p>요청 -&gt; (2) Before 필터 -&gt; (3) 액션의 execute 메소드 -&gt; (4) 응답</p></li>
</ol>
<p>처음 요청시 Xitrum는 응답을 지정된 기간 동안 캐시합니다.
<code class="docutils literal notranslate"><span class="pre">&#64;CachePageMinute</span> <span class="pre">(1)</span></code> 과 <code class="docutils literal notranslate"><span class="pre">&#64;CacheActionMinute</span> <span class="pre">(1)</span></code> 은 1 분 동안 캐시하는 것을 의미합니다.
Xitrum는 응답 상태가 “200 OK”인 경우에만 캐시합니다.
예를 들어, 응답 상태가 “500 Internal Server Error” 또는 “302 Found”(리디렉션)이되는 응답은 캐시되지 않습니다.</p>
<p>동일한 작업에 대한 동일 요청에는 만약 캐시된 응답이 지정된 기간 내에 있을 경우
Xitrum은 즉시 캐시된 응답을 반환합니다:</p>
<ul class="simple">
<li><p>페이지 캐시의 경우 처리 과정은 (1) -&gt; (4)입니다.</p></li>
<li><p>액션 캐시의 경우 (1) -&gt; (2) -&gt; (4) 또는 Before 필터가 “false”를 반환한 경우 (1) -&gt; (2)입니다.</p></li>
</ul>
<p>차이점은 page 캐시는 Before 필터를 수행하지 않습니다.</p>
<p>일반적으로 페이지 캐시는 모든 사용자에게 공통된 반응의 경우에 사용합니다.
액션 캐시는 Before 필터를 통해, 예를 들어 사용자의 로그인 상태 체크 등, 캐시된 응답을 “가드” 하는 경우에 사용합니다:</p>
<ul class="simple">
<li><p>로그인한 경우 캐시된 응답에 액세스 할 수 있습니다.</p></li>
<li><p>로그인하지 않은 경우 로그인 페이지로 리다이렉트 합니다.</p></li>
</ul>
</div>
<div class="section" id="id3">
<h3>캐시 오브젝트<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://xitrum-framework.github.io/api/3.17/index.html#xitrum.Cache">xitrum.Cache</a> 을 대신하여
<code class="docutils literal notranslate"><span class="pre">xitrum.Config.xitrum.cache</span></code> 사용할 수 있습니다.</p>
<p>명시적으로 TTL을 설정하지 않은 경우:</p>
<ul class="simple">
<li><p>put(key, value)</p></li>
</ul>
<p>유효기간을 설정한 경우:</p>
<ul class="simple">
<li><p>putSecond(key, value, seconds)</p></li>
<li><p>putMinute(key, value, minutes)</p></li>
<li><p>putHour(key, value, hours)</p></li>
<li><p>putDay(key, value, days)</p></li>
</ul>
<p>존재하지 않을 경우만 캐시하는 방법:</p>
<ul class="simple">
<li><p>putIfAbsent(key, value)</p></li>
<li><p>putIfAbsentSecond(key, value, seconds)</p></li>
<li><p>putIfAbsentMinute(key, value, minutes)</p></li>
<li><p>putIfAbsentHour(key, value, hours)</p></li>
<li><p>putIfAbsentDay(key, value, days)</p></li>
</ul>
</div>
<div class="section" id="id4">
<h3>캐시 제거<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>페이지나 액션의 캐시 제거:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">removeAction</span><span class="p">[</span><span class="n">MyAction</span><span class="p">]</span>
</pre></div>
</div>
<p>오브젝트 캐시 제거:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
<p>prefix로 시작되는 키를 모두 제거:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">removePrefix</span><span class="p">(</span><span class="n">keyPrefix</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">removePrefix</span></code> 는 prefix를 사용하여 계층적 캐쉬를 구축 할 수 있습니다.
예를 들어, 기사와 관련된 요소를 캐쉬하고 싶은 경우라면 기사가 변경되었을 때 관련 캐쉬는 다음과 같이 정리할 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Config.xitrum.cache</span>

<span class="o">//</span> <span class="n">prefix를</span> <span class="n">이용하여</span> <span class="n">캐쉬</span>
<span class="n">val</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;articles/&quot;</span> <span class="o">+</span> <span class="n">article</span><span class="o">.</span><span class="n">id</span>
<span class="n">cache</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;/likes&quot;</span><span class="p">,</span> <span class="n">likes</span><span class="p">)</span>
<span class="n">cache</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;/comments&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span>

<span class="o">//</span> <span class="n">필요시</span><span class="p">,</span> <span class="n">기사와</span> <span class="n">관련된</span> <span class="n">캐쉬를</span> <span class="n">전부</span> <span class="n">삭제할</span> <span class="n">수</span> <span class="n">있습니다</span><span class="o">.</span>
<span class="n">cache</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>설정<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Xitrum 캐시 기능은 캐시 엔진에 의해 제공됩니다. 캐시 엔진은 프로젝트의 필요에 따라 취사선택할 수 있습니다.
캐시 엔진 설정은 <a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/config/xitrum.conf">config / xitrum.conf</a> 에서 사용하는 엔진에 따라 다음 두 가지 방식으로 설정할 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cache</span> <span class="o">=</span> <span class="n">my</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">EngineClassName</span>
</pre></div>
</div>
<p>또는:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cache</span> <span class="p">{</span>
  <span class="s2">&quot;my.cache.EngineClassName&quot;</span> <span class="p">{</span>
    <span class="n">option1</span> <span class="o">=</span> <span class="n">value1</span>
    <span class="n">option2</span> <span class="o">=</span> <span class="n">value2</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Xitrum은 이것을 제공합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cache</span> <span class="p">{</span>
  <span class="c1"># Simple in-memory cache</span>
  <span class="s2">&quot;xitrum.local.LruCache&quot;</span> <span class="p">{</span>
    <span class="n">maxElems</span> <span class="o">=</span> <span class="mi">10000</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>만약 클러스터링 된 서버를 사용하는 경우 캐쉬 엔진에는 <a class="reference external" href="https://github.com/xitrum-framework/xitrum-hazelcast">Hazelcast</a> 를 사용할 수 있습니다.</p>
<p>자체 캐쉬 엔진을 사용하는 경우에는 <code class="docutils literal notranslate"><span class="pre">xitrum.Cache</span></code> 의 <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/Cache.scala">interface</a> 를 구현합니다.</p>
</div>
<div class="section" id="id6">
<h3>캐쉬의 동작원리<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Inbound:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>               액션응답
               캐쉬됨
request        캐쉬가 존재?
-------------------------+---------------NO---------------&gt;
                         |
&lt;---------YES------------+
  캐쉬에서 응답
</pre></div>
</div>
<p>Outbound:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>               액션응답
               캐쉬됨
               캐쉬가 존재하지 않음? 　          response
&lt;---------NO-------------+---------------------------------
                         |
&lt;---------YES------------+
  캐쉬를 저장함
</pre></div>
</div>
</div>
<div class="section" id="xitrum-util-locallrucache">
<h3>xitrum.util.LocalLruCache<a class="headerlink" href="#xitrum-util-locallrucache" title="Permalink to this headline">¶</a></h3>
<p>위에서 언급 한 캐쉬 엔진은 시스템 전체가 공유하는 캐시입니다.
만약 작은 간단한 캐쉬 엔진 만 필요한 경우에는 <code class="docutils literal notranslate"><span class="pre">xitrum.util.LocalLruCache</span></code> 을 사용합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.util.LocalLruCache</span>

<span class="o">//</span> <span class="n">LRU</span> <span class="p">(</span><span class="n">Least</span> <span class="n">Recently</span> <span class="n">Used</span><span class="p">)</span> <span class="n">캐쉬는</span> <span class="mi">1000</span><span class="n">개만</span> <span class="n">저장합니다</span>
<span class="o">//</span> <span class="n">키와</span> <span class="n">저장값은</span> <span class="n">String</span> <span class="n">타입으로</span> <span class="n">사용됩니다</span>
<span class="n">val</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">LocalLruCache</span><span class="p">[</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">](</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>반환된 <code class="docutils literal notranslate"><span class="pre">캐쉬</span></code> 는 <a class="reference external" href="http://docs.oracle.com/javase/6/docs/api/java/util/LinkedHashMap.html">java.util.LinkedHashMap</a> 인스턴스이기 때문에 <code class="docutils literal notranslate"><span class="pre">LinkedHashMap</span></code> 방법을 사용하여 처리 할 수 있습니다.</p>
</div>
</div>
<span id="document-i18n"></span><div class="section" id="i18n">
<h2>I18n<a class="headerlink" href="#i18n" title="Permalink to this headline">¶</a></h2>
<p>GNU gettext 가 사용됩니다. gettext는 다른 국제화 방법과는 다르게 복수형을 지원합니다.</p>
<img alt="http://poedit.net/images/home_image2-big.png" src="http://poedit.net/images/home_image2-big.png" />
<div class="section" id="id1">
<h3>소스코드에 국제화 메세지 작성<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">xitrum.Action</span></code> 은 <code class="docutils literal notranslate"><span class="pre">xitrum.I18n</span></code> 확장했으며 다음의 메소드가 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>t(&quot;Message&quot;)
tc(&quot;Context&quot;, &quot;Message&quot;)

t(&quot;Hello %s&quot;).format(&quot;World&quot;)

// 1$ and 2$ are placeholders
t(&quot;%1$s says hello to %2$s, then %2$s says hello back to %1$s&quot;).format(&quot;Bill&quot;, &quot;Hillary&quot;)

// {0} and {1} are placeholders
java.text.MessageFormat.format(t(&quot;{0} says hello to {1}, then {1} says hello back to {0}&quot;), &quot;Bill&quot;, &quot;Hillary&quot;)

t(&quot;%,.3f&quot;).format(1234.5678)                                // =&gt; 1,234.568
t(&quot;%,.3f&quot;).formatLocal(java.util.Locale.FRENCH, 1234.5678)  // =&gt; 1 234,568
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Above</span><span class="p">,</span> <span class="n">you</span> <span class="n">explicitly</span> <span class="n">specify</span> <span class="n">locale</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">implicitly</span> <span class="n">use</span> <span class="n">locale</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">action</span><span class="p">:</span>
<span class="o">//</span> <span class="n">when</span> <span class="n">English</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="mf">234.568</span><span class="p">,</span> <span class="n">when</span> <span class="n">French</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="mi">234</span><span class="p">,</span><span class="mi">568</span>
<span class="n">t</span><span class="p">(</span><span class="s2">&quot;%,.3f&quot;</span><span class="p">,</span> <span class="mf">1234.5678</span><span class="p">)</span>
</pre></div>
</div>
<p>action 안에서나 혹은 액션에서 호출할 수 있습니다.
model과 같은 곳에서의 사용은 현재의 액션에서 <code class="docutils literal notranslate"><span class="pre">t</span></code> 나 <code class="docutils literal notranslate"><span class="pre">tc</span></code> 를 호출하여 넘겨줘야 합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">In</span> <span class="n">an</span> <span class="n">action</span>
<span class="n">respondText</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">hello</span><span class="p">(</span><span class="n">this</span><span class="p">))</span>

<span class="o">//</span> <span class="n">In</span> <span class="n">the</span> <span class="n">model</span>
<span class="kn">import</span> <span class="nn">xitrum.I18n</span>
<span class="nb">object</span> <span class="n">MyModel</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">i18n</span><span class="p">:</span> <span class="n">I18n</span><span class="p">)</span> <span class="o">=</span> <span class="n">i18n</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="pot">
<h3>pot에 메세지 추출하기<a class="headerlink" href="#pot" title="Permalink to this headline">¶</a></h3>
<p>프로젝트 루트에 빈 i18n.pot 파일을 생성하여 전체 프로젝트를 다시 컴파일 하면 됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sbt</span><span class="o">/</span><span class="n">sbt</span> <span class="n">clean</span>
<span class="n">rm</span> <span class="n">i18n</span><span class="o">.</span><span class="n">pot</span>
<span class="n">touch</span> <span class="n">i18n</span><span class="o">.</span><span class="n">pot</span>
<span class="n">sbt</span><span class="o">/</span><span class="n">sbt</span> <span class="nb">compile</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sbt/sbt</span> <span class="pre">clean</span></code> 는 모든 .class파일을 삭제하고 전체를 다시 컴파일 합니다.
<code class="docutils literal notranslate"><span class="pre">sbt/sbt</span> <span class="pre">clean</span></code> 명령은 SBT가 모든 <a class="reference internal" href="index.html#document-deps"><span class="doc">의존된</span></a> 라이브러리를 다운받기 때문에
<code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">target</span> <span class="pre">-name</span> <span class="pre">*.class</span> <span class="pre">-delete</span></code> 명령이 조금 더 빠르지만
<code class="docutils literal notranslate"><span class="pre">target</span></code> 내부의 .class 파일을 삭제하는것은 동일합니다.</p>
<p>재컴파일 후에 i18n.pot는 소스코드로 부터 추출된 gettext 메세지를 채웁니다.
마법같은 이 동작은 <a class="reference external" href="http://www.scala-lang.org/node/140">Scala compiler plugin technique</a> 에 기술되어 있습니다.</p>
<p>한 가지 이 메소드의 주의점은 gettext는 Scala 소스 코드로부터 메세지를 추출합니다. 만약 자바 파일을 사용한다면 다음과 같이 <code class="docutils literal notranslate"><span class="pre">xgettext</span></code>
커맨드 라인을 사용하여야 합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>xgettext -kt -ktc:1c,2 -ktn:1,2 -ktcn:1c,2,3 -o i18n_java.pot --from-code=UTF-8 $(find src/main/java -name &quot;*.java&quot;)
</pre></div>
</div>
<p>그리고 나서 수동으로 i18n_java.pot 파일과 i18n.pot파일을 병합해야 합니다.</p>
</div>
<div class="section" id="po">
<h3>po 파일 저장위치<a class="headerlink" href="#po" title="Permalink to this headline">¶</a></h3>
<p>i18n.pot은 임시 파일입니다. 파일들을 &lt;language&gt;.po 로 복사하여 번역해야 합니다.</p>
<p>Xitrum은 클래스 패스상의 <code class="docutils literal notranslate"><span class="pre">i18n</span></code> 디렉토리를 모니터링합니다.
만약 런타임시 디렉토리 상의 &lt;language&gt;.po 파일이 변경되거나 추가된다면
Xitrum은 자동으로 &lt;language&gt;.po 파일들을 다시 로드합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">src</span>
  <span class="n">main</span>
    <span class="n">scala</span>
    <span class="n">view</span>
    <span class="n">resources</span>
      <span class="n">i18n</span>
        <span class="n">ja</span><span class="o">.</span><span class="n">po</span>
        <span class="n">vi</span><span class="o">.</span><span class="n">po</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>po 파일을 수정하기 위해서는 <a class="reference external" href="http://www.poedit.net/">Poedit</a> 와 같은 툴을 사용하면 됩니다.
툴을 사용하여 새로운 pot 파일을 기존의 po 파일에 추가 할수 있습니다.</p>
<p>po 파일들은 여러 JAR파일들에 패키징할 수 있고 Xitrum은 실행시에 자동으로 병합합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mylib</span><span class="o">.</span><span class="n">jar</span>
  <span class="n">i18n</span>
    <span class="n">ja</span><span class="o">.</span><span class="n">po</span>
    <span class="n">vi</span><span class="o">.</span><span class="n">po</span>
        <span class="o">...</span>

<span class="n">another</span><span class="o">.</span><span class="n">jar</span>
  <span class="n">i18n</span>
    <span class="n">ja</span><span class="o">.</span><span class="n">po</span>
    <span class="n">vi</span><span class="o">.</span><span class="n">po</span>
        <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>언어설정<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>브라우저의 요청 헤더의 <code class="docutils literal notranslate"><span class="pre">Accept-Language</span></code> 에서 언어 셋을 가져오려면
<code class="docutils literal notranslate"><span class="pre">browserLanguages</span></code> 를 호출하면 됩니다. 결과는 브라우저의 우선순위에 따라 정렬됩니다.</p></li>
<li><p>기본 언어는 “en” 입니다. 현재의 언어로 세팅하기 위해서는, 예를 들어, 일어일 경우 <code class="docutils literal notranslate"><span class="pre">language</span> <span class="pre">=</span> <span class="pre">&quot;ja&quot;</span></code> 로 하면 됩니다.</p></li>
<li><p>가장 적절한 언어를 리소스에서 찾아 자동세팅을 위해서는
<code class="docutils literal notranslate"><span class="pre">autosetLanguage(availableLanguages)</span></code> 을 호출하면 됩니다.
<code class="docutils literal notranslate"><span class="pre">availableLanguages</span></code> 는 <code class="docutils literal notranslate"><span class="pre">resources/i18n</span></code> 디렉토리와 JAR파일들의 가능한 언어들의 리스트를 가지고 있습니다.
만약 적절한 언어가 없을 경우에는 기본언어인 “en”으로 설정합니다.</p></li>
<li><p>현재의 언어셋을 확인하려면 <code class="docutils literal notranslate"><span class="pre">language</span></code> 를 사용하면 됩니다.</p></li>
</ul>
<p>일반적으로 액션의 before 필터에서 언어를 세팅합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">beforeFilter</span> <span class="p">{</span>
  <span class="n">val</span> <span class="n">lango</span><span class="p">:</span> <span class="n">Option</span><span class="p">[</span><span class="n">String</span><span class="p">]</span> <span class="o">=</span> <span class="n">yourMethodToGetUserPreferenceLanguageInSession</span><span class="p">()</span>
  <span class="n">lango</span> <span class="n">match</span> <span class="p">{</span>
    <span class="n">case</span> <span class="kc">None</span>       <span class="o">=&gt;</span> <span class="n">autosetLanguage</span><span class="p">(</span><span class="n">Locale</span><span class="o">.</span><span class="n">forLanguageTag</span><span class="p">(</span><span class="s2">&quot;ja&quot;</span><span class="p">),</span> <span class="n">Locale</span><span class="o">.</span><span class="n">forLanguageTag</span><span class="p">(</span><span class="s2">&quot;vi&quot;</span><span class="p">))</span>
    <span class="n">case</span> <span class="n">Some</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">language</span> <span class="o">=</span> <span class="n">lang</span>
  <span class="p">}</span>
  <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>검증 메세지<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>jQuery Validation 플러그인은 <a class="reference external" href="https://github.com/jzaefferer/jquery-validation/tree/master/src/localization">i18n error messages</a>
제공합니다.
Xitrum은 자동으로 현재의 언어에 상응하는 메세지를 가져옵니다.</p>
<p>서버의 기본 검증인 <code class="docutils literal notranslate"><span class="pre">xitrum.validator</span></code> 패키지, 또한
Xitrum은 제공하고 있습니다.</p>
</div>
<div class="section" id="id4">
<h3>복수형<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tn</span><span class="p">(</span><span class="s2">&quot;Message&quot;</span><span class="p">,</span> <span class="s2">&quot;Plural form&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">tcn</span><span class="p">(</span><span class="s2">&quot;Context&quot;</span><span class="p">,</span> <span class="s2">&quot;Message&quot;</span><span class="p">,</span> <span class="s2">&quot;Plural form&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Xitrum은 다음에 정의된 복수형만을 사용합니다:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.gnu.org/software/gettext/manual/html_node/Plural-forms.html#Plural-forms">What are plural forms</a></p></li>
<li><p><a class="reference external" href="http://www.gnu.org/software/gettext/manual/html_node/Translating-plural-forms.html#Translating-plural-forms">Translating plural forms</a></p></li>
</ul>
<p>복수형은 다음 중 하나를 사용해야 합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>nplurals=1; plural=0
nplurals=2; plural=n != 1
nplurals=2; plural=n&gt;1
nplurals=3; plural=n%10==1 &amp;&amp; n%100!=11 ? 0 : n != 0 ? 1 : 2
nplurals=3; plural=n==1 ? 0 : n==2 ? 1 : 2
nplurals=3; plural=n==1 ? 0 : (n==0 || (n%100 &gt; 0 &amp;&amp; n%100 &lt; 20)) ? 1 : 2
nplurals=3; plural=n%10==1 &amp;&amp; n%100!=11 ? 0 : n%10&gt;=2 &amp;&amp; (n%100&lt;10 || n%100&gt;=20) ? 1 : 2
nplurals=3; plural=n%10==1 &amp;&amp; n%100!=11 ? 0 : n%10&gt;=2 &amp;&amp; n%10&lt;=4 &amp;&amp; (n%100&lt;10 || n%100&gt;=20) ? 1 : 2
nplurals=3; plural=(n==1) ? 0 : (n&gt;=2 &amp;&amp; n&lt;=4) ? 1 : 2
nplurals=3; plural=n==1 ? 0 : n%10&gt;=2 &amp;&amp; n%10&lt;=4 &amp;&amp; (n%100&lt;10 || n%100&gt;=20) ? 1 : 2
nplurals=4; plural=n%100==1 ? 0 : n%100==2 ? 1 : n%100==3 || n%100==4 ? 2 : 3
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>날짜와 시간 포멧<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>만약 Scalate 템플릿 엔진을 사용한다면 날짜와 시간 포멧은 현재 액션의 언어 포멧을 따르게 됩니다.</p>
<p>다른 포멧을 사용하고자 하는 경우:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.text.</span><span class="p">{</span><span class="n">DateFormat</span><span class="p">,</span> <span class="n">NumberFormat</span><span class="p">}</span>

<span class="n">val</span> <span class="n">myDateFormat</span>   <span class="o">=</span> <span class="o">...</span>
<span class="n">val</span> <span class="n">myNumberFormat</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">val</span> <span class="n">options</span>        <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="s2">&quot;date&quot;</span> <span class="o">-&gt;</span> <span class="n">myDateFormat</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span> <span class="o">-&gt;</span> <span class="n">myNumberFormat</span><span class="p">)</span>
<span class="n">respondView</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-log"></span><div class="section" id="id1">
<h2>로그<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="xitrum-log">
<h3>xitrum.Log 오브젝트를 직접 사용하기<a class="headerlink" href="#xitrum-log" title="Permalink to this headline">¶</a></h3>
<p>어디서든지 다음과 같이 직접 호출할 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xitrum</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;My debug msg&quot;</span><span class="p">)</span>
<span class="n">xitrum</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;My info msg&quot;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="xitrum-log-trait">
<h3>xitrum.Log trait 사용하기<a class="headerlink" href="#xitrum-log-trait" title="Permalink to this headline">¶</a></h3>
<p>만약 로그가 사용된 위치(클래스)를 알고 싶다면 xitrum.log를 확장하면 됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">my_package</span>
<span class="kn">import</span> <span class="nn">xitrum.Log</span>

<span class="nb">object</span> <span class="n">MyModel</span> <span class="n">extends</span> <span class="n">Log</span> <span class="p">{</span>
  <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;My debug msg&quot;</span><span class="p">)</span>
  <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;My info msg&quot;</span><span class="p">)</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">log/xitrum.log</span></code> 파일에서  <code class="docutils literal notranslate"><span class="pre">MyModel</span></code> 로부터 나오는 로그 메세지를 확인할 수 있습니다.</p>
<p>Xitrum 액션은 xitrum.Log를 확장하고 있어서 어느 액션에서도 다음과 같이 사용할 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>로깅하기 전에 로그레벨을 체크하지 않아도 됩니다<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">xitrum.Log</span></code> 는 <a class="reference external" href="http://slf4s.org/">SLF4S</a> (<a class="reference external" href="http://slf4s.org/api/1.7.7/">API</a>) 를 바탕으로 합니다.
SLF4S <a class="reference external" href="http://www.slf4j.org/">SLF4J</a> 위에 구축되어 있습니다.</p>
<p>전통적으로 로그 결과를 확인하기 전에 계산으로 인한 과도한 CPU사용을 방지하기 위해 로그레벨을 체크하였지만
<a class="reference external" href="https://github.com/mattroberts297/slf4s/blob/master/src/main/scala/org/slf4s/Logger.scala">SLF4S의 자동체크</a> 기능이 있어서
일부러 체크할 필요가 없습니다.</p>
<p>이전 버전(이 코드는 3.13 이후로는 동작하지 않습니다):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">isTraceEnabled</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">val</span> <span class="n">result</span> <span class="o">=</span> <span class="n">heavyCalculation</span><span class="p">()</span>
  <span class="n">log</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Output: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>현재:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">log</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">s</span><span class="s2">&quot;Output: #{heavyCalculation()}&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>로그레벨 및 출력파일 조정<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>build.sbt 파일에 다음과 같은 라인이 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s2">&quot;ch.qos.logback&quot;</span> <span class="o">%</span> <span class="s2">&quot;logback-classic&quot;</span> <span class="o">%</span> <span class="s2">&quot;1.1.2&quot;</span>
</pre></div>
</div>
<p>이것의 의미는 <a class="reference external" href="http://logback.qos.ch/">Logback</a> 을 기본으로 사용한다는 뜻입니다.
Logback의 설정파일은  <code class="docutils literal notranslate"><span class="pre">config/logback.xml</span></code> 에 있습니다.</p>
<p>Logback을 <a class="reference external" href="http://www.slf4j.org/">SLF4J</a> 으로 교체 할 수도 있습니다.</p>
</div>
<div class="section" id="fluentd">
<h3>Fluentd 에 로그를 출력<a class="headerlink" href="#fluentd" title="Permalink to this headline">¶</a></h3>
<p>매우 대중적인 <a class="reference external" href="http://www.fluentd.org/">Fluentd</a> 로그 수집장치가 있습니다.
Logback을 수정하여 로그를 Fluentd 서버로 전송(여러곳에서 전송된)할 수 있습니다.</p>
<p>먼저, <a class="reference external" href="https://github.com/sndyuk/logback-more-appenders">logback-more-appenders</a> 라이브러리를 추가합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s2">&quot;org.fluentd&quot;</span> <span class="o">%</span> <span class="s2">&quot;fluent-logger&quot;</span> <span class="o">%</span> <span class="s2">&quot;0.2.11&quot;</span>

<span class="n">resolvers</span> <span class="o">+=</span> <span class="s2">&quot;Logback more appenders&quot;</span> <span class="n">at</span> <span class="s2">&quot;http://sndyuk.github.com/maven&quot;</span>

<span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s2">&quot;com.sndyuk&quot;</span> <span class="o">%</span> <span class="s2">&quot;logback-more-appenders&quot;</span> <span class="o">%</span> <span class="s2">&quot;1.1.0&quot;</span>
</pre></div>
</div>
<p>그리고 <code class="docutils literal notranslate"><span class="pre">config/logback.xml</span></code> 파일을 수정합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>...

&lt;appender name=&quot;FLUENT&quot; class=&quot;ch.qos.logback.more.appenders.DataFluentAppender&quot;&gt;
  &lt;tag&gt;mytag&lt;/tag&gt;
  &lt;label&gt;mylabel&lt;/label&gt;
  &lt;remoteHost&gt;localhost&lt;/remoteHost&gt;
  &lt;port&gt;24224&lt;/port&gt;
  &lt;maxQueueSize&gt;20000&lt;/maxQueueSize&gt;  &lt;!-- Save to memory when remote server is down --&gt;
&lt;/appender&gt;

&lt;root level=&quot;DEBUG&quot;&gt;
  &lt;appender-ref ref=&quot;FLUENT&quot;/&gt;
  &lt;appender-ref ref=&quot;OTHER_APPENDER&quot;/&gt;
&lt;/root&gt;

...
</pre></div>
</div>
</div>
</div>
<span id="document-deploy"></span><div class="section" id="id1">
<h2>프로덕션 서버에 배포하기<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Xitrum을 직접 배포할 수 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">브라우저</span> <span class="o">------</span> <span class="n">Xitrum</span> <span class="n">인스턴스</span>
</pre></div>
</div>
<p>HAProxy와 같은 로드밸런서 뒤, 혹은 Apache 의 Nginx와 같은 리버스 프록시에:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">브라우저</span> <span class="o">------</span> <span class="n">로드밸런서</span><span class="o">/</span><span class="n">리버스</span> <span class="n">프록시</span>   <span class="o">-+----</span> <span class="n">Xitrum</span> <span class="n">인스턴스1</span>
                                   <span class="o">+----</span> <span class="n">Xitrum</span> <span class="n">인스턴스2</span>
</pre></div>
</div>
<div class="section" id="package">
<h3>Package 디렉토리<a class="headerlink" href="#package" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">sbt/sbt</span> <span class="pre">xitrumPackage</span></code> 를 실행하여 배포될 <code class="docutils literal notranslate"><span class="pre">target/xitrum</span></code> 디렉토리를 준비합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">target</span><span class="o">/</span><span class="n">xitrum</span>
  <span class="n">config</span>
    <span class="p">[</span><span class="n">config</span> <span class="n">files</span><span class="p">]</span>
  <span class="n">public</span>
    <span class="p">[</span><span class="n">static</span> <span class="n">public</span> <span class="n">files</span><span class="p">]</span>
  <span class="n">lib</span>
    <span class="p">[</span><span class="n">dependencies</span> <span class="ow">and</span> <span class="n">packaged</span> <span class="n">project</span> <span class="n">file</span><span class="p">]</span>
  <span class="n">script</span>
    <span class="n">runner</span>
    <span class="n">runner</span><span class="o">.</span><span class="n">bat</span>
    <span class="n">scalive</span>
    <span class="n">scalive</span><span class="o">.</span><span class="n">jar</span>
    <span class="n">scalive</span><span class="o">.</span><span class="n">bat</span>
</pre></div>
</div>
</div>
<div class="section" id="xitrum-package">
<h3>사용자 정의 xitrum-package<a class="headerlink" href="#xitrum-package" title="Permalink to this headline">¶</a></h3>
<p>기본적으로 <code class="docutils literal notranslate"><span class="pre">sbt/sbt</span> <span class="pre">xitrumPackage</span></code> 명령은 수정된 <code class="docutils literal notranslate"><span class="pre">config</span></code> , <code class="docutils literal notranslate"><span class="pre">public</span></code> 그리고 <code class="docutils literal notranslate"><span class="pre">script</span></code> 를 <code class="docutils literal notranslate"><span class="pre">target/xitrum</span></code> 복사합니다
복사할 파일이나 디렉토리를 추가하려면 <code class="docutils literal notranslate"><span class="pre">build.sbt</span></code> 파일을 수정하면 됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">XitrumPackage</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;public, &quot;</span><span class="n">script</span><span class="s2">&quot;, &quot;</span><span class="n">doc</span><span class="o">/</span><span class="n">README</span><span class="o">.</span><span class="n">txt</span><span class="s2">&quot;, &quot;</span><span class="n">etc</span><span class="o">.</span><span class="s2">&quot;)</span>
</pre></div>
</div>
<p>자세한 내용은 <a class="reference external" href="https://github.com/xitrum-framework/xitrum-package">xitrum-package 사이트</a> 를 참조하세요.</p>
</div>
<div class="section" id="jvm-scala">
<h3>실행중인 JVM 프로세스에 Scala 콘솔 연결<a class="headerlink" href="#jvm-scala" title="Permalink to this headline">¶</a></h3>
<p>프로덕션 환경에서도 특별한 준비없이 <a class="reference external" href="https://github.com/xitrum-framework/scalive">Scalive</a> 를 사용하여
실행중인 JVM 프로세스에 대해 Scala 콘솔을 연결하고 디버깅을 할 수 있습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">script</span></code> 디렉토리에서 <code class="docutils literal notranslate"><span class="pre">scalive</span></code> 실행하면 됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">script</span>
  <span class="n">runner</span>
  <span class="n">runner</span><span class="o">.</span><span class="n">bat</span>
  <span class="n">scalive</span>
  <span class="n">scalive</span><span class="o">.</span><span class="n">jar</span>
  <span class="n">scalive</span><span class="o">.</span><span class="n">bat</span>
</pre></div>
</div>
</div>
<div class="section" id="oracle-jdk-centos">
<h3>Oracle JDK를 CentOS 나 우분투에 설차하기<a class="headerlink" href="#oracle-jdk-centos" title="Permalink to this headline">¶</a></h3>
<p>여기에서는 Java를 설치하는 방법에 대한 간단한 가이드를 소개합니다.
패키지 관리자를 사용하여 Java를 설치할 수 있습니다.</p>
<p>현재 설치되어 있는 Java 확인:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">alternatives</span> <span class="o">--</span><span class="nb">list</span> <span class="n">java</span>
</pre></div>
</div>
<p>출력 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/</span><span class="n">jdk1</span><span class="o">.</span><span class="mf">7.0_15</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/</span><span class="n">jdk1</span><span class="o">.</span><span class="mf">7.0_25</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span>
</pre></div>
</div>
<p>머신환경 확인 (32 bit 또는 64 bit):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">init</span>
</pre></div>
</div>
<p>출력 예:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">init</span><span class="p">:</span> <span class="n">ELF</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span> <span class="n">LSB</span> <span class="n">shared</span> <span class="nb">object</span><span class="p">,</span> <span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="p">,</span> <span class="n">version</span> <span class="mi">1</span> <span class="p">(</span><span class="n">SYSV</span><span class="p">),</span> <span class="n">dynamically</span> <span class="n">linked</span> <span class="p">(</span><span class="n">uses</span> <span class="n">shared</span> <span class="n">libs</span><span class="p">),</span> <span class="k">for</span> <span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span> <span class="mf">2.6</span><span class="o">.</span><span class="mi">24</span><span class="p">,</span> <span class="n">BuildID</span><span class="p">[</span><span class="n">sha1</span><span class="p">]</span><span class="o">=</span><span class="mh">0x4efe732752ed9f8cc491de1c8a271eb7f4144a5c</span><span class="p">,</span> <span class="n">stripped</span>
</pre></div>
</div>
<p>JDK를 <a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html">Oracle</a> 사이트에서 다운로드합니다.
브라우저를 통하지 않고 다운로드하려면 약간의 <a class="reference external" href="http://stackoverflow.com/questions/10268583/how-to-automate-download-and-instalation-of-java-jdk-on-linux">트릭</a> 이 필요합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">cookies</span> <span class="o">--</span><span class="n">header</span> <span class="s2">&quot;Cookie: gpw_e24=http%3A</span><span class="si">%2F%2F</span><span class="s2">www.oracle.com&quot;</span> <span class="s2">&quot;http://download.oracle.com/otn-pub/java/jdk/7u45-b18/jdk-7u45-linux-x64.tar.gz&quot;</span>
</pre></div>
</div>
<p>압축을 해제하고 이동합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">xzvf</span> <span class="n">jdk</span><span class="o">-</span><span class="mi">7</span><span class="n">u45</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">sudo</span> <span class="n">mv</span> <span class="n">jdk1</span><span class="o">.</span><span class="mf">7.0_45</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/</span><span class="n">jdk1</span><span class="o">.</span><span class="mf">7.0_45</span>
</pre></div>
</div>
<p>명령을 등록합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">alternatives</span> <span class="o">--</span><span class="n">install</span> <span class="s2">&quot;/usr/bin/java&quot;</span> <span class="s2">&quot;java&quot;</span> <span class="s2">&quot;/usr/lib/jvm/jdk1.7.0_45/bin/java&quot;</span> <span class="mi">1</span>
<span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">alternatives</span> <span class="o">--</span><span class="n">install</span> <span class="s2">&quot;/usr/bin/javac&quot;</span> <span class="s2">&quot;javac&quot;</span> <span class="s2">&quot;/usr/lib/jvm/jdk1.7.0_45/bin/javac&quot;</span> <span class="mi">1</span>
<span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">alternatives</span> <span class="o">--</span><span class="n">install</span> <span class="s2">&quot;/usr/bin/javap&quot;</span> <span class="s2">&quot;javap&quot;</span> <span class="s2">&quot;/usr/lib/jvm/jdk1.7.0_45/bin/javap&quot;</span> <span class="mi">1</span>
<span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">alternatives</span> <span class="o">--</span><span class="n">install</span> <span class="s2">&quot;/usr/bin/javaws&quot;</span> <span class="s2">&quot;javaws&quot;</span> <span class="s2">&quot;/usr/lib/jvm/jdk1.7.0_45/bin/javaws&quot;</span> <span class="mi">1</span>
</pre></div>
</div>
<p>인터랙티브 쉘에서 새 경로를 지정합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">alternatives</span> <span class="o">--</span><span class="n">config</span> <span class="n">java</span>
</pre></div>
</div>
<p>출력 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">There</span> <span class="n">are</span> <span class="mi">3</span> <span class="n">choices</span> <span class="k">for</span> <span class="n">the</span> <span class="n">alternative</span> <span class="n">java</span> <span class="p">(</span><span class="n">providing</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span><span class="p">)</span><span class="o">.</span>

  <span class="n">Selection</span>    <span class="n">Path</span>                               <span class="n">Priority</span>   <span class="n">Status</span>
<span class="o">------------------------------------------------------------</span>
<span class="o">*</span> <span class="mi">0</span>            <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/</span><span class="n">jdk1</span><span class="o">.</span><span class="mf">7.0_25</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span>   <span class="mi">50001</span>     <span class="n">auto</span> <span class="n">mode</span>
  <span class="mi">1</span>            <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/</span><span class="n">jdk1</span><span class="o">.</span><span class="mf">7.0_15</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span>   <span class="mi">50000</span>     <span class="n">manual</span> <span class="n">mode</span>
  <span class="mi">2</span>            <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/</span><span class="n">jdk1</span><span class="o">.</span><span class="mf">7.0_25</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span>   <span class="mi">50001</span>     <span class="n">manual</span> <span class="n">mode</span>
  <span class="mi">3</span>            <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/</span><span class="n">jdk1</span><span class="o">.</span><span class="mf">7.0_45</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span>   <span class="mi">1</span>         <span class="n">manual</span> <span class="n">mode</span>

<span class="n">Press</span> <span class="n">enter</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">the</span> <span class="n">current</span> <span class="n">choice</span><span class="p">[</span><span class="o">*</span><span class="p">],</span> <span class="ow">or</span> <span class="nb">type</span> <span class="n">selection</span> <span class="n">number</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">update</span><span class="o">-</span><span class="n">alternatives</span><span class="p">:</span> <span class="n">using</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jvm</span><span class="o">/</span><span class="n">jdk1</span><span class="o">.</span><span class="mf">7.0_45</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span> <span class="n">to</span> <span class="n">provide</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span> <span class="p">(</span><span class="n">java</span><span class="p">)</span> <span class="ow">in</span> <span class="n">manual</span> <span class="n">mode</span>
</pre></div>
</div>
<p>버전 체크:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">java</span> <span class="o">-</span><span class="n">version</span>
</pre></div>
</div>
<p>출력 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">java</span> <span class="n">version</span> <span class="s2">&quot;1.7.0_45&quot;</span>
<span class="n">Java</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="n">SE</span> <span class="n">Runtime</span> <span class="n">Environment</span> <span class="p">(</span><span class="n">build</span> <span class="mf">1.7</span><span class="o">.</span><span class="mi">0_45</span><span class="o">-</span><span class="n">b18</span><span class="p">)</span>
<span class="n">Java</span> <span class="n">HotSpot</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="mi">64</span><span class="o">-</span><span class="n">Bit</span> <span class="n">Server</span> <span class="n">VM</span> <span class="p">(</span><span class="n">build</span> <span class="mf">24.45</span><span class="o">-</span><span class="n">b08</span><span class="p">,</span> <span class="n">mixed</span> <span class="n">mode</span><span class="p">)</span>
</pre></div>
</div>
<p>javac 등도 마찬가지로 합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">alternatives</span> <span class="o">--</span><span class="n">config</span> <span class="n">javac</span>
<span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">alternatives</span> <span class="o">--</span><span class="n">config</span> <span class="n">javap</span>
<span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">alternatives</span> <span class="o">--</span><span class="n">config</span> <span class="n">javaws</span>
</pre></div>
</div>
</div>
<div class="section" id="xitrum">
<h3>시스템이 구동될때 Xitrum을 시작하기<a class="headerlink" href="#xitrum" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">script</span> <span class="pre">/</span> <span class="pre">runner</span></code> (<a href="#id4"><span class="problematic" id="id5">*</span></a>nix 환경)과 <code class="docutils literal notranslate"><span class="pre">script</span> <span class="pre">/</span> <span class="pre">runner.bat</span></code> (Windows 환경)은 객체의 <code class="docutils literal notranslate"><span class="pre">main</span></code> 메소드를 실행하기 위한 스크립트입니다. 프로덕션 환경에서는 이 스크립트를 사용하여 Web 서버를 시작합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">script</span><span class="o">/</span><span class="n">runner</span> <span class="n">quickstart</span><span class="o">.</span><span class="n">Boot</span>
</pre></div>
</div>
<p><a class="reference external" href="http://www.oracle.com/technetwork/java/hotspotfaq-138619.html">JVM 설정</a> 을 수정하려면
<code class="docutils literal notranslate"><span class="pre">runner</span></code> (또는 <code class="docutils literal notranslate"><span class="pre">runner.bat</span></code>) 을 수정합니다.
또한 <code class="docutils literal notranslate"><span class="pre">config</span> <span class="pre">/</span> <span class="pre">xitrum.conf</span></code> 참조하십시오.</p>
<p>리눅스에서 시스템이 시작할 때 백그라운드로 Xitrum이 구동되길 원한다면 간단하게 <code class="docutils literal notranslate"><span class="pre">/etc/rc.local</span></code> 에 라인을 추가해도
됩니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">su</span> <span class="o">-</span> <span class="n">user_foo_bar</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">the</span><span class="o">/</span><span class="n">runner</span><span class="o">/</span><span class="n">script</span><span class="o">/</span><span class="n">above</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p><a class="reference external" href="http://cr.yp.to/daemontools.html">daemontools</a> 는 또다른 방법입니다.
CentOS에 설치하는 방법은 <a class="reference external" href="http://whomwah.com/2008/11/04/installing-daemontools-on-centos5-x86_64/">설치방법</a> 을 참고하세요.
또는, <a class="reference external" href="http://supervisord.org/">Supervisord</a> 도 있습니다</p>
<p><code class="docutils literal notranslate"><span class="pre">/etc/supervisord.conf</span></code> 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">my_app</span><span class="p">]</span>
<span class="n">directory</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">my_app</span>
<span class="n">command</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">my_app</span><span class="o">/</span><span class="n">script</span><span class="o">/</span><span class="n">runner</span> <span class="n">quickstart</span><span class="o">.</span><span class="n">Boot</span>
<span class="n">autostart</span><span class="o">=</span><span class="n">true</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">true</span>
<span class="n">startsecs</span><span class="o">=</span><span class="mi">3</span>
<span class="n">user</span><span class="o">=</span><span class="n">my_user</span>
<span class="n">redirect_stderr</span><span class="o">=</span><span class="n">true</span>
<span class="n">stdout_logfile</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">my_app</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">stdout</span><span class="o">.</span><span class="n">log</span>
<span class="n">stdout_logfile_maxbytes</span><span class="o">=</span><span class="mi">10</span><span class="n">MB</span>
<span class="n">stdout_logfile_backups</span><span class="o">=</span><span class="mi">7</span>
<span class="n">stdout_capture_maxbytes</span><span class="o">=</span><span class="mi">1</span><span class="n">MB</span>
<span class="n">stdout_events_enabled</span><span class="o">=</span><span class="n">false</span>
<span class="n">environment</span><span class="o">=</span><span class="n">PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">aws</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">~/</span><span class="nb">bin</span>
</pre></div>
</div>
<p>다른 방법:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://smarden.org/runit/">runit</a></p></li>
<li><p><a class="reference external" href="http://upstart.ubuntu.com/">upstart</a></p></li>
</ul>
</div>
<div class="section" id="id7">
<h3>포트포워딩 방법<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>기본적으로 Xitrum는 8000 포트와 4430 포트를 사용합니다.
이 포트 번호는 <code class="docutils literal notranslate"><span class="pre">config</span> <span class="pre">/</span> <span class="pre">xitrum.conf</span></code> 으로 설정할 수 있습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">/</span> <span class="pre">etc</span> <span class="pre">/</span> <span class="pre">sysconfig</span> <span class="pre">/</span> <span class="pre">iptables</span></code> 를 다음 명령으로 수정함으로써
80에서 8000에 443에서 4430로 포트 포워딩을 수행 할 수 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">su</span> <span class="o">-</span> <span class="n">root</span>
<span class="n">chmod</span> <span class="mi">700</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">iptables</span>
<span class="n">iptables</span><span class="o">-</span><span class="n">restore</span> <span class="o">&lt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">iptables</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="n">PREROUTING</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">80</span> <span class="o">-</span><span class="n">j</span> <span class="n">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">port</span> <span class="mi">8000</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="n">PREROUTING</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">443</span> <span class="o">-</span><span class="n">j</span> <span class="n">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">port</span> <span class="mi">4430</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">I</span> <span class="n">OUTPUT</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">d</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">80</span> <span class="o">-</span><span class="n">j</span> <span class="n">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ports</span> <span class="mi">8000</span>
<span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">I</span> <span class="n">OUTPUT</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">d</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">443</span> <span class="o">-</span><span class="n">j</span> <span class="n">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">ports</span> <span class="mi">4430</span>
<span class="n">iptables</span><span class="o">-</span><span class="n">save</span> <span class="o">-</span><span class="n">c</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">iptables</span>
<span class="n">chmod</span> <span class="mi">644</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">iptables</span>
</pre></div>
</div>
<p>만약 Apache가 80 포트, 443 포트를 사용하고 있다면 반드시 서버를 멈추고 실행해야 합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">httpd</span> <span class="n">stop</span>
<span class="n">sudo</span> <span class="n">chkconfig</span> <span class="n">httpd</span> <span class="n">off</span>
</pre></div>
</div>
<p>Iptables에 대한 좋은 정보:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.frozentux.net/iptables-tutorial/chunkyhtml/">Iptables 튜토리얼</a></p></li>
</ul>
</div>
<div class="section" id="linux">
<h3>대량연결에 대한 Linux 설정<a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h3>
<p>Mac의 경우 JDK는 <a class="reference external" href="https://groups.google.com/forum/#!topic/spray-user/S-SNR2m0BWU">IO (NIO)에 관련된 성능 문제</a> 가 존재합니다.</p>
<p>참고자료:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://docs.basho.com/riak/latest/ops/tuning/linux/">Linux Performance Tuning (Riak)</a></p></li>
<li><p><a class="reference external" href="http://docs.basho.com/riak/latest/ops/tuning/aws/">AWS Performance Tuning (Riak)</a></p></li>
<li><p><a class="reference external" href="http://www.frozentux.net/ipsysctl-tutorial/chunkyhtml/">Ipsysctl tutorial</a></p></li>
<li><p><a class="reference external" href="http://www.frozentux.net/ipsysctl-tutorial/chunkyhtml/tcpvariables.html">TCP variables</a></p></li>
</ul>
<div class="section" id="id8">
<h4>파일 디스크립터 제한<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>각 연결은 Linux에 오픈된 파일로 간주됩니다.
하나의 프로세스가 동시에 오픈할 수 있는 파일 디스크립터 수는 기본적으로 1024으로 되어 있습니다.
이 제한을 변경하려면 <code class="docutils literal notranslate"><span class="pre">/</span> <span class="pre">etc</span> <span class="pre">/</span> <span class="pre">security</span> <span class="pre">/</span> <span class="pre">limits.conf</span></code> 을 편집합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span>  <span class="n">soft</span>  <span class="n">nofile</span>  <span class="mi">1024000</span>
<span class="o">*</span>  <span class="n">hard</span>  <span class="n">nofile</span>  <span class="mi">1024000</span>
</pre></div>
</div>
<p>변경내용을 적용하려면 로그아웃한 후 다시 로그인해야 합니다.
일시적으로 적용하려면 <code class="docutils literal notranslate"><span class="pre">ulimit</span> <span class="pre">-n</span></code> 을 실행합니다.</p>
</div>
<div class="section" id="id9">
<h4>커널 조정<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://www.metabrew.com/article/a-million-user-comet-application-with-mochiweb-part-1">A Million-user Comet Application with Mochiweb（영문）</a> 에 소개된것 처럼, <code class="docutils literal notranslate"><span class="pre">/etc/sysctl.conf</span></code> 를 편집합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># General gigabit tuning</span>
<span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">rmem_max</span> <span class="o">=</span> <span class="mi">16777216</span>
<span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">wmem_max</span> <span class="o">=</span> <span class="mi">16777216</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">tcp_rmem</span> <span class="o">=</span> <span class="mi">4096</span> <span class="mi">87380</span> <span class="mi">16777216</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">tcp_wmem</span> <span class="o">=</span> <span class="mi">4096</span> <span class="mi">65536</span> <span class="mi">16777216</span>

<span class="c1"># This gives the kernel more memory for TCP</span>
<span class="c1"># which you need with many (100k+) open socket connections</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">tcp_mem</span> <span class="o">=</span> <span class="mi">50576</span> <span class="mi">64768</span> <span class="mi">98152</span>

<span class="c1"># Backlog</span>
<span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">netdev_max_backlog</span> <span class="o">=</span> <span class="mi">2048</span>
<span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">somaxconn</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">tcp_max_syn_backlog</span> <span class="o">=</span> <span class="mi">2048</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">tcp_syncookies</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>변경사항을 적용하기 위해, <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">sysctl</span> <span class="pre">-p</span></code> 를 실행합니다.
재부팅할 필요는 없습니다. 지금부터 더 많은 커넥션을 바로 수행이 가능합니다.</p>
</div>
<div class="section" id="id10">
<h4>백 로그에 대해<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>TCP는 연결 확립을 위해 세 종류의 핸드 셰이크 방식을 사용합니다.
원격 클라이언트가 서버에 연결할 때 클라이언트는 SYN 패킷을 보냅니다.
그리고 서버 측의 OS는 SYN-ACK 패킷을 회신합니다.
그 후 원격 클라이언트는 다시 ACK 패킷을 전송하고 연결이 설정합니다.
Xitrum는 연결이 완전히 확립했을 때 가져옵니다.</p>
<p><a class="reference external" href="https://sites.google.com/site/beingroot/articles/apache/socket-backlog-tuning-for-apache">Socket backlog tuning for Apache (영어)</a> 에 따르면
연결 시간 제한은 Web 서버의 백 로그 큐가 SYN-ACK 패킷으로 흘러 버린 때 SYN 패킷이 손실되기 때문에 발생합니다.</p>
<p><a class="reference external" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/configtuning-kernel-limits.html">FreeBSD Handbook (영어)</a> 에 따르면
기본 128이라는 설정은 고부하 서버 환경에서 새로운 연결을 확실하게 받기에는 너무 낮은 수치입니다.
그런 환경에서는 1024 이상으로 설정하는 것이 좋다고 알려져 있습니다.
큐 크기를 크게하는 것은 DoS 공격을 피하는 의미에서도 효과가 있습니다.</p>
<p>Xitrum는 백 로그 크기를 1024 (memcached와 같은 값)로 하고 있습니다.
그러나 위의 커널 튜닝하는 것도 잊지 마십시오.</p>
<p>백 로그 설정 확인 방법 :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">somaxconn</span>
</pre></div>
</div>
<p>또는:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sysctl</span> <span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">somaxconn</span>
</pre></div>
</div>
<p>一임시로 변경:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">sysctl</span> <span class="o">-</span><span class="n">w</span> <span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">somaxconn</span><span class="o">=</span><span class="mi">1024</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="haproxy">
<h3>HAProxy 팁<a class="headerlink" href="#haproxy" title="Permalink to this headline">¶</a></h3>
<p>HAProxy를 SockJS 위해 설정하려면 <a class="reference external" href="https://github.com/sockjs/sockjs-node/blob/master/examples/haproxy.cfg">샘플</a> 을 참조하십시오.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">defaults</span>
    <span class="n">mode</span> <span class="n">http</span>
    <span class="n">timeout</span> <span class="n">connect</span> <span class="mi">10</span><span class="n">s</span>
    <span class="n">timeout</span> <span class="n">client</span>  <span class="mi">10</span><span class="n">h</span>  <span class="c1"># Set to long time to avoid WebSocket connections being closed when there&#39;s no network activity</span>
    <span class="n">timeout</span> <span class="n">server</span>  <span class="mi">10</span><span class="n">h</span>  <span class="c1"># Set to long time to avoid ERR_INCOMPLETE_CHUNKED_ENCODING on Chrome</span>

<span class="n">frontend</span> <span class="n">xitrum_with_discourse</span>
    <span class="n">bind</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">80</span>

    <span class="n">option</span> <span class="n">forwardfor</span>

    <span class="n">acl</span> <span class="n">is_discourse</span> <span class="n">path_beg</span> <span class="o">/</span><span class="n">forum</span>
    <span class="n">use_backend</span> <span class="n">discourse</span> <span class="k">if</span> <span class="n">is_discourse</span>
    <span class="n">default_backend</span> <span class="n">xitrum</span>

<span class="n">backend</span> <span class="n">xitrum</span>
    <span class="n">server</span> <span class="n">srv_xitrum</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8000</span>

<span class="n">backend</span> <span class="n">discourse</span>
    <span class="n">server</span> <span class="n">srv_discourse</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">3000</span>
</pre></div>
</div>
<p>HAProxy를 다시 시작하지 않고 설정 파일을 로드하려면 <a class="reference external" href="http://serverfault.com/questions/165883/is-there-a-way-to-add-more-backend-server-to-haproxy-without-restarting-haproxy">토론</a> 을 참조하십시오.</p>
<p>HAProxy는 Nginx보다 훨씬 사용하기 쉽습니다.
<a class="reference internal" href="index.html#document-cache"><span class="doc">캐시</span></a> 에서 처럼 Xitrum은 <a class="reference external" href="https://gist.github.com/3293596">정적 파일전송이 매우 빠르므로</a> 그렇기 때문에
정적 파일 전송에 Nginx를 준비 할 필요는 없습니다. 그 점에서 HAProxy는 Xitrum과 아주 궁합이 좋다고 말할 수 있습니다.</p>
</div>
<div class="section" id="nginx">
<h3>Nginx 팁<a class="headerlink" href="#nginx" title="Permalink to this headline">¶</a></h3>
<p>Nginx 1.2 이전에 Xitrum를 사용하는 경우 Xitrum의 WebSocket과 SockJS 기능을 사용하려면
<a class="reference external" href="https://github.com/yaoweibin/nginx_tcp_proxy_module">nginx_tcp_proxy_module</a> 를 사용할 필요가 있습니다.
Nginx 1.3+ 이상은 기본적으로 WebSocket을 지원하고 있습니다.</p>
<p>Nginx는 기본적으로 HTTP 1.0을 역방향 프록시 프로토콜로 사용합니다.
청크 응답을 사용하는 경우에는 Nginx에 HTTP 1.1 프로토콜로 사용한다고 알려야 합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">location</span> <span class="o">/</span> <span class="p">{</span>
  <span class="n">proxy_http_version</span> <span class="mf">1.1</span><span class="p">;</span>
  <span class="n">proxy_set_header</span> <span class="n">Connection</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="n">proxy_pass</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>http keepalive에 대한 <a class="reference external" href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive">문서</a> 에서 말하듯이 <code class="docutils literal notranslate"><span class="pre">proxy_set_header</span> <span class="pre">Connection</span> <span class="pre">&quot;&quot;</span></code> 로 설정해야 합니다.</p>
</div>
<div class="section" id="heroku">
<h3>Heroku에 배포하기<a class="headerlink" href="#heroku" title="Permalink to this headline">¶</a></h3>
<p>Xitrum을 <a class="reference external" href="https://www.heroku.com/">Heroku</a> 에서 실행도 가능합니다</p>
<div class="section" id="id16">
<h4>가입 및 저장소 만들기<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://devcenter.heroku.com/articles/quickstart">공식문서</a> 에 따라 가입 및 저장소를 만듭니다</p>
</div>
<div class="section" id="procfile">
<h4>Procfile 생성<a class="headerlink" href="#procfile" title="Permalink to this headline">¶</a></h4>
<p>Procfile를 만들고 프로젝트의 루트 디렉토리에 저장합니다.
Heroku는 이 파일을 기초로 시작 시 명령을 실행합니다.
포트 번호는 <code class="docutils literal notranslate"><span class="pre">$PORT</span></code> 라는 변수에 Heroku에서 전달됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>web: target/xitrum/script/runner &lt;YOUR_PACKAGE.YOUR_MAIN_CLASS&gt; $PORT
</pre></div>
</div>
</div>
<div class="section" id="port">
<h4>Port설정 변경<a class="headerlink" href="#port" title="Permalink to this headline">¶</a></h4>
<p>포트 번호는 Heroku에 의해 동적으로 할당되기 때문에 다음과 같이 할 필요가 있습니다:</p>
<p>config/xitrum.conf:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">port</span> <span class="p">{</span>
  <span class="n">http</span>              <span class="o">=</span> <span class="mi">8000</span>
  <span class="c1"># https             = 4430</span>
  <span class="c1"># flashSocketPolicy = 8430  # flash_socket_policy.xml will be returned</span>
<span class="p">}</span>
</pre></div>
</div>
<p>SSL을 사용하기 원한다면 <a class="reference external" href="https://addons.heroku.com/ssl">add on</a> 을 참고하세요</p>
</div>
<div class="section" id="id18">
<h4>로그 레벨 수정<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<p>config/logback.xml:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">root</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">appender</span><span class="o">-</span><span class="n">ref</span> <span class="n">ref</span><span class="o">=</span><span class="s2">&quot;CONSOLE&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Heroku의 tail log 명령어:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">heroku</span> <span class="n">logs</span> <span class="o">-</span><span class="n">tail</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h4><code class="docutils literal notranslate"><span class="pre">xitrum-package</span></code> 별칭 부여<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<p>배치 실행시 Heroku는 <code class="docutils literal notranslate"><span class="pre">sbt</span> <span class="pre">/</span> <span class="pre">sbt</span> <span class="pre">clean</span> <span class="pre">compile</span> <span class="pre">stage</span></code> 를 실행합니다.
따라서 <code class="docutils literal notranslate"><span class="pre">xitrum-package</span></code> 대한 별칭을 작성해야 합니다.</p>
<p>build.sbt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">addCommandAlias</span><span class="p">(</span><span class="s2">&quot;stage&quot;</span><span class="p">,</span> <span class="s2">&quot;;xitrum-package&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id20">
<h4>Heroku에 푸시하기<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>배포 프로세스는 git push에 의해 수행됩니다</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="n">heroku</span> <span class="n">master</span>
</pre></div>
</div>
<p>Heroku <a class="reference external" href="https://devcenter.heroku.com/articles/getting-started-with-scala">Scala 공식문서</a> 를 참고하세요.</p>
</div>
</div>
</div>
<span id="document-cluster"></span><div class="section" id="akka-hazelcast">
<h2>Akka와 Hazelcast 클러스터링<a class="headerlink" href="#akka-hazelcast" title="Permalink to this headline">¶</a></h2>
<p>Xitrum가 프록시 서버와 로드 밸런서 뒤에 클러스터 구성에서 동작할 수 있도록 설계되어 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                         <span class="o">/</span> <span class="n">Xitrum</span> <span class="n">인스턴스</span> <span class="mi">1</span>
<span class="n">로드밸런서</span><span class="o">/</span><span class="n">프록시</span> <span class="n">서버</span>      <span class="o">----</span> <span class="n">Xitrum</span> <span class="n">인스턴스</span> <span class="mi">2</span>
                         \ <span class="n">Xitrum</span> <span class="n">인스턴스</span> <span class="mi">3</span>
</pre></div>
</div>
<p><a class="reference external" href="http://akka.io/">Akka</a> 와 <a class="reference external" href="https://github.com/xitrum-framework/xitrum-hazelcast">Hazelcast</a>
클러스터링 기능을 사용하여 캐시, 세션, SockJS세션을 클러스터링 할 수 있습니다.</p>
<p>Hazelcast가 Xitrum 인스턴스의 프로세스의 메모리 캐시 서버가 되므로
Memcache 같은 추가 서버는 필요하지 않습니다.</p>
<p>Akka와 Hazelcast 클러스터링을 설정하려면 <code class="docutils literal notranslate"><span class="pre">config</span> <span class="pre">/</span> <span class="pre">akka.conf</span></code> <a class="reference external" href="http://akka.io/docs/">Akka 문서</a>
<a class="reference external" href="http://hazelcast.org/documentation/">Hazelcast 문서</a> 를 참고하십시오.</p>
<p>참고 : 세션, <span class="xref std std-doc">클라이언트 측 쿠키에 저장</span> 할 수 있습니다.</p>
</div>
<span id="document-handler"></span><div class="section" id="netty">
<h2>Netty 핸들러<a class="headerlink" href="#netty" title="Permalink to this headline">¶</a></h2>
<p>이번 챕터는 숙련자용으로 Xitrum을 보통으로 사용하시는 분은 읽지 않아도 됩니다.
이해를 위해서는 <a class="reference external" href="http://netty.io/">Netty</a> 를 반드시 숙지해야 합니다.</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Rack_(Web_server_interface)">Rack</a> ,
<a class="reference external" href="http://en.wikipedia.org/wiki/Web_Server_Gateway_Interface">WSGI</a> ,
<a class="reference external" href="http://en.wikipedia.org/wiki/PSGI">PSGI</a> 라는 미들웨어 아키텍처가 있습니다.
Xitrum은 <a class="reference external" href="http://netty.io/">Netty</a> 를 기본으로 하고 같은 핸들러를 사용합니다.
핸들러를 생성하여 추가할 수 있고 채널의 파이프라인을 수정하여 케이스별 서버의 성능을 극대화 할 수 있습니다.</p>
<p>이 장의 설명:</p>
<ul class="simple">
<li><p>Netty 핸들러 구조</p></li>
<li><p>Xitrum이 제공하는 핸들러와 기본순서</p></li>
<li><p>핸들러를 생성하고 수정하는 방법</p></li>
</ul>
<div class="section" id="id3">
<h3>Netty 핸들러 구조<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>각각의 커넥션은 채널 파이프라인이 있고 IO 데이터를 조작합니다
채널 파이프 라인은 여러 개의 핸들러로 구성되어 있으며 두 가지 종류의 핸들러가 있습니다:</p>
<ul class="simple">
<li><p>인바운드(Inbound): 요청 방향 클라이언트 -&gt; 서버</p></li>
<li><p>아웃바운드(Inbound): 응답 방향 서버 -&gt; 클라이언트</p></li>
</ul>
<p><a class="reference external" href="http://netty.io/4.0/api/io/netty/channel/ChannelPipeline.html">ChannelPipeline</a>
은 여기에서 더 자세한 정보를 얻을 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                               <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">Request</span>
                                          <span class="n">via</span> <span class="n">Channel</span> <span class="ow">or</span>
                                      <span class="n">ChannelHandlerContext</span>
                                                    <span class="o">|</span>
<span class="o">+---------------------------------------------------+---------------+</span>
<span class="o">|</span>                           <span class="n">ChannelPipeline</span>         <span class="o">|</span>               <span class="o">|</span>
<span class="o">|</span>                                                  \<span class="o">|/</span>              <span class="o">|</span>
<span class="o">|</span>    <span class="o">+---------------------+</span>            <span class="o">+-----------+----------+</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="o">|</span> <span class="n">Inbound</span> <span class="n">Handler</span>  <span class="n">N</span>  <span class="o">|</span>            <span class="o">|</span> <span class="n">Outbound</span> <span class="n">Handler</span>  <span class="mi">1</span>  <span class="o">|</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="o">+----------+----------+</span>            <span class="o">+-----------+----------+</span>    <span class="o">|</span>
<span class="o">|</span>              <span class="o">/|</span>\                                  <span class="o">|</span>               <span class="o">|</span>
<span class="o">|</span>               <span class="o">|</span>                                  \<span class="o">|/</span>              <span class="o">|</span>
<span class="o">|</span>    <span class="o">+----------+----------+</span>            <span class="o">+-----------+----------+</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="o">|</span> <span class="n">Inbound</span> <span class="n">Handler</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>            <span class="o">|</span> <span class="n">Outbound</span> <span class="n">Handler</span>  <span class="mi">2</span>  <span class="o">|</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="o">+----------+----------+</span>            <span class="o">+-----------+----------+</span>    <span class="o">|</span>
<span class="o">|</span>              <span class="o">/|</span>\                                  <span class="o">.</span>               <span class="o">|</span>
<span class="o">|</span>               <span class="o">.</span>                                   <span class="o">.</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">ChannelHandlerContext</span><span class="o">.</span><span class="n">fireIN_EVT</span><span class="p">()</span> <span class="n">ChannelHandlerContext</span><span class="o">.</span><span class="n">OUT_EVT</span><span class="p">()</span><span class="o">|</span>
<span class="o">|</span>        <span class="p">[</span> <span class="n">method</span> <span class="n">call</span><span class="p">]</span>                       <span class="p">[</span><span class="n">method</span> <span class="n">call</span><span class="p">]</span>         <span class="o">|</span>
<span class="o">|</span>               <span class="o">.</span>                                   <span class="o">.</span>               <span class="o">|</span>
<span class="o">|</span>               <span class="o">.</span>                                  \<span class="o">|/</span>              <span class="o">|</span>
<span class="o">|</span>    <span class="o">+----------+----------+</span>            <span class="o">+-----------+----------+</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="o">|</span> <span class="n">Inbound</span> <span class="n">Handler</span>  <span class="mi">2</span>  <span class="o">|</span>            <span class="o">|</span> <span class="n">Outbound</span> <span class="n">Handler</span> <span class="n">M</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="o">+----------+----------+</span>            <span class="o">+-----------+----------+</span>    <span class="o">|</span>
<span class="o">|</span>              <span class="o">/|</span>\                                  <span class="o">|</span>               <span class="o">|</span>
<span class="o">|</span>               <span class="o">|</span>                                  \<span class="o">|/</span>              <span class="o">|</span>
<span class="o">|</span>    <span class="o">+----------+----------+</span>            <span class="o">+-----------+----------+</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="o">|</span> <span class="n">Inbound</span> <span class="n">Handler</span>  <span class="mi">1</span>  <span class="o">|</span>            <span class="o">|</span> <span class="n">Outbound</span> <span class="n">Handler</span>  <span class="n">M</span>  <span class="o">|</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="o">+----------+----------+</span>            <span class="o">+-----------+----------+</span>    <span class="o">|</span>
<span class="o">|</span>              <span class="o">/|</span>\                                  <span class="o">|</span>               <span class="o">|</span>
<span class="o">+---------------+-----------------------------------+---------------+</span>
                <span class="o">|</span>                                  \<span class="o">|/</span>
<span class="o">+---------------+-----------------------------------+---------------+</span>
<span class="o">|</span>               <span class="o">|</span>                                   <span class="o">|</span>               <span class="o">|</span>
<span class="o">|</span>       <span class="p">[</span> <span class="n">Socket</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="p">]</span>                    <span class="p">[</span> <span class="n">Socket</span><span class="o">.</span><span class="n">write</span><span class="p">()</span> <span class="p">]</span>     <span class="o">|</span>
<span class="o">|</span>                                                                   <span class="o">|</span>
<span class="o">|</span>  <span class="n">Netty</span> <span class="n">Internal</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">Threads</span> <span class="p">(</span><span class="n">Transport</span> <span class="n">Implementation</span><span class="p">)</span>            <span class="o">|</span>
<span class="o">+-------------------------------------------------------------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>핸들러의 수정<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Xitrum 서버가 구동될 때
<a class="reference external" href="http://netty.io/4.0/api/io/netty/channel/ChannelInitializer.html">ChannelInitializer</a>
를 설정할 수 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Server</span>

<span class="nb">object</span> <span class="n">Boot</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">String</span><span class="p">])</span> <span class="p">{</span>
    <span class="n">Server</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">myChannelInitializer</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>HTTPS서버의 경우에는 Xitrum은 자동으로 SSL 핸들러를 파이프라인 앞에 준비합니다.
Xitrum 핸들러를 파이프라인에서 재사용이 가능합니다.</p>
</div>
<div class="section" id="xitrum">
<h3>Xitrum 핸들러<a class="headerlink" href="#xitrum" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/handler/DefaultHttpChannelInitializer.scala">xitrum.handler.DefaultHttpChannelInitializer</a>
를 참고하세요.</p>
<p>공유가능한 핸들러(다중연결에서 공유된 같은 인스턴스들)
<code class="docutils literal notranslate"><span class="pre">DefaultHttpChannelInitializer</span></code> 개체 위에 존재하며 수정된 파이프 라인을 통하여 사용하기 원하는 어플리케이션에 쉽게 사용이 가능합니다.
이 어플리케이션들은 기본 핸들러의 집합입니다</p>
<p>예를 들어, 어플리케이션이 자신의 디스패쳐를 사용하고(Xitrum의 라우팅/디스패쳐가 아닌) Xitrum의 빠른 정적 파일만 사용한다면
다음의 핸들러만 사용하면 됩니다.</p>
<p>인바운드(Inbound):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HttpRequestDecoder</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PublicFileServer</span></code></p></li>
<li><p>자신의 dispatcher</p></li>
</ul>
<p>아웃바운드(Outbound):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HttpResponseEncoder</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChunkedWriteHandler</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">XSendFile</span></code></p></li>
</ul>
</div>
</div>
<span id="document-metrics"></span><div class="section" id="id1">
<h2>매트릭스<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Xitrum은 어플리케이션의 JVM의 힙 메모리, CPU, 액션의 수행 상태를 Akka 클러스터의 각 노드로부터 수집합니다.
또한, 이 데이터들은 JSON 데이터로 전달됩니다.
Xitrum은 매트릭스의 정의도 가능합니다.</p>
<p>매트릭스의 구성은 <a class="reference external" href="http://metrics.dropwizard.io/3.1.0/">Coda Hale Metrics</a> 라이브러리를 바탕으로 작성되었습니다.</p>
<div class="section" id="id2">
<h3>매트릭스 수집<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="section" id="cpu">
<h4>힙 메모리와 CPU<a class="headerlink" href="#cpu" title="Permalink to this headline">¶</a></h4>
<p>JVM의 힙 메모리와 CPU는 각 노드의 Akka 액터 시스템의 <a class="reference external" href="http://doc.akka.io/api/akka/2.3.0/index.html#akka.cluster.NodeMetrics">NodeMetrics</a>
으로 수집됩니다.</p>
<p>힙 메모리:</p>
<img alt="_images/metrics_heapmemory.png" src="_images/metrics_heapmemory.png" />
<p>CPU: 프로세스의 갯수와 부하</p>
<img alt="_images/metrics_cpu.png" src="_images/metrics_cpu.png" />
</div>
<div class="section" id="id3">
<h4>액션 매트릭스<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Xitrum은 각 노드에서의 액션의 실행상태를 <a class="reference external" href="http://metrics.dropwizard.io/3.1.0/getting-started/#histograms">Histogram</a> 을 통해 측정합니다.
여기에서 액션의 실행 횟수와 비동기 액션의 수행시간을 알 수 있습니다.</p>
<img alt="_images/metrics_action_count.png" src="_images/metrics_action_count.png" />
<p>최근의 특정 액션의 실행 시간:</p>
<img alt="_images/metrics_action_time.png" src="_images/metrics_action_time.png" />
</div>
<div class="section" id="id4">
<h4>수정된 매트릭스 수집<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>위에 정의된 기본적인 매트릭스 수집방법에 추가로 매트릭스를 수정하여 수집할 수 있습니다.
<code class="docutils literal notranslate"><span class="pre">xitrum.Metrics</span></code> 은 <code class="docutils literal notranslate"><span class="pre">gauge</span></code>, <code class="docutils literal notranslate"><span class="pre">counter</span></code>, <code class="docutils literal notranslate"><span class="pre">meter</span></code>, <code class="docutils literal notranslate"><span class="pre">timer</span></code> , <code class="docutils literal notranslate"><span class="pre">histogram</span></code> 에 관한 정보의 단축키 입니다.
<a class="reference external" href="http://metrics.dropwizard.io/3.1.0/">Coda Hale Metrics</a> 와 <a class="reference external" href="https://github.com/erikvanoosten/metrics-scala">its Scala implementation</a> 를 통해 사용법을 익힐 수 있습니다.</p>
<p>Timer 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.</span><span class="p">{</span><span class="n">Action</span><span class="p">,</span> <span class="n">Metrics</span><span class="p">}</span>
<span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>

<span class="nb">object</span> <span class="n">MyAction</span> <span class="p">{</span>
  <span class="n">lazy</span> <span class="n">val</span> <span class="n">myTimer</span> <span class="o">=</span> <span class="n">Metrics</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s2">&quot;myTimer&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;my/action&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="kn">import</span> <span class="nn">MyAction._</span>

  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">myTimer</span><span class="o">.</span><span class="n">time</span> <span class="p">{</span>
      <span class="o">//</span> <span class="n">Something</span> <span class="n">that</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">measure</span> <span class="n">execution</span> <span class="n">time</span>
      <span class="o">...</span>
    <span class="p">}</span>
    <span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h3>매트릭스 배포<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Xitrum은 일정 주기로 최근의 매트릭스 값을 JSON 포멧으로 제공합니다.
데이터는 휘발성이며 영구적으로 저장되지 않습니다.</p>
<p>힙 메모:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;TYPE&quot;</span>      <span class="p">:</span> <span class="s2">&quot;heapMemory&quot;</span><span class="p">,</span>
  <span class="s2">&quot;SYSTEM&quot;</span>    <span class="p">:</span> <span class="n">akka</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
  <span class="s2">&quot;HOST&quot;</span>      <span class="p">:</span> <span class="n">akka</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
  <span class="s2">&quot;PORT&quot;</span>      <span class="p">:</span> <span class="n">akka</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
  <span class="s2">&quot;HASH&quot;</span>      <span class="p">:</span> <span class="n">akka</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">hashCode</span><span class="p">,</span>
  <span class="s2">&quot;TIMESTAMP&quot;</span> <span class="p">:</span> <span class="n">akka</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">NodeMetrics</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
  <span class="s2">&quot;USED&quot;</span>      <span class="p">:</span> <span class="n">Number</span> <span class="k">as</span> <span class="n">byte</span><span class="p">,</span>
  <span class="s2">&quot;COMMITTED&quot;</span> <span class="p">:</span> <span class="n">Number</span> <span class="k">as</span> <span class="n">byte</span><span class="p">,</span>
  <span class="s2">&quot;MAX&quot;</span>       <span class="p">:</span> <span class="n">Number</span> <span class="k">as</span> <span class="n">byte</span>
<span class="p">}</span>
</pre></div>
</div>
<p>CPU:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;TYPE&quot;</span>              <span class="p">:</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
  <span class="s2">&quot;SYSTEM&quot;</span>            <span class="p">:</span> <span class="n">akka</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
  <span class="s2">&quot;HOST&quot;</span>              <span class="p">:</span> <span class="n">akka</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
  <span class="s2">&quot;PORT&quot;</span>              <span class="p">:</span> <span class="n">akka</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
  <span class="s2">&quot;HASH&quot;</span>              <span class="p">:</span> <span class="n">akka</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">hashCode</span><span class="p">,</span>
  <span class="s2">&quot;TIMESTAMP&quot;</span>         <span class="p">:</span> <span class="n">akka</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">NodeMetrics</span><span class="o">.</span><span class="n">timestamp</span>
  <span class="s2">&quot;SYSTEMLOADAVERAGE&quot;</span> <span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
  <span class="s2">&quot;CPUCOMBINED&quot;</span>       <span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
  <span class="s2">&quot;PROCESSORS&quot;</span>        <span class="p">:</span> <span class="n">Number</span>
<span class="p">}</span>
</pre></div>
</div>
<p>매트릭스 레지스트리는 <a class="reference external" href="http://metrics.dropwizard.io/3.1.0/manual/json/">metrics-json</a> 에 의해 파싱됩니다.</p>
<div class="section" id="xitrum">
<h4>Xitrum 기본 뷰어<a class="headerlink" href="#xitrum" title="Permalink to this headline">¶</a></h4>
<p>Xitrum은 기본 매트릭스 뷰어로 <code class="docutils literal notranslate"><span class="pre">/xitrum/metrics/viewer?api_key=&lt;xitrum.conf</span> <span class="pre">파일</span> <span class="pre">안의</span> <span class="pre">키&gt;</span></code> 을 제공합니다.
이 URL은 위의 정보를  <a class="reference external" href="http://d3js.org/">D3.js</a> 로 생성하여 그래프로 보여줍니다.</p>
<p>URL 생성방법:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Config</span>
<span class="kn">import</span> <span class="nn">xitrum.metrics.XitrumMetricsViewer</span>

<span class="n">url</span><span class="p">[</span><span class="n">XitrumMetricsViewer</span><span class="p">](</span><span class="s2">&quot;api_key&quot;</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="o">.</span><span class="n">xitrum</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">apiKey</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="jconsole">
<h4>Jconsole 뷰어<a class="headerlink" href="#jconsole" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://metrics.dropwizard.io/3.1.0/getting-started/#reporting-via-jmx">JVM Reporter</a> 로 볼 수 있습니다.</p>
<img alt="_images/metrics_jconsole.png" src="_images/metrics_jconsole.png" />
<p>JVM Reporter 시작하기:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">com.codahale.metrics.JmxReporter</span>

<span class="nb">object</span> <span class="n">Boot</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">String</span><span class="p">])</span> <span class="p">{</span>
    <span class="n">Server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">JmxReporter</span><span class="o">.</span><span class="n">forRegistry</span><span class="p">(</span><span class="n">xitrum</span><span class="o">.</span><span class="n">Metrics</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>다음 명령을 <a class="reference external" href="http://docs.oracle.com/javase/7/docs/technotes/guides/management/jconsole.html">jconsole</a> 커맨드로 실행합니다.</p>
</div>
<div class="section" id="id8">
<h4>사용자 정의 매트릭스 뷰어<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>매트릭스는 JSON의 형식으로 SockJS URL <code class="docutils literal notranslate"><span class="pre">xitrum/metrics/channel</span></code> 에 배포됩니다.
<code class="docutils literal notranslate"><span class="pre">jsAddMetricsNameSpace</span></code> 은 Xitrum이 제공하는 편리한 자바스크립트 단편입니다. 앤드포인트에 생성된 커넥션을 연결합니다.
JSON 핸들러를 구현하려면 핸들러에 <code class="docutils literal notranslate"><span class="pre">initMetricsChannel</span></code> 를 호출하면 됩니다.</p>
<p>액션 예제:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.annotation.GET</span>
<span class="kn">import</span> <span class="nn">xitrum.metrics.MetricsViewer</span>

<span class="nd">@GET</span><span class="p">(</span><span class="s2">&quot;my/metrics/viewer&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MySubscriber</span> <span class="n">extends</span> <span class="n">MetricsViewer</span> <span class="p">{</span>
  <span class="k">def</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">jsAddMetricsNameSpace</span><span class="p">(</span><span class="s2">&quot;window&quot;</span><span class="p">)</span>
    <span class="n">jsAddToView</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      function onValue(json) {</span>
<span class="s2">        console.log(json);</span>
<span class="s2">      }</span>
<span class="s2">      function onClose(){</span>
<span class="s2">        console.log(&quot;channel closed&quot;);</span>
<span class="s2">      }</span>
<span class="s2">      window.initMetricsChannel(onValue, onClose);</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">respondView</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4>매트릭스 저장<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>메모리를 절약하기 위해 Xitrum은 이전 매트릭스 값을 저장하지 않습니다. 만약 매트릭스값을 사용하기 위해
데이터베이스나 파일에 저장하려면 subscriber를 직접 구현해야 합니다.</p>
<p>예:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">akka.actor.Actor</span>
<span class="kn">import</span> <span class="nn">xitrum.metrics.PublisherLookUp</span>

<span class="k">class</span> <span class="nc">MySubscriber</span> <span class="n">extends</span> <span class="n">Actor</span> <span class="k">with</span> <span class="n">PublisherLookUp</span> <span class="p">{</span>
  <span class="n">override</span> <span class="k">def</span> <span class="nf">preStart</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">lookUpPublisher</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">def</span> <span class="nf">receive</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">case</span> <span class="n">_</span> <span class="o">=&gt;</span>
  <span class="p">}</span>

  <span class="n">override</span> <span class="k">def</span> <span class="nf">doWithPublisher</span><span class="p">(</span><span class="n">globalPublisher</span><span class="p">:</span> <span class="n">ActorRef</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">context</span><span class="o">.</span><span class="n">become</span> <span class="p">{</span>
      <span class="o">//</span> <span class="n">When</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">multinode</span> <span class="n">environment</span>
      <span class="n">case</span> <span class="n">multinodeMetrics</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">NodeMetrics</span><span class="p">]</span> <span class="o">=&gt;</span>
        <span class="o">//</span> <span class="n">Save</span> <span class="n">to</span> <span class="n">DB</span> <span class="ow">or</span> <span class="n">write</span> <span class="n">to</span> <span class="n">file</span><span class="o">.</span>

      <span class="o">//</span> <span class="n">When</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">single</span> <span class="n">node</span> <span class="n">environment</span>
      <span class="n">case</span> <span class="n">nodeMetrics</span><span class="p">:</span> <span class="n">NodeMetrics</span> <span class="o">=&gt;</span>
        <span class="o">//</span> <span class="n">Save</span> <span class="n">to</span> <span class="n">DB</span> <span class="ow">or</span> <span class="n">write</span> <span class="n">to</span> <span class="n">file</span><span class="o">.</span>

      <span class="n">case</span> <span class="n">Publish</span><span class="p">(</span><span class="n">registryAsJson</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="o">//</span> <span class="n">Save</span> <span class="n">to</span> <span class="n">DB</span> <span class="ow">or</span> <span class="n">write</span> <span class="n">to</span> <span class="n">file</span><span class="o">.</span>

      <span class="n">case</span> <span class="n">_</span> <span class="o">=&gt;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-howto"></span><div class="section" id="howto">
<h2>HOWTO<a class="headerlink" href="#howto" title="Permalink to this headline">¶</a></h2>
<p>이 장에서는 몇가지 작은 팁들을 제공합니다.</p>
<div class="section" id="id1">
<h3>기본적인 인증<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>사이트나 특정 액션에 <a class="reference external" href="http://ja.wikipedia.org/wiki/Basic%E8%AA%8D%E8%A8%BC">Basic authentication</a> 을 이용하여 보호할 수 있습니다.</p>
<p>Xitrum은 <a class="reference external" href="http://ja.wikipedia.org/wiki/Digest%E8%AA%8D%E8%A8%BC">digest authentication</a> 을 지원하지 않습니다
잘못된 보안 방법으로 인해 man-in-the-middle attack에 취약하므로 보다 나은 방법으로서 Xitrum을 이용하여 HTTPS를 사용하는 것을 권장합니다.
(Apache나 Nginx와 같은 리버스 프록시를 따로 구축할 필요가 없습니다)</p>
<div class="section" id="id2">
<h4>전체 프로젝트에 기본적인 인증을 설정하는 방법<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">config/xitrum.conf</span></code> 내부에 설정:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;basicAuth&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="s2">&quot;realm&quot;</span><span class="p">:</span>    <span class="s2">&quot;xitrum&quot;</span><span class="p">,</span>
  <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;xitrum&quot;</span><span class="p">,</span>
  <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;xitrum&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>특정 액션에 기본 인증을 추가<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.Action</span>

<span class="k">class</span> <span class="nc">MyAction</span> <span class="n">extends</span> <span class="n">Action</span> <span class="p">{</span>
  <span class="n">beforeFilter</span> <span class="p">{</span>
    <span class="n">basicAuth</span><span class="p">(</span><span class="s2">&quot;Realm&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;username&quot;</span> <span class="o">&amp;&amp;</span> <span class="n">password</span> <span class="o">==</span> <span class="s2">&quot;password&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h3>설정파일 로드<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="section" id="json">
<h4>JSON 파일<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h4>
<p>JSON은 중첩된 구조를 설명하기에 알맞습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">config</span></code> 디렉토리에 설정 파일을 저장합니다.
이 디렉토리는, 개발 모드에서 build.sbt에 의해, 프로덕션 모드에서는 <code class="docutils literal notranslate"><span class="pre">script/runner</span></code> (또는 <code class="docutils literal notranslate"><span class="pre">script/runner.bat</span></code>) 에 의해 자동적으로 클래스 패스에 포함됩니다.</p>
<p>myconfig.json:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;God&quot;</span><span class="p">,</span>
  <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;Does God need a password?&quot;</span><span class="p">,</span>
  <span class="s2">&quot;children&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Adam&quot;</span><span class="p">,</span> <span class="s2">&quot;Eva&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>로드방법:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.util.Loader</span>

<span class="n">case</span> <span class="k">class</span> <span class="nc">MyConfig</span><span class="p">(</span><span class="n">username</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">children</span><span class="p">:</span> <span class="n">Seq</span><span class="p">[</span><span class="n">String</span><span class="p">])</span>
<span class="n">val</span> <span class="n">myConfig</span> <span class="o">=</span> <span class="n">Loader</span><span class="o">.</span><span class="n">jsonFromClasspath</span><span class="p">[</span><span class="n">MyConfig</span><span class="p">](</span><span class="s2">&quot;myconfig.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>주의:</p>
<ul class="simple">
<li><p>키와 스트링은 큰따옴표로 둘러싸여 있어야 합니다.</p></li>
<li><p>현재는 JSON파일에 주석을 달 수 없습니다.</p></li>
</ul>
</div>
<div class="section" id="id5">
<h4>설정 파일<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>설정 파일을 사용할 수도 있습니다만 설정 파일은 안전하지 않고 UTF-8을 지원하지 않을뿐더러 중첩된 구조도 지원하지 않으므로
JSON을 사용하는 것이 훨씬 좋습니다.</p>
<p>myconfig.properties:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>username = God
password = Does God need a password?
children = Adam, Eva
</pre></div>
</div>
<p>로드 방법:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.util.Loader</span>

<span class="o">//</span> <span class="n">Here</span> <span class="n">you</span> <span class="n">get</span> <span class="n">an</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Properties</span>
<span class="n">val</span> <span class="n">properties</span> <span class="o">=</span> <span class="n">Loader</span><span class="o">.</span><span class="n">propertiesFromClasspath</span><span class="p">(</span><span class="s2">&quot;myconfig.properties&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="typesafe">
<h4>Typesafe한 설정파일<a class="headerlink" href="#typesafe" title="Permalink to this headline">¶</a></h4>
<p>Xitrum은 Akka를 포함하고 있습니다. Akka는 <a class="reference external" href="http://typesafe.com/company">Typesafe</a> 사의 <a class="reference external" href="https://github.com/typesafehub/config">config library</a> 라고 하는 라이브러리를 포함하고 있으며 더 나은 설정 방법을 제시합니다.</p>
<p>myconfig.conf:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>username = God
password = Does God need a password?
children = [&quot;Adam&quot;, &quot;Eva&quot;]
</pre></div>
</div>
<p>로드 방법:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">com.typesafe.config.</span><span class="p">{</span><span class="n">Config</span><span class="p">,</span> <span class="n">ConfigFactory</span><span class="p">}</span>

<span class="n">val</span> <span class="n">config</span>   <span class="o">=</span> <span class="n">ConfigFactory</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;myconfig.conf&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">username</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">password</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">children</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getStringList</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h3>직렬화 및 역직렬화<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Array[Byte]</span></code> 를 직렬화:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.util.SeriDeseri</span>
<span class="n">val</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">SeriDeseri</span><span class="o">.</span><span class="n">toBytes</span><span class="p">(</span><span class="s2">&quot;my serializable object&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>다시 역직렬화:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">option</span> <span class="o">=</span> <span class="n">SeriDeseri</span><span class="o">.</span><span class="n">fromBytes</span><span class="p">[</span><span class="n">MyType</span><span class="p">](</span><span class="nb">bytes</span><span class="p">)</span>  <span class="o">//</span> <span class="n">Option</span><span class="p">[</span><span class="n">MyType</span><span class="p">]</span>
</pre></div>
</div>
<p>파일에 저장 시:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.util.Loader</span>
<span class="n">Loader</span><span class="o">.</span><span class="n">bytesToFile</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="s2">&quot;myObject.bin&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>파일에서 로드 시:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">Loader</span><span class="o">.</span><span class="n">bytesFromFile</span><span class="p">(</span><span class="s2">&quot;myObject.bin&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>데이터 암호화<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>다시 해독할 필요가 없는 데이터일 경우에는 MD5등을 사용할 수 있습니다.(단방향 암호화)
다시 해독할 필요가 있는 데이터일 경우에는 Xitrum에서 제공하는 라이브러리를 사용하면 됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.util.Secure</span>

<span class="o">//</span> <span class="n">Array</span><span class="p">[</span><span class="n">Byte</span><span class="p">]</span>
<span class="n">val</span> <span class="n">encrypted</span> <span class="o">=</span> <span class="n">Secure</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="s2">&quot;my data&quot;</span><span class="o">.</span><span class="n">getBytes</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Option</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="n">Byte</span><span class="p">]]</span>
<span class="n">val</span> <span class="n">decrypted</span> <span class="o">=</span> <span class="n">Secure</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">xitrum.util.UrlSafeBase64</span></code> 을 이용하여 바이너리 데이터(HTML을 이용한 응답 등을 포함)를 일반적인 스트링값으로 암복호화가 가능합니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">cookie와</span> <span class="n">같이</span> <span class="n">URL내에</span> <span class="n">포함된</span> <span class="n">스트링</span>
<span class="n">val</span> <span class="n">string</span> <span class="o">=</span> <span class="n">UrlSafeBase64</span><span class="o">.</span><span class="n">noPaddingEncode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Option</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="n">Byte</span><span class="p">]]</span>
<span class="n">val</span> <span class="n">encrypted2</span> <span class="o">=</span> <span class="n">UrlSafeBase64</span><span class="o">.</span><span class="n">autoPaddingDecode</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</pre></div>
</div>
<p>두 가지를 한 번에 결합할 수 있습니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xitrum.util.SeriDeseri</span>

<span class="n">val</span> <span class="n">mySerializableObject</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MySerializableClass</span>

<span class="o">//</span> <span class="n">String</span>
<span class="n">val</span> <span class="n">encrypted</span> <span class="o">=</span> <span class="n">SeriDeseri</span><span class="o">.</span><span class="n">toSecureUrlSafeBase64</span><span class="p">(</span><span class="n">mySerializableObject</span><span class="p">)</span>

<span class="o">//</span> <span class="n">Option</span><span class="p">[</span><span class="n">MySerializableClass</span><span class="p">]</span>
<span class="n">val</span> <span class="n">decrypted</span> <span class="o">=</span> <span class="n">SeriDeseri</span><span class="o">.</span><span class="n">fromSecureUrlSafeBase64</span><span class="p">[</span><span class="n">MySerializableClass</span><span class="p">](</span><span class="n">encrypted</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SeriDeseri</span></code> 는 <a class="reference external" href="https://github.com/twitter/chill">Twitter Chill</a> 를 사용하여 직렬화 및 역직렬화를 합니다.
데이터는 반드시 직렬화가 가능 해야 합니다.</p>
<p>특정한 키를 암호화:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">encrypted</span> <span class="o">=</span> <span class="n">Secure</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="s2">&quot;my data&quot;</span><span class="o">.</span><span class="n">getBytes</span><span class="p">,</span> <span class="s2">&quot;my key&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">decrypted</span> <span class="o">=</span> <span class="n">Secure</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">,</span> <span class="s2">&quot;my key&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">encrypted</span> <span class="o">=</span> <span class="n">SeriDeseri</span><span class="o">.</span><span class="n">toSecureUrlSafeBase64</span><span class="p">(</span><span class="n">mySerializableObject</span><span class="p">,</span> <span class="s2">&quot;my key&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">decrypted</span> <span class="o">=</span> <span class="n">SeriDeseri</span><span class="o">.</span><span class="n">fromSecureUrlSafeBase64</span><span class="p">[</span><span class="n">MySerializableClass</span><span class="p">](</span><span class="n">encrypted</span><span class="p">,</span> <span class="s2">&quot;my key&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>키가 지정되어 있지 않은 경우에는 <code class="docutils literal notranslate"><span class="pre">config/xitrum.conf</span></code> 파일 내의 <code class="docutils literal notranslate"><span class="pre">secureKey</span></code> 가 사용됩니다.</p>
</div>
<div class="section" id="id9">
<h3>동일한 도매인 내의 여러 사이트<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Nginx와 같은 리버스 프록시를 사용하여 같은 도메인 내의 여러 다른 사이트를 실행:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">site1</span><span class="o">/...</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">site2</span><span class="o">/...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">config/xitrum.conf</span></code> 내의 <code class="docutils literal notranslate"><span class="pre">baseUrl</span></code> 을 정의합니다.</p>
<p>JavaScript코드 내에서 Ajax 요청에 정확한 URLs을 얻으려면 <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/js.scala">xitrum.js</a> 내의 <code class="docutils literal notranslate"><span class="pre">withBaseUrl</span></code> 을 사용하면 됩니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 만약 현재 사이트의 baseUrl이 &quot;site1&quot; 일 경우에 결과는:</span>
<span class="c1"># 다음과 같습니다. /site1/path/to/my/action</span>
<span class="n">xitrum</span><span class="o">.</span><span class="n">withBaseUrl</span><span class="p">(</span><span class="s1">&#39;/path/to/my/action&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="markdown-html">
<h3>Markdown 텍스트를 HTML로 변환<a class="headerlink" href="#markdown-html" title="Permalink to this headline">¶</a></h3>
<p>프로젝트가 이미 <a class="reference internal" href="index.html#document-template_engines"><span class="doc">Scalate</span></a> 을 사용하고 있다면 다음과 같이 해야 합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.fusesource.scalamd.Markdown</span>
<span class="n">val</span> <span class="n">html</span> <span class="o">=</span> <span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>아니라면 라이브러리를 프로젝트의 build.sbt에 추가해야 합니다:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s2">&quot;org.fusesource.scalamd&quot;</span> <span class="o">%%</span> <span class="s2">&quot;scalamd&quot;</span> <span class="o">%</span> <span class="s2">&quot;1.6&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>임시 디렉토리<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>기본적으로 Xitrum은 <code class="docutils literal notranslate"><span class="pre">tmp</span></code> 디렉토리 (<code class="docutils literal notranslate"><span class="pre">xitrum.conf</span></code> 의 <code class="docutils literal notranslate"><span class="pre">tmpDir</span></code> 에서 확인가능)를 생성된 scala파일의 저장이나 큰 업로드용 파일들을
저장하기 위해 사용합니다.</p>
<p>파일 경로 얻어오기:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xitrum</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">xitrum</span><span class="o">.</span><span class="n">tmpDir</span><span class="o">.</span><span class="n">getAbsolutePath</span>
</pre></div>
</div>
<p>파일이나 디렉토리 생성:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">file</span> <span class="o">=</span> <span class="n">new</span> <span class="n">java</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">xitrum</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">xitrum</span><span class="o">.</span><span class="n">tmpDir</span><span class="p">,</span> <span class="s2">&quot;myfile&quot;</span><span class="p">)</span>

<span class="n">val</span> <span class="nb">dir</span> <span class="o">=</span> <span class="n">new</span> <span class="n">java</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">xitrum</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">xitrum</span><span class="o">.</span><span class="n">tmpDir</span><span class="p">,</span> <span class="s2">&quot;mydir&quot;</span><span class="p">)</span>
<span class="nb">dir</span><span class="o">.</span><span class="n">mkdirs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>비디오 스트리밍<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>다양한 비디오 스트리밍 방법 중 쉬운 방법은:</p>
<ul class="simple">
<li><p>.mp4 비디오 파일들에 간격을 주어서 플래이하는 동안 다운로드를 합니다.</p></li>
<li><p>그리고 Xitrum이 지원하는 HTTP서버와 같이 <a class="reference external" href="http://en.wikipedia.org/wiki/Byte_serving">range requests</a> 사용자는 다운로드 받지 않은 부분에 대하여
건너뛰기가 가능합니다.</p></li>
</ul>
<p><a class="reference external" href="http://gpac.wp.mines-telecom.fr/mp4box/">MP4Box</a> 를 이용하는 것으로 500 밀리초마다 데이터를 넣을 수 있습니다.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MP4Box</span> <span class="o">-</span><span class="n">inter</span> <span class="mi">500</span> <span class="n">movie</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
</div>
</div>
<span id="document-deps"></span><div class="section" id="id1">
<h2>의존도<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>라이브러리 의존도<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Xitrum은 다양한 라이브러리를 포함하고 있습니다. 원한다면 직접 라이브러리를 사용할 수 있습니다.</p>
<img alt="_images/deps.png" src="_images/deps.png" />
<p>주요 종속 라이브러리:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.scala-lang.org/">Scala</a>:
Xitrum은 Scala로 작성되었습니다.</p></li>
<li><p><a class="reference external" href="https://netty.io/">Netty</a>:
WebSocket과 제로 복사 파일 전송 등
Xitrum의 비동기 HTTP(S) 서버의 많은 기능은 Netty의 기능을 바탕으로 구현되었습니다.</p></li>
<li><p><a class="reference external" href="http://akka.io/">Akka</a>:
주로 SockJS 위해 Akka는 <a class="reference external" href="https://github.com/typesafehub/config">Typesafe Config</a>
에 의존하고 있으며 Xitrum 또한 그것을 사용하고 있습니다.</p></li>
</ul>
<p>기타 주요 종속 라이브러리 :</p>
<ul class="simple">
<li><p><a class="reference external" href="http://commons.apache.org/lang/">Commons Lang</a>:
JSON 데이터의 이스케이프 처리에 사용하고 있습니다.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/glokka">Glokka</a>:
SockJS 액터 클러스터링에 사용하고 있습니다.</p></li>
<li><p><a class="reference external" href="https://github.com/json4s/json4s">JSON4S</a>:
JSON 파싱과 생성을 위해 사용합니다.
JSON4S은
<a class="reference external" href="http://paranamer.codehaus.org/">Paranamer</a> 의존 라이브러리로 사용하고 있습니다.</p></li>
<li><p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Rhino">Rhino</a>:
Scalate에서 CoffeeScript를 JavaScript로 컴파일하는 데 사용하고 있습니다.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/sclasner">Sclasner</a>:
클래스 파일과 jar 파일에서 HTTP 경로를 검색하는 데 사용하고 있습니다.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/scaposer">Scaposer</a>:
국제화를 위해 사용하고 있습니다.</p></li>
<li><p><a class="reference external" href="https://github.com/twitter/chill">Twitter Chill</a>:
쿠키와 세션의 직렬화, 역직렬화에 사용하고 있습니다.
Chill는 <a class="reference external" href="http://code.google.com/p/kryo/">Kryo</a> 를 바탕으로 하고 있습니다.</p></li>
<li><p><a class="reference external" href="http://slf4s.org/">SLF4S</a> <a class="reference external" href="http://logback.qos.ch/">Logback</a>:
로깅에 사용하고 있습니다.</p></li>
</ul>
<p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-new">Xitrum 프로젝트 뼈대</a> 는 다음 도구를 포장하고 있습니다:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/xitrum-framework/scala-xgettext">scala-xgettext</a>:
컴파일시에 .scala 파일 <a class="reference internal" href="index.html#document-i18n"><span class="doc">국제화</span></a> 문자열을 확장합니다.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-package">xitrum-package</a>:
프로덕션 환경에 배포하기 위해 <a class="reference internal" href="index.html#document-deploy"><span class="doc">프로젝트를 패키징</span></a> 합니다.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/scalive">Scalive</a>:
Scala 콘솔에서 JVM 프로세스에 연결하여 동적 디버깅을 가능하게 합니다.</p></li>
</ul>
</div>
<div class="section" id="id3">
<h3>관련 프로젝트<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>데모:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-new">xitrum-new</a>:
신규 Xitrum 프로젝트의 골격.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-demos">xitrum-demos</a>:
Xitrum 각 기능의 데모 프로젝트.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-placeholder">xitrum-placeholder</a>:
Xitrum으로 화상 이미지 응용 프로그램의 데모.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/comy">comy</a>:
간단한 URL 숏터 앱 데모.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-multimodule-demo">xitrum-multimodule-demo</a>:
<a class="reference external" href="http://www.scala-sbt.org/">SBT</a> 멀티 모듈 프로젝트의 데모.</p></li>
</ul>
<p>플러그인:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-scalate">xitrum-scalate</a>:
Xitrum의 기본 템플릿 엔진.
<a class="reference external" href="https://github.com/xitrum-framework/xitrum-new">Xitrum 프로젝트 뼈대</a> 에서 사용하고 있습니다.
다른 템플릿 엔진을 사용하는 것도 또한 필요가 없으면 프로젝트에서 삭제해 버리는 것도 가능합니다.
xitrum-scalate은
<a class="reference external" href="http://scalate.fusesource.org/">Scalate</a> 와
<a class="reference external" href="https://github.com/chirino/scalamd">Scalamd</a> 에 의존하고 있습니다.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-hazelcast">xitrum-hazelcast</a>:
캐시와 서버의 세션 클러스터링을 하는 플러그인.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-ko">xitrum-ko</a>:
<a class="reference external" href="http://knockoutjs.com/">Knockoutjs</a> 를 간편하게 사용할 수 있도록 하는 플러그인.</p></li>
</ul>
<p>기타 프로젝트:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-doc">xitrum-doc</a>:
<a class="reference external" href="http://xitrum-framework.github.io/guide.html">Xitrum Guide</a> 소스 코드.</p></li>
<li><p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-framework.github.io">xitrum-hp</a>:
<a class="reference external" href="http://xitrum-framework.github.io/">Xitrum Homepage</a> 소스 코드.</p></li>
</ul>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro">소개</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">기능</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">기여자들</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tutorial">튜토리얼</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#xitrum">Xitrum 프로젝트 만들기</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">시작하기</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#eclipse">Eclipse 프로젝트로 만들기</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intellij-idea">IntelliJ IDEA 프로젝트 만들기</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id6">자동 리로드</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#ide">IDE를 사용하는 경우</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id7">SBT를 사용하는 경우</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#dcevm">DCEVM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id9">무시되는 파일들</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-action_view">Action 과 view</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#normal-action">Normal Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#futureaction">FutureAction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#actor-action">Actor Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">클라이언트로의 전송</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#view">템플릿 View 파일 응답</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#currentaction">currentAction의 캐스팅</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id4">Mustache</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#coffeescript">CoffeeScript</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">레이아웃</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id6">독립적인 레이아웃 파일을 사용하지 않는 패턴</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#respondview">respondView 레이아웃을 직접 패스</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#inline-view">Inline view</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#render-fragment">Render fragment</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">다른 Action의 View를 응답하는 경우</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id8">하나의 Action - 여러 View사용</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#component">Component</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-restful">RESTful APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">루트 캐싱</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#first-last">루트의 우선순위(first, last)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#action">Action에 여러 경로를 연동</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">점을 포함하는 루트</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">정규 표현식을 이용한 라우팅</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">경로의 나머지 부분 이용</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">액션에 링크추가</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id6">다른 액션으로 리디랙션</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">다른 액션에 요청 전달</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ajax">Ajax 요청 여부 확인</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#anti-csrf">Anti-CSRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#anticsrfinput-anticsrftoken">antiCsrfInput 과 antiCsrfToken</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#csrf">CSRF 체크 생략</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id8">라우팅 조작</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id9">요청 내용 가져오기</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#swagger-api">Swagger로 API 문서화 하기</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-template_engines">템플릿 엔진</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">템플릿 엔진 설정</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">템플릿 엔진 제거</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">템플릿 엔진 만들기</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-postback">포스트백</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">레이아웃</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">폼</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#form">form 이외의 사용</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">확인 다이얼로그</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">매개 변수 추가</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ajax">Ajax로딩중 이미지 로딩</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-xml">XML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">XML의 이스케이프</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">XML 요소의 그룹화</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xhtml">XHTML 렌더링</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-js">JavaScript 와 JSON</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#javascript">JavaScript</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#javascript-view">JavaScript 조각을 View에 추가하는 방법</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id1">JavaScript를 직접 호출하는 경우</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#json">JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#knockout-js">Knockout.js 플러그인</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-async">비동기 응답</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#websocket">WebSocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sockjs">SockJS</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#chunk">Chunk응답</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#iframe">무한 iframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#event-source">Event Source</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-static">정적 파일</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">디스크의 정적 파일 전송</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#index-html">index.html 대체</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">404 과 500</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#webjar">WebJar에 의한 클래스 패스내의 리소스 파일 전송</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#webjars">WebJars</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#webjars-jar">WebJars 형식으로 리소스 파일을 .jar 내에 저장하기</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id6">클래스 패스내의 파일 응답</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#etag-max-age">ETag 과 max-age의 클라이언트 캐쉬</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#gzip">GZIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id9">서버 캐쉬</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-flash">Flash Socket 정책 파일</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-scopes">스코프</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">요청</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id3">매개변수</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id4">매개변수 접근</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#at">“at”</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#atjson">“atJson”</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#requestvar">RequestVar</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">쿠키</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id6">쿠키가 가능한 문자들</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">세션</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#session-clear">session.clear()</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#sessionvar">SessionVar</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id8">세션 스토어</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id9">클라이언트 세션 저장과 서버 세션 저장</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#object-vs-val">object vs. val</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-validation">검증</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">기본 검증</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">검증기 수정하기</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-upload">파일 업로드</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#ajax">Ajax 스타일 업로드</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-filter">액션 필터</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#before">Before 필터</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#after">After 필터</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#around">Around 필터</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">필터의 수행 순서</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cache">서버측 캐시</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">캐시페이지 혹은 액션</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">캐시 오브젝트</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">캐시 제거</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">설정</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id6">캐쉬의 동작원리</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xitrum-util-locallrucache">xitrum.util.LocalLruCache</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-i18n">I18n</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">소스코드에 국제화 메세지 작성</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#pot">pot에 메세지 추출하기</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#po">po 파일 저장위치</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">언어설정</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">검증 메세지</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">복수형</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">날짜와 시간 포멧</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-log">로그</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#xitrum-log">xitrum.Log 오브젝트를 직접 사용하기</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xitrum-log-trait">xitrum.Log trait 사용하기</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">로깅하기 전에 로그레벨을 체크하지 않아도 됩니다</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">로그레벨 및 출력파일 조정</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#fluentd">Fluentd 에 로그를 출력</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-deploy">프로덕션 서버에 배포하기</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#package">Package 디렉토리</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xitrum-package">사용자 정의 xitrum-package</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#jvm-scala">실행중인 JVM 프로세스에 Scala 콘솔 연결</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#oracle-jdk-centos">Oracle JDK를 CentOS 나 우분투에 설차하기</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xitrum">시스템이 구동될때 Xitrum을 시작하기</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">포트포워딩 방법</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#linux">대량연결에 대한 Linux 설정</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id8">파일 디스크립터 제한</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id9">커널 조정</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id10">백 로그에 대해</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#haproxy">HAProxy 팁</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#nginx">Nginx 팁</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#heroku">Heroku에 배포하기</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id16">가입 및 저장소 만들기</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#procfile">Procfile 생성</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#port">Port설정 변경</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id18">로그 레벨 수정</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id19"><code class="docutils literal notranslate"><span class="pre">xitrum-package</span></code> 별칭 부여</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id20">Heroku에 푸시하기</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cluster">Akka와 Hazelcast 클러스터링</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-handler">Netty 핸들러</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Netty 핸들러 구조</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">핸들러의 수정</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xitrum">Xitrum 핸들러</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-metrics">매트릭스</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">매트릭스 수집</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#cpu">힙 메모리와 CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id3">액션 매트릭스</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id4">수정된 매트릭스 수집</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id6">매트릭스 배포</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#xitrum">Xitrum 기본 뷰어</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#jconsole">Jconsole 뷰어</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id8">사용자 정의 매트릭스 뷰어</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id9">매트릭스 저장</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-howto">HOWTO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">기본적인 인증</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id2">전체 프로젝트에 기본적인 인증을 설정하는 방법</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id3">특정 액션에 기본 인증을 추가</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">설정파일 로드</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#json">JSON 파일</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id5">설정 파일</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#typesafe">Typesafe한 설정파일</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">직렬화 및 역직렬화</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id8">데이터 암호화</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id9">동일한 도매인 내의 여러 사이트</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#markdown-html">Markdown 텍스트를 HTML로 변환</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id10">임시 디렉토리</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id11">비디오 스트리밍</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-deps">의존도</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">라이브러리 의존도</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">관련 프로젝트</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="#">Xitrum Scala Web Framework Guide 3.30.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Xitrum Scala Web Framework Guide 3.30.0 documentation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Ngoc Dao.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>
