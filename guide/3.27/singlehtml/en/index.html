<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Xitrum Scala Web Framework Guide 3.27.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.27.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="None" href="index.html#document-index" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">Xitrum Scala Web Framework Guide 3.27.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="xitrum-guide">
<h1>Xitrum Guide<a class="headerlink" href="#xitrum-guide" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://xitrum-framework.github.io/guide.html">There are also Japanese, Korean, Russian, and Vietnamese versions.</a></p>
<div class="toctree-wrapper compound">
<span id="document-intro"></span><div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>+--------------------+
|      Clients       |
+--------------------+
          |
+--------------------+
|       Netty        |
+--------------------+
|       Xitrum       |
| +----------------+ |
| | HTTP(S) Server | |
| |----------------| |
| | Web framework  | |  &lt;- Akka, Hazelcast -&gt; Other instances
| +----------------+ |
+--------------------+
|      Your app      |
+--------------------+
</pre></div>
</div>
<p>Xitrum is an async and clustered Scala web framework and HTTP(S) server fusion
on top of <a class="reference external" href="http://netty.io/">Netty</a> and <a class="reference external" href="http://akka.io/">Akka</a>.</p>
<p>From <a class="reference external" href="https://groups.google.com/group/xitrum-framework/msg/d6de4865a8576d39">a user</a>:</p>
<blockquote>
<div><p>Wow, this is a really impressive body of work, arguably the most
complete Scala framework outside of Lift (but much easier to use).</p>
<p><a class="reference external" href="http://xitrum-framework.github.io/">Xitrum</a> is truly a full stack web framework, all the bases are covered,
including wtf-am-I-on-the-moon extras like ETags, static file cache
identifiers &amp; auto-gzip compression. Tack on built-in JSON converter,
before/around/after interceptors, request/session/cookie/flash scopes,
integrated validation (server &amp; client-side, nice), built-in cache
layer (<a class="reference external" href="http://www.hazelcast.org/">Hazelcast</a>), i18n a la GNU gettext, Netty (with Nginx, hello
blazing fast), etc. and you have, wow.</p>
</div></blockquote>
<div class="section" id="features">
<h3>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Typesafe, in the spirit of Scala. All the APIs try to be as typesafe as possible.</li>
<li>Async, in the spirit of Netty. Your request proccessing action does not have
to respond immediately. Long polling, chunked response (streaming), WebSocket,
and SockJS are supported.</li>
<li>Fast built-in HTTP and HTTPS web server based on <a class="reference external" href="http://netty.io/">Netty</a>
(HTTPS can use Java engine or native OpenSSL engine).
Xitrum&#8217;s static file serving speed is <a class="reference external" href="https://gist.github.com/3293596">similar to that of Nginx</a>.</li>
<li>Extensive client-side and server-side caching for faster responding.
At the web server layer, small files are cached in memory, big files are sent
using NIO&#8217;s zero copy.
At the web framework layer you have can declare page, action, and object cache
in the Rails style.
<a class="reference external" href="http://code.google.com/speed/page-speed/docs/rules_intro.html">All Google&#8217;s best practices</a>
like conditional GET are applied for client-side caching.
You can also force browsers to always send request to server to revalidate cache before using.</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Byte_serving">Range requests</a> support
for static files. Serving movie files for smartphones requires this feature.
You can pause/resume file download.</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> support.</li>
<li>Routes are automatically collected in the spirit of JAX-RS
and Rails Engines. You don&#8217;t have to declare all routes in a single place.
Think of this feature as distributed routes. You can plug an app into another app.
If you have a blog engine, you can package it as a JAR file, then you can put
that JAR file into another app and that app automatically has blog feature!
Routing is also two-way: you can recreate URLs (reverse routing) in a typesafe way.
You can document routes using <a class="reference external" href="http://swagger.wordnik.com/">Swagger Doc</a>.</li>
<li>Classes and routes are automatically reloaded in development mode.</li>
<li>Views can be written in a separate <a class="reference external" href="http://scalate.fusesource.org/">Scalate</a>
template file or Scala inline XML. Both are typesafe.</li>
<li>Sessions can be stored in cookies (more scalable) or clustered <a class="reference external" href="http://www.hazelcast.org/">Hazelcast</a> (more secure).
Hazelcast also gives in-process (thus faster and simpler to use) distribued cache,
you don&#8217;t need separate cache servers. The same is for pubsub feature in Akka.</li>
<li><a class="reference external" href="http://jqueryvalidation.org/">jQuery Validation</a> is integrated
for browser side and server side validation.</li>
<li>i18n using <a class="reference external" href="http://en.wikipedia.org/wiki/GNU_gettext">GNU gettext</a>.
Translation text extraction is done automatically.
You don&#8217;t have to manually mess with properties files.
You can use powerful tools like <a class="reference external" href="http://www.poedit.net/screenshots.php">Poedit</a>
for translating and merging translations.
gettext is unlike most other solutions, both singular and plural forms are supported.</li>
</ul>
<p>Xitrum tries to fill the spectrum between <a class="reference external" href="https://github.com/scalatra/scalatra">Scalatra</a>
and <a class="reference external" href="http://liftweb.net/">Lift</a>: more powerful than Scalatra and easier to
use than Lift. You can easily create both RESTful APIs and postbacks. <a class="reference external" href="http://xitrum-framework.github.io/">Xitrum</a>
is controller-first like Scalatra, not
<a class="reference external" href="http://www.assembla.com/wiki/show/liftweb/View_First">view-first</a> like Lift.
Most people are familliar with controller-first style.</p>
<p>See <a class="reference internal" href="index.html#document-deps"><em>related projects</em></a> for a list of demos, plugins etc.</p>
</div>
<div class="section" id="contributors">
<h3>Contributors<a class="headerlink" href="#contributors" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://xitrum-framework.github.io/">Xitrum</a> is <a class="reference external" href="https://github.com/xitrum-framework/xitrum">open source</a>,
please join its <a class="reference external" href="http://groups.google.com/group/xitrum-framework">Google group</a>.</p>
<p>Contributors are listed in the order of their
<a class="reference external" href="https://github.com/xitrum-framework/xitrum/graphs/contributors">first contribution</a>.</p>
<p>(*): Currently active core members.</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ngocdaothanh">Ngoc Dao (*)</a></li>
<li><a class="reference external" href="https://github.com/alide">Linh Tran</a></li>
<li><a class="reference external" href="https://github.com/earldouglas">James Earl Douglas</a></li>
<li><a class="reference external" href="https://github.com/caiiiycuk">Aleksander Guryanov</a></li>
<li><a class="reference external" href="https://github.com/georgeOsdDev">Takeharu Oshida (*)</a></li>
<li><a class="reference external" href="https://github.com/kimkha">Nguyen Kim Kha</a></li>
<li><a class="reference external" href="https://github.com/murz">Michael Murray</a></li>
</ul>
</div>
</div>
<span id="document-tutorial"></span><div class="section" id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<p>This chapter shortly describes how to create and run a Xitrum project.
<strong>It assumes that you are using Linux and you have installed Java.</strong></p>
<div class="section" id="create-a-new-empty-xitrum-project">
<h3>Create a new empty Xitrum project<a class="headerlink" href="#create-a-new-empty-xitrum-project" title="Permalink to this headline">¶</a></h3>
<p>To create a new empty project, download
<a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/archive/master.zip">xitrum-new.zip</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>wget -O xitrum-new.zip https://github.com/xitrum-framework/xitrum-new/archive/master.zip
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-python"><div class="highlight"><pre>curl -L -o xitrum-new.zip https://github.com/xitrum-framework/xitrum-new/archive/master.zip
</pre></div>
</div>
</div>
<div class="section" id="run">
<h3>Run<a class="headerlink" href="#run" title="Permalink to this headline">¶</a></h3>
<p>The de facto stardard way of building Scala projects is using
<a class="reference external" href="https://github.com/harrah/xsbt/wiki/Setup">SBT</a>. The newly created project
has already included SBT 0.13 in <code class="docutils literal"><span class="pre">sbt</span></code> directory. If you want to install
SBT yourself, see its <a class="reference external" href="https://github.com/harrah/xsbt/wiki/Setup">setup guide</a>.</p>
<p>Change to the newly created project directory and run <code class="docutils literal"><span class="pre">sbt/sbt</span> <span class="pre">run</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>unzip xitrum-new.zip
cd xitrum-new
sbt/sbt run
</pre></div>
</div>
<p>This command will download all <a class="reference internal" href="index.html#document-deps"><em>dependencies</em></a>, compile the project,
and run the class <code class="docutils literal"><span class="pre">quickstart.Boot</span></code>, which starts the web server. In the console,
you will see all the routes:</p>
<div class="highlight-python"><div class="highlight"><pre>[INFO] Load routes.cache or recollect routes...
[INFO] Normal routes:
GET  /  quickstart.action.SiteIndex
[INFO] SockJS routes:
xitrum/metrics/channel  xitrum.metrics.XitrumMetricsChannel  websocket: true, cookie_needed: false
[INFO] Error routes:
404  quickstart.action.NotFoundError
500  quickstart.action.ServerError
[INFO] Xitrum routes:
GET        /webjars/swagger-ui/2.0.17/index                            xitrum.routing.SwaggerUiVersioned
GET        /xitrum/xitrum.js                                           xitrum.js
GET        /xitrum/metrics/channel                                     xitrum.sockjs.Greeting
GET        /xitrum/metrics/channel/:serverId/:sessionId/eventsource    xitrum.sockjs.EventSourceReceive
GET        /xitrum/metrics/channel/:serverId/:sessionId/htmlfile       xitrum.sockjs.HtmlFileReceive
GET        /xitrum/metrics/channel/:serverId/:sessionId/jsonp          xitrum.sockjs.JsonPPollingReceive
POST       /xitrum/metrics/channel/:serverId/:sessionId/jsonp_send     xitrum.sockjs.JsonPPollingSend
WEBSOCKET  /xitrum/metrics/channel/:serverId/:sessionId/websocket      xitrum.sockjs.WebSocket
POST       /xitrum/metrics/channel/:serverId/:sessionId/xhr            xitrum.sockjs.XhrPollingReceive
POST       /xitrum/metrics/channel/:serverId/:sessionId/xhr_send       xitrum.sockjs.XhrSend
POST       /xitrum/metrics/channel/:serverId/:sessionId/xhr_streaming  xitrum.sockjs.XhrStreamingReceive
GET        /xitrum/metrics/channel/info                                xitrum.sockjs.InfoGET
WEBSOCKET  /xitrum/metrics/channel/websocket                           xitrum.sockjs.RawWebSocket
GET        /xitrum/metrics/viewer                                      xitrum.metrics.XitrumMetricsViewer
GET        /xitrum/metrics/channel/:iframe                             xitrum.sockjs.Iframe
GET        /xitrum/metrics/channel/:serverId/:sessionId/websocket      xitrum.sockjs.WebSocketGET
POST       /xitrum/metrics/channel/:serverId/:sessionId/websocket      xitrum.sockjs.WebSocketPOST
[INFO] HTTP server started on port 8000
[INFO] HTTPS server started on port 4430
[INFO] Xitrum started in development mode
</pre></div>
</div>
<p>On startup, all routes will be collected and output to log. It is very
convenient for you to have a list of routes if you want to write documentation
for 3rd parties about the RESTful APIs in your web application.</p>
<p>Open <a class="reference external" href="http://localhost:8000/">http://localhost:8000/</a> or <a class="reference external" href="https://localhost:4430/">https://localhost:4430/</a> in your browser. In the
console you will see request information:</p>
<div class="highlight-python"><div class="highlight"><pre>[INFO] GET quickstart.action.SiteIndex, 1 [ms]
</pre></div>
</div>
</div>
<div class="section" id="import-the-project-to-eclipse">
<h3>Import the project to Eclipse<a class="headerlink" href="#import-the-project-to-eclipse" title="Permalink to this headline">¶</a></h3>
<p>You can <a class="reference external" href="http://scala-ide.org/">use Eclipse to write Scala code</a>.</p>
<p>From the project directory, run:</p>
<div class="highlight-python"><div class="highlight"><pre>sbt/sbt eclipse
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">.project</span></code> file for Eclipse will be generated from definitions in <code class="docutils literal"><span class="pre">build.sbt</span></code>.
Now open Eclipse, and import the project.</p>
</div>
<div class="section" id="import-the-project-to-intellij">
<h3>Import the project to IntelliJ<a class="headerlink" href="#import-the-project-to-intellij" title="Permalink to this headline">¶</a></h3>
<p>You can also use <a class="reference external" href="http://www.jetbrains.com/idea/">IntelliJ</a>.</p>
<p>With its Scala plugin installed, simply open your SBT project,
you don&#8217;t need to generate project files as with Eclipse.</p>
</div>
<div class="section" id="autoreload">
<h3>Autoreload<a class="headerlink" href="#autoreload" title="Permalink to this headline">¶</a></h3>
<p>You can autoreload .class files (hot swap) without having to restart your
program. However, to avoid performance and stability problems, you should only
autoreload .class files while developing (development mode).</p>
<div class="section" id="run-with-ides">
<h4>Run with IDEs<a class="headerlink" href="#run-with-ides" title="Permalink to this headline">¶</a></h4>
<p>While developing, when you run project in advanced IDEs like Eclipse or IntelliJ,
by default the IDEs will automatically reload code for you.</p>
</div>
<div class="section" id="run-with-sbt">
<h4>Run with SBT<a class="headerlink" href="#run-with-sbt" title="Permalink to this headline">¶</a></h4>
<p>When you run with SBT, you need to open 2 console windows:</p>
<ul class="simple">
<li>One to run <code class="docutils literal"><span class="pre">sbt/sbt</span> <span class="pre">run</span></code>. This will run the program and reload .class files
when they are changed.</li>
<li>One to run <code class="docutils literal"><span class="pre">sbt/sbt</span> <span class="pre">~compile</span></code>. Whenever you edit source code files, this
will compile the source code to .class files.</li>
</ul>
<p>In the sbt directory, there&#8217;s <a class="reference external" href="https://github.com/xitrum-framework/agent7">agent7.jar</a>.
It&#8217;s in charge of reloading .class files in the current working directory (and its subdirectories).
If you see the <code class="docutils literal"><span class="pre">sbt/sbt</span></code> script, you&#8217;ll see the option like <code class="docutils literal"><span class="pre">-javaagent:agent7.jar</span></code>.</p>
</div>
<div class="section" id="dcevm">
<h4>DCEVM<a class="headerlink" href="#dcevm" title="Permalink to this headline">¶</a></h4>
<p>Normal JVM only allows only changing method bodies. You may use
<a class="reference external" href="https://github.com/dcevm/dcevm">DCEVM</a>, which is an open source modification
of the Java HotSpot VM that allows unlimited redefinition of loaded classes.</p>
<p>You can install DCEVM in 2 ways:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/dcevm/dcevm/releases">Patch</a> your existing Java installation.</li>
<li>Install a <a class="reference external" href="http://dcevm.nentjes.com/">prebuilt</a> version (easier).</li>
</ul>
<p>If you choose to patch:</p>
<ul class="simple">
<li>You can enable DCEVM permanently.</li>
<li>Or set it as an &#8220;alternative&#8221; JVM. In this case, to enable DCEVM, every time
you run <code class="docutils literal"><span class="pre">java</span></code> command, you need to specify <code class="docutils literal"><span class="pre">-XXaltjvm=dcevm</span></code> option.
For example, you need to add <code class="docutils literal"><span class="pre">-XXaltjvm=dcevm</span></code> option to the <code class="docutils literal"><span class="pre">sbt/sbt</span></code> script.</li>
</ul>
<p>If you use IDEs like Eclipse or IntelliJ, you need to configure them to use DCEVM
(not the default JVM) to run your project.</p>
<p>If you use SBT, you need to configure the <code class="docutils literal"><span class="pre">PATH</span></code> environment variable so that
the <code class="docutils literal"><span class="pre">java</span></code> command is from DCEVM (not from the default JVM). You still need
the <code class="docutils literal"><span class="pre">javaagent</span></code> above, because although DCEVM supports advanced class changes,
it itself doesn&#8217;t reload classes.</p>
<p>See <a class="reference external" href="http://javainformed.blogspot.jp/2014/01/jrebel-free-alternative.html">DCEVM - A JRebel free alternative</a>
for more info.</p>
</div>
</div>
<div class="section" id="ignore-files">
<h3>Ignore files<a class="headerlink" href="#ignore-files" title="Permalink to this headline">¶</a></h3>
<p>Normally, these file should be
<a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/.gitignore">ignored</a>
(not commited to your SVN or Git repository):</p>
<div class="highlight-python"><div class="highlight"><pre>.*
log
project/project
project/target
target
tmp
</pre></div>
</div>
</div>
</div>
<span id="document-action_view"></span><div class="section" id="action-and-view">
<h2>Action and view<a class="headerlink" href="#action-and-view" title="Permalink to this headline">¶</a></h2>
<p>To be flexible, Xitrum provides 3 kinds of actions:
normal <code class="docutils literal"><span class="pre">Action</span></code>, <code class="docutils literal"><span class="pre">FutureAction</span></code>, and <code class="docutils literal"><span class="pre">ActorAction</span></code>.</p>
<div class="section" id="normal-action">
<h3>Normal action<a class="headerlink" href="#normal-action" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.annotation.GET

@GET(&quot;hello&quot;)
class HelloAction extends Action {
  def execute() {
    respondText(&quot;Hello&quot;)
  }
}
</pre></div>
</div>
<p>Because the action will run on directly Netty&#8217;s IO thread, it should not do blocking
processing that may take a long time, otherwise Netty can&#8217;t accept new connections
or send response back to clients.</p>
</div>
<div class="section" id="futureaction">
<h3>FutureAction<a class="headerlink" href="#futureaction" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.FutureAction
import xitrum.annotation.GET

@GET(&quot;hello&quot;)
class HelloAction extends FutureAction {
  def execute() {
    respondText(&quot;hi&quot;)
  }
}
</pre></div>
</div>
<p>The action will run on the same thread pool for <code class="docutils literal"><span class="pre">ActorAction</span></code> (see below),
separated from the thread pool of Netty.</p>
</div>
<div class="section" id="actor-action">
<h3>Actor action<a class="headerlink" href="#actor-action" title="Permalink to this headline">¶</a></h3>
<p>If you want your action to be an Akka actor, extend <code class="docutils literal"><span class="pre">ActorAction</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>import scala.concurrent.duration._

import xitrum.ActorAction
import xitrum.annotation.GET

@GET(&quot;actor&quot;)
class HelloAction extends ActorAction {
  def execute() {
    // See Akka doc about scheduler
    import context.dispatcher
    context.system.scheduler.scheduleOnce(3 seconds, self, System.currentTimeMillis())

    // See Akka doc about &quot;become&quot;
    context.become {
      case pastTime =&gt;
        respondInlineView(s&quot;It&#39;s $pastTime Unix ms 3s ago.&quot;)
    }
  }
}
</pre></div>
</div>
<p>An actor instance will be created when there&#8217;s request. It will be stopped when the
connection is closed or when the response has been sent by <code class="docutils literal"><span class="pre">respondText</span></code>,
<code class="docutils literal"><span class="pre">respondView</span></code> etc. methods. For chunked response, it is not stopped right away.
It is stopped when the last chunk is sent.</p>
<p>The actor will run on the thread pool of the Akka actor system named &#8220;xitrum&#8221;.</p>
</div>
<div class="section" id="respond-to-client">
<h3>Respond to client<a class="headerlink" href="#respond-to-client" title="Permalink to this headline">¶</a></h3>
<p>From an action, to respond something to client, use:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">respondView</span></code>: responds view template file, with or without layout</li>
<li><code class="docutils literal"><span class="pre">respondInlineView</span></code>: responds embedded template (not separate template file), with or without layout</li>
<li><code class="docutils literal"><span class="pre">respondText(&quot;hello&quot;)</span></code>: responds a string without layout</li>
<li><code class="docutils literal"><span class="pre">respondHtml(&quot;&lt;html&gt;...&lt;/html&gt;&quot;)</span></code>: same as above, with content type set to &#8220;text/html&#8221;</li>
<li><code class="docutils literal"><span class="pre">respondJson(List(1,</span> <span class="pre">2,</span> <span class="pre">3))</span></code>: converts Scala object to JSON object then responds</li>
<li><code class="docutils literal"><span class="pre">respondJs(&quot;myFunction([1,</span> <span class="pre">2,</span> <span class="pre">3])&quot;)</span></code></li>
<li><code class="docutils literal"><span class="pre">respondJsonP(List(1,</span> <span class="pre">2,</span> <span class="pre">3),</span> <span class="pre">&quot;myFunction&quot;)</span></code>: combination of the above two</li>
<li><code class="docutils literal"><span class="pre">respondJsonText(&quot;[1,</span> <span class="pre">2,</span> <span class="pre">3]&quot;)</span></code></li>
<li><code class="docutils literal"><span class="pre">respondJsonPText(&quot;[1,</span> <span class="pre">2,</span> <span class="pre">3]&quot;,</span> <span class="pre">&quot;myFunction&quot;)</span></code></li>
<li><code class="docutils literal"><span class="pre">respondBinary</span></code>: responds an array of bytes</li>
<li><code class="docutils literal"><span class="pre">respondFile</span></code>: sends a file directly from disk, very fast
because <a class="reference external" href="http://www.ibm.com/developerworks/library/j-zerocopy/">zero-copy</a>
(aka send-file) is used</li>
<li><code class="docutils literal"><span class="pre">respondEventSource(&quot;data&quot;,</span> <span class="pre">&quot;event&quot;)</span></code></li>
</ul>
</div>
<div class="section" id="respond-template-view-file">
<h3>Respond template view file<a class="headerlink" href="#respond-template-view-file" title="Permalink to this headline">¶</a></h3>
<p>Each action may have an associated <a class="reference external" href="http://scalate.fusesource.org/">Scalate</a>
template view file. Instead of responding directly in the action with the above
methods, you can use a separate view file.</p>
<p>scr/main/scala/mypackage/MyAction.scala:</p>
<div class="highlight-python"><div class="highlight"><pre>package mypackage

import xitrum.Action
import xitrum.annotation.GET

@GET(&quot;myAction&quot;)
class MyAction extends Action {
  def execute() {
    respondView()
  }

  def hello(what: String) = &quot;Hello %s&quot;.format(what)
}
</pre></div>
</div>
<p>scr/main/scalate/mypackage/MyAction.jade:</p>
<div class="highlight-python"><div class="highlight"><pre>- import mypackage.MyAction

!!! 5
html
  head
    != antiCsrfMeta
    != xitrumCss
    != jsDefaults
    title Welcome to Xitrum

  body
    a(href={url}) Path to the current action
    p= currentAction.asInstanceOf[MyAction].hello(&quot;World&quot;)

    != jsForView
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">xitrumCss</span></code> includes the default CSS for Xitrum. You may remove it if you
don&#8217;t like.xitrum-framework</li>
<li><code class="docutils literal"><span class="pre">jsDefaults</span></code> includes jQuery, jQuery Validate plugin etc.
should be put at layout&#8217;s &lt;head&gt;.</li>
<li><code class="docutils literal"><span class="pre">jsForView</span></code> contains JS fragments added by <code class="docutils literal"><span class="pre">jsAddToView</span></code>,
should be put at layout&#8217;s bottom.</li>
</ul>
<p>In templates you can use all methods of the class <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/Action.scala">xitrum.Action</a>.
Also, you can use utility methods provided by Scalate like <code class="docutils literal"><span class="pre">unescape</span></code>.
See the <a class="reference external" href="http://scalate.fusesource.org/documentation/index.html">Scalate doc</a>.</p>
<p>The default Scalate template type is <a class="reference external" href="http://scalate.fusesource.org/documentation/jade.html">Jade</a>.
You can also use <a class="reference external" href="http://scalate.fusesource.org/documentation/mustache.html">Mustache</a>,
<a class="reference external" href="http://scalate.fusesource.org/documentation/scaml-reference.html">Scaml</a>, or
<a class="reference external" href="http://scalate.fusesource.org/documentation/ssp-reference.html">Ssp</a>.
To config the default template type, see xitrum.conf file in the config directory
of your Xitrum application.</p>
<p>You can override the default template type by passing &#8220;jade&#8221;, &#8220;mustache&#8221;, &#8220;scaml&#8221;,
or &#8220;ssp&#8221; to <cite>respondView</cite>.</p>
<div class="highlight-python"><div class="highlight"><pre>val options = Map(&quot;type&quot; -&gt;&quot;mustache&quot;)
respondView(options)
</pre></div>
</div>
<div class="section" id="type-casting-currentaction">
<h4>Type casting currentAction<a class="headerlink" href="#type-casting-currentaction" title="Permalink to this headline">¶</a></h4>
<p>If you want to have exactly instance of the current action, cast <code class="docutils literal"><span class="pre">currentAction</span></code> to
the action you wish.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">p</span><span class="o">=</span> <span class="n">currentAction</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="p">[</span><span class="n">MyAction</span><span class="p">]</span><span class="o">.</span><span class="n">hello</span><span class="p">(</span><span class="s">&quot;World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you have multiple lines like above, you can cast only one time:</p>
<div class="highlight-python"><div class="highlight"><pre>- val myAction = currentAction.asInstanceOf[MyAction]; import myAction._

p= hello(&quot;World&quot;)
p= hello(&quot;Scala&quot;)
p= hello(&quot;Xitrum&quot;)
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4>Mustache<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Must read:</p>
<ul class="simple">
<li><a class="reference external" href="http://mustache.github.com/mustache.5.html">Mustache syntax</a></li>
<li><a class="reference external" href="http://scalate.fusesource.org/documentation/mustache.html">Scalate implementation</a></li>
</ul>
<p>You can&#8217;t do some things with Mustache like with Jade, because Mustache syntax
is stricter.</p>
<p>To pass things from action to Mustache template, you must use <code class="docutils literal"><span class="pre">at</span></code>:</p>
<p>Action:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">at</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="s">&quot;Jack&quot;</span>
<span class="n">at</span><span class="p">(</span><span class="s">&quot;xitrumCss&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">xitrumCss</span>
</pre></div>
</div>
<p>Mustache template:</p>
<div class="highlight-python"><div class="highlight"><pre>My name is {{name}}
{{xitrumCss}}
</pre></div>
</div>
<p>Note that you can&#8217;t use the below keys for <code class="docutils literal"><span class="pre">at</span></code> map to pass things to Scalate
template, because they&#8217;re already used:</p>
<ul class="simple">
<li>&#8220;context&#8221;: for Sclate utility object, which contains methods like <code class="docutils literal"><span class="pre">unescape</span></code></li>
<li>&#8220;helper&#8221;: for the current action object</li>
</ul>
</div>
<div class="section" id="coffeescript">
<h4>CoffeeScript<a class="headerlink" href="#coffeescript" title="Permalink to this headline">¶</a></h4>
<p>You can embed CoffeeScript in Scalate template using
<a class="reference external" href="http://scalate.fusesource.org/documentation/jade-syntax.html#filters">:coffeescript filter</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>body
  :coffeescript
    alert &quot;Hello, Coffee!&quot;
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;body&gt;
  &lt;script type=&#39;text/javascript&#39;&gt;
    //&lt;![CDATA[
      (function() {
        alert(&quot;Hello, Coffee!&quot;);
      }).call(this);
    //]]&gt;
  &lt;/script&gt;
&lt;/body&gt;
</pre></div>
</div>
<p>But note that it is <a class="reference external" href="http://groups.google.com/group/xitrum-framework/browse_thread/thread/6667a7608f0dc9c7">slow</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>jade+javascript+1thread: 1-2ms for page
jade+coffesscript+1thread: 40-70ms for page
jade+javascript+100threads: ~40ms for page
jade+coffesscript+100threads: 400-700ms for page
</pre></div>
</div>
<p>You pre-generate CoffeeScript to JavaScript if you need speed.</p>
</div>
</div>
<div class="section" id="layout">
<h3>Layout<a class="headerlink" href="#layout" title="Permalink to this headline">¶</a></h3>
<p>When you respond a view with <code class="docutils literal"><span class="pre">respondView</span></code> or <code class="docutils literal"><span class="pre">respondInlineView</span></code>, Xitrum
renders it to a String, and sets the String to <code class="docutils literal"><span class="pre">renderedView</span></code> variable. Xitrum
then calls <code class="docutils literal"><span class="pre">layout</span></code> method of the current action, finally Xitrum responds
the result of this method to the browser.</p>
<p>By default <code class="docutils literal"><span class="pre">layout</span></code> method just returns <code class="docutils literal"><span class="pre">renderedView</span></code> itself. If you want
to decorate your view with something, override this method. If you include
<code class="docutils literal"><span class="pre">renderedView</span></code> in the method, the view will be included as part of your layout.</p>
<p>The point is <code class="docutils literal"><span class="pre">layout</span></code> is called after your action&#8217;s view, and whatever returned
is what responded to the browser. This mechanism is simple and straight forward.
No magic. For convenience, you may think that there&#8217;s no layout in Xitrum at all.
There&#8217;s just the <code class="docutils literal"><span class="pre">layout</span></code> method and you do whatever you want with it.</p>
<p>Typically, you create a parent class which has a common layout for many views:</p>
<p>src/main/scala/mypackage/AppAction.scala</p>
<div class="highlight-python"><div class="highlight"><pre>package mypackage
import xitrum.Action

trait AppAction extends Action {
  override def layout = renderViewNoLayout[AppAction]()
}
</pre></div>
</div>
<p>src/main/scalate/mypackage/AppAction.jade</p>
<div class="highlight-python"><div class="highlight"><pre>!!! 5
html
  head
    != antiCsrfMeta
    != xitrumCss
    != jsDefaults
    title Welcome to Xitrum

  body
    != renderedView
    != jsForView
</pre></div>
</div>
<p>src/main/scala/mypackage/MyAction.scala</p>
<div class="highlight-python"><div class="highlight"><pre>package mypackage
import xitrum.annotation.GET

@GET(&quot;myAction&quot;)
class MyAction extends AppAction {
  def execute() {
    respondView()
  }

  def hello(what: String) = &quot;Hello %s&quot;.format(what)
}
</pre></div>
</div>
<p>scr/main/scalate/mypackage/MyAction.jade:</p>
<div class="highlight-python"><div class="highlight"><pre>- import mypackage.MyAction

a(href={url}) Path to the current action
p= currentAction.asInstanceOf[MyAction].hello(&quot;World&quot;)
</pre></div>
</div>
<div class="section" id="layout-without-separate-file">
<h4>Layout without separate file<a class="headerlink" href="#layout-without-separate-file" title="Permalink to this headline">¶</a></h4>
<p>AppAction.scala</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.view.DocType

trait AppAction extends Action {
  override def layout = DocType.html5(
    &lt;html&gt;
      &lt;head&gt;
        {antiCsrfMeta}
        {xitrumCss}
        {jsDefaults}
        &lt;title&gt;Welcome to Xitrum&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        {renderedView}
        {jsForView}
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</pre></div>
</div>
</div>
<div class="section" id="pass-layout-directly-to-respondview">
<h4>Pass layout directly to respondView<a class="headerlink" href="#pass-layout-directly-to-respondview" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre>val specialLayout = () =&gt;
  DocType.html5(
    &lt;html&gt;
      &lt;head&gt;
        {antiCsrfMeta}
        {xitrumCss}
        {jsDefaults}
        &lt;title&gt;Welcome to Xitrum&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        {renderedView}
        {jsForView}
      &lt;/body&gt;
    &lt;/html&gt;
  )

respondView(specialLayout _)
</pre></div>
</div>
</div>
</div>
<div class="section" id="inline-view">
<h3>Inline view<a class="headerlink" href="#inline-view" title="Permalink to this headline">¶</a></h3>
<p>Normally, you write view in a Scalate file. You can also write it directly:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.annotation.GET

@GET(&quot;myAction&quot;)
class MyAction extends Action {
  def execute() {
    val s = &quot;World&quot;  // Will be automatically HTML-escaped
    respondInlineView(
      &lt;p&gt;Hello &lt;em&gt;{s}&lt;/em&gt;!&lt;/p&gt;
    )
  }
}
</pre></div>
</div>
</div>
<div class="section" id="render-fragment">
<h3>Render fragment<a class="headerlink" href="#render-fragment" title="Permalink to this headline">¶</a></h3>
<p>Suppose MyAction.jade is at:
scr/main/scalate/mypackage/MyAction.jade</p>
<p>If you want to render the fragment file in the same directory:
scr/main/scalate/mypackage/_MyFragment.jade</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">renderFragment</span><span class="p">[</span><span class="n">MyAction</span><span class="p">](</span><span class="s">&quot;MyFragment&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal"><span class="pre">MyAction</span></code> is the current action, you can skip it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">renderFragment</span><span class="p">(</span><span class="s">&quot;MyFragment&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="respond-view-of-other-action">
<h3>Respond view of other action<a class="headerlink" href="#respond-view-of-other-action" title="Permalink to this headline">¶</a></h3>
<p>Use the syntax <code class="docutils literal"><span class="pre">respondView[ClassName]()</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>package mypackage

import xitrum.Action
import xitrum.annotation.{GET, POST}

@GET(&quot;login&quot;)
class LoginFormAction extends Action {
  def execute() {
    // Respond scr/main/scalate/mypackage/LoginFormAction.jade
    respondView()
  }
}

@POST(&quot;login&quot;)
class DoLoginAction extends Action {
  def execute() {
    val authenticated = ...
    if (authenticated)
      redirectTo[HomeAction]()
    else
      // Reuse the view of LoginFormAction
      respondView[LoginFormAction]()
  }
}
</pre></div>
</div>
<div class="section" id="one-action-multiple-views">
<h4>One action - multiple views<a class="headerlink" href="#one-action-multiple-views" title="Permalink to this headline">¶</a></h4>
<p>If you want to have multiple views for one:</p>
<div class="highlight-python"><div class="highlight"><pre>package mypackage

import xitrum.Action
import xitrum.annotation.GET

// These are non-routed actions, for mapping to view template files:
// scr/main/scalate/mypackage/HomeAction_NormalUser.jade
// scr/main/scalate/mypackage/HomeAction_Moderator.jade
// scr/main/scalate/mypackage/HomeAction_Admin.jade
trait HomeAction_NormalUser extends Action
trait HomeAction_Moderator  extends Action
trait HomeAction_Admin      extends Action

@GET(&quot;&quot;)
class HomeAction extends Action {
  def execute() {
    val userType = ...
    userType match {
      case NormalUser =&gt; respondView[HomeAction_NormalUser]()
      case Moderator  =&gt; respondView[HomeAction_Moderator]()
      case Admin      =&gt; respondView[HomeAction_Admin]()
    }
  }
}
</pre></div>
</div>
<p>Using addional non-routed actions like above seems to be tedious, but this way
your program will be typesafe.</p>
<p>You can also use <code class="docutils literal"><span class="pre">String</span></code> to specify template location:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">respondView</span><span class="p">(</span><span class="s">&quot;mypackage/HomeAction_NormalUser&quot;</span><span class="p">)</span>
<span class="n">respondView</span><span class="p">(</span><span class="s">&quot;mypackage/HomeAction_Moderator&quot;</span><span class="p">)</span>
<span class="n">respondView</span><span class="p">(</span><span class="s">&quot;mypackage/HomeAction_Admin&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="component">
<h3>Component<a class="headerlink" href="#component" title="Permalink to this headline">¶</a></h3>
<p>You can create reusable view components that can be embedded to multiple views.
In concept, a component is similar to an action:</p>
<ul class="simple">
<li>But it does not have routes, thus <code class="docutils literal"><span class="pre">execute</span></code> method is not needed.</li>
<li>It does not &#8220;responds&#8221; a full response, it just &#8220;renders&#8221; a view fragment.
So inside a component, instead of calling <code class="docutils literal"><span class="pre">respondXXX</span></code>, please call <code class="docutils literal"><span class="pre">renderXXX</span></code>.</li>
<li>Just like an action, a component can have none, one, or multiple associated view
templates.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>package mypackage

import xitrum.{FutureAction, Component}
import xitrum.annotation.GET

class CompoWithView extends Component {
  def render() = {
    // Render associated view template, e.g. CompoWithView.jade
    // Note that this is renderView, not respondView!
    renderView()
  }
}

class CompoWithoutView extends Component {
  def render() = {
    &quot;Hello World&quot;
  }
}

@GET(&quot;foo/bar&quot;)
class MyAction extends FutureAction {
  def execute() {
    respondView()
  }
}
</pre></div>
</div>
<p>MyAction.jade:</p>
<div class="highlight-python"><div class="highlight"><pre>- import mypackage._

!= newComponent[CompoWithView]().render()
!= newComponent[CompoWithoutView]().render()
</pre></div>
</div>
</div>
</div>
<span id="document-restful"></span><div class="section" id="restful-apis">
<h2>RESTful APIs<a class="headerlink" href="#restful-apis" title="Permalink to this headline">¶</a></h2>
<p>You can write RESTful APIs for iPhone, Android applications etc. very easily.</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.annotation.GET

@GET(&quot;articles&quot;)
class ArticlesIndex extends Action {
  def execute() {...}
}

@GET(&quot;articles/:id&quot;)
class ArticlesShow extends Action {
  def execute() {...}
}
</pre></div>
</div>
<p>The same for POST, PUT, PATCH, DELETE, and OPTIONS.
Xitrum automatically handles HEAD as GET with empty response body.</p>
<p>For HTTP clients that do not support PUT and DELETE (like normal browsers), to
simulate PUT and DELETE, send a POST with <code class="docutils literal"><span class="pre">_method=put</span></code> or <code class="docutils literal"><span class="pre">_method=delete</span></code> in the
request body.</p>
<p>On web application startup, Xitrum will scan all those annotations, build the
routing table and print it out for you so that you know what APIs your
application has, like this:</p>
<div class="highlight-python"><div class="highlight"><pre>[INFO] Routes:
GET /articles     quickstart.action.ArticlesIndex
GET /articles/:id quickstart.action.ArticlesShow
</pre></div>
</div>
<p>Routes are automatically collected in the spirit of JAX-RS
and Rails Engines. You don&#8217;t have to declare all routes in a single place.
Think of this feature as distributed routes. You can plug an app into another app.
If you have a blog engine, you can package it as a JAR file, then you can put
that JAR file into another app and that app automatically has blog feature!
Routing is also two-way: you can recreate URLs (reverse routing) in a typesafe way.
You can document routes using <a class="reference external" href="http://swagger.wordnik.com/">Swagger Doc</a>.</p>
<div class="section" id="route-cache">
<h3>Route cache<a class="headerlink" href="#route-cache" title="Permalink to this headline">¶</a></h3>
<p>For better startup speed, routes are cached to file <code class="docutils literal"><span class="pre">routes.cache</span></code>.
While developing, routes in .class files in the <code class="docutils literal"><span class="pre">target</span></code> directory are not
cached. If you change library dependencies that contain routes, you may need to
delete <code class="docutils literal"><span class="pre">routes.cache</span></code>. This file should not be committed to your project
source code repository.</p>
</div>
<div class="section" id="route-order-with-first-and-last">
<h3>Route order with first and last<a class="headerlink" href="#route-order-with-first-and-last" title="Permalink to this headline">¶</a></h3>
<p>When you want to route like this:</p>
<div class="highlight-python"><div class="highlight"><pre>/articles/:id --&gt; ArticlesShow
/articles/new --&gt; ArticlesNew
</pre></div>
</div>
<p>You must make sure the second route be checked first. <code class="docutils literal"><span class="pre">First</span></code> is for this purpose:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.annotation.{GET, First}

@GET(&quot;articles/:id&quot;)
class ArticlesShow extends Action {
  def execute() {...}
}

@First  // This route has higher priority than &quot;ArticlesShow&quot; above
@GET(&quot;articles/new&quot;)
class ArticlesNew extends Action {
  def execute() {...}
}
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">Last</span></code> is similar.</p>
</div>
<div class="section" id="multiple-paths-for-one-action">
<h3>Multiple paths for one action<a class="headerlink" href="#multiple-paths-for-one-action" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>@GET(&quot;image&quot;, &quot;image/:format&quot;)
class Image extends Action {
  def execute() {
    val format = paramo(&quot;format&quot;).getOrElse(&quot;png&quot;)
    // ...
  }
}
</pre></div>
</div>
</div>
<div class="section" id="dot-in-route">
<h3>Dot in route<a class="headerlink" href="#dot-in-route" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>@GET(&quot;articles/:id&quot;, &quot;articles/:id.:format&quot;)
class ArticlesShow extends Action {
  def execute() {
    val id     = param[Int](&quot;id&quot;)
    val format = paramo(&quot;format&quot;).getOrElse(&quot;html&quot;)
    // ...
  }
}
</pre></div>
</div>
</div>
<div class="section" id="regex-in-route">
<h3>Regex in route<a class="headerlink" href="#regex-in-route" title="Permalink to this headline">¶</a></h3>
<p>Regex can be used in routes to specify requirements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">GET</span><span class="p">(</span><span class="s">&quot;articles/:id&lt;[0-9]+&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="catch-the-rest-of-path">
<h3>Catch the rest of path<a class="headerlink" href="#catch-the-rest-of-path" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">/</span></code> character is special thus not allowed in param names. If you want to allow
it, the param must be the last and you must write like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">GET</span><span class="p">(</span><span class="s">&quot;service/:id/proxy/:*&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The path below will match:</p>
<div class="highlight-python"><div class="highlight"><pre>/service/123/proxy/http://foo.com/bar
</pre></div>
</div>
<p>To extract the <code class="docutils literal"><span class="pre">:*</span></code> part:</p>
<div class="highlight-python"><div class="highlight"><pre>val url = param(&quot;*&quot;)  // Will be &quot;http://foo.com/bar&quot;
</pre></div>
</div>
</div>
<div class="section" id="link-to-an-action">
<h3>Link to an action<a class="headerlink" href="#link-to-an-action" title="Permalink to this headline">¶</a></h3>
<p>Xitrum tries to be typesafe. Don&#8217;t write URL manually. Do like this:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;a href={url[ArticlesShow](&quot;id&quot; -&gt; myArticle.id)}&gt;{myArticle.title}&lt;/a&gt;
</pre></div>
</div>
</div>
<div class="section" id="redirect-to-another-action">
<h3>Redirect to another action<a class="headerlink" href="#redirect-to-another-action" title="Permalink to this headline">¶</a></h3>
<p>Read to know <a class="reference external" href="http://en.wikipedia.org/wiki/URL_redirection">what redirection is</a>.</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.annotation.{GET, POST}

@GET(&quot;login&quot;)
class LoginInput extends Action {
  def execute() {...}
}

@POST(&quot;login&quot;)
class DoLogin extends Action {
  def execute() {
    ...
    // After login success
    redirectTo[AdminIndex]()
  }
}

GET(&quot;admin&quot;)
class AdminIndex extends Action {
  def execute() {
    ...
    // Check if the user has not logged in, redirect him to the login page
    redirectTo[LoginInput]()
  }
}
</pre></div>
</div>
<p>You can also redirect to the current action with <code class="docutils literal"><span class="pre">redirecToThis()</span></code>.</p>
</div>
<div class="section" id="forward-to-another-action">
<h3>Forward to another action<a class="headerlink" href="#forward-to-another-action" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal"><span class="pre">forwardTo[AnotherAction]()</span></code>. While <code class="docutils literal"><span class="pre">redirectTo</span></code> above causes the browser to
make another request, <code class="docutils literal"><span class="pre">forwardTo</span></code> does not.</p>
</div>
<div class="section" id="determine-is-the-request-is-ajax-request">
<h3>Determine is the request is Ajax request<a class="headerlink" href="#determine-is-the-request-is-ajax-request" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal"><span class="pre">isAjax</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre>// In an action
val msg = &quot;A message&quot;
if (isAjax)
  jsRender(&quot;alert(&quot; + jsEscape(msg) + &quot;)&quot;)
else
  respondText(msg)
</pre></div>
</div>
</div>
<div class="section" id="anti-csrf">
<h3>Anti-CSRF<a class="headerlink" href="#anti-csrf" title="Permalink to this headline">¶</a></h3>
<p>For non-GET requests, Xitrum protects your web application from
<a class="reference external" href="http://en.wikipedia.org/wiki/CSRF">Cross-site request forgery</a> by default.</p>
<p>When you include <code class="docutils literal"><span class="pre">antiCsrfMeta</span></code> in your layout:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.view.DocType

trait AppAction extends Action {
  override def layout = DocType.html5(
    &lt;html&gt;
      &lt;head&gt;
        {antiCsrfMeta}
        {xitrumCss}
        {jsDefaults}
        &lt;title&gt;Welcome to Xitrum&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        {renderedView}
        {jsForView}
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">&lt;head&gt;</span></code> part will include something like this:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    ...
    &lt;meta name=&quot;csrf-token&quot; content=&quot;5402330e-9916-40d8-a3f4-16b271d583be&quot; /&gt;
    ...
  &lt;/head&gt;
  ...
&lt;/html&gt;
</pre></div>
</div>
<p>The token will be automatically included in all non-GET Ajax requests as
<code class="docutils literal"><span class="pre">X-CSRF-Token</span></code> header sent by jQuery if you include
<a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/js.scala">xitrum.js</a>
in your view template. xitrum.js is included in <code class="docutils literal"><span class="pre">jsDefaults</span></code>. If you don&#8217;t
use <code class="docutils literal"><span class="pre">jsDefaults</span></code>, you can include xitrum.js in your template like this:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script type=&quot;text/javascript&quot; src={url[xitrum.js]}&gt;&lt;/script&gt;
</pre></div>
</div>
</div>
<div class="section" id="anticsrfinput-and-anticsrftoken">
<h3>antiCsrfInput and antiCsrfToken<a class="headerlink" href="#anticsrfinput-and-anticsrftoken" title="Permalink to this headline">¶</a></h3>
<p>Xitrum takes CSRF token from <code class="docutils literal"><span class="pre">X-CSRF-Token</span></code> request header. If the header does
not exists, Xitrum takes the token from <code class="docutils literal"><span class="pre">csrf-token</span></code> request body param
(note: not param in the URL).</p>
<p>If you manually write forms, and you don&#8217;t use the meta tag and xitrum.js as
described in the previous section, you need to use <code class="docutils literal"><span class="pre">antiCsrfInput</span></code> or
<code class="docutils literal"><span class="pre">antiCsrfToken</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>form(method=&quot;post&quot; action={url[AdminAddGroup]})
  != antiCsrfInput
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>form(method=&quot;post&quot; action={url[AdminAddGroup]})
  input(type=&quot;hidden&quot; name=&quot;csrf-token&quot; value={antiCsrfToken})
</pre></div>
</div>
</div>
<div class="section" id="skipcsrfcheck">
<h3>SkipCsrfCheck<a class="headerlink" href="#skipcsrfcheck" title="Permalink to this headline">¶</a></h3>
<p>When you create APIs for machines, e.g. smartphones, you may want to skip this
automatic CSRF check. Add the trait xitrum.SkipCsrfCheck to you action:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.{Action, SkipCsrfCheck}
import xitrum.annotation.POST

trait Api extends Action with SkipCsrfCheck

@POST(&quot;api/positions&quot;)
class LogPositionAPI extends Api {
  def execute() {...}
}

@POST(&quot;api/todos&quot;)
class CreateTodoAPI extends Api {
  def execute() {...}
}
</pre></div>
</div>
</div>
<div class="section" id="manipulate-collected-routes">
<h3>Manipulate collected routes<a class="headerlink" href="#manipulate-collected-routes" title="Permalink to this headline">¶</a></h3>
<p>Xitrum automatically collect routes on startup.
If you want to manipulate the routes, you can use
<a class="reference external" href="http://xitrum-framework.github.io/api/3.17/index.html#xitrum.routing.RouteCollection">xitrum.Config.routes</a>.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.{Config, Server}

object Boot {
  def main(args: Array[String]) {
    // You can modify routes before starting the server
    val routes = Config.routes

    // Remove routes to an action by its class
    routes.removeByClass[MyClass]()

    if (demoVersion) {
      // Remove routes to actions by a prefix
      routes.removeByPrefix(&quot;premium/features&quot;)

      // This also works
      routes.removeByPrefix(&quot;/premium/features&quot;)
    }

    ...

    Server.start()
  }
}
</pre></div>
</div>
</div>
<div class="section" id="getting-entire-request-content">
<h3>Getting entire request content<a class="headerlink" href="#getting-entire-request-content" title="Permalink to this headline">¶</a></h3>
<p>Usually, when the request content type is not <code class="docutils literal"><span class="pre">application/x-www-form-urlencoded</span></code>,
you may need to get the entire request content (and parse it manually etc.).</p>
<p>To get it as a string:</p>
<div class="highlight-python"><div class="highlight"><pre>val body = requestContentString
</pre></div>
</div>
<p>To get it as JSON:</p>
<div class="highlight-python"><div class="highlight"><pre>val myJValue = requestContentJValue  // =&gt; JSON4S (http://json4s.org) JValue
val myMap = xitrum.util.SeriDeseri.fromJValue[Map[String, Int]](myJValue)
</pre></div>
</div>
<p>If you want to full control, use <a class="reference external" href="http://netty.io/4.0/api/io/netty/handler/codec/http/FullHttpRequest.html">request.getContent</a>.
It returns a <a class="reference external" href="http://netty.io/4.0/api/io/netty/buffer/ByteBuf.html">ByteBuf</a>.</p>
</div>
<div class="section" id="documenting-api-with-swagger">
<h3>Documenting API with Swagger<a class="headerlink" href="#documenting-api-with-swagger" title="Permalink to this headline">¶</a></h3>
<p>You can document your API with <a class="reference external" href="https://developers.helloreverb.com/swagger/">Swagger</a>
out of the box. Add <code class="docutils literal"><span class="pre">&#64;Swagger</span></code> annotation on actions that need to be documented.
Xitrum will generate <a class="reference external" href="https://github.com/wordnik/swagger-core/wiki/API-Declaration">/xitrum/swagger.json</a>.
This file can be used with <a class="reference external" href="https://github.com/wordnik/swagger-ui">Swagger UI</a>
to generate interactive API documentation.</p>
<p>Xitrum includes Swagger UI. Access it at the path <code class="docutils literal"><span class="pre">/xitrum/swagger-ui</span></code> of your program,
e.g. <a class="reference external" href="http://localhost:8000/xitrum/swagger-ui">http://localhost:8000/xitrum/swagger-ui</a>.</p>
<img alt="_images/swagger.png" src="_images/swagger.png" />
<p>Let&#8217;s see <a class="reference external" href="https://github.com/xitrum-framework/xitrum-placeholder">an example</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.{Action, SkipCsrfCheck}
import xitrum.annotation.{GET, Swagger}

@Swagger(
  Swagger.Tags(&quot;APIs to create images&quot;),
  Swagger.Description(&quot;Dimensions should not be bigger than 2000 x 2000&quot;),
  Swagger.OptStringQuery(&quot;text&quot;, &quot;Text to render on the image, default: Placeholder&quot;),
  Swagger.Produces(&quot;image/png&quot;),
  Swagger.Response(200, &quot;PNG image&quot;),
  Swagger.Response(400, &quot;Width or height is invalid or too big&quot;)
)
trait ImageApi extends Action with SkipCsrfCheck {
  lazy val text = paramo(&quot;text&quot;).getOrElse(&quot;Placeholder&quot;)
}

@GET(&quot;image/:width/:height&quot;)
@Swagger(  // &lt;-- Inherits other info from ImageApi
  Swagger.Summary(&quot;Generate rectangle image&quot;),
  Swagger.IntPath(&quot;width&quot;),
  Swagger.IntPath(&quot;height&quot;)
)
class RectImageApi extends Api {
  def execute {
    val width  = param[Int](&quot;width&quot;)
    val height = param[Int](&quot;height&quot;)
    // ...
  }
}

@GET(&quot;image/:width&quot;)
@Swagger(  // &lt;-- Inherits other info from ImageApi
  Swagger.Summary(&quot;Generate square image&quot;),
  Swagger.IntPath(&quot;width&quot;)
)
class SquareImageApi extends Api {
  def execute {
    val width  = param[Int](&quot;width&quot;)
    // ...
  }
}
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/wordnik/swagger-spec/blob/master/versions/1.2.md">JSON for Swagger</a>
will be generated when you access <code class="docutils literal"><span class="pre">/xitrum/swagger</span></code>.</p>
<p>Swagger UI uses the JSON above to generate interactive API doc.</p>
<p>Params other than Swagger.IntPath and Swagger.OptStringQuery above: BytePath, IntQuery, OptStringForm etc.
They are in the form:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;Value</span> <span class="pre">type&gt;&lt;Param</span> <span class="pre">type&gt;</span></code> (required parameter)</li>
<li><code class="docutils literal"><span class="pre">Opt&lt;Value</span> <span class="pre">type&gt;&lt;Param</span> <span class="pre">type&gt;</span></code> (optional parameter)</li>
</ul>
<p>Value type: Byte, Int, Int32, Int64, Long, Number, Float, Double, String, Boolean, Date, DateTime</p>
<p>Param type: Path, Query, Body, Header, Form</p>
<p>Read more about <a class="reference external" href="https://github.com/wordnik/swagger-core/wiki/Datatypes">value type</a>
and <a class="reference external" href="https://github.com/wordnik/swagger-core/wiki/Parameters">param type</a>.</p>
</div>
</div>
<span id="document-template_engines"></span><div class="section" id="template-engines">
<h2>Template engines<a class="headerlink" href="#template-engines" title="Permalink to this headline">¶</a></h2>
<p>The configured template engine will be called when <a class="reference internal" href="index.html#document-action_view"><em>renderView, renderFragment,
or respondView</em></a> is called.</p>
<div class="section" id="config-template-engine">
<h3>Config template engine<a class="headerlink" href="#config-template-engine" title="Permalink to this headline">¶</a></h3>
<p>In <a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/config/xitrum.conf">config/xitrum.conf</a>,
template engine can be configured in one of the following 2 forms, depending on the engine you use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">template</span> <span class="o">=</span> <span class="n">my</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">EngineClassName</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-python"><div class="highlight"><pre>template {
  &quot;my.template.EngineClassName&quot; {
    option1 = value1
    option2 = value2
  }
}
</pre></div>
</div>
<p>The default template engine is <a class="reference external" href="https://github.com/xitrum-framework/xitrum-scalate">xitrum-scalate</a>.</p>
</div>
<div class="section" id="remove-template-engine">
<h3>Remove template engine<a class="headerlink" href="#remove-template-engine" title="Permalink to this headline">¶</a></h3>
<p>If you create only RESTful APIs in your project, normally you don&#8217;t call
renderView, renderFragment, or respondView. In this case, you can even remove
template engine from your project to make it lighter. Just remove or comment out
the <code class="docutils literal"><span class="pre">templateEngine</span></code> in config/xitrum.conf.</p>
<p>Then remove template related configs from your project.</p>
</div>
<div class="section" id="create-your-own-template-engine">
<h3>Create your own template engine<a class="headerlink" href="#create-your-own-template-engine" title="Permalink to this headline">¶</a></h3>
<p>To create your own template engine, create a class that implements
<a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/view/TemplateEngine.scala">xitrum.view.TemplateEngine</a>.
Then set your class in config/xitrum.conf.</p>
<p>For an example, see <a class="reference external" href="https://github.com/xitrum-framework/xitrum-scalate">xitrum-scalate</a>.</p>
</div>
</div>
<span id="document-postback"></span><div class="section" id="postbacks">
<h2>Postbacks<a class="headerlink" href="#postbacks" title="Permalink to this headline">¶</a></h2>
<p>There are 2 main use cases of web applications:</p>
<ul class="simple">
<li>To serve machines: you need to create RESTful APIs for smartphones, web services
for other web sites.</li>
<li>To serve human users: you need to create interactive web pages.</li>
</ul>
<p>As a web framework, Xitrum aims to support you to solve these use cases easily.
To solve the 1st use case, you use <a class="reference internal" href="index.html#document-restful"><em>RESTful actions</em></a>.
To solve the 2nd use case, you can use the Ajax form postback feature in Xitrum.
Please see the following links for the idea about postback:</p>
<ul class="simple">
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Postback">http://en.wikipedia.org/wiki/Postback</a></li>
<li><a class="reference external" href="http://nitrogenproject.com/doc/tutorial.html">http://nitrogenproject.com/doc/tutorial.html</a></li>
</ul>
<p>Xitrum&#8217;s postback feature is inspired by <a class="reference external" href="http://nitrogenproject.com/">Nitrogen</a>.</p>
<div class="section" id="layout">
<h3>Layout<a class="headerlink" href="#layout" title="Permalink to this headline">¶</a></h3>
<p>AppAction.scala</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.view.DocType

trait AppAction extends Action {
  override def layout = DocType.html5(
    &lt;html&gt;
      &lt;head&gt;
        {antiCsrfMeta}
        {xitrumCss}
        {jsDefaults}
        &lt;title&gt;Welcome to Xitrum&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        {renderedView}
        {jsForView}
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</pre></div>
</div>
</div>
<div class="section" id="form">
<h3>Form<a class="headerlink" href="#form" title="Permalink to this headline">¶</a></h3>
<p>Articles.scala</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.annotation.{GET, POST, First}
import xitrum.validator._

@GET(&quot;articles/:id&quot;)
class ArticlesShow extends AppAction {
  def execute() {
    val id      = param(&quot;id&quot;)
    val article = Article.find(id)
    respondInlineView(
      &lt;h1&gt;{article.title}&lt;/h1&gt;
      &lt;div&gt;{article.body}&lt;/div&gt;
    )
  }
}

@First  // Force this route to be matched before &quot;show&quot;
@GET(&quot;articles/new&quot;)
class ArticlesNew extends AppAction {
  def execute() {
    respondInlineView(
      &lt;form data-postback=&quot;submit&quot; action={url[ArticlesCreate]}&gt;
        &lt;label&gt;Title&lt;/label&gt;
        &lt;input type=&quot;text&quot; name=&quot;title&quot; class=&quot;required&quot; /&gt;&lt;br /&gt;

        &lt;label&gt;Body&lt;/label&gt;
        &lt;textarea name=&quot;body&quot; class=&quot;required&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;

        &lt;input type=&quot;submit&quot; value=&quot;Save&quot; /&gt;
      &lt;/form&gt;
    )
  }
}

@POST(&quot;articles&quot;)
class ArticlesCreate extends AppAction {
  def execute() {
    val title   = param(&quot;title&quot;)
    val body    = param(&quot;body&quot;)
    val article = Article.save(title, body)

    flash(&quot;Article has been saved.&quot;)
    jsRedirectTo(show, &quot;id&quot; -&gt; article.id)
  }
}
</pre></div>
</div>
<p>When <code class="docutils literal"><span class="pre">submit</span></code> JavaScript event of the form is triggered, the form will be posted back
to <code class="docutils literal"><span class="pre">ArticlesCreate</span></code>.</p>
<p><code class="docutils literal"><span class="pre">action</span></code> attribute of <code class="docutils literal"><span class="pre">&lt;form&gt;</span></code> is encrypted. The encrypted URL acts as the anti-CSRF token.</p>
</div>
<div class="section" id="non-form">
<h3>Non-form<a class="headerlink" href="#non-form" title="Permalink to this headline">¶</a></h3>
<p>Postback can be set on any element, not only form.</p>
<p>An example with link:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;a href=&quot;#&quot; data-postback=&quot;click&quot; action={postbackUrl[LogoutAction]}&gt;Logout&lt;/a&gt;
</pre></div>
</div>
<p>Clicking the link above will trigger the postback to LogoutAction.</p>
</div>
<div class="section" id="confirmation-dialog">
<h3>Confirmation dialog<a class="headerlink" href="#confirmation-dialog" title="Permalink to this headline">¶</a></h3>
<p>If you want to display a confirmation dialog:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;a href=&quot;#&quot; data-postback=&quot;click&quot;
            action={url[LogoutAction]}
            data-confirm=&quot;Do you want to logout?&quot;&gt;Logout&lt;/a&gt;
</pre></div>
</div>
<p>If the user clicks &#8220;Cancel&#8221;, the postback will not be sent.</p>
</div>
<div class="section" id="extra-params">
<h3>Extra params<a class="headerlink" href="#extra-params" title="Permalink to this headline">¶</a></h3>
<p>In case of form element, you can add <code class="docutils literal"><span class="pre">&lt;input</span> <span class="pre">type=&quot;hidden&quot;...</span></code> to send
extra params with the postback.</p>
<p>For other elements, you do like this:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;a href=&quot;#&quot;
   data-postback=&quot;click&quot;
   action={url[ArticlesDestroy](&quot;id&quot; -&gt; item.id)}
   data-params=&quot;_method=delete&quot;
   data-confirm={&quot;Do you want to delete %s?&quot;.format(item.name)}&gt;Delete&lt;/a&gt;
</pre></div>
</div>
<p>You may also put extra params in a separate form:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;form id=&quot;myform&quot; data-postback=&quot;submit&quot; action={url[SiteSearch]}&gt;
  Search:
  &lt;input type=&quot;text&quot; name=&quot;keyword&quot; /&gt;

  &lt;a class=&quot;pagination&quot;
     href=&quot;#&quot;
     data-postback=&quot;click&quot;
     data-form=&quot;#myform&quot;
     action={url[SiteSearch](&quot;page&quot; -&gt; page)}&gt;{page}&lt;/a&gt;
&lt;/form&gt;
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">#myform</span></code> is the jQuery selector to select the form that contains extra params.</p>
</div>
<div class="section" id="display-animation-image-while-ajax-is-loading">
<h3>Display animation image while Ajax is loading<a class="headerlink" href="#display-animation-image-while-ajax-is-loading" title="Permalink to this headline">¶</a></h3>
<p>If you want to display image like this while Ajax is loading</p>
<img alt="_images/ajax_loading.gif" src="_images/ajax_loading.gif" />
<p>please call this JS snippet after including <code class="docutils literal"><span class="pre">jsDefaults</span></code> (which includes
<a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/js.scala">xitrum.js</a>)
in your view template:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">xitrum</span><span class="o">.</span><span class="n">ajaxLoadingImg</span> <span class="o">=</span> <span class="s">&#39;path/to/your/image&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-xml"></span><div class="section" id="xml">
<h2>XML<a class="headerlink" href="#xml" title="Permalink to this headline">¶</a></h2>
<p>Scala allow wrting literal XML. Xitrum uses this feature as its &#8220;template engine&#8221;:</p>
<ul class="simple">
<li>Scala checks XML syntax at compile time: Views are typesafe.</li>
<li>Scala automatically escapes XML: Views are <a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_scripting">XSS</a>-free by default.</li>
</ul>
<p>Below are some tips.</p>
<div class="section" id="unescape-xml">
<h3>Unescape XML<a class="headerlink" href="#unescape-xml" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal"><span class="pre">scala.xml.Unparsed</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>import scala.xml.Unparsed

&lt;script&gt;
  {Unparsed(&quot;if (1 &lt; 2) alert(&#39;Xitrum rocks&#39;);&quot;)}
&lt;/script&gt;
</pre></div>
</div>
<p>Or use <code class="docutils literal"><span class="pre">&lt;xml:unparsed&gt;</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script&gt;
  &lt;xml:unparsed&gt;
    if (1 &lt; 2) alert(&#39;Xitrum rocks&#39;);
  &lt;/xml:unparsed&gt;
&lt;/script&gt;
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;xml:unparsed&gt;</span></code> will be hidden in the output:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script&gt;
  if (1 &lt; 2) alert(&#39;Xitrum rocks&#39;);
&lt;/script&gt;
</pre></div>
</div>
</div>
<div class="section" id="group-xml-elements">
<h3>Group XML elements<a class="headerlink" href="#group-xml-elements" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>&lt;div id=&quot;header&quot;&gt;
  {if (loggedIn)
    &lt;xml:group&gt;
      &lt;b&gt;{username}&lt;/b&gt;
      &lt;a href={url[LogoutAction]}&gt;Logout&lt;/a&gt;
    &lt;/xml:group&gt;
  else
    &lt;xml:group&gt;
      &lt;a href={url[LoginAction]}&gt;Login&lt;/a&gt;
      &lt;a href={url[RegisterAction]}&gt;Register&lt;/a&gt;
    &lt;/xml:group&gt;}
&lt;/div&gt;
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;xml:group&gt;</span></code> will be hidden in the output, for example when the use has logged in:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;div id=&quot;header&quot;&gt;
  &lt;b&gt;My username&lt;/b&gt;
  &lt;a href=&quot;/login&quot;&gt;Logout&lt;/a&gt;
&lt;/div&gt;
</pre></div>
</div>
</div>
<div class="section" id="render-xhtml">
<h3>Render XHTML<a class="headerlink" href="#render-xhtml" title="Permalink to this headline">¶</a></h3>
<p>Xitrum renders views and layouts as XHTML automatically.
If you want to render it yourself (rarely), pay attention to the code below.</p>
<div class="highlight-python"><div class="highlight"><pre>import scala.xml.Xhtml

val br = &lt;br /&gt;
br.toString            // =&gt; &lt;br&gt;&lt;/br&gt;, some browsers will render this as 2 &lt;br /&gt;s
Xhtml.toXhtml(&lt;br /&gt;)  // =&gt; &quot;&lt;br /&gt;&quot;
</pre></div>
</div>
</div>
</div>
<span id="document-js"></span><div class="section" id="javascript-and-json">
<h2>JavaScript and JSON<a class="headerlink" href="#javascript-and-json" title="Permalink to this headline">¶</a></h2>
<div class="section" id="javascript">
<h3>JavaScript<a class="headerlink" href="#javascript" title="Permalink to this headline">¶</a></h3>
<p>Xitrum includes jQuery. There are some jsXXX helpers.</p>
<div class="section" id="add-javascript-fragments-to-view">
<h4>Add JavaScript fragments to view<a class="headerlink" href="#add-javascript-fragments-to-view" title="Permalink to this headline">¶</a></h4>
<p>In your action, call <code class="docutils literal"><span class="pre">jsAddToView</span></code> (multiple times if you need):</p>
<div class="highlight-python"><div class="highlight"><pre>class MyAction extends AppAction {
  def execute() {
    ...
    jsAddToView(&quot;alert(&#39;Hello&#39;)&quot;)
    ...
    jsAddToView(&quot;alert(&#39;Hello again&#39;)&quot;)
    ...
    respondInlineView(&lt;p&gt;My view&lt;/p&gt;)
  }
}
</pre></div>
</div>
<p>In your layout, call <code class="docutils literal"><span class="pre">jsForView</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.view.DocType

trait AppAction extends Action {
  override def layout = DocType.html5(
    &lt;html&gt;
      &lt;head&gt;
        {antiCsrfMeta}
        {xitrumCss}
        {jsDefaults}
      &lt;/head&gt;
      &lt;body&gt;
        &lt;div id=&quot;flash&quot;&gt;{jsFlash}&lt;/div&gt;
        {renderedView}
        {jsForView}
      &lt;/body&gt;
    &lt;/html&gt;
  )
</pre></div>
</div>
</div>
<div class="section" id="respond-javascript-directly-without-view">
<h4>Respond JavaScript directly without view<a class="headerlink" href="#respond-javascript-directly-without-view" title="Permalink to this headline">¶</a></h4>
<p>To respond JavaScript:</p>
<div class="highlight-python"><div class="highlight"><pre>jsRespond(&quot;$(&#39;#error&#39;).html(%s)&quot;.format(jsEscape(&lt;p class=&quot;error&quot;&gt;Could not login.&lt;/p&gt;)))
</pre></div>
</div>
<p>To redirect:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">jsRedirectTo</span><span class="p">(</span><span class="s">&quot;http://cntt.tv/&quot;</span><span class="p">)</span>
<span class="n">jsRedirectTo</span><span class="p">[</span><span class="n">LoginAction</span><span class="p">]()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="json">
<h3>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h3>
<p>Xitrum includes <a class="reference external" href="https://github.com/json4s/json4s">JSON4S</a>.
Please read about it to know how to parse and generate JSON.</p>
<p>To convert between Scala case object and JSON string:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.util.SeriDeseri

case class Person(name: String, age: Int, phone: Option[String])
val person1 = Person(&quot;Jack&quot;, 20, None)
val json    = SeriDeseri.toJson(person1)
val person2 = SeriDeseri.fromJson[Person](json)
</pre></div>
</div>
<p>To respond JSON:</p>
<div class="highlight-python"><div class="highlight"><pre>val scalaData = List(1, 2, 3)  // An example
respondJson(scalaData)
</pre></div>
</div>
<p>JSON is also neat for config files that need nested structures.
See <a class="reference internal" href="index.html#document-howto"><em>Load config files</em></a>.</p>
</div>
<div class="section" id="plugin-for-knockout-js">
<h3>Plugin for Knockout.js<a class="headerlink" href="#plugin-for-knockout-js" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://github.com/xitrum-framework/xitrum-ko">https://github.com/xitrum-framework/xitrum-ko</a></p>
</div>
</div>
<span id="document-async"></span><div class="section" id="async-response">
<h2>Async response<a class="headerlink" href="#async-response" title="Permalink to this headline">¶</a></h2>
<p>List of normal responding methods:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">respondView</span></code>: responds view template file, with or without layout</li>
<li><code class="docutils literal"><span class="pre">respondInlineView</span></code>: responds embedded template (not separate template file), with or without layout</li>
<li><code class="docutils literal"><span class="pre">respondText(&quot;hello&quot;)</span></code>: responds a string without layout</li>
<li><code class="docutils literal"><span class="pre">respondHtml(&quot;&lt;html&gt;...&lt;/html&gt;&quot;)</span></code>: same as above, with content type set to &#8220;text/html&#8221;</li>
<li><code class="docutils literal"><span class="pre">respondJson(List(1,</span> <span class="pre">2,</span> <span class="pre">3))</span></code>: converts Scala object to JSON object then responds</li>
<li><code class="docutils literal"><span class="pre">respondJs(&quot;myFunction([1,</span> <span class="pre">2,</span> <span class="pre">3])&quot;)</span></code></li>
<li><code class="docutils literal"><span class="pre">respondJsonP(List(1,</span> <span class="pre">2,</span> <span class="pre">3),</span> <span class="pre">&quot;myFunction&quot;)</span></code>: combination of the above two</li>
<li><code class="docutils literal"><span class="pre">respondJsonText(&quot;[1,</span> <span class="pre">2,</span> <span class="pre">3]&quot;)</span></code></li>
<li><code class="docutils literal"><span class="pre">respondJsonPText(&quot;[1,</span> <span class="pre">2,</span> <span class="pre">3]&quot;,</span> <span class="pre">&quot;myFunction&quot;)</span></code></li>
<li><code class="docutils literal"><span class="pre">respondBinary</span></code>: responds an array of bytes</li>
<li><code class="docutils literal"><span class="pre">respondFile</span></code>: sends a file directly from disk, very fast
because <a class="reference external" href="http://www.ibm.com/developerworks/library/j-zerocopy/">zero-copy</a>
(aka send-file) is used</li>
<li><code class="docutils literal"><span class="pre">respondEventSource(&quot;data&quot;,</span> <span class="pre">&quot;event&quot;)</span></code></li>
</ul>
<p>Xitrum does not automatically send any default response.
You must explicitly call <code class="docutils literal"><span class="pre">respondXXX</span></code> methods above to send response.
If you don&#8217;t call <code class="docutils literal"><span class="pre">respondXXX</span></code>, Xitrum will keep the HTTP connection for you,
and you can call <code class="docutils literal"><span class="pre">respondXXX</span></code> later.</p>
<p>To check if the connection is still open, call <code class="docutils literal"><span class="pre">channel.isOpen</span></code>.
You can also use <code class="docutils literal"><span class="pre">addConnectionClosedListener</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>addConnectionClosedListener {
  // The connection has been closed
  // Unsubscribe from events, release resources etc.
}
</pre></div>
</div>
<p>Because of the async nature, the response is not sent right away.
<code class="docutils literal"><span class="pre">respondXXX</span></code> returns
<a class="reference external" href="http://netty.io/4.0/api/io/netty/channel/ChannelFuture.html">ChannelFuture</a>.
You can use it to perform actions when the response has actually been sent.</p>
<p>For example, if you want to close the connection after the response has been sent:</p>
<div class="highlight-python"><div class="highlight"><pre>import io.netty.channel.{ChannelFuture, ChannelFutureListener}

val future = respondText(&quot;Hello&quot;)
future.addListener(new ChannelFutureListener {
  def operationComplete(future: ChannelFuture) {
    future.getChannel.close()
  }
})
</pre></div>
</div>
<p>Or shorter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">respondText</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">addListener</span><span class="p">(</span><span class="n">ChannelFutureListener</span><span class="o">.</span><span class="n">CLOSE</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="websocket">
<h3>WebSocket<a class="headerlink" href="#websocket" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>import scala.runtime.ScalaRunTime
import xitrum.annotation.WEBSOCKET
import xitrum.{WebSocketAction, WebSocketBinary, WebSocketText, WebSocketPing, WebSocketPong}

@WEBSOCKET(&quot;echo&quot;)
class EchoWebSocketActor extends WebSocketAction {
  def execute() {
    // Here you can extract session data, request headers etc.
    // but do not use respondText, respondView etc.
    // To respond, use respondWebSocketXXX like below.

    log.debug(&quot;onOpen&quot;)

    context.become {
      case WebSocketText(text) =&gt;
        log.info(&quot;onTextMessage: &quot; + text)
        respondWebSocketText(text.toUpperCase)

      case WebSocketBinary(bytes) =&gt;
        log.info(&quot;onBinaryMessage: &quot; + ScalaRunTime.stringOf(bytes))
        respondWebSocketBinary(bytes)

      case WebSocketPing =&gt;
        log.debug(&quot;onPing&quot;)

      case WebSocketPong =&gt;
        log.debug(&quot;onPong&quot;)
    }
  }

  override def postStop() {
    log.debug(&quot;onClose&quot;)
    super.postStop()
  }
}
</pre></div>
</div>
<p>An actor will be created when there&#8217;s request. It will be stopped when:</p>
<ul class="simple">
<li>The connection is closed</li>
<li>WebSocket close frame is received or sent</li>
</ul>
<p>Use these to send WebSocket frames:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">respondWebSocketText</span></code></li>
<li><code class="docutils literal"><span class="pre">respondWebSocketBinary</span></code></li>
<li><code class="docutils literal"><span class="pre">respondWebSocketPing</span></code></li>
<li><code class="docutils literal"><span class="pre">respondWebSocketClose</span></code></li>
</ul>
<p>There&#8217;s no respondWebSocketPong, because Xitrum will automatically send pong frame
for you when it receives ping frame.</p>
<p>To get URL to the above WebSocket action:</p>
<div class="highlight-python"><div class="highlight"><pre>// Probably you want to use this in Scalate view etc.
val url = absWebSocketUrl[EchoWebSocketActor]
</pre></div>
</div>
</div>
<div class="section" id="sockjs">
<h3>SockJS<a class="headerlink" href="#sockjs" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/sockjs/sockjs-client">SockJS</a> is a browser JavaScript
library that provides a WebSocket-like object, for browsers that don&#8217;t support
WebSocket. SockJS tries to use WebSocket first. If that fails it can use a variety
of ways but still presents them through the WebSocket-like object.</p>
<p>If you want to work with WebSocket API on all kind of browsers, you should use
SockJS and avoid using WebSocket directly.</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script&gt;
  var sock = new SockJS(&#39;http://mydomain.com/path_prefix&#39;);
  sock.onopen = function() {
    console.log(&#39;open&#39;);
  };
  sock.onmessage = function(e) {
    console.log(&#39;message&#39;, e.data);
  };
  sock.onclose = function() {
    console.log(&#39;close&#39;);
  };
&lt;/script&gt;
</pre></div>
</div>
<p>Xitrum includes the JavaScript file of SockJS.
In your view template, just write like this:</p>
<div class="highlight-python"><div class="highlight"><pre>...
html
  head
    != jsDefaults
...
</pre></div>
</div>
<p>SockJS does require a <a class="reference external" href="https://github.com/sockjs/sockjs-protocol">server counterpart</a>.
Xitrum automatically does it for you.</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.{Action, SockJsAction, SockJsText}
import xitrum.annotation.SOCKJS

@SOCKJS(&quot;echo&quot;)
class EchoSockJsActor extends SockJsAction {
  def execute() {
    // To respond, use respondSockJsXXX like below

    log.info(&quot;onOpen&quot;)

    context.become {
      case SockJsText(text) =&gt;
        log.info(&quot;onMessage: &quot; + text)
        respondSockJsText(text)
    }
  }

  override def postStop() {
    log.info(&quot;onClose&quot;)
    super.postStop()
  }
}
</pre></div>
</div>
<p>An actor will be created when there&#8217;s a new SockJS session. It will be stopped when
the SockJS session is closed.</p>
<p>Use these to send SockJS frames:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">respondSockJsText</span></code></li>
<li><code class="docutils literal"><span class="pre">respondSockJsClose</span></code></li>
</ul>
<p>See <a class="reference external" href="https://github.com/sockjs/sockjs-node#various-issues-and-design-considerations">Various issues and design considerations</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>Basically cookies are not suited for SockJS model. If you want to authorize a
session, provide a unique token on a page, send it as a first thing over SockJS
connection and validate it on the server side. In essence, this is how cookies
work.
</pre></div>
</div>
<p>To config SockJS clustering, see <a class="reference internal" href="index.html#document-cluster"><em>Clustering with Akka</em></a>.</p>
</div>
<div class="section" id="chunked-response">
<h3>Chunked response<a class="headerlink" href="#chunked-response" title="Permalink to this headline">¶</a></h3>
<p>To send <a class="reference external" href="http://en.wikipedia.org/wiki/Chunked_transfer_encoding">chunked response</a>:</p>
<ol class="arabic simple">
<li>Call <code class="docutils literal"><span class="pre">setChunked</span></code></li>
<li>Call <code class="docutils literal"><span class="pre">respondXXX</span></code> as many times as you want</li>
<li>Lastly, call <code class="docutils literal"><span class="pre">respondLastChunk</span></code></li>
</ol>
<p>Chunked response has many use cases. For example, when you need to generate a
very large CSV file that does may not fit memory, you can generate chunk by chunk
and send them while you generate:</p>
<div class="highlight-python"><div class="highlight"><pre>// &quot;Cache-Control&quot; header will be automatically set to:
// &quot;no-store, no-cache, must-revalidate, max-age=0&quot;
//
// Note that &quot;Pragma: no-cache&quot; is linked to requests, not responses:
// http://palizine.plynt.com/issues/2008Jul/cache-control-attributes/
setChunked()

val generator = new MyCsvGenerator

generator.onFirstLine { line =&gt;
  val future = respondText(header, &quot;text/csv&quot;)
  future.addListener(new ChannelFutureListener {
    def operationComplete(future: ChannelFuture) {
      if (future.isSuccess) generator.next()
    }
  }
}

generator.onNextLine { line =&gt;
  val future = respondText(line)
  future.addListener(new ChannelFutureListener {
    def operationComplete(future: ChannelFuture) {
      if (future.isSuccess) generator.next()
    }
  })
}

generator.onLastLine { line =&gt;
  val future = respondText(line)
  future.addListener(new ChannelFutureListener {
    def operationComplete(future: ChannelFuture) {
      if (future.isSuccess) respondLastChunk()
    }
  })
}

generator.generate()
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li>Headers are sent on the first <code class="docutils literal"><span class="pre">respondXXX</span></code> call.</li>
<li>You can send optional trailing headers at <code class="docutils literal"><span class="pre">respondLastChunk</span></code></li>
<li><a class="reference internal" href="index.html#document-cache"><em>Page and action cache</em></a> cannot be used with chunked response.</li>
</ul>
<p>Using chunked response together with <code class="docutils literal"><span class="pre">ActorAction</span></code>, you can easily implement
<a class="reference external" href="http://www.cubrid.org/blog/dev-platform/faster-web-page-loading-with-facebook-bigpipe/">Facebook BigPipe</a>.</p>
<div class="section" id="forever-iframe">
<h4>Forever iframe<a class="headerlink" href="#forever-iframe" title="Permalink to this headline">¶</a></h4>
<p>Chunked response <a class="reference external" href="http://www.shanison.com/2010/05/10/stop-the-browser-%E2%80%9Cthrobber-of-doom%E2%80%9D-while-loading-comet-forever-iframe/">can be used</a>
for <a class="reference external" href="http://en.wikipedia.org/wiki/Comet_%28programming%29">Comet</a>.</p>
<p>The page that embeds the iframe:</p>
<div class="highlight-python"><div class="highlight"><pre>...
&lt;script&gt;
  var functionForForeverIframeSnippetsToCall = function() {...}
&lt;/script&gt;
...
&lt;iframe width=&quot;1&quot; height=&quot;1&quot; src=&quot;path/to/forever/iframe&quot;&gt;&lt;/iframe&gt;
...
</pre></div>
</div>
<p>The action that responds <code class="docutils literal"><span class="pre">&lt;script&gt;</span></code> snippets forever:</p>
<div class="highlight-python"><div class="highlight"><pre>// Prepare forever iframe

setChunked()

// Need something like &quot;123&quot; for Firefox to work
respondText(&quot;&lt;html&gt;&lt;body&gt;123&quot;, &quot;text/html&quot;)

// Most clients (even curl!) do not execute &lt;script&gt; snippets right away,
// we need to send about 2KB dummy data to bypass this problem
for (i &lt;- 1 to 100) respondText(&quot;&lt;script&gt;&lt;/script&gt;\n&quot;)
</pre></div>
</div>
<p>Later, whenever you want to pass data to the browser, just send a snippet:</p>
<div class="highlight-python"><div class="highlight"><pre>if (channel.isOpen)
  respondText(&quot;&lt;script&gt;parent.functionForForeverIframeSnippetsToCall()&lt;/script&gt;\n&quot;)
else
  // The connection has been closed, unsubscribe from events etc.
  // You can also use ``addConnectionClosedListener``.
</pre></div>
</div>
</div>
<div class="section" id="event-source">
<h4>Event Source<a class="headerlink" href="#event-source" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference external" href="http://dev.w3.org/html5/eventsource/">http://dev.w3.org/html5/eventsource/</a></p>
<p>Event Source response is a special kind of chunked response.
Data must be UTF-8.</p>
<p>To respond event source, call <code class="docutils literal"><span class="pre">respondEventSource</span></code> as many time as you want.</p>
<div class="highlight-python"><div class="highlight"><pre>respondEventSource(&quot;data1&quot;, &quot;event1&quot;)  // Event name is &quot;event1&quot;
respondEventSource(&quot;data2&quot;)            // Event name is set to &quot;message&quot; by default
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-static"></span><div class="section" id="static-files">
<h2>Static files<a class="headerlink" href="#static-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="serve-static-files-on-disk">
<h3>Serve static files on disk<a class="headerlink" href="#serve-static-files-on-disk" title="Permalink to this headline">¶</a></h3>
<p>Project directory layout:</p>
<div class="highlight-python"><div class="highlight"><pre>config
public
  favicon.ico
  robots.txt
  404.html
  500.html
  img
    myimage.png
  css
    mystyle.css
  js
    myscript.js
src
build.sbt
</pre></div>
</div>
<p>Xitrum automatically serves static files inside <code class="docutils literal"><span class="pre">public</span></code> directory.
URLs to them are in the form:</p>
<div class="highlight-python"><div class="highlight"><pre>/img/myimage.png
/css/mystyle.css
/css/mystyle.min.css
</pre></div>
</div>
<p>To refer to them:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;img src={publicUrl(&quot;img/myimage.png&quot;)} /&gt;
</pre></div>
</div>
<p>To serve normal file in development environment and its minimized version in
production environment (mystyle.css and mystyle.min.css as above):</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;img src={publicUrl(&quot;css&quot;, &quot;mystyle.css&quot;, &quot;mystyle.min.css&quot;)} /&gt;
</pre></div>
</div>
<p>To send a static file on disk from your action, use <code class="docutils literal"><span class="pre">respondFile</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">respondFile</span><span class="p">(</span><span class="s">&quot;/absolute/path&quot;</span><span class="p">)</span>
<span class="n">respondFile</span><span class="p">(</span><span class="s">&quot;path/relative/to/the/current/working/directory&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To optimize static file serving speed,
you can avoid unnecessary file existence check with regex filter.
If request url does not match pathRegex, Xitrum will respond 404 for that request.</p>
<p>See <code class="docutils literal"><span class="pre">pathRegex</span></code> in <code class="docutils literal"><span class="pre">config/xitrum.conf</span></code>.</p>
</div>
<div class="section" id="index-html-fallback">
<h3>index.html fallback<a class="headerlink" href="#index-html-fallback" title="Permalink to this headline">¶</a></h3>
<p>If there&#8217;s no route (no action) for URL <code class="docutils literal"><span class="pre">/foo/bar</span></code> (or <code class="docutils literal"><span class="pre">/foo/bar/</span></code>),
Xitrum will try to look for static file <code class="docutils literal"><span class="pre">public/foo/bar/index.html</span></code>
(in the &#8220;public&#8221; directory). If the file exists, Xitrum will respond it
to the client.</p>
</div>
<div class="section" id="and-500">
<h3>404 and 500<a class="headerlink" href="#and-500" title="Permalink to this headline">¶</a></h3>
<p>404.html and 500.html in <code class="docutils literal"><span class="pre">public</span></code> directory are used when there&#8217;s no matching
route and there&#8217;s error processing request, respectively. If you want to use
your own error handler:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.annotation.{Error404, Error500}

@Error404
class My404ErrorHandlerAction extends Action {
  def execute() {
    if (isAjax)
      jsRespond(&quot;alert(&quot; + jsEscape(&quot;Not Found&quot;) + &quot;)&quot;)
    else
      renderInlineView(&quot;Not Found&quot;)
  }
}

@Error500
class My500ErrorHandlerAction extends Action {
  def execute() {
    if (isAjax)
      jsRespond(&quot;alert(&quot; + jsEscape(&quot;Internal Server Error&quot;) + &quot;)&quot;)
    else
      renderInlineView(&quot;Internal Server Error&quot;)
  }
}
</pre></div>
</div>
<p>Response status is set to 404 or 500 before the actions are executed, so you
don&#8217;t have to set yourself.</p>
</div>
<div class="section" id="serve-resource-files-in-classpath-with-webjars-convention">
<h3>Serve resource files in classpath with WebJars convention<a class="headerlink" href="#serve-resource-files-in-classpath-with-webjars-convention" title="Permalink to this headline">¶</a></h3>
<div class="section" id="webjars">
<h4>WebJars<a class="headerlink" href="#webjars" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://www.webjars.org/">WebJars</a> provides a lot of web libraries that you can
declare as a dependency in your project.</p>
<p>For example, if you want to use <a class="reference external" href="http://underscorejs.org/">Underscore.js</a>,
declare in your project&#8217;s <code class="docutils literal"><span class="pre">build.sbt</span></code> like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;org.webjars&quot;</span> <span class="o">%</span> <span class="s">&quot;underscorejs&quot;</span> <span class="o">%</span> <span class="s">&quot;1.6.0-3&quot;</span>
</pre></div>
</div>
<p>Then in your .jade template file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">script</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="p">{</span><span class="n">webJarsUrl</span><span class="p">(</span><span class="s">&quot;underscorejs/1.6.0&quot;</span><span class="p">,</span> <span class="s">&quot;underscore.js&quot;</span><span class="p">,</span> <span class="s">&quot;underscore-min.js&quot;</span><span class="p">)})</span>
</pre></div>
</div>
<p>Xitrum will automatically use <code class="docutils literal"><span class="pre">underscore.js</span></code> for development environment and
<code class="docutils literal"><span class="pre">underscore-min.js</span></code> for production environment.</p>
<p>The result will look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>/webjars/underscorejs/1.6.0/underscore.js?XOKgP8_KIpqz9yUqZ1aVzw
</pre></div>
</div>
<p>If you want to use the same file for both environments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">script</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="p">{</span><span class="n">webJarsUrl</span><span class="p">(</span><span class="s">&quot;underscorejs/1.6.0/underscore.js&quot;</span><span class="p">)})</span>
</pre></div>
</div>
<p>Dependencies of a dependency are automatically downloaded. If you see that the
version you want is not selected (you can confirm by running <code class="docutils literal"><span class="pre">sbt</span> <span class="pre">xitrum-package</span></code>
and see files in the created directory <code class="docutils literal"><span class="pre">target/xitrum/lib</span></code>), you can force it with
<code class="docutils literal"><span class="pre">dependencyOverrides</span></code>. For example, if you see that jQuery 2.x is selected,
but you want to support Internet Explorer 6, 7, or 8, you need to force jQuery 1.x
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dependencyOverrides</span> <span class="o">+=</span> <span class="s">&quot;org.webjars&quot;</span> <span class="o">%</span> <span class="s">&quot;jquery&quot;</span> <span class="o">%</span> <span class="s">&quot;1.11.3&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="save-resource-file-inside-jar-file-with-webjars-convention">
<h4>Save resource file inside .jar file with WebJars convention<a class="headerlink" href="#save-resource-file-inside-jar-file-with-webjars-convention" title="Permalink to this headline">¶</a></h4>
<p>If you are a library developer and want to serve myimage.png from your library,
which is a .jar file in classpath, save myimage.png in your .jar file with
<a class="reference external" href="http://www.webjars.org/">WebJars</a> convention, example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">META</span><span class="o">-</span><span class="n">INF</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">webjars</span><span class="o">/</span><span class="n">mylib</span><span class="o">/</span><span class="mf">1.0</span><span class="o">/</span><span class="n">myimage</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<p>To serve it:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;img src={webJarsUrl(&quot;mylib/1.0/myimage.png&quot;)} /&gt;
</pre></div>
</div>
<p>In both development and production environments, the URL will be:</p>
<div class="highlight-python"><div class="highlight"><pre>/webjars/mylib/1.0/myimage.png?xyz123
</pre></div>
</div>
</div>
<div class="section" id="respond-a-file-in-classpath">
<h4>Respond a file in classpath<a class="headerlink" href="#respond-a-file-in-classpath" title="Permalink to this headline">¶</a></h4>
<p>To respond a file inside an classpath element (a .jar file or a directory), even
when the file is not saved with <a class="reference external" href="http://www.webjars.org/">WebJars</a> convention:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">respondResource</span><span class="p">(</span><span class="s">&quot;path/relative/to/the/classpath/element&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Ex:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">respondResource</span><span class="p">(</span><span class="s">&quot;akka/actor/Actor.class&quot;</span><span class="p">)</span>
<span class="n">respondResource</span><span class="p">(</span><span class="s">&quot;META-INF/resources/webjars/underscorejs/1.6.0/underscore.js&quot;</span><span class="p">)</span>
<span class="n">respondResource</span><span class="p">(</span><span class="s">&quot;META-INF/resources/webjars/underscorejs/1.6.0/underscore-min.js&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="client-side-cache-with-etag-and-max-age">
<h3>Client side cache with ETag and max-age<a class="headerlink" href="#client-side-cache-with-etag-and-max-age" title="Permalink to this headline">¶</a></h3>
<p>Xitrum automatically adds <a class="reference external" href="http://en.wikipedia.org/wiki/HTTP_ETag">Etag</a> for
static files on disk and in classpath.</p>
<p>ETags for small files are MD5 of file content. They are cached for later use.
Keys of cache entries are <code class="docutils literal"><span class="pre">(file</span> <span class="pre">path,</span> <span class="pre">modified</span> <span class="pre">time)</span></code>. Because modified time
on different servers may differ, each web server in a cluster has its own local
ETag cache.</p>
<p>For big files, only modified time is used as ETag. This is not perfect because not
identical file on different servers may have different ETag, but it is still better
than no ETag at all.</p>
<p><code class="docutils literal"><span class="pre">publicUrl</span></code> and <code class="docutils literal"><span class="pre">webJarsUrl</span></code> automatically add ETag to the URLs they
generate. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>webJarsUrl(&quot;jquery/2.1.1/jquery.min.js&quot;)
=&gt; /webjars/jquery/2.1.1/jquery.min.js?0CHJg71ucpG0OlzB-y6-mQ
</pre></div>
</div>
<p>Xitrum also sets <code class="docutils literal"><span class="pre">max-age</span></code> and <code class="docutils literal"><span class="pre">Expires</span></code> headers to
<a class="reference external" href="https://developers.google.com/speed/docs/best-practices/caching">one year</a>.
Don&#8217;t worry that browsers do not pickup a latest file when you change it.
Because when a file on disk changes, its <code class="docutils literal"><span class="pre">modified</span> <span class="pre">time</span></code> changes, thus the URLs
generated by <code class="docutils literal"><span class="pre">publicUrl</span></code> and <code class="docutils literal"><span class="pre">webJarsUrl</span></code> also change. Its ETag cache
is also updated because the cache key changes.</p>
</div>
<div class="section" id="gzip">
<h3>GZIP<a class="headerlink" href="#gzip" title="Permalink to this headline">¶</a></h3>
<p>Xitrum automatically gzips textual responses. It checks the <code class="docutils literal"><span class="pre">Content-Type</span></code>
header to determine if a response is textual: <code class="docutils literal"><span class="pre">text/html</span></code>, <code class="docutils literal"><span class="pre">xml/application</span></code> etc.</p>
<p>Xitrum always gzips static textual files, but for dynamic textual responses,
for overall performance reason it does not gzips response smaller than 1 KB.</p>
</div>
<div class="section" id="server-side-cache">
<h3>Server side cache<a class="headerlink" href="#server-side-cache" title="Permalink to this headline">¶</a></h3>
<p>To avoid loading files from disk, Xitrum caches small static files
(not only textual) in memory with LRU (Least Recently Used) expiration.
See <code class="docutils literal"><span class="pre">small_static_file_size_in_kb</span></code> and <code class="docutils literal"><span class="pre">max_cached_small_static_files</span></code>
in <code class="docutils literal"><span class="pre">config/xitrum.conf</span></code>.</p>
</div>
</div>
<span id="document-flash"></span><div class="section" id="serve-flash-socket-policy-file">
<h2>Serve flash socket policy file<a class="headerlink" href="#serve-flash-socket-policy-file" title="Permalink to this headline">¶</a></h2>
<p>Read about flash socket policy:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.adobe.com/devnet/flashplayer/articles/socket_policy_files.html">http://www.adobe.com/devnet/flashplayer/articles/socket_policy_files.html</a></li>
<li><a class="reference external" href="http://www.lightsphere.com/dev/articles/flash_socket_policy.html">http://www.lightsphere.com/dev/articles/flash_socket_policy.html</a></li>
</ul>
<p>The protocol to serve flash socket policy file is different from HTTP.
To serve:</p>
<ol class="arabic simple">
<li>Modify <a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/config/flash_socket_policy.xml">config/flash_socket_policy.xml</a> appropriately</li>
<li>Modify <a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/config/xitrum.conf">config/xitrum.conf</a> to enable serving the above file</li>
</ol>
</div>
<span id="document-scopes"></span><div class="section" id="scopes">
<h2>Scopes<a class="headerlink" href="#scopes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="request">
<h3>Request<a class="headerlink" href="#request" title="Permalink to this headline">¶</a></h3>
<div class="section" id="kinds-of-params">
<h4>Kinds of params<a class="headerlink" href="#kinds-of-params" title="Permalink to this headline">¶</a></h4>
<p>There are 2 kinds of request params: textual params and file upload params (binary).</p>
<p>There are 3 kinds of textual params, of type <code class="docutils literal"><span class="pre">scala.collection.mutable.Map[String,</span> <span class="pre">Seq[String]]</span></code>:</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">queryParams</span></code>: params after the ? mark in the URL, example: <a class="reference external" href="http://example.com/blah?x=1&amp;y=2">http://example.com/blah?x=1&amp;y=2</a></li>
<li><code class="docutils literal"><span class="pre">bodyTextParams</span></code>: params in POST request body</li>
<li><code class="docutils literal"><span class="pre">pathParams</span></code>: params embedded in the URL, example: <code class="docutils literal"><span class="pre">GET(&quot;articles/:id/:title&quot;)</span></code></li>
</ol>
<p>These params are merged in the above order as <code class="docutils literal"><span class="pre">textParams</span></code>
(from 1 to 3, the latter will override the former).</p>
<p><code class="docutils literal"><span class="pre">bodyFileParams</span></code> is of type scala.collection.mutable.Map[String, Seq[<a class="reference external" href="http://netty.io/4.0/api/io/netty/handler/codec/http/multipart/FileUpload.html">FileUpload</a>]].</p>
</div>
<div class="section" id="accesing-params">
<h4>Accesing params<a class="headerlink" href="#accesing-params" title="Permalink to this headline">¶</a></h4>
<p>From an action, you can access the above params directly, or you can use
accessor methods.</p>
<p>To access <code class="docutils literal"><span class="pre">textParams</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">param(&quot;x&quot;)</span></code>: returns <code class="docutils literal"><span class="pre">String</span></code>, throws exception if x does not exist</li>
<li><code class="docutils literal"><span class="pre">paramo(&quot;x&quot;)</span></code>: returns <code class="docutils literal"><span class="pre">Option[String]</span></code></li>
<li><code class="docutils literal"><span class="pre">params(&quot;x&quot;)</span></code>: returns <code class="docutils literal"><span class="pre">Seq[String]</span></code>, Seq.empty if x does not exist</li>
</ul>
<p>You can convert text params to other types (Int, Long, Fload, Double) automatically
by using <code class="docutils literal"><span class="pre">param[Int](&quot;x&quot;)</span></code>, <code class="docutils literal"><span class="pre">params[Int](&quot;x&quot;)</span></code> etc. To convert text params to more types,
override <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala-2.11/xitrum/scope/request/ParamAccess.scala">convertTextParam</a>.</p>
<p>For file upload: <code class="docutils literal"><span class="pre">param[FileUpload](&quot;x&quot;)</span></code>, <code class="docutils literal"><span class="pre">params[FileUpload](&quot;x&quot;)</span></code> etc.
For more details, see <a class="reference internal" href="index.html#document-upload"><em>Upload chapter</em></a>.</p>
</div>
<div class="section" id="at">
<h4>&#8220;at&#8221;<a class="headerlink" href="#at" title="Permalink to this headline">¶</a></h4>
<p>To pass things around when processing a request (e.g. from action to view or layout)
you can use <code class="docutils literal"><span class="pre">at</span></code>. <code class="docutils literal"><span class="pre">at</span></code> type is <code class="docutils literal"><span class="pre">scala.collection.mutable.HashMap[String,</span> <span class="pre">Any]</span></code>.
If you know Rails, you&#8217;ll see <code class="docutils literal"><span class="pre">at</span></code> is a clone of <code class="docutils literal"><span class="pre">&#64;</span></code> of Rails.</p>
<p>Articles.scala</p>
<div class="highlight-python"><div class="highlight"><pre>@GET(&quot;articles/:id&quot;)
class ArticlesShow extends AppAction {
  def execute() {
    val (title, body) = ...  // Get from DB
    at(&quot;title&quot;) = title
    respondInlineView(body)
  }
}
</pre></div>
</div>
<p>AppAction.scala</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.view.DocType

trait AppAction extends Action {
  override def layout = DocType.html5(
    &lt;html&gt;
      &lt;head&gt;
        {antiCsrfMeta}
        {xitrumCss}
        {jsDefaults}
        &lt;title&gt;{if (at.isDefinedAt(&quot;title&quot;)) &quot;My Site - &quot; + at(&quot;title&quot;) else &quot;My Site&quot;}&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        {renderedView}
        {jsForView}
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</pre></div>
</div>
</div>
<div class="section" id="atjson">
<h4>&#8220;atJson&#8221;<a class="headerlink" href="#atjson" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">atJson</span></code> helper method automatically converts <code class="docutils literal"><span class="pre">at(&quot;key&quot;)</span></code> to JSON.
It is useful when you need to pass model from Scala to JavaScript.</p>
<p><code class="docutils literal"><span class="pre">atJson(&quot;key&quot;)</span></code> is equivalent to <code class="docutils literal"><span class="pre">xitrum.util.SeriDeseri.toJson(at(&quot;key&quot;))</span></code>:</p>
<p>Action.scala</p>
<div class="highlight-python"><div class="highlight"><pre>case class User(login: String, name: String)

...

def execute() {
  at(&quot;user&quot;) = User(&quot;admin&quot;, &quot;Admin&quot;)
  respondView()
}
</pre></div>
</div>
<p>Action.ssp</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;script type=&quot;text/javascript&quot;&gt;
  var user = ${atJson(&quot;user&quot;)};
  alert(user.login);
  alert(user.name);
&lt;/script&gt;
</pre></div>
</div>
</div>
<div class="section" id="requestvar">
<h4>RequestVar<a class="headerlink" href="#requestvar" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">at</span></code> in the above section is not typesafe because you can set anything to the
map. To be more typesafe, you should use RequestVar, which is a wrapper arround
<code class="docutils literal"><span class="pre">at</span></code>.</p>
<p>RVar.scala</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.RequestVar

object RVar {
  object title extends RequestVar[String]
}
</pre></div>
</div>
<p>Articles.scala</p>
<div class="highlight-python"><div class="highlight"><pre>@GET(&quot;articles/:id&quot;)
class ArticlesShow extends AppAction {
  def execute() {
    val (title, body) = ...  // Get from DB
    RVar.title.set(title)
    respondInlineView(body)
  }
}
</pre></div>
</div>
<p>AppAction.scala</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.view.DocType

trait AppAction extends Action {
  override def layout = DocType.html5(
    &lt;html&gt;
      &lt;head&gt;
        {antiCsrfMeta}
        {xitrumCss}
        {jsDefaults}
        &lt;title&gt;{if (RVar.title.isDefined) &quot;My Site - &quot; + RVar.title.get else &quot;My Site&quot;}&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        {renderedView}
        {jsForView}
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="cookie">
<h3>Cookie<a class="headerlink" href="#cookie" title="Permalink to this headline">¶</a></h3>
<p>Read Wikipedia about <a class="reference external" href="http://en.wikipedia.org/wiki/HTTP_cookie">cookies</a>.</p>
<p>Inside an action, use <code class="docutils literal"><span class="pre">requestCookies</span></code>, a <code class="docutils literal"><span class="pre">Map[String,</span> <span class="pre">String]</span></code>, to read cookies sent by browser.</p>
<div class="highlight-python"><div class="highlight"><pre>requestCookies.get(&quot;myCookie&quot;) match {
  case None         =&gt; ...
  case Some(string) =&gt; ...
}
</pre></div>
</div>
<p>To send cookie to browser, create an instance of <a class="reference external" href="http://netty.io/4.0/api/io/netty/handler/codec/http/DefaultCookie.html">DefaultCookie</a>
and append it to <code class="docutils literal"><span class="pre">responseCookies</span></code>, an <code class="docutils literal"><span class="pre">ArrayBuffer</span></code> that contains <a class="reference external" href="http://netty.io/4.0/api/io/netty/handler/codec/http/Cookie.html">Cookie</a>.</p>
<div class="highlight-python"><div class="highlight"><pre>val cookie = new DefaultCookie(&quot;name&quot;, &quot;value&quot;)
cookie.setHttpOnly(true)  // true: JavaScript cannot access this cookie
responseCookies.append(cookie)
</pre></div>
</div>
<p>If you don&#8217;t set cookie&#8217;s path by calling <code class="docutils literal"><span class="pre">cookie.setPath(cookiePath)</span></code>, its
path will be set to the site&#8217;s root path (<code class="docutils literal"><span class="pre">xitrum.Config.withBaseUrl(&quot;/&quot;)</span></code>).
This avoids accidental duplicate cookies.</p>
<p>To delete a cookie sent by browser, send a cookie with the same name and set
its max age to 0. The browser will expire it immediately. To tell browser to
delete cookie when the browser closes windows, set max age to <code class="docutils literal"><span class="pre">Long.MinValue</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cookie</span><span class="o">.</span><span class="n">setMaxAge</span><span class="p">(</span><span class="n">Long</span><span class="o">.</span><span class="n">MinValue</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="http://mrcoles.com/blog/cookies-max-age-vs-expires/">Internet Explorer does not support &#8220;max-age&#8221;</a>,
but Netty detects and outputs either &#8220;max-age&#8221; or &#8220;expires&#8221; properly. Don&#8217;t worry!</p>
<p>Browsers will not send cookie attributes back to the server. They will
<a class="reference external" href="http://en.wikipedia.org/wiki/HTTP_cookie#Cookie_attributes">only send the cookie name-value pairs</a>.</p>
<p>If you want to sign your cookie value to prevent user from tampering, use
<code class="docutils literal"><span class="pre">xitrum.util.SeriDeseri.toSecureUrlSafeBase64</span></code> and <code class="docutils literal"><span class="pre">xitrum.util.SeriDeseri.fromSecureUrlSafeBase64</span></code>.
For more information, see <a class="reference internal" href="index.html#document-howto"><em>How to encrypt data</em></a>.</p>
<div class="section" id="allowed-characters-in-cookie">
<h4>Allowed characters in cookie<a class="headerlink" href="#allowed-characters-in-cookie" title="Permalink to this headline">¶</a></h4>
<p>You cannot use <a class="reference external" href="http://stackoverflow.com/questions/1969232/allowed-characters-in-cookies">arbitrary characters in cookie</a>.
For example, if you need to use UTF-8 characters, you need to encode them.
You can use <code class="docutils literal"><span class="pre">xitrum.utill.UrlSafeBase64</span></code> or <code class="docutils literal"><span class="pre">xitrum.util.SeriDeseri</span></code>.</p>
<p>Write cookie example:</p>
<div class="highlight-python"><div class="highlight"><pre>import io.netty.util.CharsetUtil
import xitrum.util.UrlSafeBase64

val value   = &quot;&quot;&quot;{&quot;identity&quot;:&quot;example@gmail.com&quot;,&quot;first_name&quot;:&quot;Alexander&quot;}&quot;&quot;&quot;
val encoded = UrlSafeBase64.noPaddingEncode(value.getBytes(CharsetUtil.UTF_8))
val cookie  = new DefaultCookie(&quot;profile&quot;, encoded)
responseCookies.append(cookie)
</pre></div>
</div>
<p>Read cookie example:</p>
<div class="highlight-python"><div class="highlight"><pre>requestCookies.get(&quot;profile&quot;).foreach { encoded =&gt;
  UrlSafeBase64.autoPaddingDecode(encoded).foreach { bytes =&gt;
    val value = new String(bytes, CharsetUtil.UTF_8)
    println(&quot;profile: &quot; + value)
  }
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="session">
<h3>Session<a class="headerlink" href="#session" title="Permalink to this headline">¶</a></h3>
<p>Session storing, restoring, encrypting etc. is done automatically by Xitrum.
You don&#8217;t have to mess with them.</p>
<p>In your actions, you can use <code class="docutils literal"><span class="pre">session</span></code>. It is an instance of
<code class="docutils literal"><span class="pre">scala.collection.mutable.Map[String,</span> <span class="pre">Any]</span></code>. Things in <code class="docutils literal"><span class="pre">session</span></code> must be
serializable.</p>
<p>For example, to mark that a user has logged in, you can set his username into the
session:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">session</span><span class="p">(</span><span class="s">&quot;userId&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">userId</span>
</pre></div>
</div>
<p>Later, if you want to check if a user has logged in or not, just check if
there&#8217;s a username in his session:</p>
<div class="highlight-python"><div class="highlight"><pre>if (session.isDefinedAt(&quot;userId&quot;)) println(&quot;This user has logged in&quot;)
</pre></div>
</div>
<p>Storing user ID and pull the user from database on each access is usually a good
practice. That way changes to the user are updated on each access (including
changes to user roles/authorizations).</p>
<div class="section" id="session-clear">
<h4>session.clear()<a class="headerlink" href="#session-clear" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://guides.rubyonrails.org/security.html#session-fixation">One line of code will protect you from session fixation</a>.</p>
<p>Read the link above to know about session fixation. To prevent session fixation
attack, in the action that lets users login, call <code class="docutils literal"><span class="pre">session.clear()</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre>@GET(&quot;login&quot;)
class LoginAction extends Action {
  def execute() {
    ...
    session.clear()  // Reset first before doing anything else with the session
    session(&quot;userId&quot;) = userId
  }
}
</pre></div>
</div>
<p>To log users out, also call <code class="docutils literal"><span class="pre">session.clear()</span></code>.</p>
</div>
<div class="section" id="sessionvar">
<h4>SessionVar<a class="headerlink" href="#sessionvar" title="Permalink to this headline">¶</a></h4>
<p>SessionVar, like RequestVar, is a way to make your session more typesafe.</p>
<p>For example, you want save username to session after the user has logged in:</p>
<p>Declare the session var:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.SessionVar

object SVar {
  object username extends SessionVar[String]
}
</pre></div>
</div>
<p>After login success:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">SVar</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
<p>Display the username:</p>
<div class="highlight-python"><div class="highlight"><pre>if (SVar.username.isDefined)
  &lt;em&gt;{SVar.username.get}&lt;/em&gt;
else
  &lt;a href={url[LoginAction]}&gt;Login&lt;/a&gt;
</pre></div>
</div>
<ul class="simple">
<li>To remove the session var: <code class="docutils literal"><span class="pre">SVar.username.remove()</span></code></li>
<li>To reset the whole session: <code class="docutils literal"><span class="pre">session.clear()</span></code></li>
</ul>
</div>
<div class="section" id="session-stores">
<h4>Session stores<a class="headerlink" href="#session-stores" title="Permalink to this headline">¶</a></h4>
<p>Xitrum provides 3 session stores.
In <a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/config/xitrum.conf">config/xitrum.conf</a>
you can config the session store you want:</p>
<p>CookieSessionStore:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Store sessions on client side</span>
<span class="n">store</span> <span class="o">=</span> <span class="n">xitrum</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">CookieSessionStore</span>
</pre></div>
</div>
<p>LruSessionStore:</p>
<div class="highlight-python"><div class="highlight"><pre># Simple in-memory server side session store
store {
  &quot;xitrum.local.LruSessionStore&quot; {
    maxElems = 10000
  }
}
</pre></div>
</div>
<p>If you run multiple servers in a cluster, you can
<a class="reference external" href="https://github.com/xitrum-framework/xitrum-hazelcast">use Hazelcast to store cluster-aware sessions</a>,</p>
<p>Note that when you use CookieSessionStore or Hazelcast, your session data must be
serializable. If you must store unserializable things, use LruSessionStore.
If you use LruSessionStore and still want to run a cluster of multiple servers,
you must use a load balancer that supports sticky sessions.</p>
<p>The three default session stores above are enough for normal cases.
If you have a special case and want to implement your own session store,
extend
<a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/scope/session/SessionStore.scala">SessionStore</a>
or
<a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/scope/session/ServerSessionStore.scala">ServerSessionStore</a>
and implement the abstract methods.</p>
<p>The config can be in one of the following 2 forms:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">store</span> <span class="o">=</span> <span class="n">my</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">StoreClassName</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-python"><div class="highlight"><pre>store {
  &quot;my.session.StoreClassName&quot; {
    option1 = value1
    option2 = value2
  }
}
</pre></div>
</div>
<p>Store sessions at client side cookie when you can (serializable and
<a class="reference external" href="http://stackoverflow.com/questions/640938/what-is-the-maximum-size-of-a-web-browsers-cookies-key">smaller than 4KB</a>),
because it&#8217;s more scalable.
Store sessions at server side (memory or DB) when you must.</p>
<p>Good read:
<a class="reference external" href="http://www.technicalinfo.net/papers/WebBasedSessionManagement.html">Web Based Session Management - Best practices in managing HTTP-based client sessions</a>.</p>
</div>
<div class="section" id="client-side-session-store-vs-server-side-session-store">
<h4>Client side session store vs Server side session store<a class="headerlink" href="#client-side-session-store-vs-server-side-session-store" title="Permalink to this headline">¶</a></h4>
<p>There are 2 kinds of session stores:</p>
<ul class="simple">
<li>Client side only</li>
<li>Client side + server side combination</li>
</ul>
<p>Client side only:</p>
<ul class="simple">
<li>Session data is stored in encrypted cookie at client.</li>
<li>The server doesn&#8217;t need to store anything.</li>
<li>When a request comes in, the server will decrypt the data.</li>
</ul>
<p>Client side + server side combination:</p>
<ul class="simple">
<li>A session has 2 parts: session ID and session data.</li>
<li>The server keeps the session store, which is like a lookup table: ID -&gt; data.</li>
<li>The ID is also stored in encrypted cookie at client.</li>
<li>When a request comes in, the server will decrypt the ID, and use the ID to
lookup the data.</li>
<li>This is like your credit card. Your money is not stored in the credit card,
only your ID.</li>
</ul>
<p>In both cases the client must always keep something in the cookie
(encrypted data vs encrypted ID). &#8220;Store sessions at server side&#8221; only means
storing session data at server side.</p>
</div>
</div>
<div class="section" id="object-vs-val">
<h3>object vs. val<a class="headerlink" href="#object-vs-val" title="Permalink to this headline">¶</a></h3>
<p>Please use <code class="docutils literal"><span class="pre">object</span></code> instead of <code class="docutils literal"><span class="pre">val</span></code>.</p>
<p><strong>Do not do like this</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>object RVar {
  val title    = new RequestVar[String]
  val category = new RequestVar[String]
}

object SVar {
  val username = new SessionVar[String]
  val isAdmin  = new SessionVar[Boolean]
}
</pre></div>
</div>
<p>The above code compiles but does not work correctly, because the Vars internally
use class names to do look up. When using <code class="docutils literal"><span class="pre">val</span></code>, <code class="docutils literal"><span class="pre">title</span></code> and <code class="docutils literal"><span class="pre">category</span></code>
will have the same class name &#8220;xitrum.RequestVar&#8221;. The same for <code class="docutils literal"><span class="pre">username</span></code>
and <code class="docutils literal"><span class="pre">isAdmin</span></code>.</p>
</div>
</div>
<span id="document-validation"></span><div class="section" id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h2>
<p>Xitrum includes <a class="reference external" href="http://bassistance.de/jquery-plugins/jquery-plugin-validation/">jQuery Validation plugin</a>
for validation at client side and provides validation helpers for server side.</p>
<div class="section" id="default-validators">
<h3>Default validators<a class="headerlink" href="#default-validators" title="Permalink to this headline">¶</a></h3>
<p>Xitrum provides validators in <code class="docutils literal"><span class="pre">xitrum.validator</span></code> package.
They have these methods:</p>
<div class="highlight-python"><div class="highlight"><pre>check(value): Boolean
message(name, value): Option[String]
exception(name, value)
</pre></div>
</div>
<p>If the validation check does not pass, <code class="docutils literal"><span class="pre">message</span></code> will return <code class="docutils literal"><span class="pre">Some(error</span> <span class="pre">message)</span></code>,
<code class="docutils literal"><span class="pre">exception</span></code> will throw <code class="docutils literal"><span class="pre">xitrum.exception.InvalidInput(error</span> <span class="pre">message)</span></code>.</p>
<p>You can use validators anywhere you want.</p>
<p>Action example:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.validator.Required

@POST(&quot;articles&quot;)
class CreateArticle {
  def execute() {
    val title = param(&quot;tite&quot;)
    val body  = param(&quot;body&quot;)
    Required.exception(&quot;Title&quot;, title)
    Required.exception(&quot;Body&quot;,  body)

    // Do with the valid title and body...
  }
}
</pre></div>
</div>
<p>If you don&#8217;t <code class="docutils literal"><span class="pre">try</span></code> and <code class="docutils literal"><span class="pre">catch</span></code>, when the validation check does not pass,
Xitrum will automatically catch the exception and respond the error message to
the requesting client. This is convenient when writing web APIs or when you
already have validation at the client side.</p>
<p>Model example:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.validator.Required

case class Article(id: Int = 0, title: String = &quot;&quot;, body: String = &quot;&quot;) {
  def isValid           = Required.check(title)   &amp;&amp;     Required.check(body)
  def validationMessage = Required.message(title) orElse Required.message(body)
}
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/xitrum-framework/xitrum/tree/master/src/main/scala/xitrum/validator">xitrum.validator pakage</a>
for the full list of default validators.</p>
</div>
<div class="section" id="write-custom-validators">
<h3>Write custom validators<a class="headerlink" href="#write-custom-validators" title="Permalink to this headline">¶</a></h3>
<p>Extend <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/validator/Validator.scala">xitrum.validator.Validator</a>.
You only have to implement <code class="docutils literal"><span class="pre">check</span></code> and <code class="docutils literal"><span class="pre">message</span></code> method.</p>
<p>You can also use <a class="reference external" href="http://commons.apache.org/proper/commons-validator/">Commons Validator</a>.</p>
</div>
</div>
<span id="document-upload"></span><div class="section" id="file-upload">
<h2>File upload<a class="headerlink" href="#file-upload" title="Permalink to this headline">¶</a></h2>
<p>See also <a class="reference internal" href="index.html#document-scopes"><em>Scopes chapter</em></a>.</p>
<p>In your upload form, remember to set <code class="docutils literal"><span class="pre">enctype</span></code> to <code class="docutils literal"><span class="pre">multipart/form-data</span></code>.</p>
<p>MyUpload.scalate:</p>
<div class="highlight-python"><div class="highlight"><pre>form(method=&quot;post&quot; action={url[MyUpload]} enctype=&quot;multipart/form-data&quot;)
  != antiCsrfInput

  label Please select a file:
  input(type=&quot;file&quot; name=&quot;myFile&quot;)

  button(type=&quot;submit&quot;) Upload
</pre></div>
</div>
<p>In <code class="docutils literal"><span class="pre">MyUpload</span></code> action:</p>
<div class="highlight-python"><div class="highlight"><pre>import io.netty.handler.codec.http.multipart.FileUpload

val myFile = param[FileUpload](&quot;myFile&quot;)
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">myFile</span></code> is an instance of <a class="reference external" href="http://netty.io/4.0/api/io/netty/handler/codec/http/multipart/FileUpload.html">FileUpload</a>.
Use its methods to get file name, move file to a directory etc.</p>
<p>Small files (less than 16 KB) will be saved in memory. Big files will be saved
in the system temporary directory (or the directory specified by
<code class="docutils literal"><span class="pre">xitrum.request.tmpUploadDir</span></code> in xitrum.conf), and will be deleted automatically
when the connection is closed or when the response is sent.</p>
<div class="section" id="ajax-style-upload">
<h3>Ajax style upload<a class="headerlink" href="#ajax-style-upload" title="Permalink to this headline">¶</a></h3>
<p>There are many JavaScript libraries that support Ajax style upload. They use
hidden iframe or Flash to send the <code class="docutils literal"><span class="pre">multipart/form-data</span></code> above to the server.
If you are not sure which request parameter the libraries use in the form to send
file, see Xitrum access log.</p>
</div>
</div>
<span id="document-filter"></span><div class="section" id="action-filters">
<h2>Action filters<a class="headerlink" href="#action-filters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="before-filters">
<h3>Before filters<a class="headerlink" href="#before-filters" title="Permalink to this headline">¶</a></h3>
<p>Before filters are run before an action is run.
If a before filter responds something, all filters after it and the action will
not be run.</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.annotation.GET

@GET(&quot;before_filter&quot;)
class MyAction extends Action {
  beforeFilter {
    log.info(&quot;I run therefore I am&quot;)
  }

  // This method is run after the above filters
  def execute() {
    respondInlineView(&quot;Before filters should have been run, please check the log&quot;)
  }
}
</pre></div>
</div>
</div>
<div class="section" id="after-filters">
<h3>After filters<a class="headerlink" href="#after-filters" title="Permalink to this headline">¶</a></h3>
<p>After filters are run after an action is run.
They are functions that take no argument. Their return value will be ignored.</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.annotation.GET

@GET(&quot;after_filter&quot;)
class MyAction extends Action {
  afterFilter {
    log.info(&quot;Run at &quot; + System.currentTimeMillis())
  }

  def execute() {
    respondText(&quot;After filter should have been run, please check the log&quot;)
  }
}
</pre></div>
</div>
</div>
<div class="section" id="around-filters">
<h3>Around filters<a class="headerlink" href="#around-filters" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.annotation.GET

@GET(&quot;around_filter&quot;)
class MyAction extends Action {
  aroundFilter { action =&gt;
    val begin = System.currentTimeMillis()
    action()
    val end   = System.currentTimeMillis()
    val dt    = end - begin
    log.info(s&quot;The action took $dt [ms]&quot;)
  }

  def execute() {
    respondText(&quot;Around filter should have been run, please check the log&quot;)
  }
}
</pre></div>
</div>
<p>If there are many around filters, they will be nested.</p>
</div>
<div class="section" id="execution-order-of-filters">
<h3>Execution order of filters<a class="headerlink" href="#execution-order-of-filters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Before filters are run first, then around filters, then after filters.</li>
<li>If one of the before filters returns false, the rest (including around and
after filters) will not be run.</li>
<li>After filters are always run if at least an around filter is run.</li>
<li>If an around filter decide not to call <code class="docutils literal"><span class="pre">action</span></code>, the inner nested
around filters will not be run.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>before1 -true-&gt; before2 -true-&gt; +--------------------+ --&gt; after1 --&gt; after2
                                | around1 (1 of 2)   |
                                |   around2 (1 of 2) |
                                |     action         |
                                |   around2 (2 of 2) |
                                | around1 (2 of 2)   |
                                +--------------------+
</pre></div>
</div>
</div>
</div>
<span id="document-cache"></span><div class="section" id="server-side-cache">
<h2>Server-side cache<a class="headerlink" href="#server-side-cache" title="Permalink to this headline">¶</a></h2>
<p>Also see the chaper about <a class="reference internal" href="index.html#document-cluster"><em>clustering</em></a>.</p>
<p>Xitrum provides extensive client-side and server-side caching for faster responding.
At the web server layer, small files are cached in memory, big files are sent
using NIO&#8217;s zero copy. Xitrum&#8217;s static file serving speed is
<a class="reference external" href="https://gist.github.com/3293596">similar to that of Nginx</a>.
At the web framework layer you have can declare page, action, and object cache
in the Rails style.
<a class="reference external" href="http://code.google.com/speed/page-speed/docs/rules_intro.html">All Google&#8217;s best practices</a>
like conditional GET are applied for client-side caching.</p>
<p>For dynamic content, if the content does not change after created (as if it is
a static file), you may set headers for clients to cache aggressively.
In that case, call <code class="docutils literal"><span class="pre">setClientCacheAggressively()</span></code> in your action.</p>
<p>Sometimes you may want to prevent client-side caching.
In that case, call <code class="docutils literal"><span class="pre">setNoClientCache()</span></code> in your action.</p>
<p>Server-side cache is discussed in more details below.</p>
<div class="section" id="cache-page-or-action">
<h3>Cache page or action<a class="headerlink" href="#cache-page-or-action" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action
import xitrum.annotation.{GET, CacheActionMinute, CachePageMinute}

@GET(&quot;articles&quot;)
@CachePageMinute(1)
class ArticlesIndex extends Action {
  def execute() {
    ...
  }
}

@GET(&quot;articles/:id&quot;)
@CacheActionMinute(1)
class ArticlesShow extends Action {
  def execute() {
    ...
  }
}
</pre></div>
</div>
<p>The terms &#8220;page cache&#8221; and &#8220;action cache&#8221; came from
<a class="reference external" href="http://guides.rubyonrails.org/caching_with_rails.html">Ruby on Rails</a>.</p>
<p>The order of processing a request is designed like this:
(1) request -&gt; (2) before filter methods -&gt; (3) action&#8217;s execute method -&gt; (4) response</p>
<p>At the 1st request, Xitrum will cache the response for the time period specified.
<code class="docutils literal"><span class="pre">&#64;CachePageMinute(1)</span></code> or <code class="docutils literal"><span class="pre">&#64;CacheActionMinute(1)</span></code> both mean caching for 1 minute.
Xitrum only caches when the response status is &#8220;200 OK&#8221;. For example, response
with status &#8220;500 Internal Server Error&#8221; or &#8220;302 Found&#8221; (redirect) will not be cached.</p>
<p>At the following requests to the same action, if the cached response is still
within the specified time, Xitrum will just respond the cached response:</p>
<ul class="simple">
<li>For page cache, the order is (1) -&gt; (4).</li>
<li>For action cache, the order is (1) -&gt; (2) -&gt; (4), or just (1) -&gt; (2)
if one of the before filters return &#8220;false&#8221;.</li>
</ul>
<p>So the difference is: For page cache, the before filters are not run.</p>
<p>Usually, page cache is used when the same response can be used for all users.
Action cache is used when you want to run a before filter to &#8220;guard&#8221; the cached
response, like checking if the user has logged in:</p>
<ul class="simple">
<li>If the user has logged in, he can use the cached response.</li>
<li>If the user has not logged in, redirect him to the login page.</li>
</ul>
</div>
<div class="section" id="cache-object">
<h3>Cache object<a class="headerlink" href="#cache-object" title="Permalink to this headline">¶</a></h3>
<p>You use methods in <code class="docutils literal"><span class="pre">xitrum.Config.xitrum.cache</span></code>, it&#8217;s an instance of
<a class="reference external" href="http://xitrum-framework.github.io/api/3.17/index.html#xitrum.Cache">xitrum.Cache</a>.</p>
<p>Without an explicit TTL (time to live):</p>
<ul class="simple">
<li>put(key, value)</li>
</ul>
<p>With an explicit TTL:</p>
<ul class="simple">
<li>putSecond(key, value, seconds)</li>
<li>putMinute(key, value, minutes)</li>
<li>putHour(key, value, hours)</li>
<li>putDay(key, value, days)</li>
</ul>
<p>Only if absent:</p>
<ul class="simple">
<li>putIfAbsent(key, value)</li>
<li>putIfAbsentSecond(key, value, seconds)</li>
<li>putIfAbsentMinute(key, value, minutes)</li>
<li>putIfAbsentHour(key, value, hours)</li>
<li>putIfAbsentDay(key, value, days)</li>
</ul>
</div>
<div class="section" id="remove-cache">
<h3>Remove cache<a class="headerlink" href="#remove-cache" title="Permalink to this headline">¶</a></h3>
<p>Remove page or action cache:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">removeAction</span><span class="p">[</span><span class="n">MyAction</span><span class="p">]</span>
</pre></div>
</div>
<p>Remove object cache:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
<p>Remove all keys that start with a prefix:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">removePrefix</span><span class="p">(</span><span class="n">keyPrefix</span><span class="p">)</span>
</pre></div>
</div>
<p>With <code class="docutils literal"><span class="pre">removePrefix</span></code>, you have the power to form hierarchical cache based on prefix.
For example you want to cache things related to an article, then when the article
changes, you want to remove all those things.</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Config.xitrum.cache

// Cache with a prefix
val prefix = &quot;articles/&quot; + article.id
cache.put(prefix + &quot;/likes&quot;, likes)
cache.put(prefix + &quot;/comments&quot;, comments)

// Later, when something happens and you want to remove all cache related to the article
cache.remove(prefix)
</pre></div>
</div>
</div>
<div class="section" id="config">
<h3>Config<a class="headerlink" href="#config" title="Permalink to this headline">¶</a></h3>
<p>The cache feature in Xitrum is provided by cache engines. You can choose the
engine that suits your need.</p>
<p>In <a class="reference external" href="https://github.com/xitrum-framework/xitrum-new/blob/master/config/xitrum.conf">config/xitrum.conf</a>,
you can config cache engine in one of the following 2 forms, depending on the engine you choose:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cache</span> <span class="o">=</span> <span class="n">my</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">EngineClassName</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-python"><div class="highlight"><pre>cache {
  &quot;my.cache.EngineClassName&quot; {
    option1 = value1
    option2 = value2
  }
}
</pre></div>
</div>
<p>Xitrum provides this one:</p>
<div class="highlight-python"><div class="highlight"><pre>cache {
  # Simple in-memory cache
  &quot;xitrum.local.LruCache&quot; {
    maxElems = 10000
  }
}
</pre></div>
</div>
<p>If you have a cluster of servers, you can use <a class="reference external" href="https://github.com/xitrum-framework/xitrum-hazelcast">Hazelcast</a>.</p>
<p>If you want to create your own cache engine, implement the
<a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/Cache.scala">interface</a>
<code class="docutils literal"><span class="pre">xitrum.Cache</span></code>.</p>
</div>
<div class="section" id="how-cache-works">
<h3>How cache works<a class="headerlink" href="#how-cache-works" title="Permalink to this headline">¶</a></h3>
<p>Inbound:</p>
<div class="highlight-python"><div class="highlight"><pre>               the action response
               should be cached and
request        the cache already exists?
-------------------------+---------------NO---------------&gt;
                         |
&lt;---------YES------------+
  respond from cache
</pre></div>
</div>
<p>Outbound:</p>
<div class="highlight-python"><div class="highlight"><pre>               the action response
               should be cached and
               the cache does not exist?           response
&lt;---------NO-------------+---------------------------------
                         |
&lt;---------YES------------+
  store response to cache
</pre></div>
</div>
</div>
<div class="section" id="xitrum-util-locallrucache">
<h3>xitrum.util.LocalLruCache<a class="headerlink" href="#xitrum-util-locallrucache" title="Permalink to this headline">¶</a></h3>
<p>The above cache is the cache shared by the whole system. If you only want a
small convenient cache, you can use <code class="docutils literal"><span class="pre">xitrum.util.LocalLruCache</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.util.LocalLruCache

// LRU (Least Recently Used) cache that can contain 1000 elements.
// Keys and values are both of type String.
val cache = LocalLruCache[String, String](1000)
</pre></div>
</div>
<p>The returned <code class="docutils literal"><span class="pre">cache</span></code> is a <a class="reference external" href="http://docs.oracle.com/javase/6/docs/api/java/util/LinkedHashMap.html">java.util.LinkedHashMap</a>.
You can call <code class="docutils literal"><span class="pre">LinkedHashMap</span></code> methods from it.</p>
</div>
</div>
<span id="document-i18n"></span><div class="section" id="i18n">
<h2>I18n<a class="headerlink" href="#i18n" title="Permalink to this headline">¶</a></h2>
<p>GNU gettext is used. Unlike many other i18n methods, gettext supports plural forms.</p>
<img alt="_images/poedit.png" src="_images/poedit.png" />
<div class="section" id="write-internationalized-messages-in-source-code">
<h3>Write internationalized messages in source code<a class="headerlink" href="#write-internationalized-messages-in-source-code" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">xitrum.Action</span></code> extends <code class="docutils literal"><span class="pre">xitrum.I18n</span></code>, which has these methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="p">(</span><span class="s">&quot;Message&quot;</span><span class="p">)</span>
<span class="n">tc</span><span class="p">(</span><span class="s">&quot;Context&quot;</span><span class="p">,</span> <span class="s">&quot;Message&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In a action or action, just call them.
In other places like models, you need to pass the current action to them and
call <code class="docutils literal"><span class="pre">t</span></code> and <code class="docutils literal"><span class="pre">tc</span></code> on it:</p>
<div class="highlight-python"><div class="highlight"><pre>// In an action
respondText(MyModel.hello(this))

// In the model
import xitrum.I18n
object MyModel {
  def hello(i18n: I18n) = i18n.t(&quot;Hello World&quot;)
}
</pre></div>
</div>
</div>
<div class="section" id="extract-messages-to-pot-files">
<h3>Extract messages to pot files<a class="headerlink" href="#extract-messages-to-pot-files" title="Permalink to this headline">¶</a></h3>
<p>Create an empty i18n.pot file in your project&#8217;s root directory, then recompile
the whole project.</p>
<div class="highlight-python"><div class="highlight"><pre>sbt/sbt clean
rm i18n.pot
touch i18n.pot
sbt/sbt compile
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">sbt/sbt</span> <span class="pre">clean</span></code> is to delete all .class files, forcing SBT to recompile the whole
project. Because after <code class="docutils literal"><span class="pre">sbt/sbt</span> <span class="pre">clean</span></code>, SBT will try to redownload all <a class="reference internal" href="index.html#document-deps"><em>dependencies</em></a>,
you can do a little faster with the command <code class="docutils literal"><span class="pre">find</span> <span class="pre">target</span> <span class="pre">-name</span> <span class="pre">*.class</span> <span class="pre">-delete</span></code>,
which deletes all .class files in the <code class="docutils literal"><span class="pre">target</span></code> directory.</p>
<p>After the recompilation, i18n.pot will be filled with gettext messages extracted
from the source code. To do this magic, <a class="reference external" href="http://www.scala-lang.org/node/140">Scala compiler plugin technique</a>
is used.</p>
<p>One caveat of this method is that only gettext messages in Scala source code
files are extracted. If you have Java files, you may want to extract manually
using <code class="docutils literal"><span class="pre">xgettext</span></code> command line:</p>
<div class="highlight-python"><div class="highlight"><pre>xgettext -kt -ktc:1c,2 -ktn:1,2 -ktcn:1c,2,3 -o i18n_java.pot --from-code=UTF-8 $(find src/main/java -name &quot;*.java&quot;)
</pre></div>
</div>
<p>Then you manually merge i18n_java.pot to i18n.pot.</p>
</div>
<div class="section" id="where-to-save-po-files">
<h3>Where to save po files<a class="headerlink" href="#where-to-save-po-files" title="Permalink to this headline">¶</a></h3>
<p>i18n.pot is the template file. You need to copy it to &lt;language&gt;.po files and
translate.</p>
<p>Xitrum monitors directories named <code class="docutils literal"><span class="pre">i18n</span></code> in classpath.
If a &lt;language&gt;.po file in that directory is updated or added at runtime,
Xitrum will automatically reload that &lt;language&gt;.po file.</p>
<div class="highlight-python"><div class="highlight"><pre>src
  main
    scala
    view
    resources
      i18n
        ja.po
        vi.po
        ...
</pre></div>
</div>
<p>Use a tool like <a class="reference external" href="http://www.poedit.net/">Poedit</a> to edit po files.
You can use it to merge newly created pot file to existing po files.</p>
<img alt="_images/update_from_pot.png" src="_images/update_from_pot.png" />
<p>You can package po files in multiple JAR files. Xitrum will automatically merge
them when running.</p>
<div class="highlight-python"><div class="highlight"><pre>mylib.jar
  i18n
    ja.po
    vi.po
        ...

another.jar
  i18n
    ja.po
    vi.po
        ...
</pre></div>
</div>
</div>
<div class="section" id="set-language">
<h3>Set language<a class="headerlink" href="#set-language" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>To get languages set in the <code class="docutils literal"><span class="pre">Accept-Language</span></code> request header by the browser,
call <code class="docutils literal"><span class="pre">browserLanguages</span></code>. The result is sorted by priority set by the brower,
from high to low.</li>
<li>The default current language is &#8220;en&#8221;. To set the current language, for example
Japanese, call <code class="docutils literal"><span class="pre">language</span> <span class="pre">=</span> <span class="pre">&quot;ja&quot;</span></code>.</li>
<li>To autoset the most suitable language in resources, call
<code class="docutils literal"><span class="pre">autosetLanguage(resourceLanguages)</span></code>, where
<code class="docutils literal"><span class="pre">resourceLanguages</span></code> is a list of available languages in
<code class="docutils literal"><span class="pre">resources/i18n</span></code> directory and JAR files.
If there&#8217;s no suitable language, the language is still the default &#8220;en&#8221;.</li>
<li>To get the current language set above, use <code class="docutils literal"><span class="pre">language</span></code>.</li>
</ul>
<p>In your action, typically in a before filter, to set language:</p>
<div class="highlight-python"><div class="highlight"><pre>beforeFilter {
  val lango: Option[String] = yourMethodToGetUserPreferenceLanguageInSession()
  lango match {
    case None       =&gt; autosetLanguage(&quot;ja&quot;, &quot;vi&quot;)
    case Some(lang) =&gt; language = lang
  }
}
</pre></div>
</div>
</div>
<div class="section" id="validation-messages">
<h3>Validation messages<a class="headerlink" href="#validation-messages" title="Permalink to this headline">¶</a></h3>
<p>jQuery Validation plugin provides <a class="reference external" href="https://github.com/jzaefferer/jquery-validation/tree/master/src/localization">i18n error messages</a>.
Xitrum automatically include the message file corresponding to the current language.</p>
<p>For server side default validators in <code class="docutils literal"><span class="pre">xitrum.validator</span></code> package, Xitrum also
provide translation for them.</p>
</div>
<div class="section" id="plural-forms">
<h3>Plural forms<a class="headerlink" href="#plural-forms" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tn</span><span class="p">(</span><span class="s">&quot;Message&quot;</span><span class="p">,</span> <span class="s">&quot;Plural form&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">tcn</span><span class="p">(</span><span class="s">&quot;Context&quot;</span><span class="p">,</span> <span class="s">&quot;Message&quot;</span><span class="p">,</span> <span class="s">&quot;Plural form&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Xitrum can only work correctly with Plural-Forms exactly listed at:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.gnu.org/software/gettext/manual/html_node/Plural-forms.html#Plural-forms">What are plural forms</a></li>
<li><a class="reference external" href="http://www.gnu.org/software/gettext/manual/html_node/Translating-plural-forms.html#Translating-plural-forms">Translating plural forms</a></li>
</ul>
<p>Your plural forms must be exactly one of the following:</p>
<div class="highlight-python"><div class="highlight"><pre>nplurals=1; plural=0
nplurals=2; plural=n != 1
nplurals=2; plural=n&gt;1
nplurals=3; plural=n%10==1 &amp;&amp; n%100!=11 ? 0 : n != 0 ? 1 : 2
nplurals=3; plural=n==1 ? 0 : n==2 ? 1 : 2
nplurals=3; plural=n==1 ? 0 : (n==0 || (n%100 &gt; 0 &amp;&amp; n%100 &lt; 20)) ? 1 : 2
nplurals=3; plural=n%10==1 &amp;&amp; n%100!=11 ? 0 : n%10&gt;=2 &amp;&amp; (n%100&lt;10 || n%100&gt;=20) ? 1 : 2
nplurals=3; plural=n%10==1 &amp;&amp; n%100!=11 ? 0 : n%10&gt;=2 &amp;&amp; n%10&lt;=4 &amp;&amp; (n%100&lt;10 || n%100&gt;=20) ? 1 : 2
nplurals=3; plural=(n==1) ? 0 : (n&gt;=2 &amp;&amp; n&lt;=4) ? 1 : 2
nplurals=3; plural=n==1 ? 0 : n%10&gt;=2 &amp;&amp; n%10&lt;=4 &amp;&amp; (n%100&lt;10 || n%100&gt;=20) ? 1 : 2
nplurals=4; plural=n%100==1 ? 0 : n%100==2 ? 1 : n%100==3 || n%100==4 ? 2 : 3
</pre></div>
</div>
</div>
<div class="section" id="date-and-number-format">
<h3>Date and number format<a class="headerlink" href="#date-and-number-format" title="Permalink to this headline">¶</a></h3>
<p>If you use Scalate template engine, by default the date and number format will
be the format of the language of the current action.</p>
<p>If you want to use other format:</p>
<div class="highlight-python"><div class="highlight"><pre>import java.text.{DateFormat, NumberFormat}

val myDateFormat   = ...
val myNumberFormat = ...
val options        = Map(&quot;date&quot; -&gt; myDateFormat, &quot;number&quot; -&gt; myNumberFormat)
respondView(options)
</pre></div>
</div>
</div>
</div>
<span id="document-log"></span><div class="section" id="log">
<h2>Log<a class="headerlink" href="#log" title="Permalink to this headline">¶</a></h2>
<div class="section" id="use-object-xitrum-log-directly">
<h3>Use object xitrum.Log directly<a class="headerlink" href="#use-object-xitrum-log-directly" title="Permalink to this headline">¶</a></h3>
<p>From anywhere, you can call like this directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">xitrum</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;My debug msg&quot;</span><span class="p">)</span>
<span class="n">xitrum</span><span class="o">.</span><span class="n">Log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;My info msg&quot;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="use-trait-xitrum-log">
<h3>Use trait xitrum.Log<a class="headerlink" href="#use-trait-xitrum-log" title="Permalink to this headline">¶</a></h3>
<p>If you want to have the information about where (which class) the log has been
made, you should extend trait xitrum.Log:</p>
<div class="highlight-python"><div class="highlight"><pre>package my_package
import xitrum.Log

object MyModel extends Log {
  log.debug(&quot;My debug msg&quot;)
  log.info(&quot;My info msg&quot;)
  ...
}
</pre></div>
</div>
<p>In file log/xitrum.log you will see that the log messages comes from <code class="docutils literal"><span class="pre">MyModel</span></code>.</p>
<p>Xitrum actions extend trait xitrum.Log, so in actions, you can do write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="don-t-have-to-check-log-level-before-logging">
<h3>Don&#8217;t have to check log level before logging<a class="headerlink" href="#don-t-have-to-check-log-level-before-logging" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">xitrum.Log</span></code> is based on <a class="reference external" href="http://slf4s.org/">SLF4S</a> (<a class="reference external" href="http://slf4s.org/api/1.7.7/">API</a>),
which is in turn based on <a class="reference external" href="http://www.slf4j.org/">SLF4J</a>.</p>
<p>Traditionally, before doing a heavy calculation to get a result to log, you have
to check log level to avoid wasting CPU to do the calculation.</p>
<p><a class="reference external" href="https://github.com/mattroberts297/slf4s/blob/master/src/main/scala/org/slf4s/Logger.scala">SLF4S automatically does the check</a>,
so you don&#8217;t have to do the check yourself.</p>
<p>Before (this code doesn&#8217;t work for the current Xitrum 3.13+ any more):</p>
<div class="highlight-python"><div class="highlight"><pre>if (log.isTraceEnabled) {
  val result = heavyCalculation()
  log.trace(&quot;Output: {}&quot;, result)
}
</pre></div>
</div>
<p>Now:</p>
<div class="highlight-python"><div class="highlight"><pre>log.trace(s&quot;Output: #{heavyCalculation()}&quot;)
</pre></div>
</div>
</div>
<div class="section" id="config-log-level-log-output-file-etc">
<h3>Config log level, log output file etc.<a class="headerlink" href="#config-log-level-log-output-file-etc" title="Permalink to this headline">¶</a></h3>
<p>In build.sbt, there&#8217;s a line like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;ch.qos.logback&quot;</span> <span class="o">%</span> <span class="s">&quot;logback-classic&quot;</span> <span class="o">%</span> <span class="s">&quot;1.1.2&quot;</span>
</pre></div>
</div>
<p>This means that <a class="reference external" href="http://logback.qos.ch/">Logback</a> is used by default.
Logback config file is at <code class="docutils literal"><span class="pre">config/logback.xml</span></code>.</p>
<p>You may replace Logback with any other implementation of <a class="reference external" href="http://www.slf4j.org/">SLF4J</a>.</p>
</div>
<div class="section" id="log-to-fluentd">
<h3>Log to Fluentd<a class="headerlink" href="#log-to-fluentd" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.fluentd.org/">Fluentd</a> is a very popular log collector. You can
configure Logback to send log (maybe from many places) to a Fluentd server.</p>
<p>First, add <a class="reference external" href="https://github.com/sndyuk/logback-more-appenders">logback-more-appenders</a>
library to your project:</p>
<div class="highlight-python"><div class="highlight"><pre>libraryDependencies += &quot;org.fluentd&quot; % &quot;fluent-logger&quot; % &quot;0.2.11&quot;

resolvers += &quot;Logback more appenders&quot; at &quot;http://sndyuk.github.com/maven&quot;

libraryDependencies += &quot;com.sndyuk&quot; % &quot;logback-more-appenders&quot; % &quot;1.1.0&quot;
</pre></div>
</div>
<p>Then, in <code class="docutils literal"><span class="pre">config/logback.xml</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>...

&lt;appender name=&quot;FLUENT&quot; class=&quot;ch.qos.logback.more.appenders.DataFluentAppender&quot;&gt;
  &lt;tag&gt;mytag&lt;/tag&gt;
  &lt;label&gt;mylabel&lt;/label&gt;
  &lt;remoteHost&gt;localhost&lt;/remoteHost&gt;
  &lt;port&gt;24224&lt;/port&gt;
  &lt;maxQueueSize&gt;20000&lt;/maxQueueSize&gt;  &lt;!-- Save to memory when remote server is down --&gt;
&lt;/appender&gt;

&lt;root level=&quot;DEBUG&quot;&gt;
  &lt;appender-ref ref=&quot;FLUENT&quot;/&gt;
  &lt;appender-ref ref=&quot;OTHER_APPENDER&quot;/&gt;
&lt;/root&gt;

...
</pre></div>
</div>
</div>
</div>
<span id="document-deploy"></span><div class="section" id="deploy-to-production-server">
<h2>Deploy to production server<a class="headerlink" href="#deploy-to-production-server" title="Permalink to this headline">¶</a></h2>
<p>You may run Xitrum directly:</p>
<div class="highlight-python"><div class="highlight"><pre>Browser ------ Xitrum instance
</pre></div>
</div>
<p>Or behind a load balancer like HAProxy, or reverse proxy like Apache or Nginx:</p>
<div class="highlight-python"><div class="highlight"><pre>Browser ------ Load balancer/Reverse proxy -+---- Xitrum instance1
                                            +---- Xitrum instance2
</pre></div>
</div>
<div class="section" id="package-directory">
<h3>Package directory<a class="headerlink" href="#package-directory" title="Permalink to this headline">¶</a></h3>
<p>Run <code class="docutils literal"><span class="pre">sbt/sbt</span> <span class="pre">xitrum-package</span></code> to prepare <code class="docutils literal"><span class="pre">target/xitrum</span></code> directory, ready to
deploy to production server:</p>
<div class="highlight-python"><div class="highlight"><pre>target/xitrum
  config
    [config files]
  public
    [static public files]
  lib
    [dependencies and packaged project file]
  script
    runner
    runner.bat
    scalive
    scalive.jar
    scalive.bat
</pre></div>
</div>
</div>
<div class="section" id="customize-xitrum-package">
<h3>Customize xitrum-package<a class="headerlink" href="#customize-xitrum-package" title="Permalink to this headline">¶</a></h3>
<p>By default <code class="docutils literal"><span class="pre">sbt/sbt</span> <span class="pre">xitrum-package</span></code> command is configured to copy directories
<code class="docutils literal"><span class="pre">config</span></code>, <code class="docutils literal"><span class="pre">public</span></code>, and <code class="docutils literal"><span class="pre">script</span></code> to <code class="docutils literal"><span class="pre">target/xitrum</span></code>. If you want it to
copy additional directories or files change <code class="docutils literal"><span class="pre">build.sbt</span></code> like this:</p>
<div class="highlight-python"><div class="highlight"><pre>XitrumPackage.copy(&quot;config&quot;, &quot;public, &quot;script&quot;, &quot;doc/README.txt&quot;, &quot;etc.&quot;)
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/xitrum-framework/xitrum-package">xitrum-package homepage</a>
for more information.</p>
</div>
<div class="section" id="connect-a-scala-console-to-a-running-jvm-process">
<h3>Connect a Scala console to a running JVM process<a class="headerlink" href="#connect-a-scala-console-to-a-running-jvm-process" title="Permalink to this headline">¶</a></h3>
<p>In production environment, without prior setup, you can use
<a class="reference external" href="https://github.com/xitrum-framework/scalive">Scalive</a>
to connect a Scala console to a running JVM process for live debugging.</p>
<p>Run <code class="docutils literal"><span class="pre">scalive</span></code> in the script directory:</p>
<div class="highlight-python"><div class="highlight"><pre>script
  runner
  runner.bat
  scalive
  scalive.jar
  scalive.bat
</pre></div>
</div>
</div>
<div class="section" id="install-oracle-jdk-on-centos-or-ubuntu-manually">
<h3>Install Oracle JDK on CentOS or Ubuntu manually<a class="headerlink" href="#install-oracle-jdk-on-centos-or-ubuntu-manually" title="Permalink to this headline">¶</a></h3>
<p>This guide is here for convenient reference. You can certainly install Java from
a package manager.</p>
<p>Check installed alternatives:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo update-alternatives --list java
</pre></div>
</div>
<p>Output example:</p>
<div class="highlight-python"><div class="highlight"><pre>/usr/lib/jvm/jdk1.7.0_15/bin/java
/usr/lib/jvm/jdk1.7.0_25/bin/java
</pre></div>
</div>
<p>Check machine environment (32 bit or 64 bit):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">file</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">init</span>
</pre></div>
</div>
<p>Output example:</p>
<div class="highlight-python"><div class="highlight"><pre>/sbin/init: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=0x4efe732752ed9f8cc491de1c8a271eb7f4144a5c, stripped
</pre></div>
</div>
<p>Download JDK from <a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html">Oracle</a>.
There&#8217;s a <a class="reference external" href="http://stackoverflow.com/questions/10268583/how-to-automate-download-and-instalation-of-java-jdk-on-linux">trick</a>
to download jdk without browser:</p>
<div class="highlight-python"><div class="highlight"><pre>wget --no-cookies --header &quot;Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com&quot; &quot;http://download.oracle.com/otn-pub/java/jdk/7u45-b18/jdk-7u45-linux-x64.tar.gz&quot;
</pre></div>
</div>
<p>Unarchive and move it:</p>
<div class="highlight-python"><div class="highlight"><pre>tar -xzvf jdk-7u45-linux-x64.tar.gz
sudo mv jdk1.7.0_45 /usr/lib/jvm/jdk1.7.0_45
</pre></div>
</div>
<p>Register commands as an alternative:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo update-alternatives --install &quot;/usr/bin/java&quot; &quot;java&quot; &quot;/usr/lib/jvm/jdk1.7.0_45/bin/java&quot; 1
sudo update-alternatives --install &quot;/usr/bin/javac&quot; &quot;javac&quot; &quot;/usr/lib/jvm/jdk1.7.0_45/bin/javac&quot; 1
sudo update-alternatives --install &quot;/usr/bin/javap&quot; &quot;javap&quot; &quot;/usr/lib/jvm/jdk1.7.0_45/bin/javap&quot; 1
sudo update-alternatives --install &quot;/usr/bin/javaws&quot; &quot;javaws&quot; &quot;/usr/lib/jvm/jdk1.7.0_45/bin/javaws&quot; 1
</pre></div>
</div>
<p>Chose new path with interactive shell:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo update-alternatives --config java
</pre></div>
</div>
<p>Output example:</p>
<div class="highlight-python"><div class="highlight"><pre>There are 3 choices for the alternative java (providing /usr/bin/java).

  Selection    Path                               Priority   Status
------------------------------------------------------------
* 0            /usr/lib/jvm/jdk1.7.0_25/bin/java   50001     auto mode
  1            /usr/lib/jvm/jdk1.7.0_15/bin/java   50000     manual mode
  2            /usr/lib/jvm/jdk1.7.0_25/bin/java   50001     manual mode
  3            /usr/lib/jvm/jdk1.7.0_45/bin/java   1         manual mode

Press enter to keep the current choice[*], or type selection number: 3
update-alternatives: using /usr/lib/jvm/jdk1.7.0_45/bin/java to provide /usr/bin/java (java) in manual mode
</pre></div>
</div>
<p>Check version:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">java</span> <span class="o">-</span><span class="n">version</span>
</pre></div>
</div>
<p>Output example:</p>
<div class="highlight-python"><div class="highlight"><pre>java version &quot;1.7.0_45&quot;
Java(TM) SE Runtime Environment (build 1.7.0_45-b18)
Java HotSpot(TM) 64-Bit Server VM (build 24.45-b08, mixed mode)
</pre></div>
</div>
<p>Do also:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo update-alternatives --config javac
sudo update-alternatives --config javap
sudo update-alternatives --config javaws
</pre></div>
</div>
</div>
<div class="section" id="start-xitrum-in-production-mode-when-the-system-starts">
<h3>Start Xitrum in production mode when the system starts<a class="headerlink" href="#start-xitrum-in-production-mode-when-the-system-starts" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">script/runner</span></code> (for <a href="#id1"><span class="problematic" id="id2">*</span></a>nix) and <code class="docutils literal"><span class="pre">script/runner.bat</span></code> (for Windows) are the script to
run any object with <code class="docutils literal"><span class="pre">main</span></code> method. Use it to start the web server in production
environment.</p>
<div class="highlight-python"><div class="highlight"><pre>script/runner quickstart.Boot
</pre></div>
</div>
<p>You may want to modify <code class="docutils literal"><span class="pre">runner</span></code> (or <code class="docutils literal"><span class="pre">runner.bat</span></code>) to tune
<a class="reference external" href="http://www.oracle.com/technetwork/java/hotspotfaq-138619.html">JVM settings</a>.
Also see <code class="docutils literal"><span class="pre">config/xitrum.conf</span></code>.</p>
<p>To start Xitrum in background on Linux when the system starts, a simple approach
is to add a line to <code class="docutils literal"><span class="pre">/etc/rc.local</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>su - user_foo_bar -c /path/to/the/runner/script/above &amp;
</pre></div>
</div>
<p><a class="reference external" href="http://cr.yp.to/daemontools.html">daemontools</a> is another approach. To install it on CentOS, see
<a class="reference external" href="http://whomwah.com/2008/11/04/installing-daemontools-on-centos5-x86_64/">this instruction</a>.</p>
<p>Or use <a class="reference external" href="http://supervisord.org/">Supervisord</a>.
<code class="docutils literal"><span class="pre">/etc/supervisord.conf</span></code> example:</p>
<div class="highlight-python"><div class="highlight"><pre>[program:my_app]
directory=/path/to/my_app
command=/path/to/my_app/script/runner quickstart.Boot
autostart=true
autorestart=true
startsecs=3
user=my_user
redirect_stderr=true
stdout_logfile=/path/to/my_app/log/stdout.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=7
stdout_capture_maxbytes=1MB
stdout_events_enabled=false
environment=PATH=/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/opt/aws/bin:~/bin
</pre></div>
</div>
<p>Other alternatives:</p>
<ul class="simple">
<li><a class="reference external" href="http://smarden.org/runit/">runit</a></li>
<li><a class="reference external" href="http://upstart.ubuntu.com/">upstart</a></li>
</ul>
</div>
<div class="section" id="set-up-port-forwarding">
<h3>Set up port forwarding<a class="headerlink" href="#set-up-port-forwarding" title="Permalink to this headline">¶</a></h3>
<p>Xitrum listens on port 8000 and 4430 by default.
You can change these ports in <code class="docutils literal"><span class="pre">config/xitrum.conf</span></code>.</p>
<p>You can update <code class="docutils literal"><span class="pre">/etc/sysconfig/iptables</span></code> with these commands to forward port
80 to 8000 and 443 to 4430:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo su - root
chmod 700 /etc/sysconfig/iptables
iptables-restore &lt; /etc/sysconfig/iptables
iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8000
iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 443 -j REDIRECT --to-port 4430
iptables -t nat -I OUTPUT -p tcp -d 127.0.0.1 --dport 80 -j REDIRECT --to-ports 8000
iptables -t nat -I OUTPUT -p tcp -d 127.0.0.1 --dport 443 -j REDIRECT --to-ports 4430
iptables-save -c &gt; /etc/sysconfig/iptables
chmod 644 /etc/sysconfig/iptables
</pre></div>
</div>
<p>Of course for example if you have Apache running on port 80 and 443, you have to stop it:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo /etc/init.d/httpd stop
sudo chkconfig httpd off
</pre></div>
</div>
<p>Good read:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.frozentux.net/iptables-tutorial/chunkyhtml/">Iptables tutorial</a></li>
</ul>
</div>
<div class="section" id="tune-linux-for-massive-connections">
<h3>Tune Linux for massive connections<a class="headerlink" href="#tune-linux-for-massive-connections" title="Permalink to this headline">¶</a></h3>
<p>Note that on Mac, <a class="reference external" href="https://groups.google.com/forum/#!topic/spray-user/S-SNR2m0BWU">JDKs suffer from a serious problem with IO (NIO) performance</a>.</p>
<p>Good read:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.basho.com/riak/latest/ops/tuning/linux/">Linux Performance Tuning (Riak)</a></li>
<li><a class="reference external" href="http://docs.basho.com/riak/latest/ops/tuning/aws/">AWS Performance Tuning (Riak)</a></li>
<li><a class="reference external" href="http://www.frozentux.net/ipsysctl-tutorial/chunkyhtml/">Ipsysctl tutorial</a></li>
<li><a class="reference external" href="http://www.frozentux.net/ipsysctl-tutorial/chunkyhtml/tcpvariables.html">TCP variables</a></li>
</ul>
<div class="section" id="increase-open-file-limit">
<h4>Increase open file limit<a class="headerlink" href="#increase-open-file-limit" title="Permalink to this headline">¶</a></h4>
<p>Each connection is seen by Linux as an open file.
The default maximum number of open file is 1024.
To increase this limit, modify /etc/security/limits.conf:</p>
<div class="highlight-python"><div class="highlight"><pre>*  soft  nofile  1024000
*  hard  nofile  1024000
</pre></div>
</div>
<p>You need to logout and login again for the above config to take effect.
To confirm, run <code class="docutils literal"><span class="pre">ulimit</span> <span class="pre">-n</span></code>.</p>
</div>
<div class="section" id="tune-kernel">
<h4>Tune kernel<a class="headerlink" href="#tune-kernel" title="Permalink to this headline">¶</a></h4>
<p>As instructed in the article
<a class="reference external" href="http://www.metabrew.com/article/a-million-user-comet-application-with-mochiweb-part-1">A Million-user Comet Application with Mochiweb</a>,
modify /etc/sysctl.conf:</p>
<div class="highlight-python"><div class="highlight"><pre># General gigabit tuning
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# This gives the kernel more memory for TCP
# which you need with many (100k+) open socket connections
net.ipv4.tcp_mem = 50576 64768 98152

# Backlog
net.core.netdev_max_backlog = 2048
net.core.somaxconn = 1024
net.ipv4.tcp_max_syn_backlog = 2048
net.ipv4.tcp_syncookies = 1

# If you run clients
net.ipv4.ip_local_port_range = 1024 65535
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 10
</pre></div>
</div>
<p>Run <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">sysctl</span> <span class="pre">-p</span></code> to apply.
No need to reboot, now your kernel should be able to handle a lot more open connections.</p>
</div>
<div class="section" id="note-about-backlog">
<h4>Note about backlog<a class="headerlink" href="#note-about-backlog" title="Permalink to this headline">¶</a></h4>
<p>TCP does the 3-way handshake for making a connection.
When a remote client connects to the server,
it sends SYN packet, and the server OS replies with SYN-ACK packet,
then again that remote client sends ACK packet and the connection is established.
Xitrum gets the connection when it is completely established.</p>
<p>According to the article
<a class="reference external" href="https://sites.google.com/site/beingroot/articles/apache/socket-backlog-tuning-for-apache">Socket backlog tuning for Apache</a>,
connection timeout happens because of SYN packet loss which happens because
backlog queue for the web server is filled up with connections sending SYN-ACK
to slow clients.</p>
<p>According to the
<a class="reference external" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/configtuning-kernel-limits.html">FreeBSD Handbook</a>,
the default value of 128 is typically too low for robust handling of new
connections in a heavily loaded web server environment. For such environments,
it is recommended to increase this value to 1024 or higher.
Large listen queues also do a better job of avoiding Denial of Service (DoS) attacks.</p>
<p>The backlog size of Xitrum is set to 1024 (memcached also uses this value),
but you also need to tune the kernel as above.</p>
<p>To check the backlog config:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">somaxconn</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-python"><div class="highlight"><pre>sysctl net.core.somaxconn
</pre></div>
</div>
<p>To tune temporarily, you can do like this:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo sysctl -w net.core.somaxconn=1024
</pre></div>
</div>
</div>
</div>
<div class="section" id="haproxy-tips">
<h3>HAProxy tips<a class="headerlink" href="#haproxy-tips" title="Permalink to this headline">¶</a></h3>
<p>To config HAProxy for SockJS, see <a class="reference external" href="https://github.com/sockjs/sockjs-node/blob/master/examples/haproxy.cfg">this example</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>defaults
    mode http
    timeout connect 10s
    timeout client  10h  # Set to long time to avoid WebSocket connections being closed when there&#39;s no network activity
    timeout server  10h  # Set to long time to avoid ERR_INCOMPLETE_CHUNKED_ENCODING on Chrome

frontend xitrum_with_discourse
    bind 0.0.0.0:80

    option forwardfor

    acl is_discourse path_beg /forum
    use_backend discourse if is_discourse
    default_backend xitrum

backend xitrum
    server srv_xitrum 127.0.0.1:8000

backend discourse
    server srv_discourse 127.0.0.1:3000
</pre></div>
</div>
<p>To have HAProxy reload config file without restarting, see <a class="reference external" href="http://serverfault.com/questions/165883/is-there-a-way-to-add-more-backend-server-to-haproxy-without-restarting-haproxy">this discussion</a>.</p>
<p>HAProxy is much easier to use than Nginx. It suits Xitrum because as mentioned in
<a class="reference internal" href="index.html#document-cache"><em>the section about caching</em></a>, Xitrum serves static files
<a class="reference external" href="https://gist.github.com/3293596">very fast</a>. You don&#8217;t have to use the static file
serving feature in Nginx.</p>
</div>
<div class="section" id="nginx-tips">
<h3>Nginx tips<a class="headerlink" href="#nginx-tips" title="Permalink to this headline">¶</a></h3>
<p>If you use WebSocket or SockJS feature in Xitrum and want to run Xitrum behind
Nginx 1.2, you must install additional module like
<a class="reference external" href="https://github.com/yaoweibin/nginx_tcp_proxy_module">nginx_tcp_proxy_module</a>.
Nginx 1.3+ supports WebSocket natively.</p>
<p>Nginx by default uses HTTP 1.0 protocol for reverse proxy. If your backend server
returns chunked response, you need to tell Nginx to use HTTP 1.1 like this:</p>
<div class="highlight-python"><div class="highlight"><pre>location / {
  proxy_http_version 1.1;
  proxy_set_header Connection &quot;&quot;;
  proxy_pass http://127.0.0.1:8000;
}
</pre></div>
</div>
<p>The <a class="reference external" href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive">documentation</a> states that for http keepalive, you should also set proxy_set_header Connection &#8220;&#8221;;</p>
</div>
<div class="section" id="deploy-to-heroku">
<h3>Deploy to Heroku<a class="headerlink" href="#deploy-to-heroku" title="Permalink to this headline">¶</a></h3>
<p>You may run Xitrum at <a class="reference external" href="https://www.heroku.com/">Heroku</a>.</p>
<div class="section" id="sign-up-and-create-repository">
<h4>Sign up and create repository<a class="headerlink" href="#sign-up-and-create-repository" title="Permalink to this headline">¶</a></h4>
<p>Following the <a class="reference external" href="https://devcenter.heroku.com/articles/quickstart">Official Document</a>,
sign up and create git repository.</p>
</div>
<div class="section" id="create-procfile">
<h4>Create Procfile<a class="headerlink" href="#create-procfile" title="Permalink to this headline">¶</a></h4>
<p>Create Procfile and save it at project root directory. Heroku reads this file and
executes on start.</p>
<div class="highlight-python"><div class="highlight"><pre>web: target/xitrum/script/runner &lt;YOUR_PACKAGE.YOUR_MAIN_CLASS&gt;
</pre></div>
</div>
</div>
<div class="section" id="change-port-setting">
<h4>Change port setting<a class="headerlink" href="#change-port-setting" title="Permalink to this headline">¶</a></h4>
<p>Because Heroku assigns port automatically, you need to do like this:</p>
<p>config/xitrum.conf:</p>
<div class="highlight-python"><div class="highlight"><pre>port {
  http              = ${PORT}
  # https             = 4430
  # flashSocketPolicy = 8430  # flash_socket_policy.xml will be returned
}
</pre></div>
</div>
<p>If you want to use SSL, you need <a class="reference external" href="https://addons.heroku.com/ssl">add on</a>.</p>
</div>
<div class="section" id="see-log-level">
<h4>See log level<a class="headerlink" href="#see-log-level" title="Permalink to this headline">¶</a></h4>
<p>config/logback.xml:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;root level=&quot;INFO&quot;&gt;
  &lt;appender-ref ref=&quot;CONSOLE&quot;/&gt;
&lt;/root&gt;
</pre></div>
</div>
<p>Tail log from Heroku command:</p>
<div class="highlight-python"><div class="highlight"><pre>heroku logs -tail
</pre></div>
</div>
</div>
<div class="section" id="create-alias-for-xitrum-package">
<h4>Create alias for <code class="docutils literal"><span class="pre">xitrum-package</span></code><a class="headerlink" href="#create-alias-for-xitrum-package" title="Permalink to this headline">¶</a></h4>
<p>At deploy time, Heroku runs <code class="docutils literal"><span class="pre">sbt/sbt</span> <span class="pre">clean</span> <span class="pre">compile</span> <span class="pre">stage</span></code>. So you need to add alias
for <code class="docutils literal"><span class="pre">xitrum-package</span></code>.</p>
<p>build.sbt:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">addCommandAlias</span><span class="p">(</span><span class="s">&quot;stage&quot;</span><span class="p">,</span> <span class="s">&quot;;xitrum-package&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="push-to-heroku">
<h4>Push to Heroku<a class="headerlink" href="#push-to-heroku" title="Permalink to this headline">¶</a></h4>
<p>Deploy process is hooked by git push.</p>
<div class="highlight-python"><div class="highlight"><pre>git push heroku master
</pre></div>
</div>
<p>See also <a class="reference external" href="https://devcenter.heroku.com/articles/getting-started-with-scala">Official document for Scala</a>.</p>
</div>
</div>
</div>
<span id="document-cluster"></span><div class="section" id="clustering-with-akka-and-hazelcast">
<h2>Clustering with Akka and Hazelcast<a class="headerlink" href="#clustering-with-akka-and-hazelcast" title="Permalink to this headline">¶</a></h2>
<p>Xitrum is designed in mind to run in production environment as multiple instances
behind a proxy server or load balancer:</p>
<div class="highlight-python"><div class="highlight"><pre>                              / Xitrum instance 1
Load balancer/proxy server ---- Xitrum instance 2
                              \ Xitrum instance 3
</pre></div>
</div>
<p>Cache, sessions, and SockJS sessions can be clustered out of the box thanks to
<a class="reference external" href="http://akka.io/">Akka</a> and <a class="reference external" href="https://github.com/xitrum-framework/xitrum-hazelcast">Hazelcast</a>.</p>
<p>With Hazelcast, Xitrum instances become in-process memory cache servers. You don&#8217;t
need seperate things like Memcache.</p>
<p>Please see <code class="docutils literal"><span class="pre">config/akka.conf</span></code>, and read <a class="reference external" href="http://akka.io/docs/">Akka doc</a> and
<a class="reference external" href="http://hazelcast.org/documentation/">Hazelcast doc</a> to know how to config Akka and
Hazelcast clustering.</p>
<p>Note: For sessions, you can also <a class="reference internal" href="index.html#document-scopes"><em>store them at client side in cookie</em></a>.</p>
</div>
<span id="document-handler"></span><div class="section" id="netty-handlers">
<h2>Netty handlers<a class="headerlink" href="#netty-handlers" title="Permalink to this headline">¶</a></h2>
<p>This chapter is advanced, you don&#8217;t have to know to use Xitrum normally. To
understand, you must have knowlege about <a class="reference external" href="http://netty.io/">Netty</a>.</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Rack_(Web_server_interface)">Rack</a>,
<a class="reference external" href="http://en.wikipedia.org/wiki/Web_Server_Gateway_Interface">WSGI</a>, and
<a class="reference external" href="http://en.wikipedia.org/wiki/PSGI">PSGI</a> have middleware architecture.
Xitrum is based on <a class="reference external" href="http://netty.io/">Netty</a> which has the same thing called
handlers. You can create additional handlers and customize the channel pipeline
of handlers. Doing this, you can maximize server performance for your specific
use case.</p>
<p>This chaper describes:</p>
<ul class="simple">
<li>Netty handler architecture</li>
<li>Handlers that Xitrum provides and their default order</li>
<li>How to create and use custom handler</li>
</ul>
<div class="section" id="netty-handler-architecture">
<h3>Netty handler architecture<a class="headerlink" href="#netty-handler-architecture" title="Permalink to this headline">¶</a></h3>
<p>For each connection, there is a channel pipeline to handle the IO data.
A channel pipeline is a series of handlers. There are 2 types of handlers:</p>
<ul class="simple">
<li>Inbound: the request direction client -&gt; server</li>
<li>Outbound: the response direction server -&gt; client</li>
</ul>
<p>Please see the doc of <a class="reference external" href="http://netty.io/4.0/api/io/netty/channel/ChannelPipeline.html">ChannelPipeline</a>
for more information.</p>
<div class="highlight-python"><div class="highlight"><pre>                                               I/O Request
                                          via Channel or
                                      ChannelHandlerContext
                                                    |
+---------------------------------------------------+---------------+
|                           ChannelPipeline         |               |
|                                                  \|/              |
|    +---------------------+            +-----------+----------+    |
|    | Inbound Handler  N  |            | Outbound Handler  1  |    |
|    +----------+----------+            +-----------+----------+    |
|              /|\                                  |               |
|               |                                  \|/              |
|    +----------+----------+            +-----------+----------+    |
|    | Inbound Handler N-1 |            | Outbound Handler  2  |    |
|    +----------+----------+            +-----------+----------+    |
|              /|\                                  .               |
|               .                                   .               |
| ChannelHandlerContext.fireIN_EVT() ChannelHandlerContext.OUT_EVT()|
|        [ method call]                       [method call]         |
|               .                                   .               |
|               .                                  \|/              |
|    +----------+----------+            +-----------+----------+    |
|    | Inbound Handler  2  |            | Outbound Handler M-1 |    |
|    +----------+----------+            +-----------+----------+    |
|              /|\                                  |               |
|               |                                  \|/              |
|    +----------+----------+            +-----------+----------+    |
|    | Inbound Handler  1  |            | Outbound Handler  M  |    |
|    +----------+----------+            +-----------+----------+    |
|              /|\                                  |               |
+---------------+-----------------------------------+---------------+
                |                                  \|/
+---------------+-----------------------------------+---------------+
|               |                                   |               |
|       [ Socket.read() ]                    [ Socket.write() ]     |
|                                                                   |
|  Netty Internal I/O Threads (Transport Implementation)            |
+-------------------------------------------------------------------+
</pre></div>
</div>
</div>
<div class="section" id="custom-handlers">
<h3>Custom handlers<a class="headerlink" href="#custom-handlers" title="Permalink to this headline">¶</a></h3>
<p>When starting Xitrum server, you can pass in your own
<a class="reference external" href="http://netty.io/4.0/api/io/netty/channel/ChannelInitializer.html">ChannelInitializer</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Server

object Boot {
  def main(args: Array[String]) {
    Server.start(myChannelInitializer)
  }
}
</pre></div>
</div>
<p>For HTTPS server, Xitrum will automatically prepend SSL handler to the pipeline.
You can reuse Xitrum handlers in your pipeline.</p>
</div>
<div class="section" id="xitrum-default-handlers">
<h3>Xitrum default handlers<a class="headerlink" href="#xitrum-default-handlers" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/handler/DefaultHttpChannelInitializer.scala">xitrum.handler.DefaultHttpChannelInitializer</a>.</p>
<p>Sharable handlers (same instances are shared among many connections) are put in
<code class="docutils literal"><span class="pre">DefaultHttpChannelInitializer</span></code> object above so that they can be easily picked
up by apps that want to use custom pipeline. Those apps may only want a subset
of default handlers.</p>
<p>For example, when an app uses its own dispatcher (not Xitrum&#8217;s routing/dispatcher)
and only needs Xitrum&#8217;s fast static file serving, it may use only these handlers:</p>
<p>Inbound:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">HttpRequestDecoder</span></code></li>
<li><code class="docutils literal"><span class="pre">PublicFileServer</span></code></li>
<li>Its own dispatcher</li>
</ul>
<p>Outbound:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">HttpResponseEncoder</span></code></li>
<li><code class="docutils literal"><span class="pre">ChunkedWriteHandler</span></code></li>
<li><code class="docutils literal"><span class="pre">XSendFile</span></code></li>
</ul>
</div>
</div>
<span id="document-metrics"></span><div class="section" id="metrics">
<h2>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h2>
<p>Xitrum collects JVM heap memory, CPU, and actions&#8217; execution status from each
node of your application&#8217;s Akka cluster. It publishes the metrics as JSON data.
Xitrum also lets you publish your own metrics.</p>
<p>This metrics feature is based on the library <a class="reference external" href="http://metrics.dropwizard.io/3.1.0/">Coda Hale Metrics</a>.</p>
<div class="section" id="collect-metrics">
<h3>Collect metrics<a class="headerlink" href="#collect-metrics" title="Permalink to this headline">¶</a></h3>
<div class="section" id="heap-memory-and-cpu">
<h4>Heap memory and CPU<a class="headerlink" href="#heap-memory-and-cpu" title="Permalink to this headline">¶</a></h4>
<p>JVM heap memory and CPU will be collected as
<a class="reference external" href="http://doc.akka.io/api/akka/2.3.0/index.html#akka.cluster.NodeMetrics">NodeMetrics</a>
of Akka actor system from each node.</p>
<p>Heap memory:</p>
<img alt="_images/metrics_heapmemory.png" src="_images/metrics_heapmemory.png" />
<p>CPU: Number of processors and load average</p>
<img alt="_images/metrics_cpu.png" src="_images/metrics_cpu.png" />
</div>
<div class="section" id="action-metrics">
<h4>Action metrics<a class="headerlink" href="#action-metrics" title="Permalink to this headline">¶</a></h4>
<p>Xitrum measure actions&#8217; execution status of each node as a
<a class="reference external" href="http://metrics.dropwizard.io/3.1.0/getting-started/#histograms">Histogram</a>.
You can know how many times actions were executed, and execution time of
non-async actions.</p>
<img alt="_images/metrics_action_count.png" src="_images/metrics_action_count.png" />
<p>Latest execution time of a specific action:</p>
<img alt="_images/metrics_action_time.png" src="_images/metrics_action_time.png" />
</div>
<div class="section" id="collect-your-custom-metrics">
<h4>Collect your custom metrics<a class="headerlink" href="#collect-your-custom-metrics" title="Permalink to this headline">¶</a></h4>
<p>In addition to default metrics above, you can collect your custom metrics.
<code class="docutils literal"><span class="pre">xitrum.Metrics</span></code> is a shortcut for <code class="docutils literal"><span class="pre">gauge</span></code>, <code class="docutils literal"><span class="pre">counter</span></code>, <code class="docutils literal"><span class="pre">meter</span></code>,
<code class="docutils literal"><span class="pre">timer</span></code> and <code class="docutils literal"><span class="pre">histogram</span></code>. Please read about
<a class="reference external" href="http://metrics.dropwizard.io/3.1.0/">Coda Hale Metrics</a> and
<a class="reference external" href="https://github.com/erikvanoosten/metrics-scala">its Scala implementation</a>
to know how to use them.</p>
<p>Timer example:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.{Action, Metrics}
import xitrum.annotation.GET

object MyAction {
  lazy val myTimer = Metrics.timer(&quot;myTimer&quot;)
}

@GET(&quot;my/action&quot;)
class MyAction extends Action {
  import MyAction._

  def execute() {
    myTimer.time {
      // Something that you want to measure execution time
      ...
    }
    ...
  }
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="publish-metrics">
<h3>Publish metrics<a class="headerlink" href="#publish-metrics" title="Permalink to this headline">¶</a></h3>
<p>Xitrum publish latest value of metrics as JSON format with specified interval.
This is a volatile value and not be kept in persistently.</p>
<p>HeapMemory:</p>
<div class="highlight-python"><div class="highlight"><pre>{
  &quot;TYPE&quot;      : &quot;heapMemory&quot;,
  &quot;SYSTEM&quot;    : akka.actor.Address.system,
  &quot;HOST&quot;      : akka.actor.Address.host,
  &quot;PORT&quot;      : akka.actor.Address.port,
  &quot;HASH&quot;      : akka.actor.Address.hashCode,
  &quot;TIMESTAMP&quot; : akka.cluster.NodeMetrics.timestamp,
  &quot;USED&quot;      : Number as byte,
  &quot;COMMITTED&quot; : Number as byte,
  &quot;MAX&quot;       : Number as byte
}
</pre></div>
</div>
<p>CPU:</p>
<div class="highlight-python"><div class="highlight"><pre>{
  &quot;TYPE&quot;              : &quot;cpu&quot;,
  &quot;SYSTEM&quot;            : akka.actor.Address.system,
  &quot;HOST&quot;              : akka.actor.Address.host,
  &quot;PORT&quot;              : akka.actor.Address.port,
  &quot;HASH&quot;              : akka.actor.Address.hashCode,
  &quot;TIMESTAMP&quot;         : akka.cluster.NodeMetrics.timestamp
  &quot;SYSTEMLOADAVERAGE&quot; : Number,
  &quot;CPUCOMBINED&quot;       : Number,
  &quot;PROCESSORS&quot;        : Number
}
</pre></div>
</div>
<p>MetricsRegistry will be parsed with <a class="reference external" href="http://metrics.dropwizard.io/3.1.0/manual/json/">metrics-json</a>.</p>
<div class="section" id="xitrum-default-viewer">
<h4>Xitrum default viewer<a class="headerlink" href="#xitrum-default-viewer" title="Permalink to this headline">¶</a></h4>
<p>Xitrum provides default metrics viewer at URL <code class="docutils literal"><span class="pre">/xitrum/metrics/viewer?api_key=&lt;see</span> <span class="pre">xitrum.conf&gt;</span></code>.
This URL shows graphs like above. The graphs are created using <a class="reference external" href="http://d3js.org/">D3.js</a>.</p>
<p>The URL can be generated with:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Config
import xitrum.metrics.XitrumMetricsViewer

url[XitrumMetricsViewer](&quot;api_key&quot; -&gt; Config.xitrum.metrics.get.apiKey)
</pre></div>
</div>
</div>
<div class="section" id="jconsole-viewer">
<h4>Jconsole viewer<a class="headerlink" href="#jconsole-viewer" title="Permalink to this headline">¶</a></h4>
<p>You can see it with <a class="reference external" href="http://metrics.dropwizard.io/3.1.0/getting-started/#reporting-via-jmx">JVM Reporter</a>.</p>
<img alt="_images/metrics_jconsole.png" src="_images/metrics_jconsole.png" />
<p>Start JMX reporter:</p>
<div class="highlight-python"><div class="highlight"><pre>import com.codahale.metrics.JmxReporter

object Boot {
  def main(args: Array[String]) {
    Server.start()
    JmxReporter.forRegistry(xitrum.Metrics.registry).build().start()
  }
}
</pre></div>
</div>
<p>Then run the <a class="reference external" href="http://docs.oracle.com/javase/7/docs/technotes/guides/management/jconsole.html">jconsole</a> command.</p>
</div>
<div class="section" id="display-metrics-with-custom-viewer">
<h4>Display metrics with custom viewer<a class="headerlink" href="#display-metrics-with-custom-viewer" title="Permalink to this headline">¶</a></h4>
<p>The metrics will be published at SockJS URL <code class="docutils literal"><span class="pre">xitrum/metrics/channel</span></code> as JSON.
<code class="docutils literal"><span class="pre">jsAddMetricsNameSpace</span></code> is a convenient JavaScript snippet that Xitrum provides
for creating connection to this endpoint.</p>
<p>Implement your own JSON handler, and call <code class="docutils literal"><span class="pre">initMetricsChannel</span></code> with your handler.</p>
<p>Action example:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.annotation.GET
import xitrum.metrics.MetricsViewer

@GET(&quot;my/metrics/viewer&quot;)
class MySubscriber extends MetricsViewer {
  def execute() {
    jsAddMetricsNameSpace(&quot;window&quot;)
    jsAddToView(&quot;&quot;&quot;
      function onValue(json) {
        console.log(json);
      }
      function onClose(){
        console.log(&quot;channel closed&quot;);
      }
      window.initMetricsChannel(onValue, onClose);
    &quot;&quot;&quot;)
    respondView()
  }
}
</pre></div>
</div>
</div>
<div class="section" id="save-metrics">
<h4>Save metrics<a class="headerlink" href="#save-metrics" title="Permalink to this headline">¶</a></h4>
<p>To save memory, Xitrum doesn&#8217;t remember old metrics values. If you want to save
metrics to the database or files for later use, you need to implement your custom
subscriber.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre>import akka.actor.Actor
import xitrum.metrics.PublisherLookUp

class MySubscriber extends Actor with PublisherLookUp {
  override def preStart() {
    lookUpPublisher()
  }

  def receive = {
    case _ =&gt;
  }

  override def doWithPublisher(globalPublisher: ActorRef) = {
    context.become {
      // When run in multinode environment
      case multinodeMetrics: Set[NodeMetrics] =&gt;
        // Save to DB or write to file.

      // When run in single node environment
      case nodeMetrics: NodeMetrics =&gt;
        // Save to DB or write to file.

      case Publish(registryAsJson) =&gt;
        // Save to DB or write to file.

      case _ =&gt;
    }
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-howto"></span><div class="section" id="howto">
<h2>HOWTO<a class="headerlink" href="#howto" title="Permalink to this headline">¶</a></h2>
<p>This chapter contains various small tips. Each tip is too small to have its own
chapter.</p>
<div class="section" id="basic-authentication">
<h3>Basic authentication<a class="headerlink" href="#basic-authentication" title="Permalink to this headline">¶</a></h3>
<p>You can protect the whole site or just certain actions with
<a class="reference external" href="http://en.wikipedia.org/wiki/Basic_access_authentication">basic authentication</a>.</p>
<p>Note that Xitrum does not support
<a class="reference external" href="http://en.wikipedia.org/wiki/Digest_access_authentication">digest authentication</a>
because it provides a false sense of security. It is vulnerable to a man-in-the-middle attack.
For better security, you should use HTTPS, which Xitrum has built-in support
(no need for additional reverse proxy like Apache or Nginx just to add HTTPS support).</p>
<div class="section" id="config-basic-authentication-for-the-whole-site">
<h4>Config basic authentication for the whole site<a class="headerlink" href="#config-basic-authentication-for-the-whole-site" title="Permalink to this headline">¶</a></h4>
<p>In config/xitrum.conf:</p>
<div class="highlight-python"><div class="highlight"><pre>&quot;basicAuth&quot;: {
  &quot;realm&quot;:    &quot;xitrum&quot;,
  &quot;username&quot;: &quot;xitrum&quot;,
  &quot;password&quot;: &quot;xitrum&quot;
}
</pre></div>
</div>
</div>
<div class="section" id="add-basic-authentication-to-an-action">
<h4>Add basic authentication to an action<a class="headerlink" href="#add-basic-authentication-to-an-action" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.Action

class MyAction extends Action {
  beforeFilter {
    basicAuth(&quot;Realm&quot;) { (username, password) =&gt;
      username == &quot;username&quot; &amp;&amp; password == &quot;password&quot;
    }
  }
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="load-config-files">
<h3>Load config files<a class="headerlink" href="#load-config-files" title="Permalink to this headline">¶</a></h3>
<div class="section" id="json-file">
<h4>JSON file<a class="headerlink" href="#json-file" title="Permalink to this headline">¶</a></h4>
<p>JSON is neat for config files that need nested structures.</p>
<p>Save your own config files in &#8220;config&#8221; directory. This directory is put into
classpath in development mode by build.sbt and in production mode by script/runner (and script/runner.bat).</p>
<p>myconfig.json:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="s">&quot;username&quot;</span><span class="p">:</span> <span class="s">&quot;God&quot;</span><span class="p">,</span>
  <span class="s">&quot;password&quot;</span><span class="p">:</span> <span class="s">&quot;Does God need a password?&quot;</span><span class="p">,</span>
  <span class="s">&quot;children&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;Adam&quot;</span><span class="p">,</span> <span class="s">&quot;Eva&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Load it:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.util.Loader

case class MyConfig(username: String, password: String, children: Seq[String])
val myConfig = Loader.jsonFromClasspath[MyConfig](&quot;myconfig.json&quot;)
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li>Keys and strings must be quoted with double quotes</li>
<li>Currently, you cannot write comment in JSON file</li>
</ul>
</div>
<div class="section" id="properties-file">
<h4>Properties file<a class="headerlink" href="#properties-file" title="Permalink to this headline">¶</a></h4>
<p>You can also use properties files, but you should use JSON whenever possible
because it&#8217;s much better. Properties files are not typesafe, do not support UTF-8
and nested structures etc.</p>
<p>myconfig.properties:</p>
<div class="highlight-python"><div class="highlight"><pre>username = God
password = Does God need a password?
children = Adam, Eva
</pre></div>
</div>
<p>Load it:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.util.Loader

// Here you get an instance of java.util.Properties
val properties = Loader.propertiesFromClasspath(&quot;myconfig.properties&quot;)
</pre></div>
</div>
</div>
<div class="section" id="typesafe-config-file">
<h4>Typesafe config file<a class="headerlink" href="#typesafe-config-file" title="Permalink to this headline">¶</a></h4>
<p>Xitrum also includes Akka, which includes the
<a class="reference external" href="https://github.com/typesafehub/config">config library</a> created by the
<a class="reference external" href="http://typesafe.com/company">company called Typesafe</a>.
It may be a better way to load config files.</p>
<p>myconfig.conf:</p>
<div class="highlight-python"><div class="highlight"><pre>username = God
password = Does God need a password?
children = [&quot;Adam&quot;, &quot;Eva&quot;]
</pre></div>
</div>
<p>Load it:</p>
<div class="highlight-python"><div class="highlight"><pre>import com.typesafe.config.{Config, ConfigFactory}

val config   = ConfigFactory.load(&quot;myconfig.conf&quot;)
val username = config.getString(&quot;username&quot;)
val password = config.getString(&quot;password&quot;)
val children = config.getStringList(&quot;children&quot;)
</pre></div>
</div>
</div>
</div>
<div class="section" id="serialize-and-deserialize">
<h3>Serialize and deserialize<a class="headerlink" href="#serialize-and-deserialize" title="Permalink to this headline">¶</a></h3>
<p>To serialize to <code class="docutils literal"><span class="pre">Array[Byte]</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.util.SeriDeseri
val bytes = SeriDeseri.toBytes(&quot;my serializable object&quot;)
</pre></div>
</div>
<p>To deserialize bytes back:</p>
<div class="highlight-python"><div class="highlight"><pre>val option = SeriDeseri.fromBytes[MyType](bytes)  // Option[MyType]
</pre></div>
</div>
<p>If you want to save to file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">xitrum.util.Loader</span>
<span class="n">Loader</span><span class="o">.</span><span class="n">bytesToFile</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="s">&quot;myObject.bin&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To load from the file:</p>
<div class="highlight-python"><div class="highlight"><pre>val bytes = Loader.bytesFromFile(&quot;myObject.bin&quot;)
</pre></div>
</div>
</div>
<div class="section" id="encrypt-data">
<h3>Encrypt data<a class="headerlink" href="#encrypt-data" title="Permalink to this headline">¶</a></h3>
<p>To encrypt data that you don&#8217;t need to decrypt later (one way encryption),
you can use MD5 or something like that.</p>
<p>If you want to decrypt later, you can use the utility Xitrum provides:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.util.Secure

// Array[Byte]
val encrypted = Secure.encrypt(&quot;my data&quot;.getBytes)

// Option[Array[Byte]]
val decrypted = Secure.decrypt(encrypted)
</pre></div>
</div>
<p>You can use <code class="docutils literal"><span class="pre">xitrum.util.UrlSafeBase64</span></code> to encode and decode the binary data to
normal string (to embed to HTML for response etc.).</p>
<div class="highlight-python"><div class="highlight"><pre>// String that can be included in URL, cookie etc.
val string = UrlSafeBase64.noPaddingEncode(encrypted)

// Option[Array[Byte]]
val encrypted2 = UrlSafeBase64.autoPaddingDecode(string)
</pre></div>
</div>
<p>If you can combine the above operations in one step:</p>
<div class="highlight-python"><div class="highlight"><pre>import xitrum.util.SeriDeseri

val mySerializableObject = new MySerializableClass

// String
val encrypted = SeriDeseri.toSecureUrlSafeBase64(mySerializableObject)

// Option[MySerializableClass]
val decrypted = SeriDeseri.fromSecureUrlSafeBase64[MySerializableClass](encrypted)
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">SeriDeseri</span></code> uses <a class="reference external" href="https://github.com/twitter/chill">Twitter Chill</a>
to serialize and deserialize. Your data must be serializable.</p>
<p>You can specify a key for encryption.</p>
<div class="highlight-python"><div class="highlight"><pre>val encrypted = Secure.encrypt(&quot;my data&quot;.getBytes, &quot;my key&quot;)
val decrypted = Secure.decrypt(encrypted, &quot;my key&quot;)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>val encrypted = SeriDeseri.toSecureUrlSafeBase64(mySerializableObject, &quot;my key&quot;)
val decrypted = SeriDeseri.fromSecureUrlSafeBase64[MySerializableClass](encrypted, &quot;my key&quot;)
</pre></div>
</div>
<p>If no key is specified, <code class="docutils literal"><span class="pre">secureKey</span></code> in xitrum.conf file in config directory
will be used.</p>
</div>
<div class="section" id="multiple-sites-at-the-same-domain-name">
<h3>Multiple sites at the same domain name<a class="headerlink" href="#multiple-sites-at-the-same-domain-name" title="Permalink to this headline">¶</a></h3>
<p>If you want to use a reverse proxy like Nginx to run multiple different sites
at the same domain name:</p>
<div class="highlight-python"><div class="highlight"><pre>http://example.com/site1/...
http://example.com/site2/...
</pre></div>
</div>
<p>You can config baseUrl in config/xitrum.conf.</p>
<p>In your JS code, to have the correct URLs for Ajax requests, use <code class="docutils literal"><span class="pre">withBaseUrl</span></code>
in <a class="reference external" href="https://github.com/xitrum-framework/xitrum/blob/master/src/main/scala/xitrum/js.scala">xitrum.js</a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># If the current site&#39;s baseUrl is &quot;site1&quot;, the result will be:</span>
<span class="c"># /site1/path/to/my/action</span>
<span class="n">xitrum</span><span class="o">.</span><span class="n">withBaseUrl</span><span class="p">(</span><span class="s">&#39;/path/to/my/action&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="convert-markdown-text-to-html">
<h3>Convert Markdown text to HTML<a class="headerlink" href="#convert-markdown-text-to-html" title="Permalink to this headline">¶</a></h3>
<p>If you have already configured your project to use <a class="reference internal" href="index.html#document-template_engines"><em>Scalate template engine</em></a>,
you only have to do like this:</p>
<div class="highlight-python"><div class="highlight"><pre>import org.fusesource.scalamd.Markdown
val html = Markdown(&quot;input&quot;)
</pre></div>
</div>
<p>Otherwise, you need to add this dependency to your project&#8217;s build.sbt:</p>
<div class="highlight-python"><div class="highlight"><pre>libraryDependencies += &quot;org.fusesource.scalamd&quot; %% &quot;scalamd&quot; % &quot;1.6&quot;
</pre></div>
</div>
</div>
<div class="section" id="monitor-file-change">
<h3>Monitor file change<a class="headerlink" href="#monitor-file-change" title="Permalink to this headline">¶</a></h3>
<p>You can register callback(s) for
<a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/nio/file/StandardWatchEventKinds.html">StandardWatchEventKinds</a>
on files or directories.</p>
<div class="highlight-python"><div class="highlight"><pre>import java.nio.file.Paths
import xitrum.util.FileMonitor

val target = Paths.get(&quot;absolute_path_or_path_relative_to_application_directory&quot;).toAbsolutePath
FileMonitor.monitor(FileMonitor.MODIFY, target, { path =&gt;
  // Do some callback with path
  println(s&quot;File modified: $path&quot;)

  // And stop monitoring if necessary
  FileMonitor.unmonitor(FileMonitor.MODIFY, target)
})
</pre></div>
</div>
<p>Under the hood, <code class="docutils literal"><span class="pre">FileMonitor</span></code> uses
<a class="reference external" href="https://github.com/lloydmeta/schwatcher">Schwatcher</a>.</p>
</div>
<div class="section" id="temporary-directory">
<h3>Temporary directory<a class="headerlink" href="#temporary-directory" title="Permalink to this headline">¶</a></h3>
<p>Xitrum projects by default (see <code class="docutils literal"><span class="pre">tmpDir</span></code> in xitrum.conf) uses <code class="docutils literal"><span class="pre">tmp</span></code> directory
in the current working directory to save Scalate generated .scala files, big
upload files etc.</p>
<p>To get path to that directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">xitrum</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">xitrum</span><span class="o">.</span><span class="n">tmpDir</span><span class="o">.</span><span class="n">getAbsolutePath</span>
</pre></div>
</div>
<p>To create a new file or directory in that directory:</p>
<div class="highlight-python"><div class="highlight"><pre>val file = new java.io.File(xitrum.Config.xitrum.tmpDir, &quot;myfile&quot;)

val dir = new java.io.File(xitrum.Config.xitrum.tmpDir, &quot;mydir&quot;)
dir.mkdirs()
</pre></div>
</div>
</div>
<div class="section" id="stream-videos">
<h3>Stream videos<a class="headerlink" href="#stream-videos" title="Permalink to this headline">¶</a></h3>
<p>There are many ways to stream videos. One easy way:</p>
<ul class="simple">
<li>Serve interleaved .mp4 video files, so that users can play the videos while
downloading.</li>
<li>And use a HTTP server like Xitrum that supports
<a class="reference external" href="http://en.wikipedia.org/wiki/Byte_serving">range requests</a>, so that users
can skip to a movie position that has not been downloaded.</li>
</ul>
<p>You can use <a class="reference external" href="http://gpac.wp.mines-telecom.fr/mp4box/">MP4Box</a> to interleave
movie file data by chunks of 500 milliseconds:</p>
<div class="highlight-python"><div class="highlight"><pre>MP4Box -inter 500 movie.mp4
</pre></div>
</div>
</div>
</div>
<span id="document-deps"></span><div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dependency-libraries">
<h3>Dependency libraries<a class="headerlink" href="#dependency-libraries" title="Permalink to this headline">¶</a></h3>
<p>Xitrum includes some libraries. In your Xitrum project, you can use them
directly if you want.</p>
<img alt="_images/deps.png" src="_images/deps.png" />
<p>Main dependencies:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.scala-lang.org/">Scala</a>:
Xitrum is written in Scala language.</li>
<li><a class="reference external" href="https://netty.io/">Netty</a>:
For async HTTP(S) server. Many features in Xitrum are based on those in Netty,
like WebSocket and zero copy file serving.</li>
<li><a class="reference external" href="http://akka.io/">Akka</a>:
For SockJS. Akka depends on <a class="reference external" href="https://github.com/typesafehub/config">Typesafe Config</a>,
which is also used by Xitrum.</li>
</ul>
<p>Other dependencies:</p>
<ul class="simple">
<li><a class="reference external" href="http://commons.apache.org/lang/">Commons Lang</a>:
For escaping JSON data.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/glokka">Glokka</a>:
For clustering SockJS actors.</li>
<li><a class="reference external" href="https://github.com/json4s/json4s">JSON4S</a>:
For parsing and generating JSON data. JSON4S depends on
<a class="reference external" href="http://paranamer.codehaus.org/">Paranamer</a>.</li>
<li><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Rhino">Rhino</a>:
For Scalate to compile CoffeeScript to JavaScript.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/sclasner">Sclasner</a>:
For scanning HTTP routes in action classes in .class and .jar files.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/scaposer">Scaposer</a>:
For i18n.</li>
<li><a class="reference external" href="https://github.com/twitter/chill">Twitter Chill</a>:
For serializing and deserializing cookies and sessions.
Chill is based on <a class="reference external" href="http://code.google.com/p/kryo/">Kryo</a>.</li>
<li><a class="reference external" href="http://slf4s.org/">SLF4S</a>, <a class="reference external" href="http://logback.qos.ch/">Logback</a>:
For logging.</li>
</ul>
<p><a class="reference external" href="https://github.com/xitrum-framework/xitrum-new">Xitrum new project skeleton</a>
includes these tools:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/xitrum-framework/scala-xgettext">scala-xgettext</a>:
For <a class="reference internal" href="index.html#document-i18n"><em>extracting i18n strings</em></a> from your .scala files when you compile them.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/xitrum-package">xitrum-package</a>:
For <a class="reference internal" href="index.html#document-deploy"><em>packaging your project</em></a>, ready to deploy to production server.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/scalive">Scalive</a>:
For connecting a Scala console to a running JVM process for live debugging.</li>
</ul>
</div>
<div class="section" id="related-projects">
<h3>Related projects<a class="headerlink" href="#related-projects" title="Permalink to this headline">¶</a></h3>
<p>Demos:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/xitrum-framework/xitrum-new">xitrum-new</a>:
Xitrum new project skeleton.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/xitrum-demos">xitrum-demos</a>:
Demos features in Xitrum.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/xitrum-placeholder">xitrum-placeholder</a>:
Demos APIs that return images.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/comy">comy</a>:
Demos a simple URL shortening service.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/xitrum-multimodule-demo">xitrum-multimodule-demo</a>:
Example about creating multimodule <a class="reference external" href="http://www.scala-sbt.org/">SBT</a> project.</li>
</ul>
<p>Plugins:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/xitrum-framework/xitrum-scalate">xitrum-scalate</a>:
This is the default template engine in Xitrum, preconfigured in
<a class="reference external" href="https://github.com/xitrum-framework/xitrum-new">Xitrum new project skeleton</a>.
You can replace it with other template engines, or totally remove it if your
project doesn&#8217;t need any template engine. It depends on
<a class="reference external" href="http://scalate.fusesource.org/">Scalate</a> and
<a class="reference external" href="https://github.com/chirino/scalamd">Scalamd</a>.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/xitrum-hazelcast">xitrum-hazelcast</a>:
For clustering cache and server side sessions.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/xitrum-ko">xitrum-ko</a>:
Provides some convenient helpers for <a class="reference external" href="http://knockoutjs.com/">Knockoutjs</a>.</li>
</ul>
<p>Other projects:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/xitrum-framework/xitrum-doc">xitrum-doc</a>:
Source code of the <a class="reference external" href="http://xitrum-framework.github.io/guide.html">Xitrum Guide</a>.</li>
<li><a class="reference external" href="https://github.com/xitrum-framework/xitrum-framework.github.io">xitrum-hp</a>:
Source code of the <a class="reference external" href="http://xitrum-framework.github.io/">Xitrum Homepage</a>.</li>
</ul>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html#document-index">Table Of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#contributors">Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tutorial">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#create-a-new-empty-xitrum-project">Create a new empty Xitrum project</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#run">Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#import-the-project-to-eclipse">Import the project to Eclipse</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#import-the-project-to-intellij">Import the project to IntelliJ</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#autoreload">Autoreload</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#run-with-ides">Run with IDEs</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#run-with-sbt">Run with SBT</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#dcevm">DCEVM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ignore-files">Ignore files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-action_view">Action and view</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#normal-action">Normal action</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#futureaction">FutureAction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#actor-action">Actor action</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#respond-to-client">Respond to client</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#respond-template-view-file">Respond template view file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#type-casting-currentaction">Type casting currentAction</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id1">Mustache</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#coffeescript">CoffeeScript</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#layout">Layout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#layout-without-separate-file">Layout without separate file</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#pass-layout-directly-to-respondview">Pass layout directly to respondView</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#inline-view">Inline view</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#render-fragment">Render fragment</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#respond-view-of-other-action">Respond view of other action</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#one-action-multiple-views">One action - multiple views</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#component">Component</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-restful">RESTful APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#route-cache">Route cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#route-order-with-first-and-last">Route order with first and last</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#multiple-paths-for-one-action">Multiple paths for one action</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#dot-in-route">Dot in route</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#regex-in-route">Regex in route</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#catch-the-rest-of-path">Catch the rest of path</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#link-to-an-action">Link to an action</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#redirect-to-another-action">Redirect to another action</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#forward-to-another-action">Forward to another action</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#determine-is-the-request-is-ajax-request">Determine is the request is Ajax request</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#anti-csrf">Anti-CSRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#anticsrfinput-and-anticsrftoken">antiCsrfInput and antiCsrfToken</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#skipcsrfcheck">SkipCsrfCheck</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#manipulate-collected-routes">Manipulate collected routes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#getting-entire-request-content">Getting entire request content</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#documenting-api-with-swagger">Documenting API with Swagger</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-template_engines">Template engines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#config-template-engine">Config template engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#remove-template-engine">Remove template engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#create-your-own-template-engine">Create your own template engine</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-postback">Postbacks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#layout">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#form">Form</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#non-form">Non-form</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#confirmation-dialog">Confirmation dialog</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#extra-params">Extra params</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#display-animation-image-while-ajax-is-loading">Display animation image while Ajax is loading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-xml">XML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#unescape-xml">Unescape XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#group-xml-elements">Group XML elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#render-xhtml">Render XHTML</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-js">JavaScript and JSON</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#javascript">JavaScript</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#add-javascript-fragments-to-view">Add JavaScript fragments to view</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#respond-javascript-directly-without-view">Respond JavaScript directly without view</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#json">JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#plugin-for-knockout-js">Plugin for Knockout.js</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-async">Async response</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#websocket">WebSocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sockjs">SockJS</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#chunked-response">Chunked response</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#forever-iframe">Forever iframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#event-source">Event Source</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-static">Static files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#serve-static-files-on-disk">Serve static files on disk</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#index-html-fallback">index.html fallback</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#and-500">404 and 500</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#serve-resource-files-in-classpath-with-webjars-convention">Serve resource files in classpath with WebJars convention</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#webjars">WebJars</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#save-resource-file-inside-jar-file-with-webjars-convention">Save resource file inside .jar file with WebJars convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#respond-a-file-in-classpath">Respond a file in classpath</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#client-side-cache-with-etag-and-max-age">Client side cache with ETag and max-age</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#gzip">GZIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#server-side-cache">Server side cache</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-flash">Serve flash socket policy file</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-scopes">Scopes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#request">Request</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#kinds-of-params">Kinds of params</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#accesing-params">Accesing params</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#at">&#8220;at&#8221;</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#atjson">&#8220;atJson&#8221;</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#requestvar">RequestVar</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#cookie">Cookie</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#allowed-characters-in-cookie">Allowed characters in cookie</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#session">Session</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#session-clear">session.clear()</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#sessionvar">SessionVar</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#session-stores">Session stores</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#client-side-session-store-vs-server-side-session-store">Client side session store vs Server side session store</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#object-vs-val">object vs. val</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-validation">Validation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#default-validators">Default validators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#write-custom-validators">Write custom validators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-upload">File upload</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#ajax-style-upload">Ajax style upload</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-filter">Action filters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#before-filters">Before filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#after-filters">After filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#around-filters">Around filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#execution-order-of-filters">Execution order of filters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cache">Server-side cache</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#cache-page-or-action">Cache page or action</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#cache-object">Cache object</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#remove-cache">Remove cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#config">Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-cache-works">How cache works</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xitrum-util-locallrucache">xitrum.util.LocalLruCache</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-i18n">I18n</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#write-internationalized-messages-in-source-code">Write internationalized messages in source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#extract-messages-to-pot-files">Extract messages to pot files</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#where-to-save-po-files">Where to save po files</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#set-language">Set language</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#validation-messages">Validation messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#plural-forms">Plural forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#date-and-number-format">Date and number format</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-log">Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#use-object-xitrum-log-directly">Use object xitrum.Log directly</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#use-trait-xitrum-log">Use trait xitrum.Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#don-t-have-to-check-log-level-before-logging">Don&#8217;t have to check log level before logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#config-log-level-log-output-file-etc">Config log level, log output file etc.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#log-to-fluentd">Log to Fluentd</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-deploy">Deploy to production server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#package-directory">Package directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#customize-xitrum-package">Customize xitrum-package</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#connect-a-scala-console-to-a-running-jvm-process">Connect a Scala console to a running JVM process</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#install-oracle-jdk-on-centos-or-ubuntu-manually">Install Oracle JDK on CentOS or Ubuntu manually</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#start-xitrum-in-production-mode-when-the-system-starts">Start Xitrum in production mode when the system starts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#set-up-port-forwarding">Set up port forwarding</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tune-linux-for-massive-connections">Tune Linux for massive connections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#increase-open-file-limit">Increase open file limit</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#tune-kernel">Tune kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#note-about-backlog">Note about backlog</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#haproxy-tips">HAProxy tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#nginx-tips">Nginx tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#deploy-to-heroku">Deploy to Heroku</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#sign-up-and-create-repository">Sign up and create repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#create-procfile">Create Procfile</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#change-port-setting">Change port setting</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#see-log-level">See log level</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#create-alias-for-xitrum-package">Create alias for <code class="docutils literal"><span class="pre">xitrum-package</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#push-to-heroku">Push to Heroku</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cluster">Clustering with Akka and Hazelcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-handler">Netty handlers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#netty-handler-architecture">Netty handler architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#custom-handlers">Custom handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xitrum-default-handlers">Xitrum default handlers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-metrics">Metrics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#collect-metrics">Collect metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#heap-memory-and-cpu">Heap memory and CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#action-metrics">Action metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#collect-your-custom-metrics">Collect your custom metrics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#publish-metrics">Publish metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#xitrum-default-viewer">Xitrum default viewer</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#jconsole-viewer">Jconsole viewer</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#display-metrics-with-custom-viewer">Display metrics with custom viewer</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#save-metrics">Save metrics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-howto">HOWTO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-authentication">Basic authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#config-basic-authentication-for-the-whole-site">Config basic authentication for the whole site</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#add-basic-authentication-to-an-action">Add basic authentication to an action</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#load-config-files">Load config files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#json-file">JSON file</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#properties-file">Properties file</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#typesafe-config-file">Typesafe config file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#serialize-and-deserialize">Serialize and deserialize</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#encrypt-data">Encrypt data</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#multiple-sites-at-the-same-domain-name">Multiple sites at the same domain name</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#convert-markdown-text-to-html">Convert Markdown text to HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#monitor-file-change">Monitor file change</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#temporary-directory">Temporary directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#stream-videos">Stream videos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-deps">Dependencies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#dependency-libraries">Dependency libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#related-projects">Related projects</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">Xitrum Scala Web Framework Guide 3.27.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Ngoc Dao.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>